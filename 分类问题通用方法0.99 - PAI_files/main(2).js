define("../experiment/global/utils",["zero/zero"],function(a){"use strict";var b=a.each,c={toInt:function(a){return parseInt(a,10)},toString:function(a){return""+a},toFixed:function(a,b){var c=Math.pow(10,b);return(Math.round(a*c)/c).toFixed(b)},toFixedNumber:function(a,b){var d=Math.pow(10,b);return c.accDiv(Math.round(a*d),d)},toWeakFixed:function(a,b){var d=a.toString(),e=0;try{e=d.split(".")[1].length}catch(a){}return e>b&&(a=c.toFixedNumber(a,b)),a},lcFirst:function(a){return a+="",a.charAt(0).toLowerCase()+a.substr(1)},ucFirst:function(a){return a+="",a.charAt(0).toUpperCase()+a.substr(1)},padLeft:function(a,b,c){for(a=""+a,c=c||" ";a.length<b;)a=c+a;return a},formatDate:function(a){if(a){a instanceof Date||(a=new Date(a));var b=function(a){return c.padLeft(a,2,"0")};return b(a.getFullYear(),2,"0")+"-"+b(a.getMonth()+1,2,"0")+"-"+b(a.getDate(),2,"0")+" "+b(a.getHours(),2,"0")+":"+b(a.getMinutes(),2,"0")}},getTextWidth:function(a){var b=$("<div />").css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","white-space":"nowrap"}).appendTo(document.body).text(a),c=b.outerWidth();return b.remove(),c},getMaxTextWidth:function(a){var b=$("<div />").css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","white-space":"nowrap"}).appendTo(document.body),c=[];return a.forEach(function(a){b.text(a),c.push(b.outerWidth())}),b.remove(),Math.max.apply(null,c)},runIfIsFunction:function(b,c,d){c=c||null,d=d||[],a.isFunction(b)&&b.apply(c,d)},getCookie:function(b,c){var d=a.getAny([function(){return document.cookie}]),e=b+"=";if(d){var f,g,h,i=d.split(";"),j=i.length;for(f=0;f<j;f++){for(g=i[f];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(e))return h=g.substring(e.length,g.length),c?encodeURIComponent(h):h}}return null},cleanupParams:function(b){var c={};return a.each(b,function(a,b){""!==a&&(c[b]=a)}),c},getBoundingClientRect:function(a){var c=a.getBoundingClientRect(),d={};return b(["bottom","height","left","right","top","width"],function(a){d[a]=c[a]}),d},disableCopy:function(a){$(a).attr("unselectable","on").css({"-moz-user-select":"-moz-none","-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).on("contextmenu",function(){return!1}).on("dragstart",function(){return!1}).on("selectstart",function(){return!1}).on("beforecopy",function(){return!1}).on("select",function(){document.selection.empty()}).on("copy",function(){document.selection.empty()}).attr("tabindex",1).on("keydown",function(a){if(a.metaKey&&["a","c"].some(function(b){return a.key===b}))return!1})},getURLArg:function(b,c){var d,e=(""+b).split("?")[1]||"";return a.some(e.split("&"),function(a){var b=a.split("=");if(b[0]===c)return d=b[1],!0}),d||""},changeURLArg:function(a,b,c){var d,e=/#.*$/,f=a.match(e);f&&(d=f[0],a=a.replace(e,""));var g,h=b+"=[^&]*",i=b+"="+c;return g=a.match(h)?a.replace(new RegExp(h,"ig"),i):a.match("[?]")?a+"&"+i:a+"?"+i,d&&(g+=d),g},deleteURLArg:function(a,b){var c="[&]"+b+"=[^&#]*",d=a.split("?"),e="&"+d[1];return e.match(c)&&(e=e.replace(new RegExp(c,"ig"),""),d[1]=e.substr(1)),d.join("?")},pushState:function(){var b=a.toArray(arguments),c=a.isPlainObject(b[0])?b.shift():null,d=b.length>1?b.shift():null,e=b[0];try{history.pushState(c,d,e)}catch(a){}},numberToLetter:function(a){var b,c,d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e=[],f="";do{b=a%26,c=b>0?b:26,e.push(d[c-1]),a-=c,a/=26}while(a>0);for(var g=e.length-1,h=0;g>=h;g--)f+=e[g];return f},letterToNumber:function(a){var b=0,c="a".charCodeAt();a=a.toLowerCase();for(var d=0,e=a.length;d<e;d++)b+=(a.charCodeAt(d)-c+1)*Math.pow(26,e-d-1);return b},accDiv:function(a,b){var c=a.toString(),d=b.toString(),e=0;try{e=d.split(".")[1].length}catch(a){}try{e-=c.split(".")[1].length}catch(a){}return(c.replace(".","")-0)/(d.replace(".","")-0)*Math.pow(10,e)},accMul:function(a,b){var c=a.toString(),d=b.toString(),e=0;try{e+=c.split(".")[1].length}catch(a){}try{e+=d.split(".")[1].length}catch(a){}return(c.replace(".","")-0)*(d.replace(".","")-0)/Math.pow(10,e)},accAdd:function(a,b){var c=0,d=0;try{c=a.toString().split(".")[1].length}catch(a){}try{d=b.toString().split(".")[1].length}catch(a){}var e=Math.pow(10,Math.max(c,d));return(Math.round(a*e)+Math.round(b*e))/e},accSub:function(a,b){return accAdd(a,-b)},JSONFormat:function(){var a=[],b=function(b){return"\\"+a.push(b)+"\\"},c=function(b,c){return a[c-1]},d=function(a){return new Array(a+1).join("\t")};return function(e){a=[];var f="",g=0;e=e.replace(/\\./g,b).replace(/(".*?"|'.*?')/g,b).replace(/\s+/,"");for(var h=0;h<e.length;h++){var i=e.charAt(h);switch(i){case"{":case"[":f+=i+"\n"+d(++g);break;case"}":case"]":f+="\n"+d(--g)+i;break;case",":f+=",\n"+d(g);break;case":":f+=": ";break;default:f+=i}}return f=f.replace(/\[[\d,\s]+?\]/g,function(a){return a.replace(/\s/g,"")}).replace(/\\(\d+)\\/g,c).replace(/\\(\d+)\\/g,c)}}(),track:function(a){return function(b,c){try{if(window.Tracert){var d=a?a+"."+b:b,e=c||{};window._to&&window._to.mdata&&(e.expId=window._to.mdata.expId),window.Tracert.call("click",d,e)}}catch(a){console.warn(a)}}},log:function(a,b){try{if(window.Tracert){var c=b||{};window._to&&window._to.mdata&&(c.expId=window._to.mdata.expId),window.Tracert.call("click",a,c)}}catch(a){console.warn(a)}}};return c}),define("../experiment/storage/persistence",["zero/zero","zero/json"],function(a,b){"use strict";var c=a.getAny([function(){return window.localStorage},function(){return window.sessionStorage},function(){return{}}]);return{raw:c,keys:{canvasStatus:"canvas-status",currentLang:"current-lang",currentProject:"current-project",experimentFoldPath:"experiment-fold-path",componentFoldPath:"component-fold-path",modelFoldPath:"model-fold-path",activeHomeDate:"active-home-date",activeToolboxIndex:"active-toolbox-index",activeExperimentId:"workspace-active-experiment-id",loadExperimentDagBenchmark:"load-experiment-dag-benchmark",loadExperimentXmlBenchmark:"load-experiment-xml-benchmark",nodeClipboardData:"node-clipboard-data",systemNotify:"system-notify",hideDeployGuide:"hide-deploy-guide",hideBenchmarkGuide:"hide-benchmark-guide"},get:function(a){return c[a]||null},set:function(a,b){c[a]=b},getInt:function(b,c){var d=this.get(b);return null===d?c:a.toInt(d)},getBoolean:function(a,b){var c=this.get(a);return null===c?b:"true"===c},setObject:function(a,d){c[a]=b.stringify(d)},getObject:function(a){var c=this.get(a);if(null===c||""===c)return{};try{return b.parse(c)}catch(a){return{}}}}}),define("../experiment/global/checkRefresh",["zero/zero","../global/utils","../storage/persistence"],function(a,b,c){"use strict";var d=window.location.href,e=b.getURLArg(d,"Lang"),f=c.get(c.keys.currentLang),g="",h=!1;!e&&f&&f!==window.USER_LOCALE&&(g=b.changeURLArg(g||d,"Lang",f),h=!0),c.set(c.keys.currentLang,window.USER_LOCALE),h&&g&&(window.location.href=g)}),function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("zero",[],b):"object"==typeof exports?exports.zero=b():a.zero=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="/dist/",b(0)}([function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}Object.defineProperty(b,"__esModule",{value:!0}),b.Events=b.utils=void 0;var f=c(8);Object.keys(f).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return f[a]}})}),c(25);var g=c(10),h=e(g),i=c(18),j=d(i);b.utils=h,b.Events=j.default},,,,,,,,function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.Popup=b.Transition=b.ComponentCollection=b.Component=void 0;var e=c(9),f=d(e),g=c(19),h=d(g),i=c(20),j=d(i),k=c(23),l=d(k);b.Component=f.default,b.ComponentCollection=h.default,b.Transition=j.default,b.Popup=l.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(){return s++}function j(a,b,c){return m.isObject(b)?$.extend(!0,a,b):m.isUndefined(c)?a[b]:void(a[b]=c)}Object.defineProperty(b,"__esModule",{value:!0});var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=c(10),m=e(l),n=c(18),o=d(n),p=c(19),q=d(p),r={},s=0,t=function(a){function b(a){f(this,b);var c=g(this,Object.getPrototypeOf(b).call(this));return c.setting(a),c.id=i(),c.eventNS="."+c.options.namespace+"-"+c.id,c.ensureElement(),c.stamp(),c}return h(b,a),k(b,null,[{key:"setDefaults",value:function(a,b){return this.defaults||(this.defaults={}),j(this.defaults,a,b)}},{key:"getInstanceById",value:function(a){return r[a]}},{key:"initialize",value:function(a){var b=this,c=[];return 1===$(a.element).each(function(){var d=this,e=$.extend(!0,{},a,{element:d}),f=new b(e);c.push(f)}).length?c[0]:new q.default(c)}}]),k(b,[{key:"setting",value:function(a,b){if(this.options||(this.options={}),!m.isObject(a))return j(this.options,a,b);$.extend(!0,this.options,this.constructor.defaults,a)}},{key:"ensureElement",value:function(){this.$elem=$(this.options.element),this.element=this.$elem[0],this.element||this.error(this.errors.invalidElement)}},{key:"stamp",value:function(){this.$elem.data(this.options.namespace,this.id),r[this.id]=this}},{key:"destroy",value:function(){this.$elem.off(this.eventNS).removeData(this.options.namespace),this.off();for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.destroy=function(){},delete r[this.id]}},{key:"error",value:function(){var a=console.error;m.bind(a,console,this.options.namespace+":").apply(console,arguments)}},{key:"getAttrData",value:function(a,b){var c="data-"+this.metadata[a],d=b?$(b):this.$elem;return d&&d.attr&&d.attr(c)}},{key:"getOption",value:function(a,b){return this.getAttrData(a,b)||this.options[a]}},{key:"invoke",value:function(a){if(a){var b=this[a];m.isFunction(b)||this.error(this.errors.unknownMethod,a);var c=m.slice(arguments,1);return m.invoke(b,c,this)}}},{key:"triggerCallback",value:function(a){var b=!0;if(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b=!1!==m.invoke(this.trigger,d,this)&&b;var f="on"+m.ucFirst(a),g=this.options[f];m.isFunction(g)&&(b=!1!==m.invoke(g,d,this)&&b)}return b}},{key:"classNames",get:function(){return this.options.classNames}},{key:"selectors",get:function(){return this.options.selectors}},{key:"metadata",get:function(){return this.options&&this.options.metadata||{}}},{key:"errors",get:function(){return this.options.errors}}]),b}(o.default);t.setDefaults({namespace:"ui-component",metadata:{},selectors:{},classNames:{},errors:{invalidElement:"Invalid element.",unknownMethod:"The method you called is not defined. Method name: "}}),$(window).unload(function(){m.forIn(r,function(a){a.destroy()})}),b.default=t},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(11);Object.keys(d).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return d[a]}})});var e=c(12);Object.keys(e).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return e[a]}})});var f=c(13);Object.keys(f).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return f[a]}})});var g=c(15);Object.keys(g).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return g[a]}})});var h=c(14);Object.keys(h).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return h[a]}})});var i=c(16);Object.keys(i).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return i[a]}})});var j=c(17);Object.keys(j).forEach(function(a){"default"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return j[a]}})}),b.default={}},function(a,b){"use strict";function c(a){return null===a}function d(a){return void 0===a}function e(a){return"string"==typeof a}function f(a){return"boolean"==typeof a}function g(a){return d(a)||c(a)}function h(a,b){return s.call(a)==="[object "+b+"]"}function i(a){if(!a)return!1;var b=void 0===a?"undefined":q(a);return"function"===b||"object"===b}function j(a){return a&&a===a.window}function k(a){return h(a,"Function")}function l(a){return Array.isArray(a)}function m(a){if(l(a))return!0;if(k(a)||j(a))return!1;var b=!!a&&"length"in a&&a.length;return 0===b||"number"==typeof b&&b>0&&b-1 in a}function n(a){return!l(a)&&a-parseFloat(a)+1>=0}function o(a){return!(!i(a)||a.nodeType||j(a))&&!(a.constructor&&!t.call(a.constructor.prototype,"isPrototypeOf"))}function p(a){for(var b in a)return!1;return!0}Object.defineProperty(b,"__esModule",{value:!0});var q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},r=Object.prototype,s=r.toString,t=r.hasOwnProperty;b.isNull=c,b.isType=h,b.isArray=l,b.isWindow=j,b.isObject=i,b.isString=e,b.isBoolean=f,b.isNumeric=n,b.isFunction=k,b.isArrayLike=m,b.isUndefined=d,b.isPlainObject=o,b.isEmptyObject=p,b.isNullOrUndefined=g},function(a,b,c){"use strict";function d(a){return(0,p.isArray)(a)?a:(0,p.isArrayLike)(a)?q.slice.call(a):[a]}function e(a,b){return a?q.indexOf.call(a,b):-1}function f(a,b){return a?q.lastIndexOf.call(a,b):-1}function g(a,b,c){return!!a&&q.every.call(a,b,c)}function h(a,b,c){return!!a&&q.some.call(a,b,c)}function i(a,b,c){a&&q.forEach.call(a,b,c)}function j(a,b,c){return a?q.map.call(a,b,c):[]}function k(a,b,c){return a?q.filter.call(a,b,c):[]}function l(a,b,c){return a?q.reduce.call(a,b,c):c}function m(a,b,c){return a?q.reduceRight.call(a,b,c):c}function n(a,b){return a&&e(a,b)>=0}function o(a,b,c){return a?q.slice.call(a,b,c):[]}Object.defineProperty(b,"__esModule",{value:!0}),b.contains=b.lastIndexOf=b.reduceRight=b.indexOf=b.toArray=b.forEach=b.reduce=b.filter=b.slice=b.every=b.some=b.map=void 0;var p=c(11),q=Array.prototype;b.map=j,b.some=h,b.every=g,b.slice=o,b.filter=k,b.reduce=l,b.forEach=i,b.toArray=d,b.indexOf=e,b.reduceRight=m,b.lastIndexOf=f,b.contains=n},function(a,b,c){"use strict";function d(a){return""+a}function e(a){return(""+a).toUpperCase()}function f(a){return a.charAt(0).toUpperCase()+a.substring(1)}function g(a){return(""+a).toLowerCase()}function h(a){return(""+a).split(arguments.length<=1||void 0===arguments[1]?/\s+/:arguments[1])}function i(a){return a?r.trim.call(""+a):""}function j(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function k(a){var b=0,c=a.length;if(0===c)return b;for(var d=0;d<c;d++){b=(b<<5)-b+a.charCodeAt(d),b&=b}return b}function l(a,b){return b=b||{},(""+a).replace(/\$\{(\w+)\}/g,function(a,c){var d=(0,q.getByPath)(b,c);return void 0!==d?d:a})}function m(a){return(a||"").replace(/ /g," ")}function n(a,b){return 0===(""+a).indexOf(b)}function o(a,b){return a=""+a,-1!==a.indexOf(b,a.length-b.length)}function p(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/[&<>"'`]/g;return/[&<>"'`]/.test(a)?a.replace(c,function(a){return b[a]}):a}Object.defineProperty(b,"__esModule",{value:!0}),b.ucFirst=b.format=b.escape=b.split=b.trim=b.uc=b.lc=b.toString=b.sanitizeText=b.endWith=b.startWith=b.hashCode=b.uuid=void 0;var q=c(14),r=String.prototype;b.uuid=j,b.hashCode=k,b.startWith=n,b.endWith=o,b.sanitizeText=m,b.toString=d,b.lc=g,b.uc=e,b.trim=i,b.split=h,b.escape=p,b.format=l,b.ucFirst=f},function(a,b,c){"use strict";function d(a,b){return null!==a&&Object.prototype.hasOwnProperty.call(a,b)}function e(a){return a?Object.keys(a):[]}function f(a,b,c){(0,k.forEach)(e(a),function(d){b.call(c,a[d],d)})}function g(a){a||(a={});for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];if(d)for(var e in d)a[e]=d[e]}return a}function h(a){a||(a={});for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];if(d)for(var e in d){var f=a[e],g=d[e],i=(0,l.isArray)(g);if(i||(0,l.isPlainObject)(g)){var j=void 0;j=i?f&&(0,l.isArray)(f)?f:[]:f&&(0,l.isPlainObject)(f)?f:{},a[e]=h(j,g)}else a[e]=g}}return a}function i(a,b,c){c=c||".";for(var d=b.split(c);d.length;){var e=d.shift();if(!(Object(a)===a&&e in a))return;a=a[e]}return a}function j(a){if(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];a&&(a.prototype=a.__proto__=null),a.destroyed=!0}}Object.defineProperty(b,"__esModule",{value:!0}),b.getByPath=b.destroy=b.extend=b.merge=b.forIn=b.keys=b.hasKey=void 0;var k=c(12),l=c(11);b.hasKey=d,b.keys=e,b.forIn=f,b.merge=h,b.extend=g,b.destroy=j,b.getByPath=i},function(a,b,c){"use strict";function d(a){return window.isFinite(a)&&!window.isNaN(parseFloat(a))}function e(a){return(0,k.isString)(a)&&"%"===a.slice(-1)}function f(a){return parseInt(a,10)}function g(a,b){var c=parseFloat(a);return b?c/100:c}function h(a,b){var c=Math.pow(10,b);return g((Math.round(a*c)/c).toFixed(b))}function i(a,b,c){var d=g(a,b);return isNaN(d)?c:d}function j(a,b){return(0,k.isNullOrUndefined)(a)?b:Math.min(a,b)}Object.defineProperty(b,"__esModule",{value:!0}),b.fixNumber=b.isPercentage=b.isFinite=b.fixIndex=b.toFixed=b.toFloat=b.toInt=void 0;var k=c(11);b.toInt=f,b.toFloat=g,b.toFixed=h,b.fixIndex=j,b.isFinite=d,b.isPercentage=e,b.fixNumber=i},function(a,b,c){"use strict";function d(a,b,c){var d=void 0;if((0,f.isFunction)(a)){var e=b.length,g=b[0],h=b[1],i=b[2];d=0===e?a.call(c):1===e?a.call(c,g):2===e?a.call(c,g,h):3===e?a.call(c,g,h,i):a.apply(c,b)}return d}function e(a){if((0,f.isFunction)(a)){var b=(0,g.slice)(arguments,1);return d(Function.prototype.bind,b,a)}return a}Object.defineProperty(b,"__esModule",{value:!0}),b.invoke=b.bind=void 0;var f=c(11),g=c(12);b.bind=e,b.invoke=d},function(a,b){"use strict";function c(a,b,c){var d=$(a),e=$(b),f=d.offset(),g=e.offset(),h=d.outerWidth(),i=d.outerHeight(),j=e.outerWidth(),k=e.outerHeight();if(c)return f.left<=g.left&&f.top<=g.top&&f.left+h>=g.left+j&&f.top+i>=g.top+k;var l=Math.max(f.left,g.left),m=Math.max(f.top,g.top),n=Math.min(f.left+h,g.left+j),o=Math.min(f.top+i,g.top+k);return l<=n&&m<=o}Object.defineProperty(b,"__esModule",{value:!0}),b.isContained=c},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b,c){for(var d=!0,e=0,f=a.length;e<f;e+=2)d=!1!==i.invoke(a[e],b,a[e+1]||c)&&d;return d}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(10),i=d(h),j=function(){function a(){e(this,a)}return g(a,[{key:"on",value:function(a,b,c){var d=this;if(!b)return d;var e=d.__events||(d.__events={});return i.forEach(i.split(a),function(a){(e[a]||(e[a]=[])).push(b,c)}),d}},{key:"once",value:function(a,b,c){var d=this,e=function e(){d.off(a,e),b.apply(c||d,arguments)};return d.on(a,e,c)}},{key:"off",value:function(a,b,c){var d=this,e=d.__events;return e?a||b||c?(a=a?i.split(a):i.keys(e),i.forEach(a,function(a){var d=e[a];if(d){if(!b&&!c)return void delete e[a];for(var f=d.length-2;f>=0;f-=2)b&&d[f]!==b||c&&d[f+1]!==c||d.splice(f,2)}}),d):(delete d.__events,d):d}},{key:"trigger",value:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=this,g=e.__events;if(!g||!a)return null;var h=!0,j=g["*"];return i.forEach(i.split(a),function(a){var b=void 0;"*"!==a&&(b=g[a])&&(h=f(b,c,e)&&h),j&&(h=f(j,[a].concat(c),e)&&h)}),h}}]),a}();b.default=j},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(10),h=d(g),i=function(){function a(b){e(this,a),this.instances=b||[]}return f(a,[{key:"invoke",value:function(){var a=[],b=arguments;return h.forEach(this.instances,function(c){var d=h.invoke(c.invoke,b,c);a.push(d)}),a}}]),a}();b.default=i},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)};c(21);var k=c(10),l=e(k),m=c(9),n=d(m),o=function(){var a=document.createElement("div").style,b={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var c in b)if(!l.isUndefined(a[c]))return b[c];return!1}(),p={},q=function(a){function b(a,c){f(this,b),c?c.element=a:c=$.isPlainObject(a)?a:{element:a};var d=g(this,Object.getPrototypeOf(b).call(this,c));return d.options.play&&d.start(),d}return h(b,a),i(b,null,[{key:"isSupported",value:function(){return!1!==o}},{key:"initialize",value:function(a,c){c?c.element=a:c=a;var d=j(Object.getPrototypeOf(b),"initialize",this).call(this,c);return d instanceof b||function(){var a=d.instances,b=a.length;l.forEach(a,function(a,c){a.batchCount=b,a.batchIndex=c})}(),d}}]),i(b,[{key:"start",value:function(a,b,c){var d=this.options;a&&(d.animation=a),(b||0===b)&&(d.duration=b),c&&(d.onComplete=c),d.interval?this.delay():this.restart()}},{key:"restart",value:function(){var a=arguments.length<=0||void 0===arguments[0]?this.options:arguments[0];if(!b.isSupported())return this.error(this.errors.unSupport),!1;var c=a.animation;if(this.isAnimating()){if(a.queue)return!a.repeat&&this.hasDirection()&&this.isOccurring()&&!this.isQueuing()||this.queue(c),!1;if(!a.repeat&&this.isOccurring())return!1;this.complete()}this.canAnimate()?this.play(c):this.error(this.errors.noAnimation,c,this.element)}},{key:"delay",value:function(){var a=arguments.length<=0||void 0===arguments[0]?this.options.interval:arguments[0],b=this.getDirectionInClass();b||(b=this.checkDirection()?this.getNextDirection():"static");var c=this.batchCount||1,d=this.batchIndex||0,e=this.options.reverse,f=!0===e||"auto"===e&&b===this.classNames.outward?(c-d)*a:d*a;setTimeout(l.bind(this.restart,this),f)}},{key:"play",value:function(){var a=arguments.length<=0||void 0===arguments[0]?this.options.animation:arguments[0];this.clearCompleteCallback();var b=this.getAnimationClass(a);this.cacheAnimationClass(b),this.forceVisible(),this.removeHidden(),this.removeDirection(),this.$elem.addClass(b).one(o+".complete"+this.eventNS,l.bind(this.complete,this)),this.options.safelyFail&&this.setupSafelyFail(),this.setDuration(this.options.duration),this.onStart()}},{key:"pause",value:function(){this.disable()}},{key:"resume",value:function(){this.enable()}},{key:"stop",value:function(a){a&&this.clearQueue(),this.$elem.triggerHandler(o)}},{key:"queue",value:function(){var a=this,b=$.extend(!0,{},a.options);a.queuing=!0,a.$elem.one(o+".queue"+this.eventNS,function(){a.queuing=!1,a.repaint(),a.restart.apply(a,b)})}},{key:"clearQueue",value:function(){this.clearQueueCallback()}},{key:"complete",value:function(){this.clearCompleteCallback(),this.clearSafelyFail(),this.isLooping()||(this.isOutward()?(this.restoreFromCache(),this.hide()):this.isInward()?(this.restoreFromCache(),this.show()):(this.restoreFromCache(),this.onComplete()))}},{key:"hide",value:function(){this.isAnimating()&&this.reset(),this.$elem.blur(),this.removeDisplay(),this.removeVisible(),this.setHidden(),this.forceHidden(),this.onHide(),this.onComplete()}},{key:"show",value:function(){this.removeHidden(),this.setVisible(),this.forceVisible(),this.onShow(),this.onComplete()}},{key:"toggle",value:function(){this.isVisible()?this.hide():this.show()}},{key:"enable",value:function(){this.$elem.removeClass(this.classNames.disabled)}},{key:"disable",value:function(){this.$elem.addClass(this.classNames.disabled)}},{key:"forceHidden",value:function(){var a=this.$elem;"none"===a.css("display")||this.isHidden()?a.attr("style")||a.removeAttr("style"):a.css("display","none")}},{key:"forceVisible",value:function(){var a=this.$elem,b=this.getDisplayType();if(a.css("display")!==b){var c=this.getInlineStyle(),d=c+" display: "+b+" !important;";a.attr("style",d)}else a.attr("style")||a.removeAttr("style")}},{key:"reset",value:function(){this.clearAnimationCallbacks(),this.restoreFromCache(),this.removeAnimating()}},{key:"refresh",value:function(){this.$elem.removeData(this.metadata.display)}},{key:"repaint",value:function(a){if(a){var b=this.$elem,c=b.next(),d=b.parent();0===c.length?b.detach().appendTo(d):b.detach().insertBefore(c)}else{this.element.offsetWidth}return this}},{key:"canAnimate",value:function(){return l.isBoolean(this.checkDirection())}},{key:"destroy",value:function(){this.isAnimating()&&this.complete(),j(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"restoreFromCache",value:function(){var a=this.getCachedAnimationClass();a&&this.$elem.removeClass(a),this.removeDuration()}},{key:"cacheAnimationClass",value:function(a){this.cache||(this.cache={}),this.cache.animation=a}},{key:"getCachedAnimationClass",value:function(){return this.cache&&this.cache.animation}},{key:"getAnimationClass",value:function(){var a=arguments.length<=0||void 0===arguments[0]?this.options.animation:arguments[0],b=this.checkDirection()&&!this.hasDirection()?this.getNextDirection()+" ":"";return this.classNames.transition+" "+this.classNames.animating+" "+b+a}},{key:"getInlineStyle",value:function(a){return a=a||this.$elem.attr("style")||"",a=a.replace(/display.*?;?/g,""),a=l.trim(a),l.endWith(a,";")||(a+=";"),a}},{key:"getDuration",value:function(){var a=arguments.length<=0||void 0===arguments[0]?this.options.duration:arguments[0];return!1===a&&(a=this.$elem.css("animation-duration")||0),l.isString(a)&&(a=l.lc(a),l.endWith(a,"s")&&!l.endWith(a,"ms"))?1e3*(l.toFloat(a)||0):l.toFloat(a)||0}},{key:"setDuration",value:function(){var a=arguments.length<=0||void 0===arguments[0]?this.options.duration:arguments[0],b="";(a||0===a)&&(a=this.getDuration(a),b=0===a?0:a>=1e3?a/1e3+"s":a+"ms"),this.$elem.css("animation-duration",b)}},{key:"removeDuration",value:function(){this.setDirection("")}},{key:"getDisplayType",value:function(){return this.getOption("display")||this.detectDisplayType()}},{key:"detectDisplayType",value:function(){var a=this.cloneElem(),b=this.$elem.attr("class"),c=this.classNames,d=a.attr("class",b).removeAttr("style").removeClass(c.hidden).removeClass(c.visible).show().css("display");return a.remove(),"none"!==d&&this.$elem.data(this.metadata.display,d),d}},{key:"checkDirection",value:function(){var a=this.options.animation,b=p[a],c=!l.isUndefined(b),d=!1,e=!1;if(!c){var f=this.cloneElem(),g=this.classNames,h=this.$elem.attr("class");f.context||f.appendTo(document.body).addClass(g.holding);var i=f.attr("class",h).addClass(a).removeClass(g.inward).removeClass(g.outward).addClass(g.transition).addClass(g.animating).css("animationName"),j=f.addClass(g.inward).css("animationName");f.remove(),i!==j?d=!0:"none"!==i&&i?d=!1:e=!0,e||(p[a]=d)}return c?b:e?void 0:d}},{key:"setDirection",value:function(){(arguments.length<=0||void 0===arguments[0]?this.getNextDirection():arguments[0])===this.classNames.inward?this.setInward():this.setOutward()}},{key:"removeDirection",value:function(){this.$elem.removeClass(this.classNames.inward).removeClass(this.classNames.outward)}},{key:"getCurrentDirection",value:function(){return this.isInward()?this.classNames.inward:this.classNames.outward}},{key:"getNextDirection",value:function(){return this.isHidden()||!this.isVisible()?this.classNames.inward:this.classNames.outward}},{key:"getDirectionInClass",value:function(){var a=this,b=arguments.length<=0||void 0===arguments[0]?this.options.animation:arguments[0],c="";return b&&function(){var d=a.classNames.inward,e=a.classNames.outward;l.some(l.split(b),function(a){return a===d?(c=d,!0):a===e?(c=e,!0):void 0})}(),c}},{key:"hasDirection",value:function(a){return""!==this.getDirectionInClass(a)}},{key:"setLooping",value:function(){this.$elem.addClass(this.classNames.looping)}},{key:"setHidden",value:function(){this.$elem.addClass(this.classNames.transition).addClass(this.classNames.hidden)}},{key:"setInward",value:function(){this.$elem.removeClass(this.classNames.outward).addClass(this.classNames.inward)}},{key:"setOutward",value:function(){this.$elem.removeClass(this.classNames.inward).addClass(this.classNames.outward)}},{key:"setVisible",value:function(){this.$elem.addClass(this.classNames.transition).addClass(this.classNames.visible)}},{key:"removeAnimating",value:function(){this.$elem.removeClass(this.classNames.animating)}},{key:"removeDisplay",value:function(){this.$elem.css("display","")}},{key:"removeHidden",value:function(){this.$elem.removeClass(this.classNames.hidden)}},{key:"removeVisible",value:function(){this.$elem.removeClass(this.classNames.visible)}},{key:"removeLooping",value:function(){this.isLooping()&&(this.reset(),this.$elem.removeClass(this.classNames.looping))}},{key:"removeTransition",value:function(){this.$elem.removeClass(this.classNames.visible).removeClass(this.classNames.hidden)}},{key:"isOccurring",value:function(){
var a=arguments.length<=0||void 0===arguments[0]?this.options.animation:arguments[0];return a="."+a.replace(/\s+/g,"."),this.$elem.filter(a).length>0}},{key:"isAnimating",value:function(){return this.$elem.hasClass(this.classNames.animating)}},{key:"isLooping",value:function(){return this.$elem.hasClass(this.classNames.looping)}},{key:"isQueuing",value:function(){return!0!==this.queuing}},{key:"isVisible",value:function(){return this.$elem.is(":visible")}},{key:"isHidden",value:function(){return"hidden"===this.$elem.css("visibility")}},{key:"isInward",value:function(){return this.$elem.hasClass(this.classNames.inward)}},{key:"isOutward",value:function(){return this.$elem.hasClass(this.classNames.outward)}},{key:"clearAnimationCallbacks",value:function(){this.clearQueueCallback(),this.clearCompleteCallback()}},{key:"clearQueueCallback",value:function(){this.$elem.off(".queue"+this.eventNS)}},{key:"clearCompleteCallback",value:function(){this.$elem.off(".complete"+this.eventNS)}},{key:"clearSafelyFail",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=0)}},{key:"setupSafelyFail",value:function(){var a=this,b=a.getDuration();a.timer=setTimeout(function(){a.$elem&&a.$elem.triggerHandler(o)},b+a.options.safelyFailDelay)}},{key:"onShow",value:function(){this.triggerCallback("show")}},{key:"onHide",value:function(){this.triggerCallback("hide")}},{key:"onStart",value:function(){this.triggerCallback("start")}},{key:"onComplete",value:function(){this.triggerCallback("complete")}},{key:"cloneElem",value:function(){var a=this.$elem.prop("tagName");return $("<"+a+" />").insertAfter(this.$elem)}}]),b}(n.default);q.version="0.0.1",q.setDefaults({namespace:"ui-transition",animation:"fade",duration:!1,play:!0,queue:!0,repeat:!1,displayType:!1,safelyFail:!0,safelyFailDelay:100,interval:0,reverse:"auto",onShow:null,onHide:null,onStart:null,onComplete:null,metadata:{display:"display"},classNames:{transition:"ui-transition",animating:"animating",disabled:"disabled",holding:"holding",looping:"looping",visible:"visible",hidden:"hidden",inward:"in",outward:"out"},errors:{noAnimation:"Invalid animation name, or element is no longer attached to DOM. Unable to animate.",unSupport:"This browser does not support CSS animations"}}),b.default=q},function(a,b){},,function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var i=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)};c(24);var l=c(10),m=e(l),n=c(9),o=d(n),p=c(20),q=d(p),r=window,s=r.document,t=s.body,u="ontouchstart"in s.documentElement,v=function(a){function b(a,c){f(this,b),c?c.element=a:c=$.isPlainObject(a)?a:{element:a};var d=g(this,Object.getPrototypeOf(b).call(this,c));return d.bindTriggerEvent(),!d.exists()&&d.options.preserve&&d.create(),d}return h(b,a),j(b,[{key:"ensureElement",value:function(){k(Object.getPrototypeOf(b.prototype),"ensureElement",this).call(this);var a=this.options;t||(t=s.body),this.$context=$(a.context||t),this.$target=a.target?$(a.target):this.$elem}},{key:"toggle",value:function(){this.isHidden()?(this.unbindCloseEvent(),this.show()):this.hide()}},{key:"show",value:function(a){if(this.isHidden()){if(this.exists()||this.create(),!1===this.onShow())return;var b=this.options;b.preserve||b.popup||this.refresh(),this.$popup&&this.updatePosition()&&(this.storeTitleAttr(),b.exclusive&&this.hideAll(),this.doShowAnimation(a))}}},{key:"hide",value:function(a){if(this.isVisible()||this.isAnimating()){if(!1===this.onHide())return;this.unbindCloseEvent(),this.restoreTitleAttr(),this.doHideAnimation(a)}}},{key:"delayedShow",value:function(){var a=this.options.delay,b=m.isObject(a)?a.show:a;clearTimeout(this.hideTimer),this.openedWithTouch||(this.showTimer=setTimeout(m.bind(this.show,this),b))}},{key:"delayedHide",value:function(){var a=this.options.delay,b=m.isObject(a)?a.hide:a;clearTimeout(this.showTimer),this.hideTimer=setTimeout(m.bind(this.hide,this),b)}},{key:"touchedShow",value:function(){this.openedWithTouch=!0,this.show()}},{key:"hideAll",value:function(){$(this.selectors&&this.selectors.popup||".ui-popup").filter("."+this.classNames.visible).each(function(){var a=$(this),b=a.data(this.metadata.activator),c=b&&b.data(this.options.namespace);c&&c.hide()})}},{key:"hideGracefully",value:function(a){this&&this.selectors&&a&&0===$(a.target).closest(this.selectors.popup||".ui-popup").length&&this.hide()}},{key:"doShowAnimation",value:function(a){var b=this.options.animation,c=m.bind(function(){this.bindCloseEvent(),this.onVisible(),m.isFunction(a)&&a.call(this)},this);b&&q.default.isSupported()?(this.showTransition&&this.showTransition.destroy(),this.showTransition=new q.default({element:this.$popup,duration:this.options.duration,animation:b+" in",queue:!1,onComplete:c})):c()}},{key:"doHideAnimation",value:function(a){var b=this.$popup,c=b.parent().length&&this.options.animation,d=m.bind(function(){this.reset(),this.onHidden(),m.isFunction(a)&&a.call(this)},this);c&&q.default.isSupported()?(this.hideTransition&&this.hideTransition.destroy(),this.hideTransition=new q.default({element:b,duration:this.options.duration,animation:c+" out",queue:!1,onComplete:d})):d()}},{key:"refresh",value:function(){var a=this.options;a.popup?this.$popup=$(a.popup).eq(0):a.inline&&(this.$popup=a.popup=this.$target.nextAll(this.selectors.popup).eq(0));var b=this.hasPopup(),c=this.$popup,d=this.$target,e=void 0;a.popup?(this.setHolding(),e=this.getOffsetParent(),this.removeHolding(),a.movePopup&&b&&this.getOffsetParent(c)[0]!==e[0]&&c.detach().appendTo(e)):e=a.inline?this.getOffsetParent(d):b?this.getOffsetParent(c):$(t),e.is("html")&&e[0]!==t&&(e=$(t)),this.$offsetParent=e;var f=this.getOption("variation");f&&b&&c.addClass(f)}},{key:"reset",value:function(){this.options.preserve?this.$elem.removeClass(this.classNames.visible):this.removePopup()}},{key:"destroy",value:function(){this.$popup&&!this.options.preserve&&this.removePopup(),clearTimeout(this.hideTimer),clearTimeout(this.showTimer),this.showTransition&&this.showTransition.destroy(),this.hideTransition&&this.hideTransition.destroy(),$(r).off(this.eventNS),k(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"exists",value:function(){return!!this.hasPopup()&&(!(!this.options.inline&&!this.options.popup)||this.$popup.closest(this.$context).length>=1)}},{key:"create",value:function(){var a=this.$elem,b=this.options,c=this.metadata.activator,d=this.getOption("html"),e=this.getOption("title"),f=this.getAttrData("content")||a.attr("title")||b.content;if(d||f||e){d||(d=this.render({title:e,content:f}));var g=$("<div/>").addClass(this.classNames.popup).data(c,a).html(d);b.inline?g.insertAfter(a):g.appendTo(this.$context),this.$popup=g,this.refresh(),b.hoverable&&this.bindHoverEvent(),this.onCreate()}else{var h=this.$target.next(this.selectors.popup),i=!1;h.length?(b.inline=!0,h.data(c,a),i=!0):b.popup?($(b.popup).data(c,a),i=!0):i=!1,i&&(this.refresh(),b.hoverable&&this.bindHoverEvent())}}},{key:"render",value:function(a){var b=this.options.render;if(b&&m.isFunction(b))return b.call(this,a);var c=this.options.escape;c?m.isFunction(c)||(c=m.escape):c=function(a){return a},c=m.bind(c,this);var d="",e=this.classNames;return a&&(a.title&&(d=d+'<div class="'+e.popupHeader+'">'+c(a.title)+"</div>"),a.content&&(d=d+'<div class="'+e.popupContent+'">'+c(a.content)+"</div>")),d}},{key:"hasPopup",value:function(){return this.$popup&&this.$popup.length>0}},{key:"removePopup",value:function(){this.hasPopup()&&!this.options.popup&&(this.$popup.remove(),this.$popup=null,this.onRemove())}},{key:"storeTitleAttr",value:function(){var a={title:this.$elem.attr("title")};a.title&&(this.$elem.removeAttr("title"),this.cache=a)}},{key:"restoreTitleAttr",value:function(){var a=this.cache&&this.cache.title;a&&this.$elem.attr("title",a)}},{key:"updateHTML",value:function(a){this.hasPopup()&&this.$popup.html(a)}},{key:"updateContent",value:function(a){this.hasPopup()&&this.$popup.find(this.selectors.popupContent).html(a)}},{key:"updateTitle",value:function(a){this.hasPopup()&&this.$popup.find(this.selectors.popupHeader).html(a)}},{key:"updatePosition",value:function(a,b){var c=this.$popup;if(0===this.$target.length||0===c.length)return this.error(this.errors.notFound),!1;var d=this.options,e=this.searchDepth;if(e&&e===d.maxSearchDepth){if(!d.fallback)return this.resetAttempts(),this.removeHolding(),this.reset(),this.onUnablePlace(),this.error(this.errors.unablePlace),!1;a=d.fallback}else a=a||this.getOption("position");b=b||this.getCalculations();var f=b.target;if(0===f.width&&0===f.height&&!(f.element instanceof SVGGraphicsElement))return!1;a=this.correctPosition(a),this.isRtl()&&(a=a.replace(/left|right/g,function(a){return"left"===a?"right":"left"})),this.setHolding(),c.removeClass(this.classNames.position).addClass(a);var g=this.calcPositioning(a,b);c.css(g);var h=c.offset();this.removeHolding();var i=this.calcBoundaryDistance(h,b);if(this.isOffstage(i)){var j=e||0,k=d.maxSearchDepth,l=void 0;if(j<k){for(j++,l=this.getNextPosition(a);!l&&j<k;)j++,l=this.getNextPosition(l);return this.searchDepth=j,l&&j<k?this.updatePosition(l,b):this.updatePosition(d.fallback,b)}}return this.resetAttempts(),this.removeHolding(),d.fluidWidth&&this.isFluid()&&c.css("width",b.container.width),!0}},{key:"getNextPosition",value:function(a){a=this.correctPosition(a);var b=this.triedPositions;b||(b=this.triedPositions={"top left":!1,"top center":!1,"top right":!1,"right top":!1,"right middle":!1,"right bottom":!1,"bottom right":!1,"bottom center":!1,"bottom left":!1,"left bottom":!1,"left middle":!1,"left top":!1}),b[a]=!0;var c={top:"bottom",bottom:"top",left:"right",right:"left",center:"center",middle:"middle"},d={"top left":"top center","top center":"top right","top right":"right top","right top":"right middle","right middle":"right bottom","right bottom":"bottom right","bottom right":"bottom center","bottom center":"bottom left","bottom left":"left bottom","left bottom":"left middle","left middle":"left top","left top":"top left"},e={"top right":"top center","top center":"top left","top left":"left top","left top":"left middle","left middle":"left bottom","left bottom":"bottom left","bottom left":"bottom center","bottom center":"bottom right","bottom right":"right bottom","right bottom":"right middle","right middle":"right top","right top":"top right"},f=this.options.prefer,g=void 0;if("opposite"===f){var h=m.split(a);g=c[h[0]]+" "+c[h[1]]}else g="clockwise"===f?d[a]:e[a];return"opposite"===f&&b[g]&&(g=d[g]),b[g]?"":g}},{key:"correctPosition",value:function(a){if(a){var b=m.split(a),c={"top left":!0,"top center":!0,"top right":!0,"right top":!0,"right middle":!0,"right bottom":!0,"bottom right":!0,"bottom center":!0,"bottom left":!0,"left bottom":!0,"left middle":!0,"left top":!0};a=b.join(" "),c[a]||(a=b.reverse().join(" ")),c[a]||(a="top center")}return a}},{key:"calcPositioning",value:function(a,b){var c=b.parent,d=b.target,e=b.popup,f={top:"auto",left:"auto",right:"auto",bottom:"auto"},g=this.calcAligner(a,b),h=this.calcOffset(a,b),j=i(h,2),k=j[0],l=j[1],n=m.startWith,o=m.endWith;return n(a,"top")?f.bottom=c.height-d.top+k:n(a,"bottom")?f.top=d.top+d.height+k:n(a,"right")?f.left=d.left+d.width+k:n(a,"left")&&(f.right=c.width-d.left+k),o(a,"left")?f.left=d.left-g.left+l:o(a,"center")?f.left=d.left+(d.width-e.width)/2-g.left+l:o(a,"right")?f.right=c.width-d.left-d.width-g.right-l:o(a,"top")?f.top=d.top-g.top+l:o(a,"middle")?f.top=d.top+(d.height-e.height)/2-g.top+l:o(a,"bottom")&&(f.bottom=c.height-d.top-d.height-g.bottom-l),f}},{key:"calcOffset",value:function(a,b){var c=this.getOption("gap")||0,d=this.getOption("offset")||0;if(this.options.inline){var e=b.target.margin,f=e.left,g=e.top,h=m.startWith;h(a,"top")?(d+=f,c-=g):h(a,"bottom")?(d+=f,c+=g):(d+=g,c-=f)}return[c,d]}},{key:"calcAligner",value:function(a,b){var c=b.target,d=this.getOption("align");(d=m.lc(d))&&-1!==m.indexOf(["left","center","right","top","middle","bottom"],d)||(d="auto");var e=0,f=0,g=0,h=0;if("auto"!==d){var i=r.getComputedStyle(this.$popup[0],":before"),j=function(a){return"auto"===a?0:Math.round(m.toFloat(a))},k=i.getPropertyValue("width"),l="auto"===k?0:1+Math.round(m.toFloat(k)/2);e=j(i.getPropertyValue("left")),f=j(i.getPropertyValue("right")),g=j(i.getPropertyValue("top")),h=j(i.getPropertyValue("bottom"));var n=m.endWith;n(a,"left")?"left"===d||"top"===d?e+=l:e="center"===d||"middle"===d?e+l-c.width/2:e+l-c.width:n(a,"center")?e="left"===d||"top"===d?c.width/2:"center"===d||"middle"===d?0:-c.width/2:n(a,"right")?"left"===d||"top"===d?f=f+l-c.width:"center"===d||"middle"===d?f=f+l-c.width/2:f+=l:n(a,"top")?"left"===d||"top"===d?g+=l:g="center"===d||"middle"===d?g+l-c.height/2:g+l-c.height:n(a,"middle")?g="left"===d||"top"===d?c.height/2:"center"===d||"middle"===d?0:-c.height/2:n(a,"bottom")&&("left"===d||"top"===d?h=h+l-c.height:"center"===d||"middle"===d?h=h+l-c.height/2:h+=l)}return{left:e,right:f,top:g,bottom:h}}},{key:"getCalculations",value:function(){var a=this.options,b=this.$target,c=b[0],d=a.inline||a.popup&&a.movePopup?b.position():b.offset(),e=this.$popup,f=this.$offsetParent,g=$(r),h={target:{element:c,width:b.outerWidth(),height:b.outerHeight(),top:d.top,left:d.left,margin:{}},popup:{width:e.outerWidth(),height:e.outerHeight()},parent:{width:f.outerWidth(),height:f.outerHeight()},screen:{scroll:{top:g.scrollTop(),left:g.scrollLeft()},width:g.width(),height:g.height()}};a.fluidWidth&&this.isFluid()&&(h.container={width:e.parent().outerWidth()},h.popup.width=h.container.width);var i=r.getComputedStyle(c),j=h.target.margin;j.top=a.inline?m.toInt(i.getPropertyValue("margin-top")):0,j.left=a.inline?this.isRtl()?m.toInt(i.getPropertyValue("margin-right")):m.toInt(i.getPropertyValue("margin-left")):0;var k=h.screen;return h.boundary={top:k.scroll.top,bottom:k.scroll.top+k.height,left:k.scroll.left,right:k.scroll.left+k.width},h}},{key:"calcBoundaryDistance",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?this.getCalculations():arguments[1],c={},d=b.popup,e=b.boundary;return a&&(c={top:a.top-e.top,left:a.left-e.left,right:e.right-(a.left+d.width),bottom:e.bottom-(a.top+d.height)}),c}},{key:"isOffstage",value:function(a){var b=this.options.jitter,c=[];return m.forIn(a,function(a,d){a<-b&&c.push(d)}),c.length>0}},{key:"resetAttempts",value:function(){this.searchDepth=0,this.triedPositions=null}},{key:"bindHoverEvent",value:function(){if(this.hasPopup()){var a=this.eventNS;this.$popup.on("mouseenter"+a,m.bind(this.delayedShow,this)).on("mouseleave"+a,m.bind(this.delayedHide,this))}}},{key:"bindCloseEvent",value:function(){var a=this.options,b=this.eventNS,c=a.on,d=$(s),e=m.bind(this.hideGracefully,this);(!0===a.hideOnScroll||"auto"===a.hideOnScroll&&"click"!==c)&&(d.one("scroll"+b,e),this.$context.one("scroll"+b,e)),"hover"===c&&this.openedWithTouch&&d.on("touchstart"+b,e),"click"===c&&a.closable&&d.on("click"+b,e)}},{key:"unbindCloseEvent",value:function(){var a=this.options,b=this.eventNS,c=a.on,d=$(s);(!0===a.hideOnScroll||"auto"===a.hideOnScroll&&"click"!==c)&&(d.off("scroll"+b),this.$context.off("scroll"+b)),"hover"===c&&this.openedWithTouch&&(d.off("touchstart"+b),this.openedWithTouch=!1),"click"===c&&a.closable&&d.off("click"+b)}},{key:"bindTriggerEvent",value:function(){var a=this.$elem,b=this.options.on,c=this.eventNS;"click"===b&&a.on("click"+c,m.bind(this.toggle,this)),"hover"===b&&u&&this.options.addTouchEvents&&a.on("touchstart"+c,m.bind(this.touchedShow,this));var d=this.getShowTriggerName();if(d){var e=this.getHideTriggerName();a.on(d+c,m.bind(this.delayedShow,this)).on(e+c,m.bind(this.delayedHide,this))}$(r).on("resize"+c,m.bind(this.onWindowResize,this))}},{key:"onWindowResize",value:function(){this.isVisible()&&this.updatePosition()}},{key:"onCreate",value:function(){this.triggerCallback("create")}},{key:"onRemove",value:function(){this.triggerCallback("remove")}},{key:"onShow",value:function(){return this.triggerCallback("show")}},{key:"onHide",value:function(){return this.triggerCallback("hide")}},{key:"onVisible",value:function(){this.triggerCallback("visible")}},{key:"onHidden",value:function(){this.triggerCallback("hidden")}},{key:"onUnablePlace",value:function(){this.triggerCallback("unablePlace")}},{key:"getShowTriggerName",value:function(){var a=this.options.on;return"hover"===a?"mouseenter":"focus"===a?"focus":""}},{key:"getHideTriggerName",value:function(){var a=this.options.on;return"hover"===a?"mouseleave":"focus"===a?"blur":""}},{key:"getOffsetParent",value:function(a){var b=a&&a[0]||this.$elem[0],c=b.parentNode,d=$(c);if(c)for(var e="none"===d.css("transform"),f=d.is("html"),g="static"===d.css("position");c&&!f&&g&&e;)c=c.parentNode,d=$(c),e="none"===d.css("transform"),f=d.is("html"),g="static"===d.css("position");return d&&d.length?d:$()}},{key:"setHolding",value:function(){this.$popup.addClass(this.classNames.holding)}},{key:"removeHolding",value:function(){this.$popup.removeClass(this.classNames.holding)}},{key:"isVisible",value:function(){return this.$popup&&this.$popup.hasClass(this.classNames.visible)}},{key:"isHidden",value:function(){return!this.isVisible()}},{key:"isAnimating",value:function(){return this.$popup&&this.$popup.hasClass(this.classNames.animating)}},{key:"isFluid",value:function(){return this.$popup&&this.$popup.hasClass(this.classNames.fluid)}},{key:"isRtl",value:function(){return"rtl"===this.$elem.css("direction")}}]),b}(o.default);v.version="0.1.1",v.setDefaults({namespace:"ui-popup",context:t,target:"",popup:"",html:"",title:"",content:"",on:"hover",addTouchEvents:!0,position:"top left",fallback:"top left",prefer:"opposite",maxSearchDepth:15,align:"auto",variation:"",movePopup:!0,inline:!1,preserve:!1,hoverable:!1,closable:!0,exclusive:!1,hideOnScroll:"auto",fluidWidth:!0,gap:0,offset:0,jitter:2,delay:{show:50,hide:70},duration:200,animation:"scale",escape:!0,render:null,onCreate:null,onRemove:null,onShow:null,onVisible:null,onHide:null,onHidden:null,onUnablePlace:null,metadata:{position:"position",align:"align",html:"html",title:"title",content:"content",gap:"gap",offset:"offset",variation:"variation",activator:"activator"},classNames:{popup:"ui-popup",popupHeader:"header",popupContent:"content",fluid:"fluid",visible:"visible",holding:"holding",animating:"animating",position:"top bottom left right center middle"},selectors:{popup:".ui-popup"},error:{cannotPlace:"Popup does not fit within the boundaries of the viewport",notFound:"The target or popup you specified does not exist on the page"}}),b.default=v},function(a,b){},function(a,b){}])}),define("../../lib/zero-components/dist/zero-components.js",function(){}),define("i18n",["zero/zero","zero/i18n","./locale/"+zero.CONFIG.defaultLocale,"./locale/"+zero.CONFIG.locale],function(a,b,c,d){"use strict";b.load(c,a.CONFIG.defaultLocale).load(d);var e=b.translate,f="data-i18n",g="data-attr";return $("title",document.head).text(e("brand")),$(".text-i18n").each(function(){var a=$(this),b=a.attr(f),c=a.attr(g)||"data-locale";if(b){var d=e(b);a.attr(c,d),b!==d&&a.removeAttr(f)}c&&a.removeAttr(g),a.addClass("translated")}),b}),define("global/validation",["zero/zero","../i18n"],function(a,b){"use strict";var c=b.translate,d=jQuery.validator;d.setDefaults({debug:!0,onsubmit:!1,onclick:!1,onkeyup:!1,focusCleanup:!0,errorClass:"form-control-error icon-close-c",highlight:function(a,b,c){$(a).parents(".form-group").addClass("has-error")},unhighlight:function(a,b,c){$(a).parents(".form-group").removeClass("has-error")}}),d.addMethod("variableName",function(a,b){return this.optional(b)||/^[a-zA-Z_]([a-zA-Z0-9_]+)?$/.test(a)}),d.addMethod("xss",function(a,b){return this.optional(b)||!/[<\/>]/.test(a)},c("errorStringXss")),d.addMethod("letter",function(a,b){return this.optional(b)||/^[a-zA-Z0-9]+$/.test(a)},c("errorLetter")),d.addMethod("int",function(a,b){return this.optional(b)||/^[1-9]\d*$/.test(a)},c("errorInt")),$.extend($.validator.messages,{required:c("errorStringRequired"),url:c("errorUrl")})}),define("global/event",["zero/zero","zero/event"],function(a,b){"use strict";var c=b({}),d={onWindowClose:"on-window-close",onWindowResize:"on-window-resize",onCanvasFocused:"on-canvas-focused",onCanvasResize:"on-canvas-resize",onCanvasZoomIn:"on-canvas-zoom-in",onCanvasZoomOut:"on-canvas-zoom-out",onCanvasScaleTo:"on-canvas-scale-to",onCanvasScaled:"on-canvas-scaled",onFitToWindow:"on-fit-to-window",onRestoreActualSize:"on-restore-actual-size",onSwitchDragOrSelectMode:"on-switch-drag-or-select-mode",onShowToolbox:"on-show-toolbox",onHideToolbox:"on-hide-toolbox",onToolboxSwitched:"on-toolbox-switched",onToolboxFreezed:"on-toolbox-freezed",onToolboxUnfreezed:"on-toolbox-unfreezed",onExperimentTreeLoaded:"on-experiment-tree-loaded",onComponentTreeLoaded:"on-component-tree-loaded",onModelTreeLoaded:"on-model-tree-loaded",onDataSourceTreeLoaded:"on-data-source-tree-loaded",onPageLoadComplete:"on-page-load-complete",onComponentDragOver:"on-component-drag-over",onComponentDrop:"on-component-drop",onTableDrop:"on-table-drop",onRefreshMyModels:"on-refresh-my-models",onExportPmml:"on-export-pmml",onShowModel:"on-show-model",onLocateModel:"on-locate-model",onSaveModel:"on-save-model",onRefreshArchivedModels:"on-refresh-archived-models",onShowDeployModelResult:"on-show-deploy-model-result",onCreateExperiment:"on-create-experiment",onExperimentTreeNodeCreated:"on-experiment-tree-node-created",onTryOpenExperiment:"on-try-open-experiment",onExperimentOpened:"on-experiment-opened",onExperimentClosed:"on-experiment-closed",onAllExperimentsClosed:"on-all-experiments-closed",onExperimentRenamed:"on-experiment-renamed",onExperimentsDeleted:"on-delete-experiments",onUpdateExperimentStatus:"on-update-experiment-status",onExecuteExperiment:"on-execute-experiment",onExecuteFromNode:"on-execute-from-node",onExecuteToNode:"on-execute-to-node",onExecuteNode:"on-execute-node",onExecuteNodes:"on-execute-nodes",onStopExecuteNode:"on-stop-execute-node",onExecutePmml:"on-execute-pmml",onExecuteGroup:"on-execute-group",onReExecuteExperiment:"on-reExecute-experiment",onStopExecution:"on-stop-execution",onSelectBenchmark:"onSelectBenchmark",onSearchedNode:"on-searched-node",onToggleNodeClass:"on-toggle-node-class",onSelectSearchedNode:"on-select-searched-node",onTryExecuteExperiment:"on-try-execute-experiment",onTryExecuteFromNode:"on-try-execute-from-node",onTryExecuteToNode:"on-try-execute-to-node",onTryExecuteNode:"on-try-execute-node",onDeployExperiment:"on-deploy-experiment",onUnDeployExperiment:"on-unDeploy-experiment",onGenerateReport:"on-generate-report",onReceivedStatus:"on-received-status",onDeployTick:"on-deploy-tick",onLocateExperiment:"on-locate-experiment",onLocateExperimentByModel:"on-locate-experiment-by-model",onExperimentsLoaded:"on-experiments-loaded",onYunqiShare:"on-yunqi-share",onYunqiShareTick:"on-yunqi-share-tick",onSelectDeployNode:"on-select-deploy-node",onSelectNodes:"on-select-nodes",onDeployOnlineService:"on-deploy-online-service",onHighlightDeployNode:"on-highlight-deploy-node",onUnHighlightDeployNode:"on-unhighlight-deploy-node",onGenerateDeployExperiment:"on-generate-deploy-experiment",onRollbackDeleteNode:"on-rollback-delete-node",onToggleGroupLoop:"on-toggle-group-loop",onToggleUnGroup:"on-toggle-unGroup",onToggleGroup:"on-toggle-group",onCreateGroup:"on-create-group",onSplitGroup:"on-split-group",onGroupLoop:"on-group-loop",onLinkUpdated:"on-link-updated",onLinkFocused:"on-link-focused",onLinkModified:"on-link-modified",onNodeFocused:"on-node-focused",onAddNode:"on-add-node",onUpdateNodes:"on-update-nodes",onUpdateNodePosition:"on-update-node-position",onShowNodeLog:"on-show-node-log",onSaveGroupAsDefine:"on-save-group-as-define",onPropTabSwitched:"on-prop-tab-switched",onPropsReload:"on-props-reload",onPropsSaving:"on-props-saving",onPropsSaved:"on-props-saved",onReloadExperimentProps:"on-reload-experiment-props",onShowTemplatePanel:"on-show-template-panel",onHideTemplatePanel:"on-hide-template-panel",onTemplatePanelShowed:"on-template-panel-showed",onTemplatePanelHided:"on-template-panel-hided",onAddRemark:"on-add-remark"};a.forEach(d,function(b,d){var e=0===d.indexOf("on")?d.substr(2):d;e=a.capitalize(e),c["on"+e]=function(a,d){c.on(b,a,d)},c["off"+e]=function(a){c.off(b,a)}}),a.extend(c,{focusCanvas:function(){c.trigger(d.onCanvasFocused)},zoomInCanvas:function(){c.trigger(d.onCanvasZoomIn)},zoomOutCanvas:function(){c.trigger(d.onCanvasZoomOut)},fitToWindow:function(a,b){c.trigger(d.onFitToWindow,a,b)},restoreActualSize:function(){c.trigger(d.onRestoreActualSize)},switchDragOrSelectMode:function(a){c.trigger(d.onSwitchDragOrSelectMode,a)},canvasScaleTo:function(a,b){c.trigger(d.onCanvasScaleTo,a,b)},canvasScaled:function(a,b){c.trigger(d.onCanvasScaled,a,b)}}),a.extend(c,{showToolbox:function(){c.trigger(d.onShowToolbox)},hideToolbox:function(){c.trigger(d.onHideToolbox)},switchToolbox:function(a){c.trigger(d.onToolboxSwitched,a)},freezeToolbox:function(a){c.trigger(d.onToolboxFreezed,!1!==a)},unfreezeToolbox:function(a){c.trigger(d.onToolboxUnfreezed,a)},experimentTreeLoaded:function(){c.trigger(d.onExperimentTreeLoaded)},componentTreeLoaded:function(){c.trigger(d.onComponentTreeLoaded)},modelTreeLoaded:function(){c.trigger(d.onModelTreeLoaded)},dataSourceTreeLoaded:function(){c.trigger(d.onDataSourceTreeLoaded)},pageLoadComplete:function(){c.trigger(d.onPageLoadComplete)}}),a.extend(c,{componentDragOver:function(a){c.trigger(d.onComponentDragOver,a)},componentDrop:function(a){c.trigger(d.onComponentDrop,a)},dropTableToGraph:function(a){c.trigger(d.onTableDrop,a)}}),a.extend(c,{refreshMyModels:function(a){c.trigger(d.onRefreshMyModels,a)},exportPmml:function(a,b){c.trigger(d.onExportPmml,a,b)},saveModel:function(a,b){c.trigger(d.onSaveModel,a,b)},showModel:function(a){c.trigger(d.onShowModel,a)},locateModel:function(a,b){c.trigger(d.onLocateModel,a,b)},refreshArchivedModels:function(){c.trigger(d.onRefreshArchivedModels)},showDeployModelResult:function(a){c.trigger(d.onShowDeployModelResult,a)}}),a.extend(c,{createExperimentTreeNode:function(a,b){c.trigger(d.onExperimentTreeNodeCreated,a,b)},createExperiment:function(a){c.trigger(d.onCreateExperiment,a)},tryOpenExperiment:function(a){c.trigger(d.onTryOpenExperiment,a)},openExperiment:function(a){c.trigger(d.onExperimentOpened,a)},closeExperiment:function(a){c.trigger(d.onExperimentClosed,a)},allExperimentClosed:function(){c.trigger(d.onAllExperimentsClosed)},renameExperiment:function(a,b){c.trigger(d.onExperimentRenamed,a,b)},deleteExperiments:function(a){c.trigger(d.onExperimentsDeleted,a)},updateExperimentStatus:function(){c.trigger(d.onUpdateExperimentStatus)},executeExperiment:function(){c.trigger(d.onExecuteExperiment)},executeFromNode:function(a){c.trigger(d.onExecuteFromNode,a)},executeToNode:function(a){c.trigger(d.onExecuteToNode,a)},executeNode:function(a){c.trigger(d.onExecuteNode,a)},executeNodes:function(a){c.trigger(d.onExecuteNodes,a)},tryExecuteExperiment:function(){c.trigger(d.onTryExecuteExperiment)},tryExecuteFromNode:function(a){c.trigger(d.onTryExecuteFromNode,a)},tryExecuteToNode:function(a){c.trigger(d.onTryExecuteToNode,a)},tryExecuteNode:function(a){c.trigger(d.onTryExecuteNode,a)},stopExecuteNode:function(a){c.trigger(d.onStopExecuteNode,a)},executePmml:function(a){c.trigger(d.onExecutePmml,a)},executeGroup:function(a){c.trigger(d.onExecuteGroup,a)},reExecuteExperiment:function(){c.trigger(d.onReExecuteExperiment)},stopExecution:function(){c.trigger(d.onStopExecution)},selectBenchmark:function(){c.trigger(d.onSelectBenchmark)},searchedNode:function(a){c.trigger(d.onSearchedNode,a)},toggleNodeClass:function(a,b,e){c.trigger(d.onToggleNodeClass,a,b,e)},selectSearchedNode:function(a){c.trigger(d.onSelectSearchedNode,a)},deployExperiment:function(){c.trigger(d.onDeployExperiment)},unDeployExperiment:function(){c.trigger(d.onUnDeployExperiment)},generateReport:function(a){c.trigger(d.onGenerateReport,a)},broadcastStatus:function(a,b){c.trigger(d.onReceivedStatus,a,b)},deployTick:function(a,b){c.trigger(d.onDeployTick,a,b)},locateExperiment:function(a){c.trigger(d.onLocateExperiment,a)},locateExperimentByModel:function(a){c.trigger(d.onLocateExperimentByModel,a)},experimentsLoaded:function(){c.trigger(d.onExperimentsLoaded)},yunqiShare:function(){c.trigger(d.onYunqiShare)},yunqiShareTick:function(){c.trigger(d.onYunqiShareTick)},selectDeployNode:function(){c.trigger(d.onSelectDeployNode)},deployOnlineService:function(a){c.trigger(d.onDeployOnlineService,a)},highlightDeployNode:function(a){c.trigger(d.onHighlightDeployNode,a)},unHighlightDeployNode:function(){c.trigger(d.onUnHighlightDeployNode)},rollbackDeleteNode:function(a){c.trigger(d.onRollbackDeleteNode,a)},toggleGroupLoop:function(a){c.trigger(d.onToggleGroupLoop,a)},toggleUnGroup:function(a){c.trigger(d.onToggleUnGroup,a)},toggleGroup:function(a){c.trigger(d.onToggleGroup,a)},createGroup:function(a){c.trigger(d.onCreateGroup,a)},splitGroup:function(a){c.trigger(d.onSplitGroup,a)},groupLoop:function(){c.trigger(d.onGroupLoop)}}),a.extend(c,{focusNode:function(a,b,e){c.trigger(d.onNodeFocused,a,b,e)},addNode:function(a,b,e,f,g){c.trigger(d.onAddNode,a,b,e,f,g)},updateNodes:function(a,b){c.trigger(d.onUpdateNodes,a,b)},updateNodePosition:function(a,b,e){c.trigger(d.onUpdateNodePosition,a,b,e)},showNodeLog:function(a){c.trigger(d.onShowNodeLog,a)},selectNodes:function(a,b){c.trigger(d.onSelectNodes,a,b)}}),a.extend(c,{saveGroupAsDefine:function(a){c.trigger(d.onSaveGroupAsDefine,a)},focusLink:function(a,b){c.trigger(d.onLinkFocused,a,b)},modifyLink:function(a,b,e){c.trigger(d.onLinkModified,a,b,e)}}),a.extend(c,{updateLink:function(a,b){c.trigger(d.onLinkUpdated,a,b)},focusLink:function(a,b){c.trigger(d.onLinkFocused,a,b)},modifyLink:function(a,b,e){c.trigger(d.onLinkModified,a,b,e)}}),a.extend(c,{switchPropTab:function(a){c.trigger(d.onPropTabSwitched,a)},reloadProps:function(a,b){c.trigger(d.onPropsReload,a,b)},beforePropsSaving:function(a,b){c.trigger(d.onPropsSaving,a,b)},afterPropsSaved:function(a,b){c.trigger(d.onPropsSaved,a,b)},reloadExperimentProps:function(a){c.trigger(d.onReloadExperimentProps,a)}}),a.extend(c,{showTemplatePanel:function(){c.trigger(d.onShowTemplatePanel)},hideTemplatePanel:function(){c.trigger(d.onHideTemplatePanel)},templatePanelShowed:function(){c.trigger(d.onTemplatePanelShowed)},templatePanelHided:function(){
c.trigger(d.onTemplatePanelHided)}}),a.extend(c,{addRemark:function(a,b){c.trigger(d.onAddRemark,a,b)}});var e=null;return $(window).unload(function(){c.trigger(d.onWindowClose)}).resize(function(){e&&clearTimeout(e),e=setTimeout(function(){c.trigger(d.onCanvasResize),c.trigger(d.onWindowResize)},100)}),setTimeout(function(){window.react_bridge.actions&&window.react_bridge.actions.global.setEvent({event:c})},1500),c}),define("storage/cacheBase",["zero/zero"],function(a){"use strict";function b(a,b,c,d){var e,i=g[a];return i&&h(i,b)?(e=i[b])&&!0===d&&(e=f(e)):e=c,e}function c(b,c,d,e){var h=g,i=(b+"").split(c||"."),j=i.length;return a.some(i,function(a,b){if((!h||"object"!=typeof h)&&b<j-1)return!0;h=h[a]})?h=d:h&&!0===e&&(h=f(h)),h}function d(b,c,d,e){var h=g[b];return h||(h=g[b]={}),!0===e&&(a.isObject(d)?d=$.extend(!0,{},d):a.isArrayLike(d)&&(d=$.extend(!0,[],d))),d=!0===e?f(d):d,h[c]=d,d}function e(a,b){var c=g[a];c&&delete c[b]}function f(b){return a.isObject(b)?$.extend(!0,{},b):a.isArrayLike(b)?$.extend(!0,[],b):b}var g={},h=a.hasKey;return{create:function(a,f){if(!a)throw new Error("Argument `scope` must be specified.");return f&&(g[a]=f),{init:function(b){g[a]=b},get:function(c,d,e){return b(a,c,d,e)},set:function(b,c,e){return d(a,b,c,e)},del:function(b){return e(a,b)},hasKey:function(b){var c=g[a];return c&&h(c,b)},raw:function(){return g[a]},clean:function(){delete g[a]},getByPath:c}}}}),define("storage/globalCache",["zero/zero","./cacheBase"],function(a,b){"use strict";var c=b.create("global");return c.keys={currentExperimentId:"current-experiment-id",projectName:"project-name",selectedNodes:"selected-nodes",hasOpenedExperiment:"has-opened-experiment"},window.classicCache=c,c}),define("midway/dialog/alert",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,e,f){var g='<div class="modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog modal-alert"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+d(a)+'</h4></div><div class="modal-body"><span class="icon icon-warning-o"></span>';return b&&(g+="<h4>"+c(b)+"</h4>"),g+="",e&&(g+="<p>"+c(e)+"</p>"),g+='</div><div class="modal-footer"><button type="button" class="btn btn-primary btn-lg btn-block">'+d(f)+"</button></div></div></div></div>"}(b.title,b.messageTitle,b.messageContent,b.buttonText)}}),define("global/Alert",["zero/zero","zero/declare","zero/ui/Dialog","../midway/dialog/alert"],function(a,b,c,d){"use strict";var e={title:"title",messageTitle:"",messageContent:"",buttonText:"OK",onOK:function(){}};return b("ui/Dialog",[c],{constructor:function(a){var b=this;return a.esc=!1,a.backdrop=!0,a.hideOnClick=!1,c.prototype.constructor.call(b,$.extend({},e,a)),b},_render:function(){var a=this,b=a.options;return a.$element=$(d(b)).appendTo(b.parent),a},_setup:function(){var a=this,b=a.options;return a.$element.find(".modal-footer").on("click",".btn",function(){b.onOK&&b.onOK.call(a)}),a}})}),define("global/uriReg",[],function(){return"(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?"}),define("global/notify",["zero/zero","zero/ui/Notify","./uriReg"],function(a,b,c){"use strict";function d(b,d,f){var g=new RegExp(c,"gi"),h=b.replace(g,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"});window.react_bridge.actions&&window.react_bridge.actions.showNotification?window.react_bridge.actions.showNotification({type:f,message:h,description:null,duration:6e4}):e.log(a.extend({text:h,type:f||"info",hasClose:!0,lifetime:6e4},d))}var e=new b;return{log:function(a,b){d(a,b)},info:function(a,b){d(a,b,"info")},error:function(a,b){d(a,b,"error")},success:function(a,b){d(a,b,"success")},logWithType:d}}),define("global/utils",["zero/zero"],function(a){"use strict";var b=a.each,c={toInt:function(a){return parseInt(a,10)},toString:function(a){return""+a},toFixed:function(a,b){var c=Math.pow(10,b);return(Math.round(a*c)/c).toFixed(b)},toFixedNumber:function(a,b){var d=Math.pow(10,b);return c.accDiv(Math.round(a*d),d)},toWeakFixed:function(a,b){var d=a.toString(),e=0;try{e=d.split(".")[1].length}catch(a){}return e>b&&(a=c.toFixedNumber(a,b)),a},lcFirst:function(a){return a+="",a.charAt(0).toLowerCase()+a.substr(1)},ucFirst:function(a){return a+="",a.charAt(0).toUpperCase()+a.substr(1)},padLeft:function(a,b,c){for(a=""+a,c=c||" ";a.length<b;)a=c+a;return a},formatDate:function(a){if(a){a instanceof Date||(a=new Date(a));var b=function(a){return c.padLeft(a,2,"0")};return b(a.getFullYear(),2,"0")+"-"+b(a.getMonth()+1,2,"0")+"-"+b(a.getDate(),2,"0")+" "+b(a.getHours(),2,"0")+":"+b(a.getMinutes(),2,"0")}},getTextWidth:function(a){var b=$("<div />").css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","white-space":"nowrap"}).appendTo(document.body).text(a),c=b.outerWidth();return b.remove(),c},getMaxTextWidth:function(a){var b=$("<div />").css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","white-space":"nowrap"}).appendTo(document.body),c=[];return a.forEach(function(a){b.text(a),c.push(b.outerWidth())}),b.remove(),Math.max.apply(null,c)},runIfIsFunction:function(b,c,d){c=c||null,d=d||[],a.isFunction(b)&&b.apply(c,d)},getCookie:function(b,c){var d=a.getAny([function(){return document.cookie}]),e=b+"=";if(d){var f,g,h,i=d.split(";"),j=i.length;for(f=0;f<j;f++){for(g=i[f];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(e))return h=g.substring(e.length,g.length),c?encodeURIComponent(h):h}}return null},cleanupParams:function(b){var c={};return a.each(b,function(a,b){""!==a&&(c[b]=a)}),c},getBoundingClientRect:function(a){var c=a.getBoundingClientRect(),d={};return b(["bottom","height","left","right","top","width"],function(a){d[a]=c[a]}),d},disableCopy:function(a){$(a).attr("unselectable","on").css({"-moz-user-select":"-moz-none","-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).on("contextmenu",function(){return!1}).on("dragstart",function(){return!1}).on("selectstart",function(){return!1}).on("beforecopy",function(){return!1}).on("select",function(){document.selection.empty()}).on("copy",function(){document.selection.empty()}).attr("tabindex",1).on("keydown",function(a){if(a.metaKey&&["a","c"].some(function(b){return a.key===b}))return!1})},getURLArg:function(b,c){var d,e=(""+b).split("?")[1]||"";return a.some(e.split("&"),function(a){var b=a.split("=");if(b[0]===c)return d=b[1],!0}),d||""},changeURLArg:function(a,b,c){var d,e=/#.*$/,f=a.match(e);f&&(d=f[0],a=a.replace(e,""));var g,h=b+"=[^&]*",i=b+"="+c;return g=a.match(h)?a.replace(new RegExp(h,"ig"),i):a.match("[?]")?a+"&"+i:a+"?"+i,d&&(g+=d),g},deleteURLArg:function(a,b){var c="[&]"+b+"=[^&#]*",d=a.split("?"),e="&"+d[1];return e.match(c)&&(e=e.replace(new RegExp(c,"ig"),""),d[1]=e.substr(1)),d.join("?")},pushState:function(){var b=a.toArray(arguments),c=a.isPlainObject(b[0])?b.shift():null,d=b.length>1?b.shift():null,e=b[0];try{history.pushState(c,d,e)}catch(a){}},numberToLetter:function(a){var b,c,d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e=[],f="";do{b=a%26,c=b>0?b:26,e.push(d[c-1]),a-=c,a/=26}while(a>0);for(var g=e.length-1,h=0;g>=h;g--)f+=e[g];return f},letterToNumber:function(a){var b=0,c="a".charCodeAt();a=a.toLowerCase();for(var d=0,e=a.length;d<e;d++)b+=(a.charCodeAt(d)-c+1)*Math.pow(26,e-d-1);return b},accDiv:function(a,b){var c=a.toString(),d=b.toString(),e=0;try{e=d.split(".")[1].length}catch(a){}try{e-=c.split(".")[1].length}catch(a){}return(c.replace(".","")-0)/(d.replace(".","")-0)*Math.pow(10,e)},accMul:function(a,b){var c=a.toString(),d=b.toString(),e=0;try{e+=c.split(".")[1].length}catch(a){}try{e+=d.split(".")[1].length}catch(a){}return(c.replace(".","")-0)*(d.replace(".","")-0)/Math.pow(10,e)},accAdd:function(a,b){var c=0,d=0;try{c=a.toString().split(".")[1].length}catch(a){}try{d=b.toString().split(".")[1].length}catch(a){}var e=Math.pow(10,Math.max(c,d));return(Math.round(a*e)+Math.round(b*e))/e},accSub:function(a,b){return accAdd(a,-b)},JSONFormat:function(){var a=[],b=function(b){return"\\"+a.push(b)+"\\"},c=function(b,c){return a[c-1]},d=function(a){return new Array(a+1).join("\t")};return function(e){a=[];var f="",g=0;e=e.replace(/\\./g,b).replace(/(".*?"|'.*?')/g,b).replace(/\s+/,"");for(var h=0;h<e.length;h++){var i=e.charAt(h);switch(i){case"{":case"[":f+=i+"\n"+d(++g);break;case"}":case"]":f+="\n"+d(--g)+i;break;case",":f+=",\n"+d(g);break;case":":f+=": ";break;default:f+=i}}return f=f.replace(/\[[\d,\s]+?\]/g,function(a){return a.replace(/\s/g,"")}).replace(/\\(\d+)\\/g,c).replace(/\\(\d+)\\/g,c)}}(),track:function(a){return function(b,c){try{if(window.Tracert){var d=a?a+"."+b:b,e=c||{};window._to&&window._to.mdata&&(e.expId=window._to.mdata.expId),window.Tracert.call("click",d,e)}}catch(a){console.warn(a)}}},log:function(a,b){try{if(window.Tracert){var c=b||{};window._to&&window._to.mdata&&(c.expId=window._to.mdata.expId),window.Tracert.call("click",a,c)}}catch(a){console.warn(a)}}};return c}),define("global/Track",["zero/zero"],function(a){"use strict";function b(a,b,c){this.prefix=a||"",this.suffix=b||"",this.division=c||"-"}return b.prototype.click=function(a){var b=this.prefix?this.prefix+this.division:"";b+=a,b+=this.suffix?this.division+this.suffix:"",window.Tracert&&window.Tracert.click(b)},b}),define("ajax/base",["zero/zero","zero/declare","zero/io/ajax","zero/json","../storage/globalCache","../global/Alert","../global/notify","../global/utils","../global/Track","../i18n"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(b,c){return a.isString(b)&&a.every(["success","fail","complete","error"],function(a){return!(c[a]&&!s(c[a]))})}function l(a,b,c,d){var e;(e=a[b])&&s(e)&&e.call(a.context,c,d)}function m(){return e.get(e.keys.projectName)||window.currentProjectName}function n(b,d){if(!k(b,d))return g.error(r("wrongAjaxParams"))||"";var e=a.extend({ctoken:p(),projectName:m()},d.data);return new Promise(function(a,h){c(b,{method:d.method||"GET",type:d.type||"json",data:e,noCache:!0,success:function(c){if("-1"===c.exceptionCode)return void(q||(q=new f({title:r("badCToken"),messageTitle:r("badCTokenTip",$("#logoutLink").attr("href")),messageContent:"",buttonText:r("refreshImmediately"),onOK:function(){q=null,window.location.reload()}})));if(c.exception_marking)return g.error(c.exception_marking),void console.error(b+"?"+e.method+"\n"+c.exception_marking);var i=c.data||{};if(c.success)l(d,"success",i,c),a(c.data);else{if("DPC00002"===i.errorCode)return void(q||(q=new f({title:r("pageExpire"),messageTitle:r("pageExpireTip"),messageContent:"",buttonText:r("refreshImmediately"),onOK:function(){q=null,window.location.reload()}})));if(d.fail?d.fail(i,c):i.errorMessage&&!d.disableMsg&&(i.errorMessage=i.errorMessage.replace("##CURRENT_URL##",window.location.origin),g.error(i.errorMessage)),!0===d.reject)return h(i)}},error:function(a){l(d,"error",a),!0===d.reject&&h(a)}})})}function o(a,b,c,d,e,f){return n(a,{data:c||{},method:b,reject:d,fail:e,disableMsg:f})}function p(){return t||(t=h.getCookie("ctoken")||Math.random().toString(36).slice(3,-1).repeat(2)),t}var q,r=j.translate,s=a.isFunction,t=!1;return{getProjectName:m,getToken:p,create:function(b,c){var d=c?c+b:b;return{ajax:a.bind(n,null,d),post:function(a,b,c){return o(d,"POST",a,b,c)},get:function(a,b,c,e){return o(d,"GET",a,b,c,e)},getToken:p}}}}),define("ajax/message",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/messages.json");return{queryOnline:function(a){return c.get({method:"queryOnline",categoryId:a,pageSize:4,pageIndex:1})},getNofity:function(){return c.get({method:"queryOnline",categoryId:3,pageSize:1,pageIndex:1}).then(function(a){var b=a&&a.messages[0]||null;return b&&b.content?b:null})}}}),define("storage/persistence",["zero/zero","zero/json"],function(a,b){"use strict";var c=a.getAny([function(){return window.localStorage},function(){return window.sessionStorage},function(){return{}}]);return{raw:c,keys:{canvasStatus:"canvas-status",currentLang:"current-lang",currentProject:"current-project",experimentFoldPath:"experiment-fold-path",componentFoldPath:"component-fold-path",modelFoldPath:"model-fold-path",activeHomeDate:"active-home-date",activeToolboxIndex:"active-toolbox-index",activeExperimentId:"workspace-active-experiment-id",loadExperimentDagBenchmark:"load-experiment-dag-benchmark",loadExperimentXmlBenchmark:"load-experiment-xml-benchmark",nodeClipboardData:"node-clipboard-data",systemNotify:"system-notify",hideDeployGuide:"hide-deploy-guide",hideBenchmarkGuide:"hide-benchmark-guide"},get:function(a){return c[a]||null},set:function(a,b){c[a]=b},getInt:function(b,c){var d=this.get(b);return null===d?c:a.toInt(d)},getBoolean:function(a,b){var c=this.get(a);return null===c?b:"true"===c},setObject:function(a,d){c[a]=b.stringify(d)},getObject:function(a){var c=this.get(a);if(null===c||""===c)return{};try{return b.parse(c)}catch(a){return{}}}}}),define("midway/home/notify",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){var c='<span class="pai-notify-banner'+d(a?" closeable":"")+'"><span class="icon icon-info"></span>'+d(b);return a&&(c+='<span class="btn-close">&times; </span>'),c+="</span>"}(b.closeable,b.content)}}),define("home/notify",["zero/zero","../ajax/message","../storage/persistence","../midway/home/notify"],function(a,b,c,d){"use strict";function e(a,b){var e=c.getObject(f);if(e&&e.content&&!window.msgShow){e.closeable=!!b;var g=$(d(e)).appendTo(a).on("click",".btn-close",function(){g.addClass("closed")})}}var f=c.keys.systemNotify;return{render:e}}),define("layout/pageLoading",["zero/zero","../global/event","../home/notify"],function(a,b,c){"use strict";function d(){var b=!1;a.each(h,function(a){!1===a&&(b=!0)}),b||e()}function e(){i&&clearTimeout(i),b.pageLoadComplete();var a=$(f.panel);a.addClass(g.fadeout),a.find(f.notify).empty(),a.onCSSTransitionEnd(function(){a.remove(),$(f.nav).find(f.logo).removeClass(g.pending)})}var f={panel:"#j-page-loading",nav:"#j-nav",logo:".pai-logo",notify:".pai-notify"},g={fadeout:"fadeout",pending:"pending"},h={experimentList:!1},i=setTimeout(e,1e4);c.render($(f.panel).find(f.notify),!1),b.onExperimentsLoaded(function(){h.experimentList=!0,d()})}),define("midway/layout/container",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f){var g='<nav class="pai-nav" id="j-nav"><div class="pai-logo pending"><span class="pai-logo-bg icon-logo-bg"></span><span class="pai-logo-app icon-app-pai"></span></div><ul class="pai-nav-list pai-toolbox-tab" id="j-toolbox-tab">';return"aliyun"!==a&&(g+='<li data-target="#j-toolbox-home"><span class="icon icon-home-l"></span><span class="text">'+e(d("home"))+"</span></li>"),g+='<li data-target="#j-toolbox-experiment"><span class="icon icon-lib-24"></span><span class="text">'+e(d("experiment"))+"</span></li>","aliyun"!==a&&(g+='<li data-target="#j-toolbox-dt"><span class="icon icon-data-source-24"></span><span class="text">'+e(d("dataSource"))+"</span></li>"),g+='<li data-target="#j-toolbox-component"><span class="icon icon-component-24"></span><span class="text">'+e(d("component"))+'</span></li><li data-target="#j-toolbox-model" id="j-nav-model"><span class="icon icon-diamond-24"></span><span class="text">'+e(d("model"))+"</span></li>","internal"===a&&(g+='<li class="pai-nav-command"><a href="/command" target="_blank"><svg aria-hidden="true" version="1.1" role="img" viewBox="0 0 16 16" width="24" height="24" class="icon svg-icon"><path d="M10.372 3.315l.065.018a.498.498 0 0 1 .3.727c-.299.522-.601 1.042-.902 1.562l-3.648 6.321a.56.56 0 0 1-.191.21.612.612 0 0 1-.175.068.094.094 0 0 0-.023.01h-.129a.45.45 0 0 0-.048-.016.5.5 0 0 1-.325-.735l2.698-4.673c.619-1.073 1.239-2.145 1.857-3.218a.515.515 0 0 1 .249-.232c.037-.015.076-.023.115-.034l.019-.008h.138zM1.001 7.76c.006-.013.014-.025.017-.038a.506.506 0 0 1 .14-.251c.869-.869 1.738-1.739 2.608-2.607a.475.475 0 0 1 .51-.122c.193.062.308.2.34.4a.48.48 0 0 1-.142.432l-1.811 1.81-.504.505-.025.026a.555.555 0 0 0 .032.035l2.307 2.307a.5.5 0 0 1-.219.84.479.479 0 0 1-.487-.128c-.163-.161-.324-.324-.486-.486a2090.79 2090.79 0 0 0-2.106-2.106.529.529 0 0 1-.159-.278c-.002-.01-.01-.02-.015-.029v-.31zM14.98 8.095l-.015.052a.495.495 0 0 1-.125.208l-.88.883-.297.299-1.044 1.047c-.128.129-.254.26-.385.387a.48.48 0 0 1-.512.118.475.475 0 0 1-.337-.407.48.48 0 0 1 .146-.426l1.14-1.145.98-.984.212-.208-.032-.034-.509-.512-1.317-1.321c-.161-.161-.324-.321-.482-.485a.477.477 0 0 1-.121-.496.478.478 0 0 1 .376-.345.483.483 0 0 1 .464.141l1.05 1.054 1.168 1.172.385.387a.435.435 0 0 1 .127.243c.001.004.005.007.007.01l.001.362z"></path></svg><span class="icon icon-festival"></span><span class="text">'+e(d("commandLine"))+"</span></a></li>"),g+=" ","aliyun"!==a&&(g+='<li data-target="#j-toolbox-settings"><span class="icon icon-setting-24"></span><span class="text">'+e(d("setting"))+"</span></li>"),g+='</ul><ul class="pai-nav-bottom pai-nav-list"><li class="pai-nav-dropdown pai-nav-account" id="j-account-info"><span class="icon icon-user-o-24"></span><span class="text">'+e(b)+'</span><ul class="pai-dropdown"><li><a id="logoutLink" href="'+e(c)+'/logout.htm"><span class="text">'+e(d("logout"))+'</span></a></li></ul></li><li class="pai-nav-dropdown pai-nav-help" id="j-help-list"><span class="icon icon-help-o-24"></span><span class="text">'+e(d("help"))+"</span></li>","antcloud"===a&&(g+='<li><a href="'+e(f)+'"><span class="icon icon-console-24"></span><span class="text">'+e(d("console"))+"</span></a></li>"),g+='</ul></nav><div class="pai-workspace is-opened" id="j-workspace"><aside class="pai-side-left" id="j-toolbox"><section class="pai-toolbox-sec hide" id="j-toolbox-home"></section><section class="pai-toolbox-sec hide" id="j-toolbox-experiment"><div class="pai-search-form"><input type="text" class="form-control"><span class="search-text"><span class="icon icon-search"></span><span class="text">'+e(d("search"))+'</span></span><span class="icon icon-close-o btn-clear"></span><span class="icon icon-loading-spinner"></span></div><div class="pai-experiment-tree" id="j-experiment-tree"></div><div class="pai-search-result hide"></div><div class="pai-btn-create" id="j-new-experiment"><span class="align-middle"><span class="icon icon-plus-o-24"></span><span class="text">'+e(d("newExperiment"))+'</span></span></div></section><section class="pai-toolbox-sec hide" id="j-toolbox-dt"><div class="pai-project-list" id="j-project-list"></div><div class="pai-dt-list" id="j-dt-tree"></div><div class="pai-btn-create" id="j-new-table">',g+="internal"!==a?'<span class="align-middle"><span class="icon icon-plus-o-24"></span><span class="text">'+e(d("createTable"))+"</span></span>":'<ul class="pai-toolbox-fixed-buttons dataset"><li><span class="icon icon-plus-o-24" style="margin-right:0px"></span><a target="_blank" href="https://lark.alipay.com/ai/pai/ql56rg"> 添加数据表</a></li></ul>',g+='</div></section><section class="pai-toolbox-sec hide" id="j-toolbox-component"><div class="flex-wapper"><div class="pai-search-form"><input type="text" class="form-control"><span class="search-text left"><span class="icon icon-search"></span><span class="text">'+e(d("searchComponent"))+'</span></span><span class="icon icon-close-o btn-clear"></span><span class="icon icon-loading-spinner"></span></div>',"aliyun"!==a&&(g+='<div class="componet-link"><a href="/components/library" target="_blank">'+e(d("componentLib"))+'</a><i class="dms-prop-label-help icon-help-o"></i></div>'),g+='</div><div class="pai-search-result hide"></div><div class="pai-component-tree" id="j-component-tree"></div><ul class="pai-toolbox-fixed-buttons">',g+=" ","aliyun"!==a&&(g+='<li class="j-component-tree-lib-li"><a href="/components/library" target="_blank" class="like-text"><span class="icon icon-list"></span><span class="text">'+e(d("componentLib"))+"</span></a></li>"),g+='</ul></section><section class="pai-toolbox-sec hide" id="j-toolbox-model"><div class="pai-search-form"><input type="text" class="form-control"><span class="search-text"><span class="icon icon-search"></span><span class="text">'+e(d("search"))+'</span></span><span class="icon icon-close-o btn-clear"></span><span class="icon icon-loading-spinner"></span></div><div class="pai-component-tree" id="j-model-tree"></div><div class="pai-search-result hide"></div></section><section class="pai-toolbox-sec hide" id="j-toolbox-settings"></section><div class="resize-bar"></div></aside><section class="pai-bpmn" id="j-bpmn" tabindex="1"></section><div class="dms-prop-item node-search-block dms-prop-item-string"><div class="dms-prop-input"><input class="search-keyword form-control" type="text" id="searchKeyWord" /><span class="btn-clear icon-close-l"></span></div><ul class="pai-dropdown"></ul></div><aside class="pai-side-right"><div class="full-fill" id="j-properties"></div><div class="resize-bar"></div></aside><div class="pai-template-panel"></div></div>'}(b.environment,b.userName,b.capHome,b.dpcHome)}}),define("ajax/experiment",["zero/zero","zero/json","./base","../global/utils","../storage/globalCache"],function(a,b,c,d,e){"use strict";var f=c.create("/experiment.json"),g=d.toInt;return{getProjectTenant:function(a){return f.get({method:"getProjectTenant",projectName:a}).then(function(a){return a?a.userDepartment:null})},getExperiment:function(a){return f.get({method:"getExperimentDesc",experimentId:a}).then(function(a){return a?a.experiment:null})},copyExperiment:function(a,b,c,d){return f.post({method:"copyExperiment",name:a,description:b,parentDirId:c,experimentId:d}).then(function(a){var b=a.documentNode;return b.parentId=b.parentDir,b.label=b.name,b})},open:function(a){return f.post({method:"openExperiment",experimentId:a}).then(function(a){return a?a.experiment:null})},close:function(a,b){var c={method:"closeOpenedExperiments",experimentIds:a};return b&&(c.projectName=b),f.post(c)},queryOpenedExperiment:function(a){var b={method:"queryOpenedExperiment"};return a&&(b.projectName=a),f.get(b).then(function(a){return a&&a.experiments||[]})},updateName:function(a,b){return f.post({method:"updateExperiment",experimentId:a,name:b})},updateDesc:function(a,b){return f.post({method:"updateExperiment",experimentId:a,description:b})},updateBizDate:function(a,b){return f.post({method:"updateExperiment",experimentId:a,bizDate:b})},executePreCheck:function(a){return f.get({method:"executePreCheck",experimentId:a},!0).then(function(a){return a&&a.checkRes})},execute:function(a){return f.post({method:"executeExperiment",experimentId:a},!0).then(function(a){if(a)return a.recordId})},executeFromUnsuccess:function(a){return f.post({method:"executeExperimentFromUnsuccess",experimentId:a},!0).then(function(a){if(a)return a.recordId})},executeFromNode:function(a,b){return f.post({method:"executeExperimentFromHere",nodeInstanceId:b,experimentId:a},!0).then(function(a){if(a)return a.recordId})},executeToNode:function(a,b){return f.post({method:"executeExperimentToHere",nodeInstanceId:b,experimentId:a},!0).then(function(a){if(a)return a.recordId})},executeNode:function(a,b){return f.post({method:"executeExperimentByOne",nodeInstanceId:b,experimentId:a},!0).then(function(a){if(a)return a.recordId})},executePmml:function(a,b){return f.post({method:"executeGenenratePmmlByOne",nodeInstanceId:b,experimentId:a},!0).then(function(a){if(a)return a.recordId})},stop:function(a){return f.post({method:"stopExperiment",recordId:a},!0).then(function(a){if(a)return a})},syncOfflineModels:function(a){var b={method:"syncOfflineModels"};return a&&(b.projectName=a),f.post(b,!0)},queryGraph:function(a){return f.get({method:"queryExperimentGraph",experimentId:a}).then(function(a){return a})},addNode:function(a,b,c,d,e){return f.post({method:"addNodeInstance",experimentId:a,nodeDefId:b,id:b,isModel:c,posX:g(d),posY:g(e)}).then(function(a){return a})},deleteNode:function(a,b){return f.post({method:"deleteNodeInstance",experimentId:a,nodeInstanceId:b}).then(function(a){return a?a.relatedNodeInstances:null})},deleteNodes:function(a,b){return f.post({method:"deleteNodeInstances",experimentId:a,nodeInstanceIds:b.join(",")}).then(function(a){return a?a.relatedNodeInstances:null})},updateNodePosition:function(a,b,c,d){return f.post({method:"updateNodeInstancePosition",experimentId:a,nodeInstanceId:b,posX:g(c),posY:g(d)})},updateNodesPosition:function(a,c){return f.post({method:"batchUpdateNodeInstancePosition",experimentId:a,newPos:b.stringify(c)})},updateNodeDetail:function(a,b,c){return f.post({method:"updateNodeInstanceDetail",experimentId:a,nodeInstanceId:b,formJSON:c})},validateModifyDependency:function(a,b,c){return f.post({method:"validateModifyDependency",experimentId:a,added:b,removed:c},!0,null)},modifyDependency:function(a,b,c){return f.post({method:"modifyDependency",experimentId:a,added:b,removed:c})},queryNodeDetail:function(a,b){return f.get({method:"queryNodeInstanceDetail",experimentId:a,nodeInstanceId:b}).then(function(a){if(a)return a.detail})},renameNodeInstance:function(a,b,c){return f.post({method:"renameNodeInstance",experimentId:a,nodeInstanceId:b,newName:c})},queryExecutionStatus:function(a){return f.get({method:"queryExecutionStatus",recordId:a},!0)},queryNodeExecutionStatus:function(a,b){return f.get({method:"queryNodeExecutionStatus",recordId:a,instId:b})},updateDependency:function(a,b){return f.post({method:"updateDependency",experimentId:a,link:b})},copyNodeInstances:function(a,c,d,e){var g={method:"copyNodeInstances",experimentId:a,copyNodes:b.stringify(d)};return e&&(g.copyGroupIds=e.join(",")),a!==c&&(g.targetExpId=c),f.post(g)},cleanupTempTable:function(a){return f.post({method:"cleanupTempTable",lastModify:a})},praiseUpOrDown:function(a,b,c,d){var e={method:"praiseUpOrDown",praise:c};return d&&(e.suggestion=d),b?e.nodeDefId=a:e.nodeInstId=a,f.post(e)},praiseTemplate:function(a,b){return f.post({method:"praiseUpOrDown",praise:b,templateId:a})},queryExperimentXml:function(a){return f.get({method:"queryExperimentXml",experimentId:a},!0).then(function(a){return a&&a.xml||""})},redoDeleteNodeInstance:function(a){return f.post({method:"redoDeleteNodeInstance",experimentId:a}).then(function(a){return a&&a.nodes||[]})},getNodeDefByCodeName:function(a){return f.get({method:"getDefDetailFromCodeName",codeName:a}).then(function(a){return a&&a.nodeDefDetail||{}})},deleteBizDate:function(a){return f.get({method:"deleteBizDate",experimentId:a})},registerModel:function(a,b){return f.get({method:"registerModelMeta",experimentId:a,nodeInstanceIds:b.join(",")})},changeExperimentProject:function(a,b){return f.post({method:"changeExperimentProject",experimentId:a,newProjectName:b}).then(function(){e.set(e.keys.projectName,b)})},searchNodesByKeywords:function(a,b){return f.post({method:"searchNodesByKeywords",experimentId:a,keyword:b})}}}),define("layout/container",["zero/zero","../i18n","../midway/layout/container","../ajax/experiment"],function(a,b,c,d){"use strict";var e={container:"#j-container"};$(e.container).html(c({capHome:window.capHome||"",dpcHome:window.dpcHome||"",userName:window.userName||"",projectName:window.currentProject||"",environment:window.currentEnvironment||""}))}),define("midway/layout/browserTip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return"<div class='pai-browser-tip' id=\"j-browser-tip\"><div class='msg'>"+e(d("browserTip"))+"</div><a href='javascript:;' class='close'>&#215;</a></div>"}()}}),define("layout/browserTip",["zero/zero","./container","../i18n","../midway/layout/browserTip"],function(a,b,c,d){function e(){f(),$(d()).prependTo(document.body).on("click",".close",f)}function f(){$("#j-browser-tip").off().remove()}!!window.chrome&&!(window.opera||navigator.userAgent.indexOf(" Opera")>=0)||e()}),define("layout/main",["./pageLoading","./container","./browserTip"],function(){}),define("global/FoldStatus",["zero/zero","zero/json","zero/declare","../storage/persistence"],function(a,b,c,d){"use strict";return c("global/FoldStatus",[],{constructor:function(a){var c=this,e=d.get(a)||"";c.key=a,c.currentProject=currentProject||"";try{c.map=b.parse(e)}catch(a){c.map={}}var f=c.map[c.currentProject]||"";c.status=f?f.split(";"):[]},save:function(c){var e=this,f=e.status,g=e.getPath(c);c.isExpanded?(a.each(c.children,function(a){a.isBranch&&a.isExpanded&&e.save(a)}),e.isOpen(c)||f.push(g)):e.removePath(g),e.map[e.currentProject]=f.join(";"),d.set(e.key,b.stringify(e.map))},removePath:function(a){for(var b=this,c=b.status,d=c.length-1;d>=0;d--)c[d]&&0===c[d].indexOf(a)&&c.splice(d,1)},getPath:function(a){for(var b=this,c=[b.getTreeNodeId(a)],d=a.parent;d;)c.unshift(b.getTreeNodeId(d)),d=d.parent;return c.join(",")},getTreeNodeId:function(a){return a.originId||a.id},isOpen:function(b){var c=this,d=c.getPath(b);return a.some(c.status,function(a){if(a&&0===a.indexOf(d))return!0})}})}),define("global/download",[],function(){"use strict";function a(a){return String(a)}function b(){var b=window.Blob||window.MozBlob||window.WebKitBlob||a;return b.call?b.bind(window):Blob}function c(a){for(var b=a.split(/[:;,]/),c=b[1],d="base64"===b[2]?atob:decodeURIComponent,e=d(b.pop()),f=[],g=0;g<e.length;g++)f.push(e.charCodeAt(g));return new j([new Uint8Array(f)],{type:c})}function d(a){var b=a.split("/").pop().split("?")[0],c=document.createElement("a");if(c.href,-1!==c.href.indexOf(encodeURI(a))){var d=new XMLHttpRequest;return d.open("GET",a,!0),d.responseType="blob",d.onload=function(a){f(a.target.response,b,g)},setTimeout(function(){d.send()},0),d}}function e(a,b,c){var d=document.createElement("a");if("download"in d)return d.href=a,d.setAttribute("download",b),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout(function(){d.click(),document.body.removeChild(d),!0===c&&setTimeout(function(){window.URL.revokeObjectURL(d.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(a)&&(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),window.open(a)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=a),!0;var e=document.createElement("iframe");document.body.appendChild(e),!c&&/^data:/.test(a)&&(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),e.src=a,setTimeout(function(){document.body.removeChild(e)},333)}function f(b,f,k){var l=!f&&!k&&b;if(l&&l.length<2048){var m=d(l);if(m)return m}var n=f||"download",o=k||g;if(/^data\:[\w+\-]+\/[\w+\-\.]+[,;]/.test(b)){if(!(b.length>h&&j))return i?i(c(b),n):e(b,n);b=c(b),o=b.type||g}var p=b instanceof j?b:new j([b],{type:o});if(i)return i(p,n);if(window.URL)e(window.URL.createObjectURL(p),n,!0);else{if("string"==typeof p||p.constructor===a)try{return e("data:"+o+";base64,"+window.btoa(p),n)}catch(a){return e("data:"+o+","+encodeURIComponent(p),n)}var q=new FileReader;q.onload=function(){e(this.result,n)},q.readAsDataURL(p)}return!0}var g="application/octet-stream",h=2096103.424,i=navigator.msSaveBlob,j=b()
;return f.downFromURL=d,f}),define("global/classNames",["zero/zero"],function(a){"use strict";var b={user_code:"element-r",analytics:"element-analytics",default:"element-default",evaluation:"element-evaluation",hideNode:"element-model",model:"element-model",otherModel:"element-otherModel",process:"element-process",source:"element-source",training:"element-training"},c={modelDeleted:"element-deleted"},d={favorite:"icon-star-l",group:"icon-group-24",user_code:"icon-script",analytics:"icon-analysis",default:"icon-c",evaluation:"icon-dimensions",hideNode:"icon-diamond",model:"icon-diamond",otherModel:"icon-diamond",process:"icon-click",source:"icon-data",training:"icon-shape"},e={1:"icon-data",2:"icon-analysis",3:"icon-shape",4:"icon-dimensions",5:"icon-diamond",6:"icon-diamond",7:"icon-click"},f={default:"icon-warning-o",fail:"icon-close-o",ready:"",running:"icon-loading",success:"icon-ok-o",dryRunSuccess:"dry-run icon-ok-o",upChangeSuccess:"up-change icon-ok-o",modelDeleted:"icon-warning-o"},g={favorite:"icon-star"},h={getTreeBranchIcon:function(a){var b=a.category;return g[b]||(a.isExpanded?"icon-folder-open":"icon-folder")},getComponentIcon:function(a){var b,c=a.iconType||a.nodeInstanceIconType||0;if(c&&(b=e[c]),b)return b;var f=a.category||a.nodeInstanceCategory;return d[f]||d.default},getComponentClass:function(a){var d=a.category||a.nodeInstanceCategory,e=a.nodeInstanceStatus||a.status||"ready";return c[e]||b[d]||b.default},getComponentAdditionalIcon:function(a){var b=a.nodeInstanceStatus||a.status||"ready";return f[b]},getNodeClassNames:function(a){return{elementClass:h.getComponentClass(a),additionalIcon:h.getComponentAdditionalIcon(a),iconClass:h.getComponentIcon(a)}}};return h}),define("global/environment",{isBase:"base"===currentEnvironment,isBaseDP:"basedp"===currentEnvironment,isInternal:"internal"===currentEnvironment,isAntLab:"antlab"===currentEnvironment,isAliyun:"aliyun"===currentEnvironment,isAntCloud:"antcloud"===currentEnvironment}),define("global/codeName",[],function(){"use strict";var a={getWithOutVersion:function(a){return a.replace(/_\d+$/,"")},isSameCodeName:function(b,c){return b=b.toLowerCase(),c=c.toLowerCase(),a.getWithOutVersion(b)===c}};return a}),define("global/nodeMenuChecker",["zero/zero","zero/querystring","../global/codeName"],function(a,b,c){"use strict";var d=a.some,e=c.isSameCodeName,f={isSameCodeName:e,hasPropPanel:function(a){return!d(["auc","model_template"],function(b){return e(a,b)})},isModelNode:function(a){},canDeployAsService:function(a){return d(["Prediction"],function(b){return e(a,b)})},canExecuteFromNode:function(a){return!d(["compositeRoc","compositeConfusionMatrix","optimal_model_selection"],function(b){return e(a,b)})},canExecuteToNode:function(a){return!d(["odps_source","optimal_model_selection"],function(b){return e(a,b)})},canExecuteNode:function(a){return!d(["odps_source","optimal_model_selection"],function(b){return e(a,b)})},canRefreshFields:function(a){return d(["odps_source"],function(b){return e(a,b)})},shouldHideTryExecute:function(a){return d(["ConvLSTM_Train","ConvLSTM_Predict","optimal_model_selection_auto"],function(b){return e(a,b)})},canShowAnalyticsReport:function(a){return d(["factor_analyze","antspark_histogram","antspark_scatterdiagram","Percentile","SimpleSummary","Histogram","histograms","HistoWithBin","data_compare","residual_histogram","pearson","Binarization","enum_feature_selection","scatter_diagram","t_test","chisq_test","chisq_test_fit","chisq_test_independence","evaluation","gbdt_importance","GBDT","GBDT_LR","gbdt_lr_infocode","regression_feature_importance","feature_importance","fe_select_runner","fe_normlize_runner","fe_scale_runner","fe_discrete_runner","fe_soften_runner","fe_meta_runner","empirical_pdf","DNN","C5","box_plot","scorecard_grouping","linearregression","glm","glm_insurance","glm_insurance_predict","normality_test","Quantile","LorenzCurve","corrcoef","corresp","DNN_CPU","ConvLSTM_Train","decompose","pivot_table","GainCurveGini","lrreportsummary","ssd_train","detection_eval","boxcox","tfidf"],function(b){return e(a,b)})},canShowEvaluationReport:function(a){return d(["roc","confusionmatrix","antspark_confusionmatrix","mc_eval_wf","antspark_multi_evaluate","evaluate","cluster_evaluation","ConvLSTM_Predict","antspark_evaluate"],function(b){return e(a,b)})},canShowModelReport:function(a){return d(["holt_winters","x13_arima","x13_auto_arima","statistics_linear_regression","statistics_logistic_regression","linear_model","psi","fitscale","statistics_logistic_regression","statistics_linear_regression","ftgarch"],function(b){return e(a,b)})},canBinning:function(a){return d(["binning"],function(b){return e(a,b)})},doCumulateGroup:function(a){return d(["cumulate_group"],function(b){return e(a,b)})},canEditModel:function(a){return d(["CartBinaryClassTrain","CartRegressionTrain","CartMultipleClassTrain"],function(b){return e(a,b)})},canViewLog:function(a){return!d(["odps_source","odps_target","model_template","algo_inputtype_config","optimal_model_selection"],function(b){return e(a,b)})},canShowScatterDiagram:function(a){return d(["scatter_diagram"],function(b){return e(a,b)})},showModelMenu:function(a){return f.showPmmlOption(a)||f.showModelOption(a)},showPmmlOption:function(a){return d(["pai_spark_xgboost","pai_spark_hyperparam_xgboost","pai_spark_multi_xgboost","pai_spark_hyperparam_multi_xgboost","pai_spark_regression_xgboost","antspark_LRClassifier","antspark_rfClassifier","antspark_gbdtClassifier","antspark_gbdtRegression","antspark_linearRegression","normalize","standardize","binning","logisticregression_binary","logisticregression_multi","random_forests","isolationforest","GBDT_LR","gbdt_lr_infocode","KMeans","linearregression","LinearSVM","CartBinaryClassTrain","CartMultipleClassTrain","CartRegressionTrain","linear_model","glm_insurance","GBDT","onepass_kmeans","kmodes","kprototype","pai_ps_smart_regression","pai_ps_smart_binary","pai_ps_smart_muti","optimal_model_selection_auto"],function(b){return e(a,b)})},showModelOption:function(a){return d(["antspark_LRClassifier","antspark_rfClassifier","antspark_gbdtClassifier","antspark_gbdtRegression","antspark_linearRegression","LinearSVM","logisticregression_binary","GBDT_LR","gbdt_lr_infocode","xgboost_cls","logisticregression_multi","random_forests","isolationforest","NaiveBayes","linearregression","GBDT","xgboost_reg","etrec","KMeans","linear_model","glm_insurance","split_word_model","CartBinaryClassTrain","CartMultipleClassTrain","CartRegressionTrain","model_template","DNN_model_template","table_output_model"],function(b){return e(a,b)})},isSpark:function(a){return d(["antspark_LRClassifier","antspark_rfClassifier","antspark_gbdtClassifier","antspark_gbdtRegression","antspark_linearRegression"],function(b){return e(a,b)})},isInteractiveVariable:function(a){return d(["interactive_variable"],function(b){return e(a,b)})},isMultiLogistic:function(a){return d(["logistic_regression","logisticregression_multi"],function(b){return e(a,b)})},isBinaryLogistic:function(a){return d(["logisticregression_binary"],function(b){return e(a,b)})},isRandomForests:function(a){return d(["random_forests"],function(b){return e(a,b)})},isGBDT:function(a){return d(["GBDT_1","GBDT_LR","gbdt_lr_infocode","GBDT_LR_1"],function(b){return e(a,b)})},isBinaryAlgo:function(a){return d(["GBDT_LR","RANDOM_FORESTS","LOGISTIC_REGRESSION_BINARY","PAI_PS_SMART_BINARY"],function(b){return e(a,b)})},isIsolationForest:function(a){return d(["isolationforest"],function(b){return e(a,b)})},isKMeans:function(a){return d(["KMeans"],function(b){return e(a,b)})},isLinearRegression:function(a){return d(["linearregression"],function(b){return e(a,b)})},isLinearSVM:function(a){return d(["LinearSVM"],function(b){return e(a,b)})},isGLM:function(a){return d(["glm_insurance"],function(b){return e(a,b)})},isEvaluation:function(a){return d(["evaluate"],function(b){return e(a,b)})},isStructure2Vec:function(a){return d(["structure2vec"],function(b){return e(a,b)})},canShowGenerateReport:function(a){return f.isEvaluation(a)},showGroup:function(a){return!d(["optimal_model_selection"],function(b){return e(a,b)})},showGroupLoop:function(a){return!d(["odps_source","optimal_model_selection","optimal_model_selection_auto"],function(b){return e(a,b)})},canShowModel:function(a){return f.isMultiLogistic(a)||f.isBinaryLogistic(a)||f.isLinearRegression(a)||f.isRandomForests(a)||f.isIsolationForest(a)||f.isKMeans(a)||f.isLinearSVM(a)||e(a,"antspark_LRClassifier")},canShowFeatureAnalysis:function(a){return(window.GLOBALS.whitelist||[]).indexOf(window.GLOBALS.userId)>-1},canRegisterModel:function(a){return d(["DeepPredictionTrain"],function(b){return e(a,b)})},canEditDecisionTree:function(a){return d(["interactive_binary_dtree"],function(b){return e(a,b)})}};return f}),define("global/zeroUIWithLog",["zero/zero","zero/ui/ContextMenu"],function(a,b){"use strict";function c(a,c){var d=a.on;a.key;if(d){var e={};for(var f in d)d.hasOwnProperty(f)&&(e[f]=function(a){var b=a.activeMenuItem.key;d[b](a)});a.on=e}return new b(a)}return{initMenu:c}}),define("global/config",["zero/zero","zero/querystring"],function(a,b){"use strict";var c=window.currentExperimentId,d={currentExperimentId:a.toInt(c||0),maxExperimentsCount:15,forceFreezeToolbox:!1,reg:{xss:/[<\/>]/},NS:{model:"model-"},globalColor:{colors:["#289de9","#ff981f","#91278f","#67cc6f","#b0d961","#ffb553","#e95354","#bc0080","#0064ab","#04477c","#81c6e0","#00d4d5","#8eebc1","#e95f7c","#8b658e","#6f4165","#6f5659","#d97f65","#97bbcd","#addfa1"]}},e=b.parse(window.location.search);return Object.prototype.hasOwnProperty.call(e,"freeze")&&(d.forceFreezeToolbox=!0),d}),define("storage/componentCache",["zero/zero","../global/config","./cacheBase"],function(a,b,c){"use strict";var d=c.create("component");return d.add=function(c,e){return a.isArray(c)||(c=[c]),a.each(c,function(a){a.isBranch||(!0===e?d.set(b.NS.model+a.id,a):d.set(a.originId||a.id,a))}),c},d}),define("ajax/search",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/search.json");return{all:function(a){return c.get({query:a})},searchComponents:function(a){return c.get({method:"searchByKeyword",keyword:a,pageNum:1,pageSize:1e4})},searchExperiments:function(a){return c.get({method:"searchExperimentByKeyword",keyword:a,pageNum:1,pageSize:1e4})},searchModels:function(a){return c.get({method:"searchModelByKeyword",keyword:a,pageNum:1,pageSize:1e4})}}}),define("ajax/model",["zero/zero","zero/json","./base"],function(a,b,c){"use strict";function d(b,c,d,e){var f={method:b};return e=e||{},d?(f.nodeDefId=c,f.id=c):f.nodeInstanceId=c,a.extend(f,e)}var e=c.create("/modelAjax.json"),f=c.getProjectName();return{exportOutputURI:"/exportPMML.htm?nodeInstanceId=%s&projectName="+f,exportOutputURIByNodeDefId:"/exportPMML.htm?nodeDefIds=%s&projectName="+f,queryModelMeta:function(a,b){return e.get(d("queryModelMeta",a,b)).then(function(a){if(a)return a.meta})},queryModelPMML:function(a,b,c){var f=d("queryModelPMML",a,b);return c&&(f.loopTimestamp=c),e.get(f,!0).then(function(a){if(a)return a.pmml})},queryRandomForestsBase:function(a,b,c){var f=d("queryRandomForestsBase",a,b);return c&&(f.loopTimestamp=c),e.get(f).then(function(a){if(a)return a.base})},queryRandomForestsChildNodes:function(a,b,c,f){return e.get(d("queryRandomForestsChildNodes",a,f,{treeId:b,nodeId:c})).then(function(a){if(a)return a.childNodes})},queryRandomForestsTree:function(a){var b=d("queryRandomForestsTree",a.nodeInstanceId,a.fromNodeDef,a.extraParams);return a.loopTimestamp&&(b.loopTimestamp=a.loopTimestamp),e.get(b)},simpleSummary:function(a,b,c,d){var f={method:"querySimpleSummary",nodeInstanceId:a,experimentId:c};return b&&(f.nodeDefId=b),d&&(f.loopTimestamp=d),e.get(f,!0).then(function(a){return a.summary})},queryPearson:function(a,b,c,d){var f={method:"queryPearson",nodeInstanceId:a,experimentId:c};return b&&(f.nodeDefId=b),d&&(f.loopTimestamp=d),e.get(f,!0).then(function(a){return a.pearson})},queryModularity:function(a,b,c,d){var f={method:"queryModularity",nodeInstanceId:a,experimentId:c};return b&&(f.nodeDefId=b),d&&(f.loopTimestamp=d),e.get(f,!0).then(function(a){return a.modularity})},percentile:function(a,b,c,d){var f={method:"queryPercentile",nodeInstanceId:a,experimentId:c};return b&&(f.nodeDefId=b),d&&(f.loopTimestamp=d),e.get(f,!0).then(function(a){return a.percentiles})},dataComp:function(a,b,c){return e.get({method:"getDataCompare",nodeInstanceId:a,experimentId:b,projectName:c},!0).then(function(a){return a})},confusionMatrix:function(a,b,c,d){var f={method:"queryConfusionMatrix",nodeInstanceId:a,experimentId:c};return b&&(f.nodeDefId=b),d&&(f.loopTimestamp=d),e.get(f,!0).then(function(a){return a.confusionMatrix})},roc:function(a,b,c,d){var f={method:"queryRoc",nodeInstanceId:a,experimentId:c};return b&&(f.nodeDefId=b),d&&(f.loopTimestamp=d),e.get(f,!0).then(function(a){return a.roc})},auc:function(a,b,c){return e.get({method:"queryAuc",nodeInstanceId:a,nodeDefId:b,experimentId:c},!0).then(function(a){return a.auc})},queryKMeans:function(a,b,c){var d={method:"queryKMeans"};return a?d.nodeDefId=a:d.nodeInstanceId=b,c&&(d.loopTimestamp=c),e.get(d,!0).then(function(a){return a&&a.base||null})},histogram:function(a,b,c,d,f,g){return d=d||0,f=f||0,g=g||0,e.get({method:"queryHistogram",nodeInstanceId:a,nodeDefId:b,experimentId:c,min:d,max:f,step:g},!0).then(function(a){return a.histogram})},featureEngineering:function(a,b,c){var d={method:"queryFeatureMetaData",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d,!0).then(function(a){return a.featureMeta})},queryEnumFeatureSelectionData:function(a,b,c){var d={method:"queryEnumFeatureSelectionData",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d,!0).then(function(a){return a.enumFeatureSelectionData})},queryBatchHistogramData:function(a,b,c){var d={method:"queryBatchHistogramData",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d,!0).then(function(a){return a.histograms})},getCumulateGroup:function(a,b,c){return e.get({method:"queryCumulateGroupData",nodeInstanceId:a,experimentId:b,operation:"read",recover:!!c,limit:1e4},!0)},saveCumulateGroup:function(a,b,c){return e.post({method:"writeCumulateGroupData",nodeInstanceId:a,experimentId:b,featuresJson:JSON.stringify(c),limit:1e5},!0)},rerunCumulateGroup:function(a,b,c){return e.post({method:"rerunCumulateGroup",nodeInstanceId:a,experimentId:b,featuresJson:JSON.stringify(c),limit:1e5},!0).then(function(a){return a.recordId})},getBinning:function(a,b,c){return e.get({method:"queryBinningData",nodeInstanceId:a,experimentId:b,operation:"read",recover:!!c,limit:1e4},!0)},saveBinning:function(a,b,c,d){return e.post({method:"writeBinningData",nodeInstanceId:a,experimentId:b,featuresJson:JSON.stringify(c),constraintJson:JSON.stringify(d)||"",limit:1e5},!0)},rerunBinning:function(a,b,c,d){return e.post({method:"rerunBinning",nodeInstanceId:a,experimentId:b,featuresJson:JSON.stringify(c),constraintJson:JSON.stringify(d),limit:1e5},!0).then(function(a){return a.recordId})},getEvaluate:function(a,b,c,d){var f={method:"queryEvaluateData",nodeInstanceId:a,experimentId:b,size:c||1e5,reject:!0};return d&&(f.loopTimestamp=d),e.get(f,!0)},queryJsonData:function(a,b,c){var d={method:"queryJsonData",nodeInstanceId:b,experimentId:a};return c&&(d.loopTimestamp=c),e.get(d,!0)},queryRegressionEvaData:function(a,b,c){var d={method:"queryRegressionEvaData",nodeInstanceId:b,experimentId:a};return c&&(d.loopTimestamp=c),e.get(d,!0)},checkExportPmml:function(a,b,c){var d={method:"checkExportPmml",nodeInstanceId:b,experimentId:a};return c&&(d.loopTimestamp=c),e.get(d)},queryColsAsHistogramSchema:function(a,b,c){var d={method:"queryColsAsHistogramSchemaV2",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d,!0)},getPerformanceReport:function(a,b,c){return e.get({method:"getPerformanceReport",nodeInstanceId:a,experimentId:b,key:c},!0)},queryEmpiricalPDF:function(a,b,c){var d={method:"queryEmpiricalPDF",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d).then(function(a){return a&&a.empiricalPDFCurve})},getDNNDataPoints:function(a,b,c){var d={method:"getDNNDataPoints",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d)},getConvLSTMDataPoints:function(a,b,c){var d={method:"getConvLSTMDataPoints",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d)},queryScatterData:function(a,b,c){return e.get({method:"queryScatterData",nodeInstanceId:a,experimentId:b,projectName:c})},queryC5Output:function(a,b,c){var d={method:"queryC5OutputParse",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d,!0).then(function(a){return a&&a.c5outputparse||{}})},queryCARTTree:function(a,b,c){return e.get({method:"queryCARTTree",nodeInstanceId:a,treeId:b,treeDeep:c}).then(function(a){return a&&a.tree||{}})},cutCARTNodes:function(a,b,c){return e.post({method:"cutCARTNodes",nodeInstanceId:a,experimentId:b,cutIds:c.join(",")}).then(function(a){return a})},getBoxPlotData:function(a,b,c){var d={method:"getBoxPlotData",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d).then(function(a){return a.boxPlotData})},getScorecardGroupingTree:function(a,b,c){var d={method:"getScorecardGroupingTree",nodeInstanceId:a,experimentId:b};return c&&(d.loopTimestamp=c),e.get(d).then(function(a){return a.childNodes})},getScorecardGroupingModelById:function(a,b){return e.get({method:"getScorecardGroupingModelById",nodeInstanceId:a,groupId:b}).then(function(a){return a})},getScorecardGroupingRules:function(a,b){return e.get({method:"getScorecardGroupingRules",nodeInstanceId:a,groupId:b}).then(function(a){return a.rules})},getLinearModelStatic:function(a,b){var c={method:"getLinearModelStatic",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c).then(function(a){return a.tabs||a.groups})},getGLMData:function(a,b){var c={method:"getGLMData",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c).then(function(a){return a&&a.tabs||{}})},getNormalityTestData:function(a,b){var c={method:"getNormalityTestData",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c,!0).then(function(a){return a&&a.normalityData||{}})},queryLrCoefficientTableName:function(a,b,c){var d={method:"queryLrCoefficientTableName"};return a?d.nodeDefId=a:d.nodeInstanceId=b,c&&(d.loopTimestamp=c),e.get(d).then(function(a){return a&&a.coefficientTableName||""})},writeLRCoefficients:function(a,b,c){var d={method:"writeLRCoefficients"};return a?d.nodeDefId=a:d.nodeInstanceId=b,c&&(d.loopTimestamp=c),e.post(d,!0)},getCorrespData:function(a,b){var c={method:"getCorrespData",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c).then(function(a){return a.correspData||{}})},queryKmeansModelTableName:function(a,b,c){var d={method:"queryKmeansModelTableName"};return b?d.nodeDefId=b:d.nodeInstanceId=a,c&&(d.loopTimestamp=c),e.get(d).then(function(a){return a&&a.coefficientTableName||""})},writeKmeansModel:function(a,b,c){var d={method:"writeKmeansModel"};return b?d.nodeDefId=b:d.nodeInstanceId=a,c&&(d.loopTimestamp=c),e.post(d,!0)},generateDecisionTreeRules:function(b){return e.post(a.extend({method:"generateDecisionTreeRules"},b))},generateGbdtTreeRules:function(b){return e.post(a.extend({method:"generateGbdtTreeRules"},b))},generateDecisionSQL:function(b){return e.post(a.extend({method:"generateDecisionSQL"},b))},saveDecisionSQL:function(b){return e.post(a.extend({method:"generateDecisionSQLAndSave"},b),!0)},getGainCurve:function(a,b){var c={method:"getGainCurve",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c,!0)},getGLMResidual:function(a,b){var c={method:"getGLMResidual",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c,!0)},getPivotTableData:function(a,b){var c={method:"getPivotTableData",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c,!0)},getLRReportSummary:function(a,b){var c={method:"getLRReportSummary",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c,!0)},getSSDCurve:function(a,b){var c={method:"getSSDCurve",nodeInstanceId:a};return b&&(c.loopTimestamp=b),e.get(c,!0)},getArmorTensorBoard:function(a){var b={method:"getTensorBoard",nodeInstanceId:a};return e.get(b,!0)}}}),define("ajax/modelTree",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/modelTree.json");return{queryOwnModels:function(a,b){return c.get({method:"queryCurrentModelTrees",parentId:a,expId:b})},querySyncModels:function(){return c.get({method:"querySyncModels"})},querySavedModels:function(){return c.get({method:"querySavedModels"})},querySharedModels:function(){return c.get({method:"querySharedModel"}).then(function(a){return{newModelNum:a.newModelNum,models:a.sharedModels}})},shareModel:function(a,b,d){return c.post({method:"authorizeModel",modelId:a,projectName:d,targetUserNumber:b})},archivingModels:function(a,b){return c.post({method:"addBatchModelsToSavedDir",saveIds:a,deleteIds:b})},saveModel:function(a,b,d,e){var f={method:"addModelToSavedDir"};return f[b?"nodeInstanceId":"modelId"]=a,d&&(f.newDisplayName=d),e&&(f.loopTimestamp=e),c.post(f)},queryModelDesc:function(a,b,d){var e={method:"queryModelDesc"};return a?e.modelId=a:e.nodeInstanceId=b,d&&(e.loopTimestamp=d),c.get(e)},move:function(a,b,d){return c.post({method:"moveDir",childId:a,parentId:b,isModel:d})},rename:function(a,b,d){return c.post({method:"renameModel",id:a,newName:b,isModel:d})},delete:function(a,b){return c.post({method:"deleteModel",treeId:a,isModel:b})},clickNewModel:function(a){return c.post({method:"clickNewModel",modelId:a})},locateModelDir:function(a){return c.get({method:"revealInTree",experimentId:a}).then(function(a){return a&&a.parentIds||[]})},locateModel:function(a,b){return c.get({method:"revealModelInTree",experimentId:a,nodeInstanceId:b}).then(function(a){return a&&a.parentIds||[]})},deployModel:function(a,b,d,e,f){return c.post({method:"deployOnlineModel",modelId:a,onlineProjectName:b,projectName:d,cpuCores:e,memory:f},!0)},deployModelAsync:function(a,b,d,e,f){return c.post({method:"deployOnlineModelAsyn",modelId:a,onlineProjectName:b,projectName:d,cpuCores:e,memory:f},!0).then(function(a){return a&&a.jobId||""})},updateModel:function(a,b){return c.post({method:"updateOnlineModel",modelId:a,projectName:b},!0)},updateModelAsync:function(a,b){return c.post({method:"updateOnlineModelAsyn",modelId:a,projectName:b},!0).then(function(a){return a&&a.jobId||""})},queryOnlineModelDesc:function(a,b,d){var e=Object.assign({},{method:"queryOnlineModelDesc",modelId:a,projectName:b});return void 0!=d&&(e.version=d),c.get(e,!0)},queryPmmlOssPath:function(a,b,d){var e={method:"queryPmmlOssPath"};return a&&(e.nodeInstanceId=a),b&&(e.nodeDefIds=b),d&&(e.loopTimestamp=d),c.get(e)},updateModelToOss:function(a,b,d){var e={method:"uploadModelToOssAsyn"};return a&&(e.modelId=a),b&&(e.nodeInstanceId=b),d&&(e.loopTimestamp=d),c.post(e).then(function(a){return a&&a.jobId||""})},deleteOnlineModel:function(a,b){return c.post({method:"deleteOnlineModel",modelId:a,version:b},!0)}}}),define("ajax/common",["zero/zero","../i18n","../global/notify","./base"],function(a,b,c,d){"use strict";var e=d.create("/common.json");return{getProjectList:function(){return e.get({method:"getProjectList"}).then(function(b){var c={};if(c.projectList=a.map(b.projectList,function(a){var b={id:a.id,name:a.name||a.dataSourceName,isPrivate:!!a.isPrivate,isDefault:!!a.isDefault};return b.isDefault&&(c.currentProject=b.name),b}),!c.currentProject){var d=c.projectList[0];d&&(d.isDefault=!0,c.currentProject=d.name)}return c})},getNamespaceList:function(){return e.get({method:"getNamespaceList"}).then(function(a){return a&&a.namespaceList||[]})},queryAsynJobStatus:function(a,b){var d={method:"queryAsynJobStatus",jobId:a};return b&&(d.loopTimestamp=b),e.post(d,!0).then(function(a){if("failed"===a.status)throw c.error(translate("taskFailed")),new Error("failed");return a})}}}),define("midway/dialog/model/preparePMML",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="msg"><span class="icon icon-loading-spinner"></span><p>'+e(d("preparingPMML"))+"</p></div>"}()}}),define("dialog/model/preparePMML",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/common","../../ajax/modelTree","../../midway/dialog/model/preparePMML"],function(a,b,c,d,e,f){"use strict";function g(a,c){function e(){d.queryAsynJobStatus(a,c).then(function(a){if("done"===a.status){var b=[];a.modelPath&&(b.push({url:a.modelPath}),window.open(a.modelPath)),a.confPath&&(b.push({url:a.confPath}),window.open(a.confPath)),window.react_bridge.actions&&window.react_bridge.actions.downloadUrl&&window.react_bridge.actions.downloadUrl(b),g.hide()}else setTimeout(e,3e3)},function(){g.hide()})}var g;g=new b({title:h("exportPMML"),className:"dialog-prepare-pmml",body:f(),destroyOnHide:!0,canFullscreen:!1,afterShow:e,buttons:[{text:h("close"),click:function(){this.hide()}}]})}var h=c.translate;return{show:g}}),define("midway/dialog/model/showDescription",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g,h,i,j,k,l,m,n){var o='<table class="table table-hover"><tr><td style="min-width: 120px;">'+e(d("modelId"))+"</td><td>"+e(b)+"</td></tr><tr><td>"+e(d("modelName"))+"</td><td>"+e(c)+"</td></tr><tr><td>"+e(d("odpsModelName"))+"</td><td>"+e(f)+"</td></tr><tr><td>"+e(d("fromNodeInstName"))+"</td><td>"+e(g)+"</td></tr><tr><td>"+e(d("fromAlgo"))+"</td><td>"+e(h)+"</td></tr><tr><td>"+e(d("features"))+'</td><td><div class="feature-col">'+e(i)+"</div></td></tr><tr><td>"+e(d("targetColName"))+"</td><td>"+e(j)+"</td></tr><tr><td>"+e(d("parameters"))+"</td><td>";return a.each(k,function(a,b){o+="<div>"+e(b)+": "+e(a)+"</div>"}),o+="</td></tr>",l&&(o+="<tr><td>"+e(d("loopParams"))+"</td><td>",a.each(l,function(a){o+="<div>"+e(a.paramName)+": "+e(a.paramValue)+"</div>"}),o+="</td></tr>"),o+="<tr><td>"+e(d("createTime"))+"</td><td>"+e(m)+"</td></tr><tr><td>"+e(d("updateTime"))+"</td><td>"+e(n)+"</td></tr></table>"}(b.modelId,b.name,b.odpsModelName,b.fromNodeInstName,b.algoName,b.features,b.labelCol,b.parameters,b.loopParams,b.gmtCreate,b.gmtUpdate)}}),define("dialog/model/showDescription",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/modelTree","../../midway/dialog/model/showDescription"],function(a,b,c,d,e){"use strict";function f(a,c,f){new b({title:g("modelDesc"),className:"dialog-model-desc",destroyOnHide:!0,canFullscreen:!1,afterShow:function(){var b=this;d.queryModelDesc(a,c,f).then(function(a){var c=$.extend({algoName:"",fromNodeInstName:"",gmtCreate:"",gmtUpdate:"",labelCol:"",name:"",odpsModelName:"",features:"",parameters:{},loopParams:""},a.modelDesc);c.loopParams&&(c.loopParams=c.loopParams.replace(/\&quot\;/gi,'"'),c.loopParams=JSON.parse(c.loopParams)),b.set("body",e(c))})},buttons:[{text:g("close"),click:function(){this.hide()}}]})}var g=c.translate;return{show:f}}),define("dialog/model/deletionConfirm",["zero/zero","zero/ui/Confirm","../../ajax/modelTree","../../i18n"],function(a,b,c,d){"use strict";function e(a){return new Promise(function(d){b({title:f("delete"),body:f(a.isBranch?"confirmDeleteDir":"confirmDeleteModel",a.name),onAccept:function(){c.delete(a.originId,a.isModel).then(d)}})})}var f=d.translate;return{show:e}}),define("dialog/model/saveModel",["zero/zero","zero/ui/DialogSingleInput","../../ajax/modelTree","../../global/config","../../i18n"],function(a,b,c,d,e){"use strict";function f(a,d,e){return new Promise(function(f){function i(a){var b=this;return a?g.xss.test(a)?b.showErrorTip(h("inputXss")):c.saveModel(d,e,a).then(function(a){a.isDuplicate?b.showErrorTip(h("duplicateModelName")):(b.destroy(),f(a))}):b.showErrorTip(h("inputPlaceholder")),!1}new b({title:h("rename"),placeholder:h("inputPlaceholder"),inputValue:a,callback:i})})}var g=d.reg,h=e.translate;return{show:f}}),define("ajax/userProfile",["zero/zero","zero/json","./base"],function(a,b,c){"use strict";var d=c.create("/userProfile.json");return{query:function(){return d.get({method:"queryProfiles"}).then(function(a){return a&&a.profiles||{}})},update:function(a){return d.post({method:"modifyProfiles",profile:b.stringify(a)},!0)},searchUser:function(a){return d.get({method:"searchUserByKeyword",keyword:a,pageIndex:1,pageSize:10}).then(function(a){return a&&a.userModels||[]})}}}),define("midway/dialog/model/shareTo",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="form-group"><label for="modelName">'+e(d("modelName"))+'</label><input type="text" class="form-control"id="modelName" value="'+e(a)+'" disabled></div><div class="form-group"><label for="acUserList">'+e(d("chooseUser"))+'<span class="tips">'+e(d("chooseUserTip"))+'</span></label><input type="text" class="form-control" id="acUserList"placeholder="'+e(d("searchUserTip"))+'"><div class="err-msg"><span class="icon icon-close-c"></span>'+e(d("chooseUserError"))+'</div></div><div class="form-group"><div class="tags-container"></div></div>'}(b.name)}}),define("dialog/model/shareTo",["zero/zero","zero/ui/DialogEx","zero/ui/Tags","zero/ui/AutoComplete","../../i18n","../../global/notify","../../ajax/userProfile","../../ajax/modelTree","../../midway/dialog/model/shareTo"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=this;p=new d({input:a.$(s.user),ignorecase:!0,fillIn:!1,delay:500,renderItem:function(a){return a.nickName+"["+a.trueName+","+a.email+"]"},load:function(a,b){g.searchUser(a).then(function(a){b(a)})}}).on("select",function(a){n.append([a])});var b=a.$(s.tags);n=new c({container:b,tagNameProp:"nickName",autocomplete:!1,on:{change:function(a){b.toggleClass(t.hide,0===a.length),q.toggleClass(t.hasError,0===a.length)}}}),b.addClass(t.hide),q=a.$(s.user).parents(s.formGroup)}function k(){n.destroy(),p.destroy(),o=null}function l(){var b=this,c=n.getAllData();if(!c.length)return void q.addClass(t.hasError);b.showLoading();var d=a.map(c,function(a){return a.userNumber});h.shareModel(o.id,d.join(","),o.projectName).then(function(){b.hideLoading(),f.success(r("shareSuccess")),b.hide()},function(){b.hideLoading()})}function m(a){o=a,new b({title:r("shareTo"),className:"dialog-share-to",destroyOnHide:!0,body:i(a),afterShow:j,beforeHide:k,buttons:[{text:r("share"),type:"primary",click:l},{text:r("close"),click:function(){this.hide()}}]})}var n,o,p,q,r=e.translate,s={user:"#acUserList",tags:".tags-container",formGroup:".form-group"},t={hide:"hide",hasError:"has-error"};return{show:m}}),define("dialog/model/renameTreeNode",["zero/zero","zero/ui/DialogSingleInput","../../ajax/modelTree","../../global/config","../../i18n"],function(a,b,c,d,e){"use strict";function f(a){return new Promise(function(d){function e(b){var e=this;return b?g.xss.test(b)?e.showErrorTip(h("inputXss")):c.rename(a.originId,b,a.isModel).then(function(){a.name=b,a.label=b,e.destroy(),d(a)}):e.showErrorTip(h("inputPlaceholder")),!1}new b({title:h("rename"),placeholder:h("inputPlaceholder"),inputValue:a.name,callback:e})})}var g=d.reg,h=e.translate;return{show:f}}),define("ajax/odpsControl",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/odpsControl.json"),d=b.getProjectName();return{listColsInfo:function(a){return c.get({method:"listColsInfo",nodeInstanceId:a},!0).then(function(a){return a.warnMessage=a.warnMessage||"",a})},listTables:function(a,b,d){return c.get({method:"listTables",paramName:b,keyword:d,limit:20}).then(function(a){return a?(a.tableList||[]).map(function(a){return a.projectName&&(a.name=a.fullTableName),a}):[]})},listPartitions:function(a,b,d){return c.get({method:"listPartitions",nodeInstanceId:a,paramName:b,keyword:d,limit:20}).then(function(a){
return a?a.partitionList||[]:[]})},getTable:function(a,b){return c.get({method:"getTable",nodeInstanceId:a},!1,b||function(){}).then(function(a){return a?a.tableInfo:""})},searchTable:function(a,b,d){return c.get({method:"searchTablesByKeyword",keyword:a,pageNum:b,pageSize:d},!0).then(function(a){return a?a.tableList||[]:[]})},getVolumePath:function(a){return c.get({method:"getVolumePath",nodeInstanceId:a}).then(function(a){return a&&a.volumePath||""})},listVolumes:function(a,b,e,f){return c.get({method:"listVolumes",nodeInstanceId:a,selectedProjectName:b||d||"",volumeName:e||"",partitionName:f||""},!0)},createVolume:function(a,b){return c.get({method:"createVolume",selectedProjectName:a||d||"",volumeName:b||""})},deleteVolume:function(a,b){return c.get({method:"deleteVolume",selectedProjectName:a||d||"",volumeName:b||""},!0)},listProjects:function(){return c.get({method:"listProjects"},!0).then(function(a){return a&&a.projectList||[]})},updateSchema:function(a){return c.get({method:"updateSchema",nodeInstanceId:a},!0)},getCaffeModel:function(a){return c.get({method:"getCaffeModel",nodeInstanceId:a}).then(function(a){return a&&a.modelList||[]},!0)}}}),define("midway/dialog/model/publishModel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){var b='<div><div class="deploying"><p>'+e(d("deploying"))+"</p><br /><br /><p>"+e(d("deployingTip"))+'</p></div><div class="deploy-done"><h3>'+e(d("deployDone"))+'</h3><button class="btn btn-primary show-deploy-model-result">'+e(d("onlineService"))+'</button></div><div class="deploy-config"><p>'+e(d("modelPublishSpace"))+'</p><div class="project-space"></div><br /><p>'+e(d("deployQuota"))+"<div><span>CPU"+e(d("CPUNum"))+': &nbsp;&nbsp;<span><input class="deploy-value cpu-cores" type="number" value="10" disabled><span>&nbsp;&nbsp;memory(M): &nbsp;&nbsp;</span><input class="deploy-value memory-size" type="number" value="100" disabled></div><br><p>部署说明文档: <a href="http://gitlab.alibaba-inc.com/dengtao.ldt/PAI-DOC/wikis/model-online-deploy" target="_blank">http://gitlab.alibaba-inc.com/dengtao.ldt/PAI-DOC/wikis/model-online-deploy</a></p>';return a&&(b+='<br><p>权限申请链接: <a href="https://data.aliyun.com/buy/prediction" target="_blank">https://data.aliyun.com/buy/prediction</a></p><p>API 调试链接: <a href="http://data-pre.aliyun.com/console/api_tool?service_code=prediction" target="_blank">http://data-pre.aliyun.com/console/api_tool?service_code=prediction</a></p>'),b+="</div></div>"}(b.isBaseDP)}}),define("dialog/model/publishModel",["zero/zero","zero/ui/Dialog","zero/declare","zero/ui/Selector","../../ajax/common","../../ajax/modelTree","../../ajax/odpsControl","../../i18n","../../midway/dialog/model/publishModel","../../storage/globalCache","../../global/environment","../../global/event","../../global/notify"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=h.translate,o={projectSpace:".project-space",deployConfig:".deploy-config",deployValue:".deploy-value",deployDone:".deploy-done",deploying:".deploying",modalFooter:".modal-footer",deployModelResult:".show-deploy-model-result",cpuCores:".cpu-cores",memorySize:".memory-size"},p={boxItem:"dialog-publish-model",invalidInput:"invalid-input"};return c("experment/dialog/publishModel",[],{dialog:null,selectors:null,odpsProjects:null,treeNode:null,constructor:function(a){this.treeNode=a},show:function(){this._initDialog(),this._initSelector(),this._loadProjects(),this._initDomEvent()},_initDialog:function(){var a=this;this.dialog=new b({title:n("publishModel"),body:i(k),className:p.boxItem,destroyOnHide:!0,buttons:[{text:n("doDeploy"),type:"primary",focused:!0,click:this._onAccept.bind(this)},{text:n("cancel"),click:function(){a.dialog.hide()}}]})},_initSelector:function(){this.selector=new d({container:this.dialog.$(o.projectSpace),width:400})},_initDomEvent:function(){this.dialog.$element.on("click",o.deployModelResult,this._onShowDeployModelResult.bind(this))},_loadProjects:function(){var a=this;g.listProjects().then(function(b){a.odpsProjects=b,a.selector.setMenu(b),a.selector.select(0)})},_onAccept:function(){for(var a=this,b=this.dialog,c=b.$(o.deployValue),d=0;d<c.length;d++){var e=$(c[d]);if(!1===/^\d+$/.test(e.val().trim()))return m.error(n("errorInt")),void e.addClass(p.invalidInput);e.removeClass(p.invalidInput)}var g=b.$(o.cpuCores).val(),h=b.$(o.memorySize).val(),i=this.selector.getSelected(),k=j.get(j.keys.projectName),l=this.odpsProjects[i],q=this.treeNode.id||this.treeNode.originId;a._deploying(),f.deployModelAsync(q,l,k,g,h).then(function(b){a._startAsyncJob(b)},function(){a._stopAsyncJob(),a._deployConfig()})},_startAsyncJob:function(a){var b=this;e.queryAsynJobStatus(a).then(function(c){"running"===c.status?b.asyncTimer=setTimeout(b._startAsyncJob.bind(b,a),3e3):(b._deployDone(),b.treeNode.hasOnlineModel=!0)},function(){b._stopAsyncJob(),b._deployConfig()})},_stopAsyncJob:function(){clearTimeout(this.asyncTimer),this.asyncTimer=0},_deployConfig:function(){var a=this.dialog;a.$(o.deployConfig).show(),a.$(o.deploying).hide(),a.$(o.deployDone).hide(),a.$element.find(o.modalFooter).show()},_deploying:function(){var a=this.dialog;a.$(o.deployConfig).hide(),a.$(o.deploying).show(),a.$element.find(o.modalFooter).hide()},_deployDone:function(){var a=this.dialog;a.$(o.deploying).hide(),a.$(o.deployDone).show()},_onShowDeployModelResult:function(){this.dialog.destroy(),l.showDeployModelResult(this.treeNode.originId)}})}),define("midway/dialog/model/publishModelResult",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div><div class="deploying"><p>'+e(d("deploying"))+"</p><br/><br/><p>"+e(d("deployingTip"))+'</p></div><div class="deploy-result"><div class="deploy-info"><span>'+e(d("currentStatus"))+": </span><span>"+e(d("deploySuccess"))+"</span><span>"+e(d("currentVersion"))+': </span><span class="versions"></span><span>&nbsp;&nbsp;'+e(d("deployTime"))+': </span><span class="deploy-time"></span><span>&nbsp;&nbsp;'+e(d("deployHelp"))+'</span><button class="btn btn-primary btn-reDeploy">'+e(d("reDeploy"))+'</button>&nbsp;&nbsp;<button class="btn btn-primary btn-delete">'+e(d("deleteCurrentVersion"))+"</button></div><br/><div>"+e(d("deployTip"))+'</div><br/><div class="nav nav-tabs pai-tab"><li data-target=".api-mode"><a href="javascript:void(0)">'+e(d("tabApi"))+'</a></li>\x3c!--<li data-target=".sdk-mode">--\x3e\x3c!--<a href="javascript:void(0)">'+e(d("tabSdk"))+'</a>--\x3e\x3c!--</li>--\x3e<li data-target=".sample"><a href="javascript:void(0)">'+e(d("tabSample"))+'</a></li></div><div><div class="api-mode result"><p> </p></div>\x3c!--<div class="sdk-mode result">--\x3e\x3c!--<textarea disabled="disabled"></textarea>--\x3e\x3c!--</div>--\x3e<div class="sample result"><p> </p></div></div></div></div>'}()}}),define("dialog/model/publishModelResult",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Selector","zero/ui/Tab","../../i18n","../../ajax/common","../../ajax/modelTree","../../midway/dialog/model/publishModelResult"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=f.translate,k={tabItem:".nav-tabs li",redeploy:".btn-reDeploy",delete:".btn-delete",deployResult:".deploy-result",deploying:".deploying",deployDone:".deploy-done",versions:".versions",deployTime:".deploy-time",apiModeContent:".api-mode p",sdkModeContent:".sdk-mode p",sampleComtent:".sample p"},l={boxItem:"dialog-publish-model-result"};return b("experment/dialog/publishModelResult",[],{allVersions:null,versionSelector:null,treeNode:null,currentVersion:null,dialog:null,tab:null,constructor:function(a){this.treeNode=a,this._initDialog()},_initDialog:function(){var a=this;this.dialog=new c({title:j("onlineDeploy"),body:i(),className:l.boxItem,buttons:[],destroyOnHide:!0,onHide:function(){a._stopAsyncJob()}})},show:function(){this._loadModelResult(this.treeNode.id,this.treeNode.projectName),this._initVersionSelector(),this._initTab(),this._initDomEvent()},_initDomEvent:function(){var a=this;a.dialog.$element.on("click",k.redeploy,function(){a._deploying(),h.updateModelAsync(a.treeNode.id,a.treeNode.projectName).then(function(b){a._startAsyncJob(b)},function(){a._deploydone()})}).on("click",k.delete,function(){a.dialog.showLoading(),h.deleteOnlineModel(a.treeNode.id,a.currentVersion).then(function(){if(1===a.allVersions.length)a.treeNode.hasOnlineModel=!1,a.dialog.hide();else{for(var b=0;b>=0;b--)if(a.allVersions[b]===a.currentVersion){a.allVersions.splice(b,1);break}a.currentVersion=a.allVersions[0],a.versionSelector.setMenu(a.allVersions),a.versionSelector.select(a.allVersions.indexOf(a.currentVersion)),a._loadModelResult(a.treeNode.id,a.treeNode.projectName,a.currentVersion),a.dialog.hideLoading()}},function(){a.dialog.hideLoading()})})},_startAsyncJob:function(a){var b=this;g.queryAsynJobStatus(a).then(function(c){"running"===c.status?b.asyncTimer=setTimeout(b._startAsyncJob.bind(b,a),3e3):(b._deploydone(),b._loadModelResult(b.treeNode.id,b.treeNode.projectName))},function(){b._stopAsyncJob(),b._deploydone()})},_stopAsyncJob:function(){clearTimeout(this.asyncTimer),this.asyncTimer=0},_deploying:function(){this.dialog.$(k.deploying).show(),this.dialog.$(k.deployResult).hide()},_deploydone:function(){this.dialog.$(k.deploying).hide(),this.dialog.$(k.deployResult).show()},_initTab:function(){this.tab=new e({selector:this.dialog.$(k.tabItem),activeClassName:"active"})},_initVersionSelector:function(){var a=this;this.versionSelector=new d({container:this.dialog.$(k.versions),width:60}),this.versionSelector.on("select",function(b){var c=a.allVersions[b];c!==a.currentVersion&&a._loadModelResult(a.treeNode.id,a.treeNode.projectName,c)})},_loadModelResult:function(a,b,c){var d=this;h.queryOnlineModelDesc(a,b,c).then(function(a){d._showResult(a)})},_showResult:function(a){var b=a.onlineModel,c=this.dialog,d=b.currentVersion,e=b.allVersions;this.currentVersion=d,this.allVersions=e,c.$(k.deployTime).text(b.deployTime),c.$(k.apiModeContent).html(b.interfaceMode.replace(/\\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace(/\\n/gi,"<br/>")),c.$(k.sampleComtent).html(b.returnSample.replace(/\\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace(/\\n/gi,"<br/>")),this.versionSelector.setMenu(e),this.versionSelector.select(e.indexOf(d))}})}),define("midway/dialog/output/multiLogisticRegression",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="logistic-table-wrap"></div><div class="tips hide"><p>'+e(d("logisticTip1"))+"</p><p>"+e(d("logisticTip2"))+"</p></div>"}()}}),define("dialog/output/regressionTable",["zero/zero","zero/ui/DataTable","../../i18n","../../ajax/model"],function(a,b,c,d){"use strict";var e=a.each,f=c.translate;return function(a,c){var g={container:a,crossHover:!1,grid:!0,resizable:!0,defaultsort:!0,data:[],cols:[{field:"name",title:f("filedName"),sort:!0}]},h=c.fromNodeDef?c.modelId:c.nodeInstanceId;return d.queryModelPMML(h,c.fromNodeDef,c.loopTimestamp).then(function(a){var c=g.data,d=g.cols,h=a.features;return e(h,function(a){c.push({name:a})}),c.push({name:f("const")}),e(a.theatas,function(a,b){var g="weight"+b;d.push({title:a.target,field:g,group:f("weight"),sort:!0});var h=a.coefficients;e(c,function(a){a[g]=h[a.name]||""}),c[c.length-1][g]=a.intercept}),new b(g),a})}}),define("dialog/output/multiLogisticRegression",["zero/zero","zero/ui/DialogEx","../../global/utils","../../global/environment","../../i18n","../../midway/dialog/output/multiLogisticRegression","./regressionTable"],function(a,b,c,d,e,f,g){"use strict";function h(a){var b=this;(d.isAntLab||d.isAntCloud)&&c.disableCopy(b.$element),b.showLoading(),g(b.$(k.wrap),a).then(function(){b.hideLoading(),b.$(k.tips).removeClass(l.hide)},function(){b.hideLoading(),b.showEmpty()})}function i(a){new b({title:j("multiLogisticRegressionOutput"),className:"dialog-logistic-regression-output",destroyOnHide:!0,canFullscreen:!0,body:f(a),afterShow:function(){h.call(this,a)},buttons:[{text:j("close"),click:function(){this.hide()}}]})}var j=e.translate,k={wrap:".logistic-table-wrap",tips:".tips"},l={hide:"hide"};return{show:i}}),define("midway/dialog/output/binaryLogisticRegression",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){var b="",a=d("logisticFieldsTip");return b+="",a&&(b+='<div class="logistic-tips hide">'+e(a)+"</div>"),b+='<div class="logistic-table-wrap"></div>'}(b.tips)}}),define("midway/dialog/output/binaryLogisticRegressionFooter",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="coefficient-table-wrap hide"><label>'+e(d("saveToODPS"))+'</label>:<span class="table-name"></span><button class="btn btn-primary btn-sm btn-inline"><span class="text">'+e(d("save"))+'</span><span class="icon icon-loading-spinner"></span></button></div>'}()}}),define("dialog/output/binaryLogisticRegression",["zero","zero/zero","zero/ui/DialogEx","zero/ui/Clipboard","../../global/notify","../../global/utils","../../global/environment","../../i18n","../../ajax/model","../../midway/dialog/output/binaryLogisticRegression","../../midway/dialog/output/binaryLogisticRegressionFooter","./regressionTable"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b){var c;a.find(q.tableName).text(b.coefficientTableName),a.removeClass(r.hide),$(q.tableName).off("click.copy").on("click.copy",function(){c&&c.destroy(),c=new d(q.tableName,{text:function(a){return e.success(p("copySuccess")),$(a).html()}})})}function n(b){var c=this,d=b.fromNodeDef?b.modelId:null,e=b.fromNodeDef?null:b.nodeInstanceId,h=c.$element.find(q.coefficientTable);(g.isAntLab||g.isAntCloud)&&f.disableCopy(c.$element);var j,k=b.loopTimestamp;h.on("click",q.btn,function(){var a=$(this);a.addClass(r.loading),i.writeLRCoefficients(d,e,k).then(function(){a.removeClass(r.loading)},function(){a.removeClass(r.loading)})}),c.$element.find(q.footer).find(q.btn).eq(1).on("click",function(){c.hide()}),c.showLoading(),i.queryLrCoefficientTableName(d,e,k).then(function(a){h.removeClass(r.hide).find(q.tableName).text(a)}),l(c.$(q.wrap),b).then(function(b){c.hideLoading(),c.$(q.tips).removeClass(r.hide),m(h,b),j&&j.destroy&&j.destroy(),j=new a.Popup(q.tableName,{position:"middle center",align:"center",escape:!1,content:p("copy")})},function(){c.showEmpty(),c.hideLoading()})}function o(a){new c({title:p("binaryLogisticRegressionOutput"),className:"dialog-logistic-regression-output",destroyOnHide:!0,canFullscreen:!0,body:j(a),footer:k(),afterShow:function(){n.call(this,a)},buttons:[{text:p("close")}]})}var p=h.translate,q={wrap:".logistic-table-wrap",footer:".modal-content .modal-footer",coefficientTable:".coefficient-table-wrap",tableName:".table-name",btn:".btn",tips:".logistic-tips"},r={hide:"hide",loading:"loading"};return{show:o}}),define("midway/dialog/output/linearRegression",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="logistic-table-wrap"></div>'}}),define("dialog/output/linearRegression",["zero/zero","zero/ui/DialogEx","../../global/utils","../../global/environment","../../i18n","../../midway/dialog/output/linearRegression","./regressionTable"],function(a,b,c,d,e,f,g){"use strict";function h(a){var b=this;(d.isAntLab||d.isAntCloud)&&c.disableCopy(b.$element),b.showLoading(),g(b.$(k.wrap),a).then(function(){b.hideLoading(),b.$(k.tips).removeClass(l.hide)},function(){b.hideLoading(),b.showEmpty()})}function i(a){new b({title:j("linearRegressionOutput"),className:"dialog-logistic-regression-output",destroyOnHide:!0,canFullscreen:!0,body:f(a),afterShow:function(){h.call(this,a)},buttons:[{text:j("close"),click:function(){this.hide()}}]})}var j=e.translate,k={wrap:".logistic-table-wrap",tips:".tips"},l={hide:"hide"};return{show:i}}),define("midway/dialog/output/linearSVM",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e){var f='<div class="table-wrap"><table class="table table-bordered"><tbody><tr><td>模型名称</td><td colspan="2">'+d(b.modelName)+'</td></tr><tr><td>标签列</td><td colspan="2">'+d(b.targetName)+"</td></tr>",c=b.theatas[0];f+=" ";var e=b.features;return f+='<tr><td>正样本标签值</td><td colspan="2">'+d(c.target||"")+'</td></tr><tr><td>absoluteValue</td><td colspan="2">'+d(c.absoluteValue||"")+'</td></tr><tr><td>alternateTarget</td><td colspan="2">'+d(c.alternateTarget||"")+'</td></tr><tr><td rowspan="'+d(e.length+1)+'">Features</td></tr>',a.forEach(e,function(a){f+="<tr><td>"+d(a)+"</td><td>"+d(c.coefficients[a]||"")+"</td></tr>"}),f+="</tbody></table></div>"}(b.pmml,b.theata,b.features)}}),define("dialog/output/linearSVM",["zero/zero","zero/ui/DialogEx","../../global/utils","../../global/environment","../../i18n","../../ajax/model","../../midway/dialog/output/linearSVM"],function(a,b,c,d,e,f,g){"use strict";function h(a){var b=this;(d.isAntLab||d.isAntCloud)&&c.disableCopy(b.$element),b.showLoading();var e=a.fromNodeDef?a.modelId:a.nodeInstanceId;return f.queryModelPMML(e,a.fromNodeDef,a.loopTimestamp).then(function(a){b.set("body",g({pmml:a})),b.hideLoading()})}function i(a){new b({title:"LinearSVM",className:"dialog-liner-svm-output",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){h.call(this,a)},buttons:[{text:j("close"),click:function(){this.hide()}}]})}var j=e.translate;return{show:i}}),define("midway/dialog/output/randomForest",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<ul class="random-forest-list"></ul><div class="random-forest-detail">',b=a.uuid();f+=" ";var c=a.uuid();return f+='<ul class="nav nav-tabs pai-tab"><li data-target="#'+e(b)+'"><a href="javascript:void(0);">模型</a></li><li data-target="#'+e(c)+'"><a href="javascript:void(0);">规则</a></li></ul><div id="'+e(b)+'" class="cart-tree-wrap hide"><div class="action-bar"><a href="javascript:void(0);" class="back">&lsaquo; '+e(d("back"))+'</a><span class="zoom">I : I</span><span class="expand">'+e(d("expand"))+'</span><span class="col">'+e(d("collapse"))+'</span><span class="simple">'+e(d("simpleNode"))+'</span><span class="full">'+e(d("fullNode"))+'</span></div><div class="random-forest-detail-content"></div></div><div id="'+e(c)+'" class="rules-wrap hide"></div></div>'}(b.uuid1,b.uuid2)}}),define("midway/dialog/output/randomForestList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c="";return a.forEach(b,function(a){c+='<li class="dt-node" data-id="'+d(a)+'">'+d(a)+"</li>"}),c+=""}(b.treeIds)}}),define("global/tooltip",["zero/ui/Tooltip"],function(a){"use strict";return new a}),define("midway/charts/decisionTree",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f){var g='<div class="title">'+e(d("predictionPath"))+'</div><div class="feature" style="background-color: '+e(b.color)+'">Root</div>';return a.each(c,function(a){g+='<div class="fork">'+e(f(a.predict.operator,a.predict.value))+'</div><div class="feature" style="background-color: '+e(a.color)+'">'+e(a.predict.feature)+"</div>"}),g+=""}(b.first,b.list,b.markByOperator)}}),define("midway/charts/decisionTreeToolTip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g,h,i){var j='<div class="decision-tree-tooltip">';return b?j+="<div>"+e(b)+"</div>":(j+="",c&&(j+="<div><span>"+e(d("result"))+" : </span><span>"+e(c)+" ("+e(f)+")</span></div>"),j+='<div class="decision-tree-tooltip-title">Top 5</div><table>',a.each(g,function(a){j+="<tr><th>"+e(a[0])+" :</th><td>"+e(a[1])+"</td></tr>"}),j+="</table>"),j+='<div class="decision-tree-tooltip-title"></div><table><tr><td>预测</td><td>'+e(h)+"</td></tr><tr><td>预测比例</td><td>"+e(i)+"</td></tr></table></div>"}(b.label,b.topKey,b.rate,b.top5,b.countArr,b.rateArr)}}),define("charts/decisionTree",["zero/zero","zero/declare","../global/tooltip","../midway/charts/decisionTree","../midway/charts/decisionTreeToolTip"],function(a,b,c,d,e){"use strict";var f={decisionTreeContainer:"decision-tree-container",decisionTree:"decision-tree",hover:"hover",predictionPanel:"prediction-panel"},g=d3.svg.diagonal().projection(function(a){return[a.x,a.y]}),h=d3.scale.category10(),j={margin:{top:28,right:20,bottom:20,left:20},node:{style:"simple",width:30,height:30,simple:{width:30,height:30},full:{width:100,height:28},margin:10,rx:15,ry:8},link:{maxWidth:10,minWidth:2},char_to_pxl:6,depth:80,displayDepth:4,maxDisplayDepth:100,leafColor:"#7f9e07"};return b("charts/DecisionTree",{constructor:function(a){var b=this;b.opt=$.extend(!0,{},j,a),b.render()},render:function(){var a=this;a.$container=$(a.opt.container),a.container=d3.select(a.opt.container);var b=a.opt.data,c=a.$container.width()-200,d=a.$container.height(),e=a.opt.margin.left+c/2,g=a.opt.margin.top,h=a.opt.node.style;a.opt.node[h]&&(a.opt.node.width=a.opt.node[h].width,a.opt.node.height=a.opt.node[h].height);var i=a.opt.node.width+a.opt.node.margin,j=a.opt.node.height+a.opt.node.margin;a.svg=a.container.append("div").attr("class",f.decisionTreeContainer).append("svg:svg").attr("width",c).attr("height",d).attr("class",f.decisionTree).on("mousedown",function(){a.svg.style("cursor","-webkit-grabbing")}),a.vis=a.svg.append("svg:g").attr("transform","translate("+e+","+g+")"),a.zoom=d3.behavior.zoom().on("zoom",function(){a.vis.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")"),a.predictionPanel&&a.predictionPanel.style("top",d3.event.translate[1]-g+"px")}),a.zoom.translate([e,g]),a.svg.call(a.zoom),a.opt.showPredictionPanel&&(a.container.append("div").attr("class",f.predictionPanel),a.predictionPanel=a.container.select("."+f.predictionPanel)),a.tree=d3.layout.tree().nodeSize([i,j]),a.root||(a.opt.convertMap&&a.convert(b,a.opt.convertMap),a.root=b,a.root.x0=0,a.root.y0=0,a.collapseAll(a.root,a.opt.displayDepth)),a.link_stoke_scale=d3.scale.linear().domain([0,a.root.weight]).range([a.opt.link.minWidth,a.opt.link.maxWidth]),a.bindEvents(),a.update(a.root)},reRender:function(){this.destroy(),this.render()},bindEvents:function(){var a=this;$(document).on("mouseup.decisionTree",function(){a.svg&&a.svg.style("cursor","-webkit-grab")})},update:function(b){var d=this,f=500,j=d.tree.nodes(d.root).reverse();j.forEach(function(a){a.y=a.depth*d.opt.depth});var k=d.vis.selectAll("g.node").data(j,function(a){return a.id||(a.id=++i)}),l=k.enter().append("svg:g").attr("class","node").classed("leaf",function(a){return a.isLeafNode}).attr("transform",function(a){return"translate("+b.x0+","+b.y0+")"}).attr("data-id",function(a){return a.id}).on("click",function(a){d.toggle(a),d.update(a),d3.event.stopPropagation()}).on("dblclick",function(a){d3.event.stopPropagation()}).on("mouseenter",function(b){d.clearMarkPath(b),d.opt.showPredictionPanel&&d.clearPredictionPanel();var f=d.getRoute(b);d.markPath(f),d.opt.showPredictionPanel&&d.renderPredictionPanel(f);var g=b.scoreDistribution,h=b.scoreDistributionCount,i="["+a.keys(g).sort().map(function(a){return a+": "+g[a]})+"]",j="["+a.keys(h).sort().map(function(a){return a+": "+h[a]}).join(", ")+"]",k=d.sortByValue(b.scoreDistribution),l=d.sumByValue(b.scoreDistribution),m=e(b.isLeafNode?{topKey:k[0][0],rate:(k[0][1]/l*100).toFixed(2)+"%",top5:k.slice(0,5),rateArr:i,countArr:j}:{label:d.node_label(b),rateArr:i,countArr:j});c.show(m,this,{gravity:"s",offset:8})}).on("mouseleave",function(a){c.hide()});l.append("svg:rect").attr("x",function(a){return-d.opt.node.width/2}).attr("width",1e-6).attr("height",1e-6).attr("rx",function(a){return a.isLeafNode?0:2}).attr("ry",function(a){return a.isLeafNode?0:2}).style("fill",function(a){return a.isLeafNode?d.opt.leafColor:a.color=h(a.predict?a.predict.feature:"_rootNode_")}),l.append("svg:text").attr("dy","18px").attr("text-anchor","middle").text(function(a){return"full"===d.opt.node.style?d.node_label(a):a.predict?a.predict.feature.slice(0,3):" "}).style("fill-opacity",1e-6);var m=k.transition().duration(f).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});m.select("rect").attr("width",function(a){return d.opt.node.width}).attr("height",d.opt.node.height).attr("rx",d.opt.node.rx).attr("ry",d.opt.node.ry),m.select("text").style("fill-opacity",1);var n=k.exit().transition().duration(f).attr("transform",function(a){return"translate("+b.x+","+b.y+")"}).remove();n.select("rect").attr("width",1e-6).attr("height",1e-6),n.select("text").style("fill-opacity",1e-6);var o=d.vis.selectAll("path.link").data(d.tree.links(j),function(a){return a.target.id});o.enter().insert("svg:path","g").attr("class","link").attr("d",function(a){var c={x:b.x0,y:b.y0};return g({source:c,target:c})}).attr("data-id",function(a){return a.target.id}).transition().duration(f).attr("d",g).style("stroke-width",function(a){return d.link_stoke_scale(a.target.weight)}),o.transition().duration(f).attr("d",g).style("stroke-width",function(a){return d.link_stoke_scale(a.target.weight)}),o.exit().transition().duration(f).attr("d",function(a){var c={x:b.x,y:b.y};return g({source:c,target:c})}).remove(),j.forEach(function(a){a.x0=a.x,a.y0=a.y})},sortByValue:function(a){var b=[];for(var c in a)b.push([c,a[c]]);return b.sort(function(a,b){return b[1]-a[1]})},sumByValue:function(a){var b=0;for(var c in a)b+=a[c];return b},convert:function(a,b){function c(a){a[d]&&(a.children=a[d],a.children.forEach(function(b){b.depth=a.depth+1,c(b)}))}var d=b.children;a.depth=1,c(a)},changeStyle:function(a){var b=this;b.opt.node.style=a,b.reRender()},scale:function(a){var b=this;if(b.vis){var c=b.vis.attr("transform");c=c.replace(/(scale\()\d*\.*\d*(\))/,"$1"+a+"$2"),b.vis.attr("transform",c),b.zoom.scale(a)}},collapseAll:function(){this.collapse(this.root,this.opt.displayDepth),this.reRender()},expandAll:function(){this.expand(this.root,this.opt.maxDisplayDepth),this.reRender()},expand:function(a,b){var c=this,d=a.children?a.children:a._children;a&&d&&(d.forEach(function(a){c.expand(a,b)}),a.depth<=b&&a._children&&(a.children=a._children,a._children=null))},collapse:function(a,b){var c=this,d=a.children?a.children:a._children;a&&d&&(d.forEach(function(a){c.collapse(a,b)}),a.depth>=b&&a.children&&(a._children=a.children,a.children=null))},toggle:function(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)},node_label:function(a){var b=this,c=a.predict;return c?c.feature+" "+b.markByOperator(c.operator,c.value):"Root"},markPath:function(a){this.vis.selectAll("[data-id]").each(function(b){var c=d3.select(this),d=parseInt(c.attr("data-id"),10);a.forEach(function(a){parseInt(a.id,10)===d&&c.classed(f.hover,!0)})})},clearMarkPath:function(a){this.vis.selectAll("[data-id]").each(function(a){d3.select(this).classed(f.hover,!1)})},getRoute:function(a){function b(a){a.parent&&b(a.parent),c.push(a)}var c=[];return b(a),c},renderPredictionPanel:function(a){var b=this,c=a.shift(),e=d({list:a,first:c,node_label:b.node_label||"",markByOperator:b.markByOperator});b.predictionPanel.html(e)},clearPredictionPanel:function(){this.predictionPanel.html("")},markByOperator:function(a,b){var c={isIn:"in",greaterOrEqual:">=",lessThan:"<",lessOrEqual:"<=",greaterThan:">",equal:"="},d=c[a];return"in"===d?"in("+b+")":d+" "+b||""},destroy:function(){$(document).off("mouseup.decisionTree"),this.svg.remove(),this.$container.empty()}})}),define("midway/dialog/generateRules/container",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="generate-rules-options"></div><div class="generate-rules-list">规则列表<div class="form-inline"><div class="form-group"><label for="generateRulePrecision">precision &gt; </label><input type="number" class="form-control" id="generateRulePrecision"></div><div class="form-group"><label for="generateRuleRecall">recall &gt; </label><input type="number" class="form-control" id="generateRuleRecall"></div><button class="btn btn-primary btn-filter">过滤</button></div><div class="table-wrap"></div><div><button class="btn btn-primary btn-build">查看SQL</button>&nbsp;<button class="btn btn-primary btn-save">保存SQL</button><span class="table-state"><label>sqlRulesTableName:　</label><span class="sqlRulesTableName"></span></span></div><div><br><p>[1] precision = 样本正确数/样本覆盖数</p><p>[2] recall = 样本正确数/同标签类样本总数(粗估)</p></div></div><div class="generate-rules-result hide"><span class="close">×</span><div class="title">规则输出结果</div><div class="inner"></div></div>'}}),define("midway/dialog/generateRules/options",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="form-inline"><div class="form-group"><label for="generateRuleNodeCount">节点样本数 &gt; </label><input type="number" class="form-control" id="generateRuleNodeCount" value="10"></div><div class="form-group"><label for="generateRuleTreeDeep">树深度 &lt; </label><input type="number" class="form-control" id="generateRuleTreeDeep" value="4"></div><div class="form-group"><label for="generateRuleLabelValue">正样本标签值</label><input type="number" class="form-control" id="generateRuleLabelValue" value="1"></div><button class="btn btn-primary btn-generate">生成</button></div>'}}),define("midway/dialog/generateRules/result",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c="<ul>";return a.each(b,function(a,b){c+="<li><span>规则 "+d(b+1)+"</span><p>"+d(a)+"</p></li>"}),c+="</ul>"}(b.sqlRules)}}),define("dialog/generateRules",["zero/zero","zero/declare","zero/ui/DataTable","../ajax/model","../midway/dialog/generateRules/container","../midway/dialog/generateRules/options","../midway/dialog/generateRules/result","../global/notify"],function(a,b,c,d,e,f,g,h){"use strict";return b("generateRules",[],{constructor:function(a){this.options=a,a.container.append(e()),a.container.find(".generate-rules-options").append(f()),this.setup(),this.generate(a.callback)},setup:function(){var b=this;b.options.container.on("click",".btn-generate",function(){b.generate()}).on("click",".btn-filter",function(){b.filter()}).on("click",".btn-build",function(){var c=b.getRawParams(),e=b.datatable.getCheckedRows().map(function(a){for(var c=0,d=b.tableData.length;c<d;c++)if(b.tableData[c].nodeId===a.nodeId)return c}).join(",");d.generateDecisionSQL(a.extend({selectedRuleIDs:e},c)).then(function(a){b.options.container.find(".generate-rules-result").removeClass("hide").find(".inner").html(g(a))})}).on("click",".btn-save",function(){var c=$(this),e=b.getRawParams(),f=b.datatable.getCheckedRows().map(function(a){for(var c=0,d=b.tableData.length;c<d;c++)if(b.tableData[c].nodeId===a.nodeId)return c}).join(","),g=c.text();c.text("保存中..."),c.attr("disabled","disabled"),d.saveDecisionSQL(a.extend({selectedRuleIDs:f
},e)).then(function(a){h.success("保存成功!"),c.text(g),c.removeAttr("disabled")},function(a){c.text(g),c.removeAttr("disabled")})}).on("click",".close",function(){b.options.container.find(".generate-rules-result").addClass("hide")})},generate:function(a){var b=this.getGenerateParams();this.render(b,a)},filter:function(a){var b=this.getFilterData();this.render(b,a)},render:function(a,b){var c=this;"GBDT"===c.options.modelType?d.generateGbdtTreeRules(a).then(function(a){c.options.container.find(".sqlRulesTableName").html(a.rawRules.sqlRulesTableName),c.renderTable(a.rawRules.rules),b&&b()}):d.generateDecisionTreeRules(a).then(function(a){c.options.container.find(".sqlRulesTableName").html(a.rawRules.sqlRulesTableName),c.renderTable(a.rawRules.rules),b&&b()})},renderTable:function(a){this.tableData=a,this.datatable=new c({container:this.options.container.find(".generate-rules-list .table-wrap"),data:a,rowClick:!1,height:"260px",theme:"small",cols:[{field:"ruleContent",width:"10%",title:"规则"},{field:"precision",title:"precision",width:"80px",sort:!0},{field:"recall",title:"recall",width:"80px",sort:!0},{title:"样本正确数",field:"positiveSample",width:"80px"},{title:"样本覆盖数",field:"totalSample",width:"80px"},{title:"同标签类样本总数(粗估)",field:"rootPositiveSample",width:"80px"}],checkbox:!0})},getGenerateParams:function(){var b=this.options.container,c=this.getRawParams();return a.extend({minSampleSize:b.find("#generateRuleNodeCount").val(),maxDepth:b.find("#generateRuleTreeDeep").val(),positiveValue:b.find("#generateRuleLabelValue").val()},c)},getFilterData:function(){var a=this.options.container,b=this.getGenerateParams(),c=a.find("#generateRulePrecision").val(),d=a.find("#generateRuleRecall").val();return c&&(b.precision=c),d&&(b.recall=d),b},getRawParams:function(){var a=this.options;return a.nodeDefId?{nodeDefId:a.nodeDefId,treeId:a.treeId}:{treeId:a.treeId,experimentId:a.experimentId,nodeInstanceId:a.nodeInstanceId,projectName:a.projectName}},destroy:function(){this.options.container.off().empty()}})}),define("dialog/output/randomForest",["zero/zero","zero/declare","zero/dom/construct","zero/dom/query","zero/fmt/sprintf","zero/ui/DialogEx","zero/ui/Tab","../../midway/dialog/output/randomForest","../../midway/dialog/output/randomForestList","../../i18n","../../ajax/model","../../global/utils","../../charts/decisionTree","../generateRules"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o,p=j.translate,q={list:".random-forest-list",dtNode:".dt-node",detail:".random-forest-detail",dtContent:".random-forest-detail-content",back:".back",zoom:".zoom",expand:".expand",collapse:".col",full:".full",simple:".simple"},r=b("dialog/RandomForest",[],{constructor:function(){},show:function(a,b,c){var d=this;d.modelType=c,d.cachedData=a,d.dialog=new f({title:b||p("randomForestOutput"),className:"dialog-random-forest-output",body:h(),destroyOnHide:!0,canFullscreen:!0,afterShow:d.afterShow.bind(d),buttons:[{text:p("export"),type:"primary",click:d.onExport.bind(d)},{text:p("close"),click:function(){this.hide()}}]}),d.bindEvents()},afterShow:function(){var a=this,b=a.dialog,c=b.$element,d=a.cachedData;a.$list=c.find(q.list),a.$detail=c.find(q.detail),a.$dtContent=c.find(q.dtContent),a.renderList(),d.allowExport||b.$element.find(".modal-footer .btn-primary").remove()},renderList:function(){var a=this,b=a.dialog,c=a.cachedData;b.showLoading(),k.queryRandomForestsBase(a.wrapParams(),c.fromNodeDef,c.loopTimestamp).then(function(c){b.hideLoading(),a.$list.html(i(c))})},bindEvents:function(){var a=this,b=a.dialog,c=b.$element;b.on("fullScreen",a.onFullScreen.bind(a)),c.on("click",q.back,a.onBack.bind(a)),c.on("click",q.zoom,a.onZoom.bind(a)),c.on("click",q.expand,a.onExpand.bind(a)),c.on("click",q.collapse,a.onCollapse.bind(a)),c.on("click",q.simple,a.onSimple.bind(a)),c.on("click",q.full,a.onFull.bind(a)),c.on("click",q.dtNode,a.onViewDecisionTree.bind(a))},onFullScreen:function(a){var b=this;this.dialog;b.decisionTree&&b.decisionTree.reRender()},onBack:function(){var a=this;a.$list.show(),a.$detail.hide(),a.decisionTree&&a.decisionTree.destroy(),a.decisionTree=null},onZoom:function(){var a=this;a.decisionTree&&a.decisionTree.scale(1)},onExpand:function(){var a=this;a.decisionTree&&a.decisionTree.expandAll()},onCollapse:function(){var a=this;a.decisionTree&&a.decisionTree.collapseAll()},onSimple:function(){var a=this;a.decisionTree&&a.decisionTree.changeStyle("simple")},onFull:function(){var a=this;a.decisionTree&&a.decisionTree.changeStyle("full")},onViewDecisionTree:function(a){var b=this,c=b.dialog,d=$(a.currentTarget),e=b.cachedData;c.showLoading(),this.tab&&(this.tab.destroy(),this.tab=null,this.generateRules&&(this.generateRules.destroy(),this.generateRules=null)),b.tab=new g({selector:c.$(".pai-tab li"),activeIndex:0,activeClassName:"active",afterShow:function(a){1!==a||b.generateRules||(c.showLoading(),b.generateRules=new n({treeId:d.data("id"),container:c.$(".rules-wrap"),nodeDefId:b.cachedData.modelId,projectName:b.cachedData.projectName,experimentId:b.cachedData.experimentId,nodeInstanceId:b.cachedData.nodeInstanceId,modelType:b.modelType,callback:function(){c.hideLoading()}}))}}),k.queryRandomForestsTree({nodeInstanceId:b.wrapParams(),fromNodeDef:e.fromNodeDef,extraParams:{treeId:d.data("id"),treeDeep:100},loopTimestamp:e.loopTimestamp}).then(function(a){b.$list.hide(),b.$detail.show(),c.hideLoading(),b.decisionTree=new m({container:b.$dtContent[0],data:a.tree?a.tree.rootNode:{},convertMap:{children:"childNodes"},showPredictionPanel:!0})})},onExport:function(){var a=this,b=a.cachedData,c=e(k.exportOutputURIByNodeDefId,b.nodeDefId),d=e(k.exportOutputURI,b.nodeInstanceId);b.loopTimestamp&&(c+="&loopTimestamp"+loopTimestamp,d+="&loopTimestamp"+loopTimestamp),b.fromNodeDef?window.open(c):window.open(d)},wrapParams:function(){var a=this.cachedData;return a.fromNodeDef?a.modelId:a.nodeInstanceId}});return{show:function(a,b,c){o||(o=new r),o.show(a,b,c)}}}),define("midway/dialog/output/kmeans",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="summary-wrap"></div><div class="table-wrap"></div>'}}),define("midway/dialog/output/kmeansSummary",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c){return'<table class="table table-bordered"><thead><tr><th>'+e(d("modelName"))+"</th><th>"+e(a)+"</th></tr><tr><th>"+e(d("clusterDefMethod"))+"</th><th>"+e(b)+"</th></tr><tr><th>"+e(d("clusterCount"))+"</th><th>"+e(c)+"</th></tr></thead></table>"}(b.modelName,b.modelClass,b.numberOfClusters)}}),define("midway/dialog/output/kmeansFooter",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="coefficient-table-wrap hide"><label>'+e(d("saveToODPS"))+'</label>:<span class="table-name"></span><button class="btn btn-primary btn-sm btn-inline"><span class="text">'+e(d("save"))+'</span><span class="icon icon-loading-spinner"></span></button></div>'}()}}),define("dialog/output/kmeans",["zero/zero","zero/ui/DialogEx","zero/ui/DataTable","../../global/utils","../../global/environment","../../i18n","../../ajax/model","../../midway/dialog/output/kmeans","../../midway/dialog/output/kmeansSummary","../../midway/dialog/output/kmeansFooter"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(f){new b({title:l("KMeansModel"),className:"dialog-model-kmeans",body:h(),footer:j(),destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var b=this;(e.isAntLab||e.isAntCloud)&&d.disableCopy(b.$element);var h=f.fromNodeDef?f.modelId:null,j=f.fromNodeDef?null:f.nodeInstanceId;b.showLoading(),g.queryKMeans(h,j,f.loopTimestamp).then(function(d){b.$(m.summary).append(i(d));var e=[{title:l("clusterCenter"),field:"index",width:100}];a.each(d.features,function(a){e.push({title:a,field:a,sort:!0,width:100})});var f=[];a.each(d.clusterCenters,function(b,c){var e=b.value.split(" ")||[],g={index:c};a.each(d.features,function(a,b){g[a]=e[b]}),f.push(g)});var g=b.$(".table-wrap"),h={container:b.$(".table-wrap"),theme:"small",data:f,cols:e,line:!0,grid:!0,crossHover:!1,defaultsort:!0,resizable:!0};new c(h),g.find(".ui-datatable").css("min-width",101*e.length),b.hideLoading()},function(){b.hideLoading(),b.showEmpty()}),b.$element.find(m.footer).find(m.btn).eq(1).on("click",function(){b.hide()});var k=b.$element.find(m.coefficientTable);k.on("click",m.btn,function(){var a=$(this);a.addClass(n.loading),g.writeKmeansModel(j,h,f.loopTimestamp).then(function(){a.removeClass(n.loading)},function(){a.removeClass(n.loading)})}),g.queryKmeansModelTableName(j,h,f.loopTimestamp).then(function(a){k.removeClass(n.hide).find(m.tableName).text(a)})},buttons:[{text:l("close")}]})}var l=f.translate,m={wrap:".logistic-table-wrap",summary:".summary-wrap",footer:".modal-content .modal-footer",coefficientTable:".coefficient-table-wrap",tableName:".table-name",btn:".btn"},n={hide:"hide",loading:"loading"};return{show:k}}),define("midway/toolbox/syncing",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<span class="btn-sync" title="'+e(d("syncModel"))+'"><span class="icon icon-refresh"></span><span class="text">'+e(d("syncing"))+"</span></span>"}()}}),define("midway/toolbox/searchModels",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var f="";return b.length?(f+='<ul class="pai-search-result-model">',a.each(b,function(a){f+='<li><div class="component-item element-model"data-id="'+e(a.id)+'"><span class="icon icon-diamond"></span><span class="text">'+c(a.name)+"</span></div></li>"}),f+="</ul>"):f+='<div class="pai-search-result-empty"><span class="icon icon-diamond-24"></span><span class="text">'+e(d("noSearchResult"))+"</span></div>",f+=""}(b.models)}}),define("toolbox/Search",["zero/zero","zero/declare","../i18n"],function(a,b,c){"use strict";var d={input:".form-control",loading:".icon-loading-spinner",searchText:".search-text",btnClear:".btn-clear"},e={hide:"hide",searching:"searching",hasFocus:"has-focus",hasKeyword:"has-keyword"};return b("properties/SearchBase",[],{constructor:function(a){this.$container=$(a.container),this.$input=this.$container.find(d.input),this.onClear=a.onClear,this.onSearch=a.onSearch,this.setup()},setup:function(){this.$container.on("click",d.btnClear,this.clear.bind(this)).on("keydown paste",d.input,this.keyDown.bind(this)).on("focus",d.input,this.focus.bind(this)).on("blur",d.input,this.blur.bind(this))},search:function(a){if(this.keyword!==a){this.keyword=a;var b=this.$container;b.addClass(e.searching),this.onSearch(a).then(function(){b.removeClass(e.searching)})}},clear:function(){this.keyword="",this.$input.val(""),this.$container.removeClass(e.searching),this.$container.removeClass(e.hasFocus),this.$container.removeClass(e.hasKeyword),this.onClear()},keyDown:function(a){setTimeout(function(){var b=this.getKeyword();this.$container.toggleClass(e.hasKeyword,!!b),13===a.which?this.search(b):27===a.which&&this.clear()}.bind(this),0)},focus:function(){var a=this.$container;a.hasClass(e.hasFocus)||a.find(d.searchText).onCSSTransitionEnd(function(){a.addClass(e.hasFocus),a.find(d.searchText).off()})},blur:function(){var a=this.getKeyword();a?this.search(a):this.clear()},getKeyword:function(){return a.trim(this.$input.val())},destroy:function(){this.$container.off(),a.destroy(this)}})}),define("toolbox/componentsDnd",["zero/zero","zero/ui/DndPrimer","../global/event"],function(a,b,c){"use strict";function d(a,b){var c=Math.abs(a.left-b.left),d=Math.abs(a.top-b.top);return c<100&&d<100?100:300}function e(a){var b=a.data("tree");if(!b)return null;var c=a.data("id");return b.nodeById[c]}function f(a){var b=a.proxy,d=b.offset(),e=b.outerWidth(),f=b.outerHeight(),g=(a.pageX-d.left)/e,h=(a.pageY-d.top)/f;c.componentDrop({x:a.pageX,y:a.pageY,rateX:g,rateY:h,nodeDefId:a.trigger.data("id"),isModel:a.trigger.data("isModel"),isGroup:a.trigger.data("isGroup"),isSearchedNode:a.trigger.hasClass("component-item")}),m.onDragEnd(a)}function g(b){var c={left:h,top:i};b.proxy.animate(c,d(b.proxy.offset(),c),a.bind(m.onDragEnd,null,b))}var h,i,j=document.body,k={dndItem:".tree-node-label-wrapper-leaf",branch:".tree-node-label-wrapper-branch",treeNode:"#j-model-tree .tree-node",dagPaper:"#j-bpmn .pai-bpmn-paper"},l={branchProxy:"tree-node-proxy",leafProxy:"component-drag-proxy",treeItem:"tree-node-label-wrapper-leaf",searchItem:"component-item",highlight:"tree-node-highlight"},m={fully:!0,container:k.dagPaper,proxy:function(a){var b=e(a);if(b&&b.isBranch)return a.find(k.branch).clone();var c=a.clone();return c.find(".tree-node-label-tail").remove(),c},onPrepare:function(a){var b=a.trigger,c=b.offset(),d=b.outerWidth(),f=b.outerHeight(),g=(a.pageX-c.left)/d,k=(a.pageY-c.top)/f,m=e(b);m&&m.isBranch?a.proxy.addClass(l.branchProxy).appendTo(j):a.proxy.removeClass(l.treeItem).removeClass(l.searchItem).addClass(l.leafProxy).appendTo(j),d=a.proxy.outerWidth(),f=a.proxy.outerHeight(),h=a.pageX-d*g,i=a.pageY-f*k,a.proxy.css({left:h,top:i})},onDragOver:function(a){c.componentDragOver({x:a.pageX,y:a.pageY})},onDrop:function(a){a.curContainer?f(a):g(a)},onDragEnd:function(a){a.proxy.remove()}};return b.delay=300,{revert:function(a,b,c){var e=$(a.container).find(k.dndItem),f=e.clone(),g=e.outerWidth(),h=e.outerHeight(),i=e.offset(),m={left:b-g/2,top:c-h/2};f.removeClass(l.treeItem).removeClass(l.searchItem).addClass(l.leafProxy).appendTo(j).css(m),f.animate(i,d(m,i),function(){f.remove()})},init:function(b,c){a.each(b,function(a){var b=a.trigger;void 0===b.data("dnd")&&(b.data("dnd",!0).data("id",a.id).data("isModel",a.isModel).data("isGroup",a.isGroup).data("options",m),c&&b.data("tree",c))})}}}),define("toolbox/models",["zero/zero","zero/fmt/sprintf","zero/ui/Tree","../storage/persistence","../global/Track","../global/FoldStatus","../global/event","../global/notify","../global/download","../global/classNames","../global/environment","../global/nodeMenuChecker","../global/zeroUIWithLog","../storage/componentCache","../i18n","../ajax/search","../ajax/model","../ajax/modelTree","../ajax/experiment","../dialog/model/preparePMML","../dialog/model/showDescription","../dialog/model/deletionConfirm","../dialog/model/saveModel","../dialog/model/shareTo","../dialog/model/renameTreeNode","../dialog/model/publishModel","../dialog/model/publishModelResult","../dialog/output/multiLogisticRegression","../dialog/output/binaryLogisticRegression","../dialog/output/linearRegression","../dialog/output/linearSVM","../dialog/output/randomForest","../dialog/output/kmeans","../midway/toolbox/syncing","../midway/toolbox/searchModels","./Search","./componentsDnd"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){"use strict";function L(){}function M(b){var c=[];return a.each(b,function(a){if(!a.isBranch&&!a.isSync){var b=a.tree.nodeById[a.id],d=$(b.container).find(ca.dndItem);c.push({trigger:d,id:a.id,isGroup:!1,isModel:!0})}}),K.init(c,W),b}function N(){ea.length?Promise.all(ea).then(function(){g.modelTreeLoaded()}):g.modelTreeLoaded()}function O(a){}function P(a){}function Q(a){}function R(a){}function S(b){var c=b.originId||b.id;return(c>=0?r.queryOwnModels(c,b.expId||0):c===aa?r.querySharedModels():r.querySavedModels()).then(function(a){return 0===c&&R(a),a.models}).then(function(c){b.expId&&a.each(b.children,function(a){W.removeNodes(a),delete W.nodeById[a.id]});var d=X(c,function(a){return a.originId=a.id,a.parentId=b.id,a.isModel?(a.title=a.name,a.isBranch=!1,a.isSaved=b.id===_):(a.id=Q(a.id),a.isBranch=!0,a.isExpanded=!1),a}),e=[],f=[];return Y(d,function(a){a.expId?e.push(a):f.push(a)}),e.concat(f)}).then(function(a){return W&&Y(a,function(a){var b=W.nodeById[a.id];b&&b.isNew!==a.isNew&&(b.isNew=a.isNew,$(b.container).find(ca.dndItem).toggleClass(da.isNew,b.isNew))}),a}).then(O).then(M).then(L)}function T(a,b){}function U(a){var b=a.codeName;l.isMultiLogistic(b)?B.show(a):l.isBinaryLogistic(b)?C.show(a):l.isLinearRegression(b)?D.show(a):l.isRandomForests(b)?F.show(a):l.isIsolationForest(b)?F.show(a,"Isolation Forest"):l.isKMeans(b)?G.show(a):l.isLinearSVM(b)&&E.show(a)}function V(a,b){r.updateModelToOss(a,b).then(function(a){t.show(a)})}var W,X=a.map,Y=a.each,Z=(m.initMenu,o.translate),_=(new f(d.keys.modelFoldPath),"saved-model-root"),aa="shared-model-root",ba=[{isExpanded:!1,isBranch:!0,id:0,name:Z("modelDirPai")},{isExpanded:!1,isBranch:!0,id:_,name:Z("modelDirArchive")},{isExpanded:!1,isBranch:!0,id:aa,name:Z("modelDirShared")}],ca={toolbox:"#j-toolbox",table:".pai-component-tree .table",modelNav:"#j-nav-model",modelNum:".pai-new-model-count",container:"#j-model-tree",searchForm:".pai-search-form",searchResult:".pai-search-result",component:".component-item",indenter:".tree-node-indenter",leaf:".tree-node-label-wrapper-leaf",branch:".tree-node-label-wrapper-branch",dndItem:".tree-node-label-wrapper-leaf",btnSync:".btn-sync",loading:".tree-node-loading"},da={hide:"hide",isNew:"is-new",blink:"blink",loading:"loading",proxy:"component-drag-proxy",dndItem:"tree-node-label-wrapper-leaf"},ea=[];g.onRefreshMyModels(function(a){}),g.onRefreshArchivedModels(function(){}),g.onShowModel(U),g.onExportPmml(function(a,c){q.checkExportPmml(a,c).then(function(){r.queryPmmlOssPath(c).then(function(a){if("true"===a.canUpload)V(null,c);else{var d=a.ossPath||b(q.exportOutputURI,c),e=d.split("/").pop().split("?")[0],f=document.createElement("a");f.href=d,f.download=e,f.click(),window.react_bridge.actions&&window.react_bridge.actions.downloadUrl&&window.react_bridge.actions.downloadUrl({url:d,name:e})}})})}),g.onLocateModel(function(a,b){window.react_bridge.actions&&(window.react_bridge.actions.tabs.common.set({activeKey:"experiments"}),window.react_bridge.actions.tabs.experiments.openModelByExpId({experimentId:a}))}),g.onShowDeployModelResult(function(a,b){new A({id:a}).show()}),g.onSaveModel(function(a,b){r.saveModel(b,!0).then(function(a){function c(a){R(a),T(a.modelId)}a.isDuplicate?w.show(a.rawDisplayName,b,!0).then(c):c(a)})}),g.onExperimentsDeleted(function(b){if(!1!==a.isArray(b)){for(var c=[],d=0;d<b.length;d++)c.push({expId:b[d]});P(c),S(ba[0])}}),N()}),define("toolbox/main",["zero/zero","./models","../global/utils"],function(a,b,c){if(window.Tracert){var d=c.track("a455.b4928.c1");$("#j-container").delegate(".pane-node-bulb","click",function(){d("d1")}),$("#j-container").delegate(".pane-node-recommendation","click",function(){d("d2")})}}),define("storage/focusCache",["zero/zero","./cacheBase"],function(a,b){"use strict";return b.create("focus")}),define("ajax/uicontrol",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/uicontrol.json"),d=Object.prototype.hasOwnProperty,e=a.each;return{queryUiControls:function(b,f){var g=b,h=f;return c.get({method:"queryUiControls",experimentId:g,nodeInstanceId:h},!0).then(function(b){function c(a){return"prop-tab-"+g+"-"+h+"-"+a}function i(a){return"prop-item-"+g+"-"+h+"-"+a}function j(b){var c=1,d=p[b];if(d&&d.length){var f={};e(d,function(c){var d=c.fromId,e=q[d];if(e&&e.isIndented||(f[d]=1),!f.hasOwnProperty(d)){var g=o[b];a.some(g,function(a){return a.toId===d})||(f[d]=j(d))}});var g=[];e(f,function(a){g.push(a)}),c+=Math.max.apply(Math,g)}return c}function k(b){if(b){var c=b.split("\n");return c.length>1?a.map(c,function(a){return"<p>"+a+"</p>"}).join(""):c[0]}return""}function l(b){var c=b.controlId;b.id=i(c),b.depth=j(c),e("defaultValue,label,placeholder,tooltip,longTooltip".split(","),function(c){d.call(b,c)?b[c]=a.trim(b[c]):b[c]=""}),b.longTooltip&&(b.longTooltip=k(b.longTooltip)),b.value=b.value?a.trim(b.value):"",e("min,max".split(","),function(a){d.call(b,a)&&(b[a]=parseFloat(b[a]))}),a.isBoolean(b.isDisabled)||(b.isDisabled="true"===b.isDisabled),d.call(b,"options")&&!a.isArray(b.options)&&(b.options=[])}b=b.controls;var m=[],n=b.relations||[],o={},p={},q={};return e(n,function(a){var b=p[a.toId],c=o[a.fromId];b||(b=p[a.toId]=[]),c||(c=o[a.fromId]=[]),b.push(a),c.push(a)}),e(b.tabs||[],function(b,d){var f={id:c(d),name:b.tabName,groups:[]},g=f.groups;e(b.groups,function(b){var c=a.map(b.controls,function(a){return q[a.controlId]=a,l(a),a});g.push({name:b.groupName,controls:c})}),m.push(f)}),m.length>1&&(m[0].selected=!0),{social:{id:f,nodeDefineId:b.nodeDefId,name:b.defName||"",description:b.description||"",author:b.author||"",thumbUp:b.up,thumbDown:b.down,isLiked:!0===b.isUp,isUnLiked:!1===b.isUp,isDefine:!1},tabs:m,relations:n,relationFromMapping:o,relationToMapping:p}})},validateParam:function(a,b,d,e){var f={method:"validateUpdateParam",experimentId:a,nodeInstanceId:b,name:d};return e&&(f.value=e),c.post(f,!0,function(){})},updateParam:function(a,b,d,e){var f={method:"updateParam",experimentId:a,nodeInstanceId:b,name:d};return e&&(f.value=e),c.post(f,!0,function(){})}}}),define("midway/toolbox/componentSocial",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,f,g,h,i,j,k,l,m){var n='<div class="pai-component-info"><div class="section-desc"><div class="header collapsed">'+e(a)+" (id: "+e(b||"")+" )";return n+=f?'<span class="btn-close icon-close-l"></span>':'\x3c!-- <span class="btn-expand"></span> --\x3e',n+='</div><div class="content collapsed"><div class="content-inner">'+c(g)+"</div></div>",h&&(n+='<div class="owner"><span>'+e(d("algoAuthor"))+"</span>:<span>"+e(h)+"</span>",i&&(n+='<a class="componentDetail" href="/component/detail/'+e(i)+'" target="_blank">'+e(d("componentDetail"))+"</a>"),n+="</div>"),n+='<div class="footer hide"><div class="footer-sec"><span class="btn-feedback btn-like '+e(j?" isClicked":"")+'"><span class="icon icon-like-l-24"></span><span class="text">'+e(d("thumbUp"))+"<i>"+e(k)+'</i></span></span></div><div class="footer-sec"><span class="btn-feedback btn-unlike '+e(l?" isClicked":"")+'"><span class="icon icon-dislike-l-24"></span><span class="text">'+e(d("thumbDown"))+"<i>"+e(m)+'</i></span></span></div></div></div><div class="section-suggest hide"><div class="header">'+e(d("suggestion"))+'<span class="btn-cancel icon-close-l"></span></div><div class="content"><textarea class="form-control" placeholder="'+e(d("phSuggestion"))+'" name="suggestion" maxlength="180" rows="6"></textarea></div><div class="footer"><div class="footer-sec"><span class="btn-feedback btn-suggest"><span class="text">'+e(d("submit"))+'</span></span></div><div class="footer-sec"><span class="btn-feedback btn-cancel"><span class="text">'+e(d("cancel"))+"</span></span></div></div></div></div>"}(b.name,b.id,b.isDefine,b.description,b.author,b.nodeDefineId,b.isLiked,b.thumbUp,b.isUnLiked,b.thumbDown)}}),define("toolbox/ComponentSocial",["zero/zero","zero/declare","../i18n","../global/environment","../global/event","../ajax/experiment","../midway/toolbox/componentSocial"],function(a,b,c,d,e,f,g){"use strict";function h(b){var c=b.split("\n");return a.map(c,function(a){return"<p>"+a+"</p>"}).join("")}var i={hide:"hide",isClicked:"isClicked",hasError:"has-error",collapsed:""},j={header:".header",content:".content",owner:".owner",secDesc:".section-desc",secSuggest:".section-suggest",suggestion:'textarea[name="suggestion"]',btnSuggest:".btn-suggest",btnCancel:".btn-cancel",btnExpand:".btn-expand",btnClose:".btn-close",btnLike:".btn-like",btnUnLike:".btn-unlike",inputError:".form-control-error"},k=document.body,l=c.translate;return b("toolbox/ComponentSocial",[],{constructor:function(b){var c=this;c.ns="."+a.uuid(),c.isDefine=b.isDefine,b.description=h(b.description);var e=$(g(b,!0));if(d.isInternal&&b.author||e.find(j.owner).remove(),c.isDefine){e.on("click",j.btnClose,c.close.bind(c));var m=$(k).on("click"+c.ns,function(a){$.contains(c.$wrap[0],a.target)||(c.close(),m.off(c.ns))})}else e.on("click",j.header,function(){$(this).toggleClass(i.collapsed).next(j.content).toggleClass(i.collapsed)});return e.on("click",j.btnLike,function(){var a=$(this);f.praiseUpOrDown(b.id,c.isDefine,!0).then(function(){var d=a.find("i"),e=parseInt(d.text(),10)||0;b.isLiked?(b.isLiked=!1,e-=1):(b.isLiked=!0,e+=1),a.toggleClass(i.isClicked,b.isLiked),d.text(e||0),b.isLiked&&(a=c.$wrap.find(j.btnUnLike),a.hasClass(i.isClicked)&&(d=a.find("i"),e=parseInt(d.text(),10)||0,e-=1,a.toggleClass(i.isClicked,!1),d.text(e||0),b.isUnLiked=!1))})}).on("click",j.btnUnLike,function(){var a=$(this);b.isUnLiked?f.praiseUpOrDown(b.originId||b.id,c.isDefine,!1).then(function(){var c=a.find("i"),d=parseInt(c.text(),10)||0;b.isUnLiked=!1,d-=1,a.toggleClass(i.isClicked,!1),c.text(d||0)}):c.showSuggestion()}).on("click",j.btnSuggest,function(){var a=c.$wrap.find(j.suggestion),d=a.val();if(!/^(([^<>])*)$/.test(d))return void c.showError(l("errorStringXss"));if(d.length<10)return void c.showError(l("suggestionToShort"));if(d.length>180)return void c.showError(l("suggestionToLong"));var e=c.$wrap.find(j.btnUnLike);f.praiseUpOrDown(b.originId||b.id,c.isDefine,!1,d).then(function(){var d=e.find("i"),f=parseInt(d.text(),10)||0;b.isUnLiked=!0,f+=1,e.toggleClass(i.isClicked,!0),d.text(f||0),c.hideSuggestion(),a.val(""),e=c.$wrap.find(j.btnLike),e.hasClass(i.isClicked)&&(d=e.find("i"),f=parseInt(d.text(),10)||0,f-=1,e.toggleClass(i.isClicked,!1),d.text(f||0),b.isLiked=!1)})}).on("click",j.btnCancel,function(){c.hideSuggestion()}).on("focus",j.suggestion,function(){c.hideError()}),c.$wrap=e,c},close:function(){this.$wrap.addClass(i.hide)},showError:function(a){var b=this,c=b.$wrap.find(j.suggestion);return b.hideError(),c.parent().addClass(i.hasError).end().after('<label class="form-control-error icon-close-c">'+a+"</label>"),b},hideError:function(){var a=this;return a.$wrap.find(j.suggestion).next(j.inputError).remove().end().parent().removeClass(i.hasError),a},showSuggestion:function(){this.$wrap.find(j.secDesc).addClass(i.hide).end().find(j.secSuggest).removeClass(i.hide)},hideSuggestion:function(){this.$wrap.find(j.secDesc).removeClass(i.hide).end().find(j.secSuggest).addClass(i.hide)},destroy:function(){var b=this;b.$wrap.off().remove(),$(k).off(b.ns),a.destroy(b),b.destroyed=!0}})}),define("midway/properties/propertiesPanel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e){var f='<div class="dms-prop-wrap">',c=b.length>1;return f+='<header class="'+d(c?"dms-prop-header has-tab":"dms-prop-header")+'">',c||e?(f+='<ul class="dms-prop-tab">',a.each(b,function(a,b){f+='<li class="'+d(a.selected?"selected":"")+'"'+d(e?"data-key="+a.tabKey+" ":"")+'data-target="#'+d(a.id)+'" data-id="dms-prop-tab-'+d(b)+'">'+d(a.name)+"</li>"}),f+="</ul>"):f+=""+d(b[0].name),f+='</header><section class="dms-prop-body">',a.each(b,function(a){f+='<div class="dms-prop-page"'+d(e?"data-key="+a.tabKey+" ":"")+'id="'+d(a.id)+'"></div>'}),f+='</section><footer class="dms-prop-footer"></footer></div>'}(b.tabs,b.hasTab,b.isEditMode)}}),define("midway/properties/propertiesGroup",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="dms-prop-group"></div>'}}),define("midway/properties/propertyItemPadding",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="dms-prop-padding"></div>'}}),define("midway/properties/propertiesLoading",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="dms-prop-loading"><span class="icon-loading-spinner"></span><span class="text">'+e(a||d("loading"))+"</span></div>"}(b.message)}}),define("midway/properties/propertyItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g){var h='<div class="dms-prop-item '+d(a?"disabled":"")+'">';return(b||c||e||f)&&(h+='<div class="dms-prop-label'+d(b?"":" hide")+d(e?" has-long-tooltip":"")+'"><label for="'+d(g)+'">',(b||f)&&(h+='<span class="dms-prop-label-text">'+d(b)+"</span>"),h+="",(c||f)&&(h+='<span class="dms-prop-tooltip" title="'+d(c)+'">'+d(c)+"</span>"),h+="",(f||e)&&(h+='<i class="dms-prop-label-help icon-help-o"></i>'),h+="</label></div>"),h+='<div class="dms-prop-input"></div></div>'}(b.isDisabled,b.label,b.tooltip,b.longTooltip,b.isEditMode,b.id)}}),define("midway/properties/propertyErrorTip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return'<div class="dms-prop-error"><label class="icon-close-c" for="'+d(a)+'"></label></div>'}(b.id)}}),define("midway/properties/propertyWarning",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return'<div class="dms-prop-warning"><label class="icon-warning" for="'+d(a)+'"></label></div>'}(b.id)}}),define("properties/ItemBase.js",["zero","zero/zero","zero/declare","../midway/properties/propertyItem","../midway/properties/propertyErrorTip","../midway/properties/propertyWarning"],function(a,b,c,d,e,f){"use strict";var g={disabled:"disabled",hide:"hide",hasError:"has-error",hasWarning:"has-warning",loading:"loading"},h={inputWrap:".dms-prop-input",errorTip:".dms-prop-error",longTip:".dms-prop-label-help",warning:".dms-prop-warning"},i=a.Popup;return c("properties/ItemBase",[],{constructor:function(a){var c=this;return a=c.metadata=a||{},a.isEditMode=!1,void 0===a.isDisabled&&(a.isDisabled=!1),b.forEach("controlId,name,type".split(","),function(b){c[b]=a[b]||""}),c.$wrap=$(d(a)),c.$wrap.find(".dms-prop-tooltip").html(a.tooltip),c.$inputWrap=c.$wrap.find(h.inputWrap),c.isValid=!0,c.isChanged=!1,c.installLongTooltip()},installLongTooltip:function(){var a=this,b=a.metadata,c=a.metadata.longTooltip;return a.$longTooltip=a.$wrap.find(h.longTip),c&&"zh_CN"===window.USER_LOCALE&&(a.popup=new i({element:a.$longTooltip,content:c,escape:!1,hoverable:!0,position:"top right",align:"center",prefer:"counterclockwise",gap:2}),b.isDisabled),a},validate:function(){return this.hideError(),!0},getValue:function(){return this.metadata.value},reload:function(){return this},showError:function(a){var c=this,d=c.$wrap.find(h.errorTip);return d.length||(d=$(e(c.metadata)).appendTo(c.$wrap)),c.$wrap.addClass(g.hasError),d.find("label").text(a),c.hideErrorDelay&&(clearTimeout(c.hideErrorTimer),c.hideErrorTimer=setTimeout(b.bind(c.hideError,c),c.hideErrorDelay)),c},hideError:function(){var a=this;return a.$wrap.find(h.errorTip).find("label").text(""),a.$wrap.removeClass(g.hasError),a},showWarning:function(a){var b=this,c=b.$wrap.find(h.warning);return c.length||(c=$(f(b.metadata)).appendTo(b.$wrap)),b.$wrap.addClass(g.hasWarning),c.find("label").text(a),b},hideWarning:function(){var a=this;return a.$wrap.find(h.warning).find("label").text(""),a.$wrap.removeClass(g.hasWarning),a},showLoading:function(){var a=this;return a.$wrap.addClass(g.loading),a},hideLoading:function(){var a=this;return a.$wrap.removeClass(g.loading),a},beforeReload:function(){return this},afterReload:function(){return this},_setDisabled:function(a){var b=this
;if(b.$wrap.hasClass(g.disabled)!==a){b.metadata.isDisabled=!0===a;var c=b.metadata.isDisabled?"addClass":"removeClass";return b.$wrap[c](g.disabled),b.$input&&b.$input.prop("disabled",a),b}},isDisabled:function(){return this.$wrap.hasClass(g.disabled)},enable:function(){return this._setDisabled(!1)},disable:function(){return this._setDisabled(!0)},show:function(){var a=this;return a.$wrap.removeClass(g.hide),a},hide:function(){var a=this;return a.$wrap.addClass(g.hide),a},isHidden:function(){return this.$wrap.hasClass(g.hide)},clear:function(){return!1},destroy:function(){var a=this;a.$wrap.off().remove(),a.popup&&a.popup.destroy(),b.destroy(a),a.destroyed=!0}})}),define("properties/ItemLabel",["zero/zero","zero/declare","../properties/ItemBase"],function(a,b,c){"use strict";return b("properties/ItemBase",[c],{constructor:function(a){a=a||{},c.prototype.constructor.call(this,a),this.$inputWrap.remove(),delete this.$inputWrap}})}),define("properties/ItemBaseCommon",["zero/zero","zero/declare","../properties/ItemBase"],function(a,b,c){"use strict";return b("properties/ItemBaseCommon",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b},_render:function(a){var b=this;return b.$input=$(a(b.metadata)).appendTo(b.$inputWrap),b.$input.find(".btn-clear").length&&(b.$input=b.$input.find("input")),b}})}),define("properties/ItemBaseText",["zero/zero","zero/declare","../properties/ItemBaseCommon"],function(a,b,c){"use strict";return b("properties/ItemBaseText",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b},_setup:function(){var b=this;return b.metadata.isDisabled?b:(b.$input.on("keydown",function(a){13===a.which&&b.onBlur()}).on("blur",a.bind(b.onBlur,b)).on("focus",a.bind(b.onFocus,b)),b.$wrap.on("click",".btn-clear",function(){b.$input.val("").focus()}),b)},onFocus:function(){var a=this;return a.hideError(),a},onBlur:function(){var a=this;return a.validate()&&a.notifyChange.call(a.master,a),a},getValue:function(){return a.trim(this.$input.val())},setValue:function(a){return this.$input.val(a),this},clear:function(){var b=this;return!!a.trim(b.getValue())&&(b.setValue(""),b.isValid=!0,b.isChanged=!0,b.notifyChange.call(b.master,b),!0)}})}),define("properties/ItemBaseString",["zero/zero","zero/declare","zero/fmt/sprintf","../properties/ItemBaseText","../i18n"],function(a,b,c,d,e){"use strict";var f=e.translate;return b("properties/ItemBaseString",[d],{constructor:function(a){var b=this;return a=a||{},a.value=""+a.value,d.prototype.constructor.call(b,a),b},validate:function(){var a=this,b=a.metadata,c=a.getValue();if(a.isValid=!1,a.isChanged=!1,!0===b.isRequired&&""===c)return a.showError(f("errorStringRequired")),!1;if(!a.hasSpechars&&!/^(([^<>])*)$/.test(c))return a.showError(f("errorStringXss")),!1;var d=c.length;return b.hasOwnProperty("min")&&d<b.min?(a.showError(f("errorStringMin",b.min)),!1):b.hasOwnProperty("max")&&d>b.max?(a.showError(f("errorStringMax",b.max)),!1):(a.hideError(),a.isValid=!0,a.isChanged=b.value!==c,!0)}})}),define("midway/properties/itemString",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g){var h='<input type="text"id="'+d(a)+'"value="'+d(b)+'"placeholder="'+d(c||"")+'"'+d(e?" disabled ":"")+d(void 0!==f?"maxlength="+f+" ":"")+'class="form-control">';return g||(h+='<span class="btn-clear icon-close-o"></span>'),h+=""}(b.id,b.value,b.placeholder,b.isDisabled,b.max,b.isEditMode)}}),define("properties/ItemString",["zero/zero","zero/declare","../properties/ItemBaseString","../midway/properties/itemString"],function(a,b,c,d){"use strict";return b("properties/ItemString",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b.$wrap.addClass("dms-prop-item-string"),b._render(d)._setup(),b}})}),define("midway/properties/itemPassword",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g){var h='<input type="password"id="'+d(a)+'"value="'+d(b)+'"placeholder="'+d(c||"")+'"'+d(e?" disabled ":"")+d(void 0!==f?"maxlength="+f+" ":"")+'class="form-control">';return g||(h+='<span class="btn-clear icon-close-o"></span>'),h+=""}(b.id,b.value,b.placeholder,b.isDisabled,b.max,b.isEditMode)}}),define("properties/ItemPassword",["zero/zero","zero/declare","../properties/ItemBaseString","../midway/properties/itemPassword"],function(a,b,c,d){"use strict";return b("properties/ItemPassword",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b.$wrap.addClass("dms-prop-item-password"),b._render(d)._setup(),b}})}),define("midway/properties/itemNumber",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g,h){return'<input type="number"id="'+d(a)+'"step="'+d(void 0!==b?b:"")+'"value="'+d(void 0!==c?c:"")+'"placeholder="'+d(e||"")+'"'+d(f?" disabled ":"")+d(void 0!==g?"min="+g+" ":"")+d(void 0!==h?"max="+h+" ":"")+'class="form-control">'}(b.id,b.step,b.value,b.placeholder,b.isDisabled,b.min,b.max)}}),define("properties/ItemNumber",["zero/zero","zero/declare","zero/fmt/sprintf","../properties/ItemBaseText","../midway/properties/itemNumber","../i18n"],function(a,b,c,d,e,f){"use strict";var g=f.translate;return b("properties/ItemNumber",[d],{constructor:function(a){var b=this;return a=a||{},a.step=a.extraParam?parseFloat(a.extraParam):1,isNaN(a.step)&&(a.step=1),d.prototype.constructor.call(b,a),b.$wrap.addClass("dms-prop-item-number"),b._render(e)._setup(),b},validate:function(){var a=this,b=a.metadata,c=a.getValueAsNumber(),d=a.getValue();return a.isValid=!1,a.isChanged=!1,!0===b.isRequired&&""===d||isNaN(d)?(a.showError(g("errorNumberType")),!1):b.hasOwnProperty("min")&&c<b.min?(a.showError(g("errorNumberMin",b.min)),!1):b.hasOwnProperty("max")&&c>b.max?(a.showError(g("errorNumberMax",b.max)),!1):(a.hideError(),a.isValid=!0,a.isChanged=b.value!==d,!0)},getValue:function(){var a=this.$input[0],b=a.value;return isNaN(b)?"":b},getValueAsNumber:function(){var a=this.$input[0],b=a.valueAsNumber;return isNaN(b)?"":b},clear:function(){var a=this,b=a.getValue();if(!isNaN(b)){var c=this.$input[0];return c&&(c.value=""),a.isValid=!0,a.isChanged=!0,a.notifyChange.call(a.master,a),!0}return!1}})}),define("properties/ItemPercent",["zero/zero","zero/declare","../properties/ItemNumber"],function(a,b,c){"use strict";return b("properties/ItemPercent",[c],{constructor:function(a){var b=this;return a=a||{},a.label+="(%)",c.prototype.constructor.call(b,a),b}})}),define("midway/properties/itemSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e){var f='<label for="'+d(b)+'"class="select-hacker"><select id="'+d(b)+'"class="form-control"'+d(c?" disabled ":"")+">";return a.each(e,function(a){f+='<option value="'+d(a.value)+'">'+d(a.text)+"</option>"}),f+="</select></label>"}(b.id,b.isDisabled,b.options)}}),define("properties/ItemSelect",["zero/zero","zero/declare","../properties/ItemBaseCommon","../midway/properties/itemSelect"],function(a,b,c,d){"use strict";return b("properties/ItemSelect",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),a.value=""+a.value,a.options=a.options||[],b.$wrap.addClass("dms-prop-item-select"),b._render(d)._setup(),b.$input.val(a.value||""),b},_reRender:function(a){var b=this;return b.$input=$(a(b.metadata)),b.$wrap.find(".dms-prop-input").html(b.$input),b.$input.find(".btn-clear").length&&(b.$input=b.$input.find("input")),b},_reload:function(a){var b=this;return b._reRender(d)._setup(),b.$input.val(b.metadata.value||""),b},_setup:function(){var a=this;return a.$input=a.$input.find("select"),a.$input.off(),a.$input.on("change",function(){a.validate()&&a.notifyChange.call(a.master,a)}),a},validate:function(){var a=this,b=a.metadata,c=a.getValue();return a.isValid=!1,a.isChanged=!1,a.hideError(),a.isValid=!0,a.isChanged=b.value!==c,!0},getValue:function(){return this.$input.val()},setValue:function(a){return this.$input.val(a),this},clear:function(){var a=this;a.getValue()&&(a.setValue(),a.isValid=!0,a.isChanged=!0,a.notifyChange.call(a.master,a))}})}),define("midway/properties/itemMultSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<div class="ui-select ui-multi-select form-control" tabindex="-1"><input type="hidden"><div class="ui-select-text"></div><i class="ui-select-caret"></i><div class="ui-select-drop"><ul class="ui-select-items">';a.each(b,function(a,b){f+='<li class="ui-select-item"><div class="ui-checkbox"><input type="checkbox"data-value="'+e(a.value)+'"'+e(a.selected?"checked ":"")+'id="'+e(c)+"-"+e(b)+'"><label for="'+e(c)+"-"+e(b)+'"><span>'+e(a.text)+"</span></label></div></li>"}),f+='</ul><div class="ui-select-footer"><div class="ui-checkbox">';var c=a.uuid();return f+='<input type="checkbox" class="chk-selectAll" id="'+e(c)+'"><label for="'+e(c)+'"><span>'+e(d("selectAll"))+'</span></label></div><button type="button"class="btn btn-sm btn-primary btn-close fr">'+e(d("ok"))+"</button></div></div></div>"}(b.options,b.id)}}),define("properties/ItemMultiSelect",["zero/zero","zero/declare","../i18n","../properties/ItemBaseCommon","../midway/properties/itemMultSelect"],function(a,b,c,d,e){"use strict";var f={text:".ui-select-text",drop:".ui-select-drop",checkbox:".ui-select-item .ui-checkbox input",chkSelectAll:".chk-selectAll",btnClean:".btn-clean",btnClose:".btn-close"},g={opened:"opened",indeterminate:"indeterminate"},h=c.translate;return b("properties/ItemMultiSelect",[d],{constructor:function(b){var c=this;b=b||{},d.prototype.constructor.call(c,b),b.value=""+b.value,b.options=b.options||[];var f=[];return a.each(b.value.split(","),function(a){var b=a.split(":");2===b.length&&"true"===b[1]&&f.push(b[0])}),a.each(b.options,function(b){b.selected=a.some(f,function(a){return a===b.value})}),c._render(e).setup(),c.setText(),c},setup:function(){var b=this,c=b.metadata,d=c.options;return b.$input.on("click",f.text,function(){return b.toggle(),!1}).on("change",f.chkSelectAll,function(){return $(this).prop("checked")?b.selectAll():b.clear(),!1}).on("click",f.btnClose,function(){return b.close(),!1}).on("change",f.checkbox,function(){var c=$(this),e=c.attr("data-value"),f=c.prop("checked");a.some(d,function(a){if(a.value===e)return a.selected=f,!0}),b.setText()}),b},setupDocClick:function(a){var b=this,c="click.doc-"+b.metadata.id,d=$(document);return a?(d.on(c,function(a){b.$input.is(a.target)||$.contains(b.$input[0],a.target)||b.close()}),b.fixPosition()):d.off(c),b},fixPosition:function(){var a=this,b=a.$input,c=b.find(f.drop),d=b.offset().top+b.outerHeight(),e=c.outerHeight(),g=$(document.body).height();if(g-d>e)return a;if(e<=g-2){var h=g-d-e;return c.css("margin-top",h-1),a}return c.css({height:g-2,"margin-top":2-d}),a},setText:function(){var b=this.metadata.options,c=[];a.each(b,function(a){a.selected&&c.push(a.text)});var d=c.join(", ")||h("pleaseSelect");return this.$input.find(f.text).text(d).attr("title",d),this.$input.find(f.chkSelectAll).prop("checked",c.length===b.length).parent().toggleClass(g.indeterminate,c.length>0&&c.length<b.length),this},updateHint:function(){var b=this,c=b.metadata,d=c.options,e=[],f=function(a){return encodeURI(a).replace(":","%3a").replace(",","%2c").replace(" ","%20")};a.each(d,function(a){e.push(f(a.value)+":"+a.selected)});var g=e.join(",");return g!=c.value&&(c.value=g,b.isValid=!0,b.isChanged=!0,b.notifyChange&&b.notifyChange.call(b.master,b)),b},getValue:function(){return this.metadata.value},toggle:function(){this.$input.toggleClass(g.opened).focus();var a=this.$input.hasClass(g.opened);return this.setupDocClick(a),a||this.updateHint(),this},close:function(){return this.$input.removeClass(g.opened).focus().find(f.drop).removeAttr("style"),this.setupDocClick(!1),this.updateHint(),this},doSelect:function(b){var c=this.metadata.options;return this.$input.find(f.checkbox).prop("checked",b),a.each(c,function(a){a.selected=b}),this.setText(),this},selectAll:function(){return this.doSelect(!0)},clear:function(){return this.doSelect(!1)}})}),define("midway/properties/itemKeyValueItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return'<tr class="dms-prop-kv-item'+d(a?" has-remove":"")+'"data-key=""><td class="dms-prop-kv-item-label has-input"><input type="text" class="form-control input-sm"></td><td class="dms-prop-kv-item-text"><input type="text" class="form-control input-sm"><div class="btn-delete icon-close-o"></div></td></tr>'}(b.editable)}}),define("midway/properties/itemKeyValueGenerator",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<div class="dms-prop-kv"><div class="btn-add icon-plus-o'+e(b?"":" hide")+'"></div><table class="dms-prop-kv-list'+e(c.length?"":" hide")+'"><tbody>';return a.each(c,function(a){f+='<tr class="dms-prop-kv-item'+e(b?" has-remove":"")+'"data-key="'+e(a.key)+'"><td class="dms-prop-kv-item-label">'+e(a.label)+'</td><td class="dms-prop-kv-item-text"><input type="text" class="form-control input-sm"value="'+e(a.value)+'"><div class="btn-delete icon-close-o"></div></td></tr>'}),f+='</tbody></table><div class="dms-prop-kv-empty'+e(c.length?" hide":"")+'">'+e(d("addItemTip"))+"</div></div>"}(b.editable,b.values)}}),define("properties/ItemKeyValueGenerator",["zero/zero","zero/declare","../i18n","../properties/ItemBase","../midway/properties/propertyErrorTip","../midway/properties/itemKeyValueItem","../midway/properties/itemKeyValueGenerator"],function(a,b,c,d,e,f,g){"use strict";var h=c.translate,i={list:".dms-prop-kv-list",item:".dms-prop-kv-item",label:".dms-prop-kv-item-label",value:".dms-prop-kv-item-text",input:".form-control",btnAdd:".btn-add",btnDelete:".btn-delete",errorTip:".dms-prop-error",empty:".dms-prop-kv-empty"},j={hide:"hide",hasError:"has-error"};return b("properties/ItemKeyValueGenerator",[d],{constructor:function(b){var c=this;b=b||{},d.prototype.constructor.call(c,b),b.editable="true"===b.extraParam,b.value=""+b.value,b.options=b.options||[];var e=[];return a.each(b.value.split(","),function(a){if(a){var b=a.split(":");e.push({key:b[0],value:b[1]})}}),a.each(b.options,function(b){a.some(e,function(a){if(a.key===b.value)return a.label=b.text,!0})||e.push({key:b.value,label:b.text,value:""})}),b.values=e,c.$inputWrap.append(g(c.metadata)),c._setup(),c},_setup:function(){var a=this,b=a.$inputWrap;return a.metadata.editable&&b.on("click",i.btnAdd,function(){a.addItem()}).on("click",i.btnDelete,function(){a.removeItem(this)}),b.on("focus",i.input,function(){a.hideItemError(this)}).on("blur",i.input,function(){a.doBlur(this)}).on("keydown",i.input,function(b){13===b.keyCode&&a.doBlur(this)}),a},doBlur:function(b){var c=this,d=$(b),e=c.metadata.values,f=d.val();if(!/^(([^<>])*)$/.test(f))return c.showItemError(b,h("errorStringXss")),!1;var g=d.parents(i.item),j=g.attr("data-key");return d.parent().is(i.label)?j!==f&&f&&(j?a.each(e,function(a){a.key===j&&(a.key=f)}):e.push({key:f,label:f,value:""}),g.attr("data-key",f),c.isValid=!0,c.isChanged=!0):a.each(e,function(a){a.key===j&&a.value!==f&&(a.value=f,c.isValid=!0,c.isChanged=!0)}),c.isChanged&&c.notifyChange.call(c.master,c),c},showItemError:function(a,b){var c=this,d=$(a).parent(),f=d.find(i.errorTip);return f.length||(f=$(e(c.metadata)).appendTo(d)),d.addClass(j.hasError),f.find("label").text(b),c},hideItemError:function(a){return $(a).parent().removeClass(j.hasError).find(i.errorTip).remove(),this},addItem:function(){var a=this,b=a.$inputWrap;return b.find(i.item).length||(b.find(i.empty).addClass(j.hide),b.find(i.list).removeClass(j.hide)),b.find(i.list).find("tbody").append(f({editable:a.metadata.editable})),a},removeItem:function(a){var b=this,c=b.metadata.values,d=b.$inputWrap,e=$(a).parents(i.item);e.remove(),d.find(i.item).length||(d.find(i.empty).removeClass(j.hide),d.find(i.list).addClass(j.hide));var f=e.index();return c.splice(f,1),b.isValid=!0,b.isChanged=!0,b.notifyChange.call(b.master,b),b},getValue:function(){var b=[];return a.each(this.metadata.values,function(a){b.push(a.key+":"+a.value)}),b.join(",")},clear:function(){var a=this;a.getValue()&&(a.setValue(""),a.isValid=!0,a.isChanged=!0,a.notifyChange.call(a.master,a))}})}),define("midway/properties/itemCheckbox",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g){var h='<div class="ui-checkbox"><input type="checkbox"id="'+d(a)+'"'+d(b?" disabled ":"")+d(c?" checked ":"")+'><label for="'+d(a)+'"><span class="ui-checkbox-label">'+d(e)+"</span>";return(f||g)&&(h+='<span class="dms-prop-tooltip" title="'+d(f)+'">'+d(f)+"</span>"),h+="</label></div>"}(b.id,b.isDisabled,b.checked,b.label,b.tooltip,b.isEditMode)}}),define("properties/ItemCheckbox",["zero/zero","zero/declare","../properties/ItemBase","../midway/properties/itemCheckbox"],function(a,b,c,d){"use strict";return b("properties/ItemCheckbox",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),a.valueType=(a.extraParam||"boolean").toLowerCase(),a.checked=b.valueToChecked(a.value),b.revertOnFail=!0,b.hideErrorDelay=2e3,b._render()._setup(),b},_render:function(){var a=this;if(a.$wrap.addClass("dms-prop-item-checkbox"),a.$input=$(d(a.metadata)).prependTo(a.$inputWrap).find("input"),a.metadata.longTooltip){var b=a.$inputWrap.find(".dms-prop-tooltip");b.length||(b=a.$inputWrap.find(".ui-checkbox-label")),a.$longTooltip.insertAfter(b),a.$inputWrap.addClass("has-long-tooltip")}return a},_setup:function(){var b=this;return b.metadata.isDisabled?b:(b.$input.on("change",a.bind(b.onChange,b)).on("focus",a.bind(b.onFocus,b)),b)},isBoolType:function(){return"boolean"===this.metadata.valueType},checkedToValue:function(a){return this.isBoolType()?a?"true":"false":a?"1":"0"},valueToChecked:function(a){var b=this;return a+="",b.isBoolType()?"true"===a:"1"===a},onChange:function(){var a=this,b=a.metadata,c=a.$input.prop("checked");return a.isChanged=a.checkedToValue(c)!==b.value,b.checked=c,a.notifyChange.call(a.master,a,!0),a},onFocus:function(){var a=this;return a.hideError(),a},getValue:function(){var a=this,b=a.$input.prop("checked");return a.checkedToValue(b)},setValue:function(a,b){var c=this,d=c.metadata,e=c.valueToChecked(a);return c.$input.prop("checked",e),!0===b?(d.value=a,d.checked=e):c.onChange(),c},revert:function(){var a=this;return a.setValue(!a.getValue(),!0),a},clear:function(){var a=this;return!!a.getValue()&&(a.setValue(!1),a.isValid=!0,a.isChanged=!0,a.notifyChange.call(a.master,a),!0)}})}),define("midway/properties/itemTextarea",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){return'<textarea id="'+d(a)+'"placeholder="'+d(b||"")+'"'+d(void 0!==c?"maxlength="+c+" ":"")+'class="form-control">'+d(e)+"</textarea>"}(b.id,b.placeholder,b.max,b.value)}}),define("properties/ItemTextarea",["zero/zero","zero/declare","../properties/ItemBaseString","../midway/properties/itemTextarea"],function(a,b,c,d){"use strict";return b("properties/ItemTextarea",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b.$wrap.addClass("dms-prop-item-textarea"),b.hasSpechars=!0,b._render(d)._setup(),b}})}),define("ajax/codeMirror",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/codeMirror.json");return{getScript:function(a,b,d){return c.get({method:"getScript",experimentId:a,nodeInstanceId:b,paramName:d}).then(function(a){return a?a.script:""})}}}),define("midway/dialog/properties/codeEditor",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f){var g='<div class="dialog-code-editor"><div class="inner"><span class="btn-close icon icon-close-l"></span><header class="header"><h2>'+e(a)+" ";return b&&(g+='<span class="tooltip">'+e(b)+"</span> "),g+="</h2>",c&&(g+='<p class="longTooltip">'+e(c)+"</p> "),g+='</header><div class="content"><div class="content-inner"><textarea class="form-control txtCode">'+e(f)+'</textarea></div></div><div class="footer"><button type="button" class="btn btn-sm btn-primary btn-save">'+e(d("save"))+'</button><button type="button" class="btn btn-sm btn-close">'+e(d("close"))+"</button></div></div></div>"}(b.label,b.tooltip,b.longTooltip,b.value)}}),define("dialog/properties/codeEditor",["zero/zero","../../midway/dialog/properties/codeEditor"],function(a,b){"use strict";function c(c,g,h,i){function j(a){m.removeClass(f.prepared),m.removeClass(f.fullscreen),setTimeout(function(){l.toTextArea(),m.off().remove(),l=null,m=null,!0!==a&&i()},600)}function k(a){a(l.doc.getValue()),j(!0)}var l,m;return new Promise(function(i){m=$(b(c)).css(g).appendTo(document.body),setTimeout(function(){m.addClass(f.fullscreen)},10),setTimeout(function(){var b=c.codeType||"sql",g=a.merge({},d.config,{mode:d.codeType[b]}),i=m.find(e.codeInput)[0];l=CodeMirror.fromTextArea(i,g),l.setOption("extraKeys",{Tab:function(a){var b=Array(a.getOption("indentUnit")+1).join(" ");a.replaceSelection(b)}}),l.on("change",h),m.addClass(f.prepared)},600),m.on("click",e.btnClose,j).on("click",e.btnSave,function(){k(i)})})}var d=(a.map,a.some,a.filter,{codeType:{r:"text/x-rsrc",sql:"text/x-plsql",pai:"text/x-sh",python:"text/x-cython",shell:"text/x-sh",xml:"application/xml",javascript:"text/javascript",json:"application/json",go:"text/x-go"},config:{lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0,lineComment:!0,showCursorWhenSelecting:!0,indentWithTabs:!1,tabSize:4,theme:"default"}}),e={codeInput:".txtCode",btnSave:".btn-save",btnClose:".btn-close"},f={fullscreen:"fullscreen",prepared:"prepared"};return{show:c}}),define("dialog/properties/codeCache",["zero/zero","../../i18n","zero/ui/Confirm"],function(a,b,c){"use strict";function d(a){return new Promise(function(b){c({title:"代码缓存",body:"你有尚未保存的代码("+a+"),是否恢复到编辑器中?",onAccept:function(){b()}})})}b.translate;return{show:d}}),define("midway/properties/itemCodearea",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="button"><i class="icon icon-fullscreen"></i></div>'}}),define("properties/ItemCodearea",["zero/zero","zero/declare","../properties/ItemBase","../global/event","../ajax/codeMirror","../dialog/properties/codeEditor","../midway/properties/itemTextarea","../dialog/properties/codeCache","../midway/properties/itemCodearea"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){if(j.cached||(j.cached={}),j.cached[a])return b();var c=define;define=null;var d=function(){define=c,b()},e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,f=document.createElement("script");f.type="text/javascript",f.crossorigin="true",f.src="/lib/codemirror/5.0/mode/"+a+"/"+a+".js",e.insertBefore(f,e.firstChild),b&&(document.addEventListener?f.addEventListener("load",d,!1):f.onreadystatechange=function(){/loaded|complete/.test(f.readyState)&&(f.onreadystatechange=null,d())}),j.cached[a]=!0}function k(a){var b=this.master.nodeInstanceId+"_"+this.name,c={date:moment().format("YYYY-MM-DD HH:mm:ss"),code:a},d=JSON.parse(localStorage.getItem("codeCache")||"{}");d.code!==a&&(d[b]=c,localStorage.setItem("codeCache",JSON.stringify(d)))}var l={codeType:{r:"text/x-rsrc",sql:"text/x-plsql",pai:"text/x-sh",python:"text/x-cython",shell:"text/x-sh",xml:"application/xml",javascript:"text/javascript",json:"application/json",go:"text/x-go"},config:{lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0,lineComment:!0,showCursorWhenSelecting:!0,indentWithTabs:!1,tabSize:4,theme:"default"}},m={workspace:"#j-workspace"},n={big:"has-big-right-side"},o=_.throttle(function(){var a=this.master.nodeInstanceId+"_"+this.name,b=JSON.parse(localStorage.getItem("codeCache")||"{}");b[a]=null,localStorage.setItem("codeCache",JSON.stringify(b))},100,{trailing:!0}),p=_.debounce(function(a){a!==this.currentCode&&this._writeCache(a)},300,{trailing:!0}),q=_.debounce(function(a){var b=a.doc.getValue();b!==this.currentCode?this._writeCache(b):console.log("clear")},300,{trailing:!0});return b("properties/ItemCodearea",[c],{constructor:function(a,b){var d=this;return this.revertOnFail=!0,a=a||{},c.prototype.constructor.call(this,a),a.codeType=(a.extraParam||"").toLowerCase(),this.isConfigItem=!!b&&!b.experimentId,this.$wrap.addClass("dms-prop-item-codearea"),this._render(g),this.writeVal2Cache=p.bind(d),this.writeCmCode2Cache=q.bind(d),this._writeCache=k.bind(d),this.clearCodeCache=o.bind(d),this},_render:function(b){var c=this,d=c.metadata,e=d.codeType||"sql";c.$input=$(b(d)).appendTo(c.$inputWrap);var f=c.$input.get(0),g=a.merge({},l.config,{mode:l.codeType[e]});return"pai"===e&&(e="shell"),j("json-ld"===e?"javascript":e,function(){setTimeout(a.bind(c._wrapCodeMirror,c,f,g),200)}),c},_wrapCodeMirror:function(a,b){var c=this;if(c.cm=CodeMirror.fromTextArea(a,b),c.cm.setOption("extraKeys",{Tab:function(a){var b=Array(a.getOption("indentUnit")+1).join(" ");a.replaceSelection(b)}}),c.isConfigItem)return void c.cm.on("blur",function(){c.submit()});c.cm.on("blur",function(){c.submit()}),c.cm.on("change",this.writeCmCode2Cache),d.onPropTabSwitched(function(a){c.tabIndex===a&&c.cm.refresh()}),c.isConfigItem||$(i()).appendTo(c.$inputWrap).on("click",function(){var a=$(this).offset();c.fullscreenEdit(a)}),c.reload()},fullscreenEdit:function(a){var b=this,c=$.extend({},this.metadata,{value:b.getValue()});"sql"===c.codeType&&window.react_bridge.actions&&window.react_bridge.actions.properties.sqlEditor?window.react_bridge.actions.properties.sqlEditor.set({visible:!0,data:c,onSave:b.onSave.bind(this),value:c.value,writeCache:this.writeVal2Cache,clearCache:this.clearCodeCache}):f.show(c,a,this.writeCmCode2Cache,this.clearCodeCache).then(function(a){b.currentCode=a,b.cm.doc.setValue(a),b.submit()})},onSave:function(a){this.currentCode=a,this.cm.doc.setValue(a),this.submit()},broaden:function(){$(m.workspace).addClass(n.big)},narrow:function(){$(m.workspace).removeClass(n.big)},reload:function(){var a=this,b=a.name,c=a.master.experimentId,d=a.master.nodeInstanceId;return e.getScript(c,d,b).then(function(b){var c=JSON.parse(localStorage.getItem("codeCache")||"{}");a.currentCode=b;var e=d+"_"+a.name;if(a.destroyed||a.cm.doc.setValue(b),c[e]&&c[e].code!==b){var f=c[e].date;h.show(f).then(function(d){var g="\n  unsave code on date: "+f+" >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> \n"+c[e].code+"\n <<<<<<<<<<<<<<<<<<<<<<<<<<<<< unsave code on date: "+f+"\n\r"+b;a.cm.doc.setValue(g)})}}),a},setCodeType:function(a){var b=this;return b.cm.setOption("mode",l.codeType[a]),b},getValue:function(){if(this.cm)return this.cm.doc.getValue()},validate:function(){var a=this;return a.getValue()!==a.metadata.value&&(a.isChanged=!0),a.hideError(),!0},revert:function(){var a=this;return this._writeCache(a.getValue()),a},submit:function(){return this.currentCode=this.getValue(),this.validate()&&this.notifyChange.call(this.master,this),this.clearCodeCache(),this},destroy:function(){var a=this;a.cm&&a.cm.toTextArea&&a.cm.toTextArea()}})}),define("properties/ItemSqlEditor",["zero/zero","zero/declare","../properties/ItemBase","../global/event","../ajax/codeMirror","../dialog/properties/codeEditor","../midway/properties/itemTextarea","../dialog/properties/codeCache","../midway/properties/itemCodearea"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){if(j.cached||(j.cached={}),j.cached[a])return b();var c=define;define=null;var d=function(){define=c,b()},e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,f=document.createElement("script");f.type="text/javascript",f.crossorigin="true",f.src="/lib/codemirror/5.0/mode/"+a+"/"+a+".js",e.insertBefore(f,e.firstChild),b&&(document.addEventListener?f.addEventListener("load",d,!1):f.onreadystatechange=function(){/loaded|complete/.test(f.readyState)&&(f.onreadystatechange=null,d())}),j.cached[a]=!0}function k(a){var b=n.master.nodeInstanceId,c={date:moment().format("YYYY-MM-DD HH:MM:SS"),code:a},d=JSON.parse(localStorage.getItem("codeCache")||"{}");d.code!==a&&(d[b]=c,localStorage.setItem("codeCache",JSON.stringify(d)))}function l(){var a=n.master.nodeInstanceId,b=JSON.parse(localStorage.getItem("codeCache")||"{}");b[a]=null,localStorage.setItem("codeCache",JSON.stringify(b))}var m={codeType:{r:"text/x-rsrc",sql:"text/x-plsql",pai:"text/x-sh",python:"text/x-cython",shell:"text/x-sh",xml:"application/xml",javascript:"text/javascript",json:"application/json",go:"text/x-go"},config:{lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0,lineComment:!0,showCursorWhenSelecting:!0,indentWithTabs:!1,tabSize:4,theme:"default"}},n=null,o=_.debounce(function(a){k(a)},500,{trailing:!0}),p=_.debounce(function(a){k(a.doc.getValue())},500,{trailing:!0});return b("properties/ItemSqlEditor",[c],{constructor:function(a,b){return n=this,a=a||{},c.prototype.constructor.call(this,a),a.codeType=(a.extraParam||"").toLowerCase(),this.isConfigItem=!1,this.$wrap.addClass("dms-prop-item-codearea"),this._render(g),this},_render:function(b){var c=this,d=c.metadata,e="sql";c.$input=$(b(d)).appendTo(c.$inputWrap);var f=c.$input.get(0),g=a.merge({},m.config,{mode:m.codeType[e]});return j(e,function(){setTimeout(a.bind(c._wrapCodeMirror,c,f,g),200)}),c},_wrapCodeMirror:function(a,b){var c=this;if(c.cm=CodeMirror.fromTextArea(a,b),c.cm.setOption("extraKeys",{Tab:function(a){var b=Array(a.getOption("indentUnit")+1).join(" ");a.replaceSelection(b)}}),c.isConfigItem)return void c.cm.on("blur",function(){c.submit()});c.cm.on("blur",function(){c.submit()}),c.cm.on("change",p),d.onPropTabSwitched(function(a){c.tabIndex===a&&c.cm.refresh()}),c.isConfigItem||$(i()).appendTo(c.$inputWrap).on("click",function(){var a=$(this).offset();c.fullscreenEdit(a)}),c.reload()},fullscreenEdit:function(a){var b=this,c=$.extend({},this.metadata,{value:b.getValue()});window.react_bridge.actions&&window.react_bridge.actions.properties.sqlEditor&&window.react_bridge.actions.properties.sqlEditor.set({visible:!0,loading:!0,data:c,onSave:b.onSave,value:c.value,writeCache:o,clearCache:l})},onSave:function(a){n.cm.doc.setValue(a),n.submit()},reload:function(){var a=this,b=a.name,c=a.master.experimentId,d=a.master.nodeInstanceId;return e.getScript(c,d,b).then(function(b){var c=JSON.parse(localStorage.getItem("codeCache")||"{}");if(c[d]&&c[d].code!==b){console.log(b,c[d].code);var e=c[d].date;h.show(e).then(function(){var f="\n //⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣⇣ unsave code on date: "+e+"\n"+c[d].code+"\n //⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡⇡  unsave code on date: "+e+"\n"+b;a.cm.doc.setValue(f)})}a.destroyed||a.cm.doc.setValue(b)}),a},setCodeType:function(a){var b=this;return b.cm.setOption("mode",m.codeType[a]),b},getValue:function(){if(this.cm)return this.cm.doc.getValue()},validate:function(){var a=this;return a.getValue()!==a.metadata.value&&(a.isChanged=!0),a.hideError(),!0},submit:function(){
return this.validate()&&this.notifyChange.call(this.master,this),l(),this},destroy:function(){this.cm.toTextArea()}})}),define("midway/properties/itemHyperlink",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c){var e='<a class="dms-prop-link" href="'+d(a)+'" target="_blank">'+d(b)+"</a>";return c&&(e+='<div class="dms-prop-link-title">钉钉群：PAI深度学习使用交流群</div><img class="dms-prop-link-img" src="'+d(c)+'" >'),e+=""}(b.value,b.tooltip,b.imgSrc)}}),define("properties/ItemHyperlink",["zero/zero","zero/declare","../properties/ItemBase","../midway/properties/itemHyperlink"],function(a,b,c,d){"use strict";return b("properties/ItemHyperlink",[c],{constructor:function(a,b){a=a||{},c.prototype.constructor.call(this,a),!a||"pyscript_notebook"!==a.name||"NoteBook"!==b.nodeName&&"NoteBook Plus"!==b.nodeName||(this.metadata.imgSrc="https://gw.alipayobjects.com/zos/rmsportal/OcoIlwfRNNxqEFuEMtYz.png"),this.render()},render:function(){this.$wrap.addClass("dms-prop-item-hyperlink"),this.$inputWrap.remove(),delete this.$inputWrap,this.$wrap.find(".dms-prop-tooltip").remove(),this.$wrap.find(".dms-prop-label").removeClass("hide").find("label").append(d(this.metadata)),this.$link=this.$wrap.find(".dms-prop-link")}})}),define("properties/ItemDatetimePicker",["zero/zero","zero/declare","zero/ui/DatetimePicker","../properties/ItemBaseString","../midway/properties/itemString"],function(a,b,c,d,e){"use strict";return b("properties/ItemDatetimePicker",[d],{constructor:function(a){a=a||{},d.prototype.constructor.call(this,a),this.$wrap.addClass("dms-prop-item-datetime"),this._render(e)._setup().setup()},onBlur:function(){var a=this;return clearTimeout(this.tId),this.tId=setTimeout(function(){!a.destroyed&&a.validate()&&a.notifyChange.call(a.master,a)},100),a},setup:function(){var a=this;a.$wrap.off("click",".btn-clear").on("click",".btn-clear",function(){a.clear()}),$(a.$input[0]).datetimepicker({format:"YYYY-MM-DD HH:mm:ss",icons:{time:"icon icon-time-o",date:"icon icon-calendar",up:"icon icon-arrow-up-l",down:"icon icon-arrow-down-l",previous:"icon-arrow-left-l",next:"icon icon-arrow-right-l",today:"icon icon-refresh",clear:"icon icon-close-c",close:"icon icon-close-l"},showTodayButton:!0,showClear:!0,toolbarPlacement:"bottom"})}})}),define("ajax/featureColsSelect",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/featureColsSelect.json");return{queryColumns:function(a,b,d){return c.get({method:"queryAllInputColumns",paramName:b,nodeInstanceId:a,controlType:d},!0)},queryColumnsEx:function(b,d){return c.get({method:"queryAllInputColumnsWithContinuity",paramName:d,nodeInstanceId:b}).then(function(b){var c=b.inputColumns;return a.isArray(c)?c:[c]})},refreshFields:function(a,b,d){return c.get({method:"refreshInputFields",paramName:b,nodeInstanceId:a,controlType:d}).then(function(a){return a&&a.refreshed||!1},!0)}}}),define("ajax/columnsOutputSelect",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/columnsOutputSelect.json");return{getColumns:function(a,b){return c.get({method:"getColumns",paramName:b,nodeInstanceId:a}).then(function(a){return a?a.columnList||[]:[]})}}}),define("midway/dialog/properties/featureColumnSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){var b='<div class="column-search-form"><input type="text"placeholder="'+e(d("searchColumn"))+'"class="form-control txtKeyword"><span class="icon icon-search"></span></div><div class="wrap"><div class="left-wrap"><header class="wrap-header">';return b+=a?"<span>"+e(d("select"))+"</span>":'<div class="ui-checkbox"><input type="checkbox" id="chk-select-all-columns"><label for="chk-select-all-columns">'+e(d("selectAll"))+"</label></div>",b+='<button class="btn-refresh btn btn-primary btn-sm hide">'+e(d("refresh"))+'</button></header><section class="wrap-content"><div class="accordion-wrap"></div></section></div><div class="right-wrap"><header class="wrap-header">'+e(d("selected"))+'<ul class="selected-tab"><li data-target="#dlg-selected-cols-list">'+e(d("listModel"))+'</li><li data-target="#dlg-selected-cols-raw">'+e(d("editModel"))+'</li></ul></header><section class="wrap-content"><div class="selected-wrap"><div class="selected-list" id="dlg-selected-cols-list"></div><div class="selected-raw" id="dlg-selected-cols-raw"><textarea class="form-control txtRaw"></textarea>',a&&(b+='<div class="err-msg hide"><span class="icon icon-close-c"></span>'+e(d("onlySupportSingleField"))+"</div>"),b+="</div></div></section></div></div>"}(b.isSingleSelect)}}),define("midway/dialog/properties/featureColumnSelectEmpty",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="empty-list">'+e(d("empty"))+"</div>"}()}}),define("midway/dialog/properties/featureColumnSelectedList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var c='<div class="table-header"><table class="table table-bordered"><thead><tr><th><span class="icon icon-delete btn-delete"></span></th><th>'+e(d("filed"))+"</th><th>"+e(d("type"))+'</th></tr></thead></table></div><div class="table-body"><table class="table table-bordered table-hover"><tbody>';return a.each(b,function(a){c+="<tr"+e(a.type?"":" class=custom-col")+'><td><span class="icon icon-delete btn-delete"data-name="'+e(a.name)+'"></span></td><td>'+e(a.name)+"</td><td>"+e(a.type||"-")+"</td></tr>"}),c+="</tbody></table></div>"}(b.fields)}}),define("midway/dialog/properties/featureColumnSelectAccordionTitle",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){var f="";return f+=a?"<span>"+d(b)+"</span>":'<div class="ui-checkbox"><input type="checkbox" name="'+d(c)+'" id="'+d(e)+'"><label for="'+d(e)+'">'+d(b)+"</label></div>",f+=""}(b.isSingleSelect,b.label,b.name,b.id)}}),define("midway/dialog/properties/featureColumnSelectAccordionContent",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f){var g='<ul class="acc-fields-list">';return a.each(b,function(a){g+='<li title="'+e(a.comment||"")+'"><div class="ui-checkbox'+e(c?" radio":"")+'"><input type="'+e(c?"radio":"checkbox")+'"name="'+e(c?f:a.name)+'"data-field="'+e(a.name)+'"'+e(a.checked?"checked ":"")+e(a.disabled?"disabled ":"")+'id="'+e(a.id)+'"><label for="'+e(a.id)+'">'+e(a.label),a.constraint&&(g+='<sup class="superior">'+e(d("constraint"))+"</sup>"),g+="</label></div></li>"}),g+="</ul>"}(b.fields,b.isSingleSelect,b.uniqueName)}}),define("dialog/properties/featureColumnSelect",["zero/zero","zero/ui/Tab","zero/ui/DialogEx","zero/ui/Accordion","../../i18n","../../ajax/featureColsSelect","../../ajax/columnsOutputSelect","../../midway/dialog/properties/featureColumnSelect","../../midway/dialog/properties/featureColumnSelectEmpty","../../midway/dialog/properties/featureColumnSelectedList","../../midway/dialog/properties/featureColumnSelectAccordionTitle","../../midway/dialog/properties/featureColumnSelectAccordionContent"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){var a=M.$(V.leftHeader).find(V.input),b=a.parent(V.checkbox),c=M.$(V.title).find(V.input),d=c.filter(":checked").length;if(d&&d===c.length)b.removeClass(W.indeterminate),a.prop("checked",!0);else{var e=M.$(V.content).find(V.input),f=e.filter(":checked").length;b.toggleClass(W.indeterminate,f>0),a.prop("checked",!1)}}function n(a){var b=a.siblings(V.title).find(V.input),c=b.parent(V.checkbox),d=a.find(V.input),e=d.filter(":checked").length;0===e||e===d.length?(c.removeClass(W.indeterminate),b.prop("checked",0!==e)):(c.addClass(W.indeterminate),b.prop("checked",!1))}function o(a){var b=M.$(V.leftHeader).find(V.input),c=a.siblings(V.title).find(V.input);a.find(V.input).filter(":disabled").length&&(b.prop("disabled",!0),c.prop("disabled",!0))}function p(a,b){var c=null;if(Z(S,function(d){return Z(d.fields,function(d){if(d.name===a)return d.checked=b,b&&(c={exist:!0,id:d.id,name:d.name,type:d.type}),!0})}),Z(T,function(c){return Z(c.fields,function(c){if(c.name===a)return c.checked=b,!0})}),b){if(c){var d=Z(U,function(a){return a.name===c.name});d||U.push(c)}}else for(var e=U.length-1;e>=0;e--)if(U[e].name===a){U.splice(e,1);break}s()}function q(a,b){var c=null;Y(S,function(d){Y(d.fields,function(d){d.name===a?(d.checked=b,b&&(c={exist:!0,id:d.id,name:d.name,type:d.type})):b&&(d.checked=!1)})}),Y(T,function(c){Y(c.fields,function(c){c.name===a?c.checked=b:b&&(c.checked=!1)})}),U=[],b&&c&&U.push(c),s()}function r(){var b=ca?ca.split(","):[];U=[],Y(b,function(b){if(b=a.trim(b)){if(!Z(U,function(a){return a.name===b})){var c={name:b};c.exist=Z(S,function(a){return Z(a.fields,function(a){if(a.name===b)return a.checked=!0,c.id=a.id,c.type=a.type,!0})}),U.push(c)}}}),s()}function s(){var a=X(U,function(a){return a.name});ca=a.join(", ")}function t(a){M.$(V.content).find(V.input).each(function(){var b=$(this);if(b.attr("name")===a)return b.prop("checked",!1),n(b.parents(V.content)),m(),!1})}function u(){T=[];var b=ea?a.uuid():"";Y(S,function(a){var c=_(a.fields||[],function(a){return a.label&&a.label.indexOf(ba)>-1});c.length&&T.push({title:k({id:a.id,name:a.name,label:a.label,isSingleSelect:ea}),content:l({fields:c,uniqueName:b,isSingleSelect:ea}),fields:c})})}function v(){N&&(N.destroy(),N=null);var a;a=M&&M.$?M.$(V.accordionWrap)[0]:$([W.dialog,V.accordionWrap].join(" "))[0],T.length?N=new d({container:a,data:T,defaultContent:"",defaultShow:!0,multi:!0}):M.$(V.accordionWrap).html(i())}function w(){U.length?M.$(V.selectedList).html(j({fields:U})):M.$(V.selectedList).html(i()),M.$(V.raw).val(ca)}function x(){var b;M.$(V.search).on("keyup",function(){b&&clearTimeout(b);var c=a.trim($(this).val());b=setTimeout(function(){ba=c,C()},100)}).focus().val(ba)}function y(){return ea?void M.$(V.content).on("change",V.input,function(){var a=$(this);q(a.attr("data-field"),a.prop("checked")),B()}):T.length?(M.$(V.content).on("change",V.input,function(){var a=$(this);p(a.attr("data-field"),a.prop("checked")),n(a.parents(V.content)),m(),B()}).each(function(){n($(this))}),M.$(V.title).on("click",V.checkbox,function(a){a.stopPropagation()}).on("change",V.input,function(){var a=$(this),b=a.prop("checked");a.parent(V.checkbox).removeClass(W.indeterminate),a.parents(V.title).siblings(V.content).find(V.input).each(function(){var a=$(this);a.prop("checked",b),p(a.attr("name"),b)}),m(),B()}),M.$(V.leftHeader).on("change",V.input,function(){var a=$(this),b=a.prop("checked");a.parent(V.checkbox).removeClass(W.indeterminate),M.$(V.title).find(V.input).prop("checked",b).parent(V.checkbox).removeClass(W.indeterminate),M.$(V.content).find(V.input).each(function(){var a=$(this);a.prop("checked",b),p(a.attr("name"),b)}),B()}).find(V.input).prop("disabled",!1),M.$(V.content).each(function(){o($(this))}),void m()):void M.$(V.leftHeader).find(V.input).prop("checked",!1).prop("disabled",!0).parent(V.checkbox).removeClass(W.indeterminate)}function z(){M.$(V.selectedList).on("click",V.btnDelete,function(){var a=$(this),b=a.attr("data-name");ea?q(b,!1):p(b,!1),t(b),B()}).on("click",V.btnDeleteAll,function(){D()}),M.$(V.selectedRaw).on("focus",V.raw,function(){M.$(V.selectedRaw).removeClass(W.hasError).find(V.errMsg).addClass(W.hide)}).on("blur",V.raw,function(){var b=a.trim($(this).val());if(ea&&b.split(",").length>1)return void M.$(V.selectedRaw).addClass(W.hasError).find(V.errMsg).removeClass(W.hide);b!==ca&&D(b)})}function A(){M.$(V.btnRefresh).on("click",function(){M.showLoading(),fa().then(function(a){a&&H(),M.hideLoading()},function(){M.hideLoading()})})}function B(){w(),E()}function C(){u(),v(),y()}function D(a){ca=a||"",r(),B();var b={};Y(U,function(a){b[a.name]=!0}),M.$(V.content).find(V.input).each(function(){var a=$(this),c=a.attr("name");a.prop("checked",!0===b[c])}),ea||(M.$(V.content).each(function(){n($(this))}),m())}function E(){var a=M.$(V.selectedList),b=a.find(V.tableBody),c=b.find(V.table);a.toggleClass(W.isOverflow,c.height()>b.height())}function F(a,b,c){return f.refreshFields(a,b,c)}function G(b,c,d){return da?g.getColumns(b,c).then(function(c){var d={};return Y(c,function(a){var b=d[a.columnType];b||(b=d[a.columnType]={name:a.columnType,label:a.columnType,fields:[]}),b.fields.push({type:a.columnType,name:a.inputName,label:a.inputName,output:a.outputName,checked:a.selected,disabled:!1,constraint:!1})}),X(a.keys(d).sort(),function(a,c){var e=d[a];return e.id="chk-select-field-"+b+"-"+c,Y(e.fields,function(a,b){a.id=e.id+"-"+b}),e})}):f.queryColumns(b,c,d).then(function(c){var d=c.decoration||{},e=d.Constraints||[];return a.isBoolean(ea)||(ea=c.isSingleOption),"colValue"in c&&(ca=c.colValue),X(c.inputColumns.sort(function(a,b){return a.fieldType>b.fieldType}),function(c,d){var f="chk-select-field-"+b+"-"+d,g=X(c.cols,function(b,d){return{id:f+"-"+d,type:c.fieldType,name:b[0],label:b[0],checked:"true"===b[1],disabled:"true"!==b[2],constraint:a.indexOf(e,b[0])>=0,comment:b[b.length-1]}});return{id:f,name:c.fieldType,label:c.fieldType,fields:g}})})}function H(){O=ga().then(null,function(){}),I()}function I(){M.showLoading(),O.then(function(a){S=a||[],M.set("body",h({isSingleSelect:ea,hasOutput:da})),M.on("fullScreen",E),L=new b({selector:V.tab,afterShow:function(a){a?M.$(V.raw).focus():M.$(V.raw).blur()}}),C(),r(),B(),x(),A(),z(),M.hideLoading()})}function J(){N&&(N.destroy(),N=null),L&&(L.destroy(),L=null),Q||R(),ba="",Q=!1,fa=null,ga=null}function K(){var a=this,b=X(U,function(a){return{name:a.name,type:a.type}});Q=!0,P(b),a.hide()}var L,M,N,O,P,Q,R,S,T,U,V={accordionWrap:".accordion-wrap",selectedWrap:".selected-wrap",selectedList:".selected-list",selectedRaw:".selected-raw",search:".txtKeyword",btnRefresh:".btn-refresh",title:".zero-accordion-title",content:".zero-accordion-content",checkbox:".ui-checkbox",input:".ui-checkbox input",indeterminate:".indeterminate",leftHeader:".left-wrap .wrap-header",rightHeader:".right-wrap .wrap-header",tab:".dialog-column-select .selected-tab li",raw:".txtRaw",errMsg:".err-msg",table:".table",tableHeader:".table-header",tableBody:".table-body",btnDeleteAll:".table-header .btn-delete",btnDelete:".table-body .btn-delete"},W={hide:"hide",dialog:"dialog-column-select",disabled:"disabled",hasError:"has-error",isOverflow:"is-overflow",indeterminate:"indeterminate"},X=a.map,Y=a.each,Z=a.some,_=a.filter,aa=e.translate,ba="",ca="",da=!1,ea=!1,fa=null,ga=null;return{show:function(b,d,e,f,g,h){return ca=b||"",fa=F.bind(null,d,e,f),ga=G.bind(null,d,e,f),ea=a.isBoolean(g)?g:null,da=h,new Promise(function(a,b){P=a,R=b,O=ga().then(null,R),M=new c({title:aa("selectFields"),className:W.dialog,destroyOnHide:!0,canFullscreen:!0,afterShow:I,afterHide:J,buttons:[{text:aa("confirm"),type:"primary",click:K},{text:aa("cancel"),click:function(){this.hide()}}]})})}}}),define("midway/properties/itemSelectFields",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="btn-wrap"><button class="btn btn-select"></button><span class="icon icon-list btn-toggle"></span></div><div class="preview-wrap"></div>'}}),define("midway/properties/itemSelectFieldsPreview",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c="<ul>";return a.each(b,function(a){c+="<li>"+d(a.name)+"</li>"}),c+="</ul>"}(b.cols)}}),define("properties/ItemFeatureColumnSelect",["zero","zero/zero","zero/declare","zero/fmt/sprintf","../i18n","../properties/ItemBase","../dialog/properties/featureColumnSelect","../midway/properties/itemSelectFields","../midway/properties/itemSelectFieldsPreview"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=e.translate;return c("properties/ItemFeatureColumnSelect",[f],{constructor:function(a){a=a||{},f.prototype.constructor.call(this,a),this.parseValue(),this.dialog=g,this.revertOnFail=!0,this._render()._setup()},_render:function(){var a=this;return a.$wrap.addClass("dms-prop-item-selece-fields"),a.$inputWrap.html(h(a.metadata,!0)),a.$previewToggler=a.$inputWrap.find(".btn-toggle"),a.$input=a.$inputWrap.find(".btn-select"),a.$preview=a.$inputWrap.find(".preview-wrap"),a.setButtonText(a.selectedFields),a},_setup:function(){var a=this;return a.$input.on("click",function(){a.isDisabled()||(a.hideError(),a.onClick())}),a.$previewToggler.on("click",function(){$(this).toggleClass("checked");a.$wrap.toggleClass("show-preview")}),a},onClick:function(){var a=this;return a.disable(),a.dialog.show(a.metadata.value,a.master.nodeInstanceId,a.name,a.metadata.type,a.isSingle,a.hasOutput).then(function(b){a.enable(),a.setButtonText(b)},function(){a.enable()}),a},getValue:function(){return b.map(this.selectedFields,function(a){return a.name}).join(",")},parseValue:function(){var a=this,c=b.trim(""+a.metadata.value);return a.selectedFields=b.map(c?c.split(","):[],function(a){return{name:a}}),a.metadata.columnCount=a.selectedFields.length,a},updateButtonText:function(a){var b=this.selectedFields,a=b?b.length:0,c=0===a?j("selectCols"):j("selectedCols",a);this.$wrap.toggleClass("has-fields",a>0),this.$input.html(c),a?this.$preview.html(i({cols:b})):this.$preview.html("")},revert:function(){var a=this;return a.parseValue(),a.updateButtonText(),a},setButtonText:function(a){var b=this,c=b.metadata;b.selectedFields=a;var d=b.getValue();return b.isValid=!0,b.isChanged=c.value!==d,c.columnCount=a?a.length:0,b.notifyChange&&b.notifyChange.call(b.master,b),b.updateButtonText(),b},clear:function(){this.setButtonText([])}})}),define("midway/dialog/properties/featureColumnSelectEx",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="column-search-form"><input type="text"value="'+e(a)+'"placeholder="'+e(d("searchColumn"))+'"class="form-control j-search-keyword"><span class="icon icon-search"></span></div><div class="accordion-wrap j-accordion-wrap"></div>'}(b.keyword)}}),define("midway/dialog/properties/featureColumnSelectAccordionTitleEx",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f){var g='<div class="acc-left"><div class="ui-checkbox"><input type="checkbox" name="'+e(a)+'" id="'+e(b)+'"><label for="'+e(b)+'">'+e(c)+'</label></div></div><div class="acc-middle">';return f&&(g+=""+e(d("sampling"))),g+='</div><div class="acc-right"><span class="acc-right-header">'+e(d("measure"))+'</span><ul class="acc-type-select" style="height: 0"><li>'+e(d("discrete"))+"</li><li>"+e(d("continuous"))+"</li><li>"+e(d("noType"))+"</li></ul></div>"}(b.name,b.id,b.label,b.isFirst)}}),define("midway/dialog/properties/featureColumnSelectAccordionContentEx",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<ul class="acc-fields-list acc-fields-list-fix">';return a.each(b,function(b){f+='<li><div class="acc-left"><div class="ui-checkbox"><input type="checkbox"name="'+e(b.name)+'"'+e(b.checked?"checked ":"")+'id="'+e(b.id)+'"><label for="'+e(b.id)+'">'+e(b.label)+'</label></div></div><div class="acc-middle">'+e(b.sampling)+'</div><div class="acc-right"><select class="form-control input-sm">',a.each([{value:"0",text:d("discrete")},{value:"1",text:d("continuous")},{value:"2",text:d("noType")}],function(a){f+='<option value="'+e(a.value)+'"'+e(b.value===""+a.value?"selected ":"")+">"+e(a.text)+"</option>"}),f+="</select></div></li>"}),f+="</ul>"}(b.fields,b.field)}}),define("dialog/properties/featureColumnSelectEx",["zero/zero","zero/ui/Dialog","zero/ui/Accordion","../../i18n","../../ajax/featureColsSelect","../../midway/dialog/properties/featureColumnSelectEx","../../midway/dialog/properties/featureColumnSelectEmpty","../../midway/dialog/properties/featureColumnSelectAccordionTitleEx","../../midway/dialog/properties/featureColumnSelectAccordionContentEx"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=this;u=[],v&&a.$(w.content).find(w.input).filter(":checked").each(function(){var a=$(this),b=a.parents(".acc-left").siblings(".acc-right").find("select");u.push({name:a.attr("name"),value:b.val()})}),a.hide()}function k(a){var b=a.siblings(w.title).find(w.input),c=b.parent(w.checkbox),d=a.find(w.input),e=d.filter(":checked").length;0===e||e===d.length?(c.removeClass(x.indeterminate),b.prop("checked",0!==e)):(c.addClass(x.indeterminate),b.prop("checked",!1))}function l(){n(),o(),p();var b;r.$(w.search).on("keyup",function(){b&&(clearTimeout(b),b=0);var c=a.trim($(this).val());b=setTimeout(function(){y=c,n(),o(),p()},100)}).focus().val(y)}function m(a,b){u?a(u):b(""),u=null,y="",v&&(v.destroy(),v=null),this.destroy()}function n(){t=[],a.each(s,function(b){var c={},d=[];a.each(b.fields||[],function(a){a.label&&a.label.indexOf(y)>-1&&d.push(a)}),d.length&&(c.fields=d,c.title=h({id:b.id,name:b.name,label:b.label,isFirst:0===t.length}),c.content=i({fields:d}),t.push(c))})}function o(){v&&(v.destroy(),v=null),t.length?v=new c({container:r.$(w.wrap)[0],data:t,defaultContent:"",defaultShow:!0,multi:!0}):r.$(w.wrap).html(g())}function p(){r.$(w.title).on("change",w.input,function(){var a=$(this),b=a.prop("checked");a.parent(w.checkbox).removeClass(x.indeterminate),a.parents(w.title).siblings(w.content).find(w.input).each(function(){var a=$(this);a.prop("checked",b),q(a.attr("id"),b)})}).on("click",w.accRight,function(){return $(this).find(w.typeBatch).height("auto"),!1}).on("mouseleave",w.accRight,function(){$(this).find(w.typeBatch).height(0)}).on("click",w.typeItem,function(){var a=$(this),b=a.index();return a.parent().height(0).parents(w.title).siblings(w.content).find(w.select).val(b),!1}),r.$(w.content).on("change",w.input,function(){var a=$(this);k(a.parents(w.content)),q(a.attr("id"),a.prop("checked"))}).each(function(){k($(this))})}function q(b,c){a.each(s,function(d){a.each(d.fields,function(a){a.id===b&&(a.checked=c)})}),a.each(t,function(d){a.each(d.fields,function(a){a.id===b&&(a.checked=c)})})}var r,s,t,u,v,w={wrap:".j-accordion-wrap",search:".j-search-keyword",title:".zero-accordion-title",content:".zero-accordion-content",accRight:".acc-right",checkbox:".ui-checkbox",input:".ui-checkbox input",select:".acc-right select",typeBatch:".acc-type-select",typeItem:".acc-type-select li"},x={dialog:"dialog-select-fields",indeterminate:"indeterminate"},y="",z=d.translate;return{show:function(c,d,g){return new Promise(function(c,h){e.queryColumnsEx(d,g).then(function(b){return a.map(b,function(b,c){var e="chk-select-field-"+d+"-"+c,f=[];return a.forEach(b.cols,function(a,b){f.push({id:e+"-"+b,checked:"true"===a[1],sampling:a[2],value:a[3],name:a[0],label:a[0]})}),{id:e,name:b.fieldType,label:b.fieldType,fields:f}})}).then(function(a){s=a,r=new b({title:z("selectFields"),body:f({keyword:y}),className:x.dialog,afterShow:l,afterHide:function(){m.call(this,c,h)},buttons:[{text:z("confirm"),type:"primary",click:j},{text:z("cancel"),click:function(){this.hide()}}]})})})}}}),define("properties/ItemFeatureColumnSelectEx",["zero/zero","zero/declare","../properties/ItemFeatureColumnSelect","../dialog/properties/featureColumnSelectEx"],function(a,b,c,d){"use strict";return b("properties/ItemFeatureColumnSelectEx",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b.dialog=d,b},getValue:function(){var b=this,c=b.selectedFields||[],d=[];return a.forEach(c,function(a){d.push(a.name+":"+a.value)}),d.join(",")}})}),define("ajax/simpleColSelect",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/simpleColSelect.json");return{getCandidateColumns:function(a,b,d){return c.get({method:"getCandidateColumns",nodeInstanceId:a,queryName:d,paramName:b,maxDisplay:2e3}).then(function(a){return a?a.inputColumns||[]:[]})},updateLabelColumn:function(a,b){return c.post({method:"updateLabelColumn",nodeInstanceId:a,labelCol:b})}}}),define("midway/dialog/properties/simpleMultiColSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="column-search-form"><input type="text"value="'+e(a)+'"placeholder="'+e(d("searchColumn"))+'"class="form-control j-search-keyword"><span class="icon icon-search"></span></div><div class="accordion-wrap j-accordion-wrap"></div>'}(b.keyword)}}),define("dialog/properties/simpleMultiColSelect",["zero/zero","zero/ui/Dialog","zero/ui/Accordion","../../i18n","../../ajax/simpleColSelect","../../midway/dialog/properties/simpleMultiColSelect","../../midway/dialog/properties/featureColumnSelectEmpty","../../midway/dialog/properties/featureColumnSelectAccordionTitle","../../midway/dialog/properties/featureColumnSelectAccordionContent"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=this;u=[],v&&a.$(w.content).find(w.input).filter(":checked").each(function(){u.push({name:$(this).attr("name")})}),a.hide()}function k(a){var b=a.siblings(w.title).find(w.input),c=b.parent(w.checkbox),d=a.find(w.input),e=d.filter(":checked").length;0===e||e===d.length?(c.removeClass(x.indeterminate),b.prop("checked",0!==e)):(c.addClass(x.indeterminate),b.prop("checked",!1))}function l(a,b){u?a(u):b(""),u=null,y="",v&&(v.destroy(),v=null),this.destroy()}function m(){n(),o(),p();var b;r.$(w.search).on("keyup",function(){b&&(clearTimeout(b),b=0);var c=a.trim($(this).val());b=setTimeout(function(){y=c,n(),o(),p()},100)}).focus().val(y)}function n(){t=[],a.each(s,function(b){var c={},d=[];a.each(b.fields||[],function(a){a.label&&a.label.indexOf(y)>-1&&d.push(a)}),d.length&&(c.fields=d,c.title=h({id:b.id,name:b.name,label:b.label}),c.content=i({fields:d}),t.push(c))})}function o(){v&&(v.destroy(),v=null),t.length?v=new c({container:r.$(w.wrap)[0],data:t,defaultContent:"",defaultShow:!0,multi:!0}):r.$(w.wrap).html(g())}function p(){t.length&&(r.$(w.title).on("change",w.input,function(){var a=$(this),b=a.prop("checked");a.parent(w.checkbox).removeClass(x.indeterminate),a.parents(w.title).siblings(w.content).find(w.input).each(function(){var a=$(this);a.prop("checked",b),q(a.attr("id"),b)})}),r.$(w.content).on("change",w.input,function(){var a=$(this);k(a.parents(w.content)),q(a.attr("id"),a.prop("checked"))}).each(function(){k($(this))}))}function q(b,c){a.each(s,function(d){a.each(d.fields,function(a){a.id===b&&(a.checked=c)})}),a.each(t,function(d){a.each(d.fields,function(a){a.id===b&&(a.checked=c)})})}var r,s,t,u,v,w={wrap:".j-accordion-wrap",search:".j-search-keyword",title:".zero-accordion-title",content:".zero-accordion-content",checkbox:".ui-checkbox",input:".ui-checkbox input"},x={dialog:"dialog-select-fields",indeterminate:"indeterminate"},y="",z=d.translate;return{show:function(c,d,g){return new Promise(function(c,h){e.getCandidateColumns(d,g,"").then(function(b){return a.map(b,function(b,c){var e="chk-select-field-"+d+"-"+c,f=[];return a.forEach(b.cols,function(a,b){f.push({id:e+"-"+b,checked:"true"===a[1],name:a[0],label:a[0]})}),{id:e,name:b.fieldType,label:b.fieldType,fields:f}})}).then(function(a){s=a||[],r=new b({title:z("selectFields"),body:f({keyword:y}),className:x.dialog,afterShow:m,afterHide:function(){l.call(this,c,h)},buttons:[{text:z("confirm"),type:"primary",click:j},{text:z("cancel"),click:function(){this.hide()}}]})})})}}}),define("properties/ItemSimpleMultiColSelect",["zero/zero","zero/declare","../properties/ItemFeatureColumnSelect","../dialog/properties/simpleMultiColSelect"],function(a,b,c,d){"use strict";return b("properties/ItemSimpleMultiColSelect",[c],{constructor:function(a){a=a||{},c.prototype.constructor.call(this,a),this.dialog=d}})}),define("ajax/labelColSelect",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/labelColSelect.json");return{getCandidateColumns:function(a,b,d){return c.get({method:"getCandidateColumns",nodeInstanceId:a,queryName:d,paramName:b,maxDisplay:2e3}).then(function(a){return a?a.inputColumns||[]:[]})},updateLabelColumn:function(a,b){return c.post({method:"updateLabelColumn",nodeInstanceId:a,labelCol:b})}}}),define("properties/ItemAutocomplete",["zero/zero","zero/declare","zero/ui/AutoComplete","../properties/ItemString"],function(a,b,c,d){"use strict";return b("properties/ItemAutocomplete",[d],{constructor:function(a){var b=this;return d.prototype.constructor.call(b,a),b},_setup:function(){var b=this;d.prototype._setup.call(b);var e=b.metadata.loader;return e&&a.isFunction(e)&&(b.autocomplete=new c({input:b.$input,ignorecase:!0,max:10,delay:500,minLength:0,load:function(c,d){var f=b.master.nodeInstanceId;e(f,b.name,a.trim(c)).then(function(){b.destroyed||d.apply(null,arguments)})}}).on("select",function(){b.timer&&clearTimeout(b.timer),b.onChange()})),b},onBlur:function(){var b=this;return b.timer=setTimeout(a.bind(b.onChange,b),150),b},onChange:function(){var a=this;return a.validate&&a.validate()&&a.notifyChange.call(a.master,a),a}})}),define("properties/ItemLabelColumn",["zero/zero","zero/declare","../ajax/labelColSelect","../dialog/properties/featureColumnSelect","../properties/ItemAutocomplete"],function(a,b,c,d,e){"use strict";return b("properties/ItemLabelColumn",[e],{constructor:function(a){a=this.metadata=a||{},a.loader=c.getCandidateColumns,e.prototype.constructor.call(this,a),this.render(),this.setup()},render:function(){this.$wrap.addClass("dms-prop-item-label-select"),this.$inputWrap.append('<span class="btn-select icon-folder"></span>')},setup:function(){var a=this;return a.$wrap.on("click",".btn-select",function(){a.metadata.isDisabled||d.show(a.metadata.value,a.master.nodeInstanceId,a.name,a.metadata.type,!0).then(function(b){if(b&&b.length){var c=a.getValue(),d=b[0].name;c!==d&&(a.setValue(d),a.isChanged=!0,a.notifyChange.call(a.master,a))}else a.clear()},function(){})}),a}})}),define("properties/ItemSimpleColumn",["zero/zero","zero/declare","../properties/ItemAutocomplete","../ajax/simpleColSelect"],function(a,b,c,d){"use strict";return b("properties/ItemSimpleColumn",[c],{constructor:function(a){var b=this;return a=b.metadata=a||{},a.loader=d.getCandidateColumns,c.prototype.constructor.call(b,a),b}})}),define("ajax/widgetColSelect",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/weightColSelect.json");return{getCandidateColumns:function(b,d,e){return c.get({method:"getCandidateColumns",nodeInstanceId:b,queryName:e,paramName:d,maxDisplay:2e3}).then(function(b){var c=b?b.inputColumns:null;return a.isArray(c)?c:[]})},updateWeightColumn:function(a,b){return c.post({method:"updateWeightColumn",nodeInstanceId:a,weightCol:b})}}}),define("properties/ItemWeightColumn",["zero/zero","zero/declare","../properties/ItemAutocomplete","../ajax/widgetColSelect"],function(a,b,c,d){"use strict";return b("properties/ItemWidgetColumn",[c],{constructor:function(a){var b=this;return a=b.metadata=a||{},a.loader=d.getCandidateColumns,c.prototype.constructor.call(b,a),b}})}),define("midway/properties/itemSourceTableInput",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){
return null===a||void 0===a?"":a};a.escape;return'<span class="btn-create icon icon-upload-l"></span>'}}),define("ajax/odps",["zero/zero","zero/json","./base"],function(a,b,c){"use strict";var d="/odps.json",e=c.create(d),f=c.getProjectName();return{createTable:function(a,c,d,f){var g={tableName:a,schema:b.stringify(d),projectName:f,method:"createTable"};return c&&(g.lifecycle=c),e.post(g)},fetchTableSchema:function(a,b){return e.get({tableName:a,projectName:b,method:"fetchTableSchema"},!0)},uploadTableData:function(a,b,c,f,g){var h=new FormData;return h.append("ctoken",e.getToken()),h.append("projectName",g),h.append("tableName",a),h.append("content",b),h.append("fd",f),h.append("rd",c),new Promise(function(a,b){$.ajax({url:d+"?method=uploadTableData",type:"post",data:h,enctype:"multipart/form-data",processData:!1,contentType:!1}).then(function(c){c.success?a(c.data.records):b(c.data)},b)})},listResources:function(a){return e.get({resourceType:a||"",method:"listResources"},!0).then(function(a){return a?a.resources:[]},function(){return[]})},uploadResource:function(a){return a.append("ctoken",e.getToken()),a.append("projectName",f),new Promise(function(b){$.ajax({url:d+"?method=uploadResource",type:"post",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1}).then(function(a){a.success&&b(a.data.fileName)})})},deleteResource:function(a){return e.get({fileName:a,method:"deleteResource"})},listFunctions:function(){return e.get({method:"listFunctions"}).then(function(a){return a?a.functions:[]})},createFunction:function(a,b,c){return e.get({functionName:a,classPath:b,resources:c,method:"createFunction"})}}}),define("midway/dialog/properties/createTable",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f="",b=a.uuid();f+="";var c=a.uuid();return f+='<ul class="table-tab"><li data-target="#'+e(b)+'">'+e(d("tableSchema"))+'</li><li data-target="#'+e(c)+'" class="selected">'+e(d("tableData"))+'</li></ul><form id="create-table-form" class="flex-grow-1"><div class="form-vertical flex-grow-inner" id="'+e(b)+'"><div class="form-group"><label for="tableName">'+e(d("tableName"))+'<span class="form-item-tips name-tip"id="tableNameTips"></span></label><input type="text"class="form-control"id="tableName"name="tableName"placeholder="'+e(d("tableNameHolder"))+'"></div><div class="form-group table-schema-info flex-grow-1 hide"><label>'+e(d("tableSchema"))+'</label><div class="flex-grow-1"><div class="flex-grow-inner schema-wrap"></div></div></div><div class="form-group table-schema-editor hide"><label for=tableLifecycle>'+e(d("tableLifecycle"))+'</label><div class="input-group"><input type="number" class="form-control"id="tableLifecycle"step="1"min="0"value="180"name="lifecycle"><div class="input-group-addon">'+e(d("day"))+'</div></div></div><div class="form-group table-schema-editor flex-grow-1 hide"><label>'+e(d("tableSchema"))+'<span class="btn-add icon-plus-o"></span></label><div class="flex-grow-1"><div class="flex-grow-inner schema-wrap"><table class="table table-bordered"><thead><tr><th>'+e(d("columnName"))+"</th><th>"+e(d("columnType"))+"</th><th>"+e(d("isPartitionColumn"))+'</th><th></th></tr></thead><tbody></tbody><tfoot><tr><td colspan="4">'+e(d("addItemTip"))+'</td></tr></tfoot></table></div></div></div></div><div class="form-vertical flex-grow-inner hide" id="'+e(c)+'"><div class="form-group"><div class="tips">'+e(d("uploadTableDataTips"))+'</div></div><div class="form-group"><div class="btn btn-upload btn-block btn-primary">'+e(d("chooseFile"))+'</div><input type="file" class="form-control hide"name="content"accept="text/csv,text/plain"id="dataFile"></div><div class="row delimiter hide"><div class="col-sm-6"><div class="form-group"><label for="rowDelimiter">'+e(d("rowDelimiter"))+'</label><input type="text" class="form-control" value=""name="rowDelimiter"id="rowDelimiter"></div></div><div class="col-sm-6"><div class="form-group"><label for="columnDelimiter">'+e(d("columnDelimiter"))+'</label><input type="text" class="form-control" value=","maxlength="1"name="columnDelimiter"id="columnDelimiter"></div></div></div><div class="form-group data-preview hide"><label>'+e(d("dataPreview"))+'<span class="file-name"></span><span class="data-tips">'+e(d("dataPreviewTips"))+'</span></label><div class="flex-grow-1"><div class="flex-grow-inner preview-wrap"></div></div></div></div></form>'}(b.uuid1,b.uuid2)}}),define("midway/dialog/properties/createTablePreview",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<div class="table-wrap"><table class="table table-bordered table-striped table-hover"><tbody>';return a.each(b,function(b){c+="<tr>",a.each(b,function(a){c+="<td>"+d(a)+"</td>"}),c+="</tr>"}),c+="</tbody></table></div>"}(b.data)}}),define("midway/dialog/properties/createTableSchema",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var c='<table class="table table-bordered table-hover"><thead><tr><th>'+e(d("columnName"))+"</th><th>"+e(d("columnType"))+"</th><th>"+e(d("isPartitionColumn"))+"</th></tr></thead><tbody>";return a.each(b,function(a){c+="<tr><td>"+e(a.name)+"</td><td>"+e(a.odpsType)+"</td><td>"+e(d(a.isPartitionCol?"yes":"no"))+"</td></tr>"}),c+="</tbody></table>"}(b.columns)}}),define("midway/dialog/properties/createTableSchemaEditor",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f="<tr><td>",b=a.uuid();f+='<input type="text" class="form-control" id="'+e(b)+'"name="columnName"placeholder="'+e(d("columnNameHolder"))+'"></td><td><label class="select-hacker"><select name="columnType" class="form-control field-type"><option value="bigint" selected="">bigint</option><option value="double">double</option><option value="decimal">decimal</option><option value="string">string</option><option value="boolean">boolean</option><option value="datetime">datetime</option></select></label></td><td>';var c=a.uuid();return f+='<div class="ui-checkbox"><input type="checkbox" id="'+e(c)+'" name="isPartitionColumn"><label for="'+e(c)+'"></label></div></td><td><span class="btn-delete icon-close-o"></span></td></tr>'}(b.columnId,b.uuid)}}),define("dialog/properties/createTable",["zero/zero","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../global/notify","../../ajax/odps","../../midway/dialog/properties/createTable","../../midway/dialog/properties/createTablePreview","../../midway/dialog/properties/createTableSchema","../../midway/dialog/properties/createTableSchemaEditor"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){var a=this;w=new c({selector:s.tab,afterShow:function(a){}}),a.$(s.btnUpload).on("click",function(){a.$(s.fileUpload).click()}),a.$(s.fileUpload).on("change",function(){var b=this.files[0].name,c=b.lastIndexOf("."),d="";c&&(d=b.substring(c+1)),C="csv"===d,a.$(s.fileName).text(b),a.$(s.delimiter).toggleClass(t.hide,C),n()}),a.$(s.rowDelimiter).val(u[0]).on("blur",function(){var a=$(this).val();(a=u.indexOf(a)>=0?a:"")!==D&&(D=a,n())}),a.$(s.columnDelimiter).on("blur",function(){var a=$(this).val();a!==E&&(E=a,n())}),D=a.$(s.rowDelimiter).val(),E=a.$(s.columnDelimiter).val(),x=a.$(s.form).on("keydown",function(a){if(13===a.keyCode)return!1}).validate({highlight:function(a){$(a).parent().addClass("has-error")},unhighlight:function(a){$(a).parent().removeClass("has-error")},rules:{tableName:{required:!0,variableName:!0},columnName:{required:!0,variableName:!0,distinctColumnName:!0},lifecycle:{digits:!0}},messages:{tableName:{required:F("tableNameHolder"),variableName:F("msgVariableName")},columnName:{required:F("columnNameHolder"),variableName:F("msgVariableName"),distinctColumnName:F("msgDistinctColumnName")},lifecycle:{digits:F("msgDigits")}}}),a.$(s.tableName).val(B).prop("readonly",!!B).on("keydown",function(a){13===a.keyCode&&l()}).on("blur",function(){l()}),B&&l(!0);var b=a.$(s.schemaEditor).on("click","tfoot tr td",function(){b.find(s.btnAdd).click()}).on("click",s.btnAdd,function(){b.find("tbody").append(j()),b.find("tfoot").addClass(t.hide)}).on("click",s.btnDelete,function(){$(this).parents("tr").remove(),b.find("tbody").find("tr").length||b.find("tfoot").removeClass(t.hide)})}function l(a){if(x.element(s.tableName)){var b=v.$(s.tableName).val();if(b!==B||a)return B=b,v.showLoading(),f.fetchTableSchema(B,A).then(function(a){a&&a.columns?(G=!1,v.$(s.nameTip).text(F("tableNameExistTip")),v.$(s.schemaEditor).addClass(t.hide),v.$(s.schemaInfo).removeClass(t.hide).find(s.table).remove().end().find(s.schemaWrap).append(i(a))):(G=!0,v.$(s.nameTip).text(F("tableNameNoExistTip")),v.$(s.schemaInfo).addClass(t.hide),v.$(s.schemaEditor).removeClass(t.hide)),v.hideLoading()},function(){v.hideLoading()})}}function m(){var b=parseInt(v.$(s.lifecycle).val()),c=[];return v.$('input[name="columnName"]').each(function(){var b=$(this),d=a.trim(b.val());if(d){var e=b.parents("tr"),f=e.find("select").val(),g=e.find('input[name="isPartitionColumn"]').prop("checked");c.push({name:d,odpsType:f,isPartitionCol:g})}}),f.createTable(B,b,c,A).then(l)}function n(){var a=v.$(s.preview).removeClass(t.hide);a.find(s.table).remove();var b={preview:100,skipEmptyLines:!0,error:function(a,b,c,d){},complete:function(b){var c=b&&b.data||[],d=b&&b.meta||{};c.length&&(c.length>100&&(c=c.slice(0,100)),a.find(s.previewWrap).append(h({data:c}))),D=d.linebreak,E=d.delimiter}};C||(D&&(b.newline=D),E&&(b.delimiter=E));var c=v.$(s.fileUpload)[0].files[0];c&&window.Papa.parse(c,b)}function o(){var a=v.$(s.fileUpload)[0].files[0];if(a)return f.uploadTableData(B,a,D,E,A)}function p(){e.success(F("operateSucceed")),y(B),v.hide()}function q(){if(G){if(!x.form())return}else if(!x.element(s.tableName))return;v.showLoading();var a;G?x.form()&&(a=m().then(o)):a=o(),a?a.then(p).then(null,function(a){a&&a.errorMessage&&e.error(a.errorMessage),v.hideLoading()}):p()}function r(a,c,d){return z=a,B=c,A=d,new Promise(function(a){y=a,v=new b({title:F("createTable"),className:"dialog-create-table",body:g(),destroyOnHide:!0,canFullscreen:!0,afterShow:k,buttons:[{text:F("confirm"),type:"primary",click:q},{text:F("close"),click:function(){this.hide()}}]})})}var s={form:"#create-table-form",tab:".dialog-create-table .table-tab li",btnUpload:".btn-upload",fileUpload:"#dataFile",fileName:".file-name",delimiter:".delimiter",rowDelimiter:"#rowDelimiter",columnDelimiter:"#columnDelimiter",preview:".data-preview",previewWrap:".preview-wrap",table:".table",tableName:"#tableName",nameTip:".name-tip",lifecycle:"#tableLifecycle",schemaInfo:".table-schema-info",schemaWrap:".schema-wrap",schemaEditor:".table-schema-editor",btnAdd:".btn-add",btnDelete:".btn-delete"},t={hide:"hide"},u=["\\n","\\r","\\r\\n"];$.validator.addMethod("distinctColumnName",function(b,c){if(this.optional(c))return!0;if(v){var d=!1;return v.$('input[name="columnName"]').each(function(){if(c!==this&&a.trim(b)===a.trim($(this).val()))return d=!0,!1}),!d}return!0});var v,w,x,y,z,A,B,C,D,E,F=d.translate,G=!1;return{show:r}}),define("properties/ItemSourceTableInput",["zero/zero","zero/declare","../global/Track","../midway/properties/itemSourceTableInput","../dialog/properties/createTable","../properties/ItemAutocomplete","../ajax/odpsControl"],function(a,b,c,d,e,f,g){"use strict";return b("properties/ItemLabelColumn",[f],{constructor:function(a){var b=this;return a=b.metadata=a||{},a.loader=g.listTables,f.prototype.constructor.call(b,a),b},injectButton:function(){var a=this;return a.$wrap.addClass("dms-prop-item-source-table"),a.$inputWrap.prepend(d()).on("click",".btn-create",function(){e.show(a.master.nodeInstanceId,a.getValue()).then(function(b){a.setValue(b).onBlur()})}),a}})}),define("properties/ItemSourcePartitionCheckbox",["zero/zero","zero/declare","../properties/ItemCheckbox","../ajax/odpsControl"],function(a,b,c,d){"use strict";return b("properties/SourcePartitionCheckbox",[c],{constructor:function(a){a=this.metadata=a||{},c.prototype.constructor.call(this,a),setTimeout(this.reload.bind(this),10)},reload:function(){function a(a){b.destroyed||(a&&a.hasPart&&(c=!0),b._setDisabled(!c))}var b=this,c=!1;return b.master.nodeInstanceId?d.getTable(b.master.nodeInstanceId,function(){a()}).then(a):setTimeout(b.reload,100),b}})}),define("properties/ItemSourcePartitionsInput",["zero/zero","zero/declare","../properties/ItemAutocomplete","../ajax/odpsControl"],function(a,b,c,d){"use strict";return b("properties/ItemLabelColumn",[c],{constructor:function(a){a=this.metadata=a||{},a.loader=d.listPartitions,c.prototype.constructor.call(this,a)},reload:function(){if(!this.destroyed)return this.setValue("")},setValue:function(a){return this.$input.val(a),this.onBlur(),this}})}),define("properties/ItemTargetTableInput",["zero/zero","zero/declare","../properties/ItemString","../ajax/odpsControl","../i18n"],function(a,b,c,d,e){"use strict";var f=e.translate;return b("properties/ItemTargetTableName",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b},onFocus:function(){var a=this;return a.hideError(),a.hideWarning(),a},onBlur:function(){var a=this;return a.validate()&&d.getTable(a.master.nodeInstanceId,function(){a.notifyChange.call(a.master,a)}).then(function(b){b&&b.name===a.getValue()?a.showWarning(f("odpsTargetTableExists")):a.notifyChange.call(a.master,a)}),a}})}),define("midway/properties/itemTableColumnInfo",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<span class="btn-refresh icon icon-refresh"></span>';return void 0!==b&&b&&(f+='<div class="tooltips warning"><span class="icon icon-warning-o"></span><p class="text">'+e(b)+"</p></div>"),f+='<div class="grid-wrap"><table class="table table-bordered table-hover"><thead><tr><th><div class="cell">'+e(d("column"))+'</div></th><th><div class="cell">'+e(d("type"))+'</div></th><th><div class="cell">'+e(d("rangeOfFirstHundred"))+'</div></th><th><div class="cell"></div></th></tr></thead><tbody>',c&&c.length?(f+="",a.each(c,function(a){f+='<tr><td title="'+e(a.comment||"")+'"><div class="cell">'+e(a.columnName)+'</div></td><td><div class="cell">'+e(a.columnType)+'</div></td><td><div class="cell">'+e(a.dataRange)+'</div></td><td><div class="cell"></div></td></tr>'}),f+=""):f+='<tr class="warning"><td colspan="3">'+e(d("empty"))+"</td></tr>",f+="</tbody></table>\x3c!--",c&&c.length&&(f+='--\x3e\x3c!--<div class="grid-drag">--\x3e\x3c!--<div class="grid-line"></div>--\x3e\x3c!--<div class="grid-line"></div>--\x3e\x3c!--<div class="grid-line"></div>--\x3e\x3c!--</div>--\x3e\x3c!--'),f+="--\x3e</div>"}(b.warnMessage,b.columnInfoList)}}),define("properties/ItemTableColumnInfo",["zero/zero","zero/declare","../properties/ItemBase","../ajax/odpsControl","../midway/properties/propertiesLoading","../midway/properties/itemTableColumnInfo"],function(a,b,c,d,e,f){"use strict";var g={btnRefresh:".btn-refresh",gridWrap:".grid-wrap",cell:".cell",dragWrap:".grid-drag",dragLine:".grid-line",loading:".dms-prop-loading"};return b("properties/ItemTableColumnInfo",[c],{constructor:function(b){var d=this;b=b||{},c.prototype.constructor.call(d,b),d.$wrap.addClass("dms-prop-item-table"),d.showLoading(),d.setup();var e=a.bind(d.reload,d);return setTimeout(e,50),d},_render:function(a){var b=this;if(!b.destroyed)return b.$inputWrap.html(f(a)),b},setup:function(){var a=this;return a.$inputWrap.on("click",g.btnRefresh,function(){a.showLoading(),d.updateSchema(a.master.nodeInstanceId).then(function(){a.reload()},function(){a.hideLoading()})}),a},beforeReload:function(){var a=this;return a.showLoading(),a},afterReload:function(){var a=this;return a.hideLoading(),a},showLoading:function(){var a=this;return a.$inputWrap.find(g.gridWrap).hide(),a.$inputWrap.append(e({message:""})),a},hideLoading:function(){var a=this;return a.$inputWrap.find(g.loading).remove(),a.$inputWrap.find(g.gridWrap).show(),a},reload:function(){var b=this;if(!b.destroyed)return d.listColsInfo(b.master.nodeInstanceId).then(a.bind(b._render,b),a.bind(b._render,b,{columnInfoList:null})),b}})}),define("midway/properties/ItemTableSchemaEditor",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="dms-prop-item-schema"><span class="btn-add icon-plus-o"></span><ul class="schema-list '+e(a?" hide":"")+'"></ul><div class="empty-tip '+e(a?"":" hide")+'">'+e(d("addItemTip"))+"</div></div>"}(b.isEmpty)}}),define("midway/properties/ItemTableSchemaItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){return'<li class="schema-item"><input class="form-control field-name"type="text"id="schema-item-input-'+d(a)+'"value="'+d(b)+'"/><label for="schema-item-select-'+d(a)+'"class="select-hacker"><select id="schema-item-select-'+d(a)+'"class="form-control field-type"><option value="bigint" selected>bigint</option><option value="double">double</option><option value="decimal">decimal</option><option value="string">string</option><option value="boolean">boolean</option><option value="datetime">datetime</option></select></label><span class="btn-delete icon-close-o"></span></li>'}(b.index,b.fieldName)}}),define("properties/ItemTableSchemaEditor",["zero/zero","zero/declare","../i18n","../properties/ItemBase","../midway/properties/propertyErrorTip","../midway/properties/ItemTableSchemaEditor","../midway/properties/ItemTableSchemaItem"],function(a,b,c,d,e,f,g){"use strict";var h={wrap:".schema-list",item:".schema-item",emptyTip:".empty-tip",btnAdd:".btn-add",btnDelete:".btn-delete",filedName:".field-name",filedType:".field-type",errorTip:".dms-prop-error"},i={hide:"hide",hasError:"has-error"},j=a.trim,k=a.each,l=c.translate;return b("properties/ItemTableSchemaEditor",[d],{constructor:function(a){var b=this;a=a||{},d.prototype.constructor.call(b,a),a.value=""+a.value;var c=b.items=[];return a.value&&k(a.value.split(",")||[],function(a){var b=a.split(":");c.push({fieldName:j(b[0])||"",fieldType:j(b[1])||"bigint",index:c.length})}),b.render().setup(),b},render:function(){var b=this,c=b.items;return b.$inputWrap.append(f({isEmpty:0===c.length})),b.$listWrap=b.$inputWrap.find(h.wrap),b.$emptyTip=b.$inputWrap.find(h.emptyTip),k(c,a.bind(b.renderItem,b)),b},setup:function(){var b=this;return b.$wrap.on("click",h.btnAdd,a.bind(b.addItem,b,null)).on("click",h.btnDelete,function(){var a=$(this).parents(h.item).index();b.removeItem(a)}).on("keydown",h.filedName,function(a){13===a.which&&b.updateFieldName(this)}).on("focus",h.filedName,function(){var a=$(this).parents(h.item).index();b.hideError(a)}).on("blur",h.filedName,function(){b.updateFieldName(this)}).on("change",h.filedType,function(){b.updateFieldType(this)}),b},removeItem:function(a){var b=this,c=b.items;return c.splice(a,1),b.$wrap.find(h.item).eq(a).remove(),c.length||b.showEmpty(),b.updateHint(),b},addItem:function(a){var b=this,c=b.items;return c||(c=b.items=[]),a||(a={fieldName:"",fieldType:"bigint"}),a.index=c.length,c.push(a),b.renderItem(a),c.length&&b.hideEmpty(),b},renderItem:function(a){var b=this;return $(g(a)).appendTo(b.$listWrap).find(h.filedType).val(a.fieldType),b},updateFieldName:function(a){var b=this,c=$(a),d=j(c.val()),e=c.parents(h.item).index();if(d&&!/^[0-9a-zA-Z_]{1,}$/.test(d))return void b.showError(e,l("errorStringXss"));var f=b.items[e];return f&&(f.fieldName=d),b.updateHint(),b},updateFieldType:function(a){var b=this,c=$(a),d=c.val(),e=c.parents(h.item).index(),f=b.items[e];return f&&(f.fieldType=d),b.updateHint(),b},updateHint:function(){var a=this,b=a.metadata,c=a.getValue();return a.isValid=!0,a.isChanged=b.value!==c,a.isChanged&&a.notifyChange.call(a.master,a),a},getValue:function(){var a=this,b=a.items,c=[];return k(b,function(a){a.fieldName&&a.fieldType&&c.push(a.fieldName+":"+a.fieldType)}),c.join(",")},showEmpty:function(){var a=this;return a.$listWrap.addClass(i.hide),a.$emptyTip.removeClass(i.hide),a},hideEmpty:function(){var a=this;return a.$listWrap.removeClass(i.hide),a.$emptyTip.addClass(i.hide),a},showError:function(a,b){var c=this,d=c.$wrap.find(h.item).eq(a),f=d.find(h.errorTip);return f.length||(f=$(e({id:"schema-item-input-"+a})).appendTo(d)),d.addClass(i.hasError),f.find("label").text(b),c},hideError:function(a){var b=this;return b.$wrap.find(h.item).eq(a).removeClass(i.hasError).find(h.errorTip).remove(),b},showLoading:function(){return this},hideLoading:function(){return this}})}),define("midway/properties/itemJoinColumnSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){var f='<div class="dms-prop-col-join"><div class="select-group"><div class=" left-select"><input type="text"value="'+d(a)+'"data-index="'+d(b)+'"class="form-control"></div><div class="middle-sign">=</div><div class="right-select"><input type="text"value="'+d(c)+'"data-index="'+d(b)+'"class="form-control"></div></div>';return e||(f+='<div class="btn-delete icon-close-o" data-index="'+d(b)+'"></div>'),f+="",b||(f+='<div class="btn-add icon-plus-o"></div>'),f+="</div>"}(b.leftColumn,b.index,b.rightColumn,b.sole)}}),define("ajax/joinColumnSelect",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/joinColumnSelect.json");return{getColumns:function(a,b){return c.get({method:"getColumns",paramName:b,nodeInstanceId:a}).then(function(a){return a||{}})}}}),define("properties/ItemJoinColumnSelect",["zero/zero","zero/declare","zero/ui/AutoComplete","../properties/ItemBase","../midway/properties/itemJoinColumnSelect","../ajax/joinColumnSelect"],function(a,b,c,d,e,f){"use strict";var g={leftItem:"left-select",rightItem:"right-select"};return b("properties/ItemJoinColumnSelect",[d],{constructor:function(b){var c=this;b=b||{},d.prototype.constructor.call(c,b),c.$wrap.addClass("dms-prop-item-join-column-select");var e=c.selectedColumns=[];a.forEach((c.metadata.value||"").split(","),function(a){var b=a.split(":");b[0]=b[0]||"",b[1]=b[1]||"",e.push(b)});var f=a.bind(c.reload,c);return setTimeout(f,50),c._setup(),c},_render:function(){var b=this,d=b.leftColumns,f=b.rightColumns,h=b.$inputWrap.empty(),i=1===b.selectedColumns.length,j=b.autoCompletes;j?a.each(j,function(a){a.destroy()}):j=b.autoCompletes=[],a.each(b.selectedColumns,function(k,l){var m=$(e({index:l,sole:i,leftColumn:k[0],rightColumn:k[1]}));a.each(m.find("input").toArray(),function(e,h){var i=new c({input:e,ignorecase:!0,max:10,delay:500,minLength:0,data:0===h?d:f}).on("select",function(){var c=this.$node.input,d=a.trim(c.val()),e=parseInt(c.attr("data-index"),10),f=c.parent().hasClass(g.leftItem)?0:1,h=b.selectedColumns[e];h&&(h[f]=d),b.isValid=!0,b.isChanged=b.metadata.value!==b.getValue(),b.notifyChange.call(b.master,b)});j.push(i)}),h.append(m)})},_setup:function(){var b=this;return b.$inputWrap.on("click",".btn-add",function(){b.selectedColumns.push(["",""]),b._render()}).on("click",".btn-delete",function(){var a=parseInt($(this).attr("data-index"),10),c=b.getValue();b.selectedColumns.splice(a,1);var d=b.getValue();b._render(),b.isChanged=c!==d,b.notifyChange.call(b.master,b)}).on("blur","input",function(){function c(b,c){return a.some(b,function(a){return a===c})}var d=$(this),e=b.leftColumns||[],f=b.rightColumns||[];b.isValid=!1,b.isChanged=!1;var h=a.trim(d.val()),i=parseInt(d.attr("data-index"),10),j=d.parent().hasClass(g.leftItem)?0:1;h=c(j?e:f,h)?h:"",d.val(h);var k=b.selectedColumns[i];k&&(k[j]=h),b.isValid=!0,b.isChanged=b.metadata.value!==b.getValue(),b.notifyChange.call(b.master,b)}),b},_setDisabled:function(a){var b=this;if(b.$wrap.hasClass("disabled")!==a){var c=!0===a?"addClass":"removeClass";return b.$wrap[c]("disabled"),b.$inputWrap.find("input").prop("disabled",a),b}},reload:function(){var a=this;return f.getColumns(a.master.nodeInstanceId,a.name).then(function(b){a.destroyed||(a.leftColumns=b.leftInputColumns||[],a.rightColumns=b.rightInputColumns||[],a._render())}),a},getValue:function(){var b=this,c=[];return a.forEach(b.selectedColumns,function(b){if(b[0]&&b[1]){var d=b.join(":");a.indexOf(c,d)<0&&c.push(d)}}),c.join(",")},clear:function(){var a=this;a.selectedColumns=[["",""]],a._render(),a.isValid=!0,a.isChanged=!0,a.notifyChange.call(a.master,a)}})}),define("midway/dialog/properties/columnsOutputSelectWrap",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b){var c='<div class="column-search-form"><input type="text"value="'+e(a)+'"placeholder="'+e(d("searchColumn"))+'"class="form-control j-search-keyword"><span class="icon icon-search"></span></div><div class="columns-wrap-all"><div class="dialog-columns-select-wrap"></div><div class="right-wrap-output"><header class="wrap-header"><ul class="selected-tab"><li data-target="#dlg-selected-cols-list" >'+e(d("listModel"))+'</li><li data-target="#dlg-selected-cols-raw">'+e(d("editModel"))+'</li></ul></header><section class="wrap-content"><div class="selected-wrap "><div class="selected-list " id="dlg-selected-cols-list"></div><div class="selected-raw" id="dlg-selected-cols-raw"><textarea class="form-control txtRaw"></textarea>';return b&&(c+='<div class="err-msg hide"><span class="icon icon-close-c"></span>'+e(d("onlySupportSingleField"))+"</div>"),c+="</div></div></section></div></div>"}(b.keyword,b.isSingleSelect)}}),define("midway/dialog/properties/columnsOutputSelectContent",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g){var h='<div class="header-wrap"><table class="table table-bordered table-hover"><thead><tr><th class="sortable col-name" style="width:39%"><div class="ui-checkbox"><input type="checkbox" id="'+e(b)+'"><label for="'+e(b)+'">'+e(d("inputColumn"))+'</label></div><span data-field="inputName"class="sort'+e("inputName"===c?f?" desc":" asc":"")+'"></span></th><th class="sortable col-type" style="width:18%">'+e(d("type"))+'<span data-field="columnType"class="sort'+e("columnType"===c?f?" desc":" asc":"")+'"></span></th><th class="sortable" style="width:44%">'+e(d("outputColumn"))+'<span data-field="outputName"class="sort'+e("outputName"===c?f?" desc":" asc":"")+'"></span></th></tr></thead></table></div><div class="body-wrap"><table class="table table-bordered table-hover"><tbody>';return a.each(g,function(a){h+='<tr><td class="col-name" style="width:45%" title="'+e(a.comment||"")+'"><div class="ui-checkbox"><input type="checkbox"data-index="'+e(a.index)+'"'+e(a.selected?"checked ":"")+'name="'+e(a.inputName)+'"id="'+e(a.id)+'" ><label for="'+e(a.id)+'">'+e(a.inputName)+'</label></div></td><td class="col-type" style="width:20%">'+e(a.columnType)+'</td><td style="width:35%"><div class="output-name-holder" data-index="'+e(a.index)+'">'+e(a.outputName)+"</div></td></tr>"}),h+='</tbody></table><div class="output-name-editor"><div class="error-tip"></div><input type="text" class="form-control input-sm"><div class="btn-group"><button class="btn btn-primary btn-sm j-submit">'+e(d("save"))+'</button><button class="btn btn-sm j-cancel">'+e(d("cancel"))+"</button></div></div></div>"}(b.id,b.sortField,b.sortType,b.columns)}}),define("midway/dialog/properties/columnOutputSelectedList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var c='<div class="table-header"><table class="table table-bordered"><thead><tr><th style="width:10%"><span class="icon icon-delete btn-delete"></span></th><th style="width:35%">'+e(d("inputColumn"))+'</th><th style="width:20%">'+e(d("type"))+'</th><th style="width:35%">'+e(d("outputColumn"))+'</th></tr></thead></table></div><div class="table-body"><table class="table table-bordered table-hover"><tbody>';return a.each(b,function(a){c+="<tr "+e(a.exist?"":"class=warning")+'><td style="width:10%"><span class="icon icon-delete btn-delete"data-name="'+e(a.inputName)+'"></span></td><td style="width:35%" title="'+e(a.comment||"")+'">'+e(a.inputName)+'</td><td style="width:20%">'+e(a.columnType||"-")+'</td><td style="width:35%">'+e(a.outputName)+"</td></tr>"}),c+="</tbody></table></div>"}(b.fields)}}),define("dialog/properties/columnsOutputSelect",["zero/zero","zero/ui/Tab","zero/ui/Dialog","../../i18n","../../ajax/columnsOutputSelect","../../midway/dialog/properties/columnsOutputSelectWrap","../../midway/dialog/properties/columnsOutputSelectContent","../../midway/dialog/properties/featureColumnSelectEmpty","../../midway/dialog/properties/columnOutputSelectedList"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){N.find("input").val(""),N.siblings(P.holder).show(),N.appendTo(O)}function k(a){N.siblings(P.holder).show();var b=$(a);b.hide().after(N),N.find("input").val(b.text()).focus()}function l(){var b=a.trim(N.find("input").val());if(!b)return m(W("outputColEmpty")),!1;if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(b))return m(W("outputColIllegal")),!1;var c=N.siblings(P.holder),d=!1;if(O.find(P.input).filter(":checked").each(function(){var a=$(this),e=a.parents("tr").find(P.holder);if(c[0]!==e[0]){var f=e.text();return b.toLowerCase()===f.toLowerCase()?(d=!0,m(W("outputColDuplicated")),!1):void 0}}),d)return!1;c.text(b);var e=parseInt(c.attr("data-index"),10),f=I[e];f&&(f.outputName=b),o(f.outputName,f.selected),j()}function m(a){N.addClass(Q.hasError).find(P.errorTip).text(a).show()}function n(){N.removeClass(Q.hasError).find(P.errorTip).text("").hide()}function o(a,b){var c=null;if(T(I,function(d){if(d.inputName===a)return d.selected=b,b&&(c={exist:!0,id:d.id,inputName:d.inputName,columnType:d.columnType,outputName:d.outputName}),!0;if(d.outputName===a&&d.inputName!==d.outputName){if(d.selected=b,b&&(d.outputName=a,c={exist:!0,id:d.id,inputName:d.inputName,columnType:d.columnType,outputName:d.outputName},d.outputName===a))for(var e=K.length-1;e>=0;e--)K[e].inputName===c.inputName&&K[e].outputName!==c.outputName&&K.splice(e,1);return!0}}),T(J,function(c){if(c.inputName===a)return c.selected=b,!0}),b){if(c){var d=V(K,function(a){return a.inputName===c.inputName});d||K.push(c)}}else for(var e=K.length-1;e>=0;e--)if(K[e].inputName===a){K.splice(e,1);break}A(),r()}function p(){var b=S?S.split(","):[];K=[],U(b,function(b,c){b=a.trim(b);var d=b.split(":")[0],e=b.split(":")[1];if(d&&e){if(!V(K,function(a){return a.name===b})){var f={inputName:d,outputName:e};T(I,function(a){return a.inputName===d||a.outputName===e?(f.selected=!0,f.id=a.id,f.columnType=a.columnType,f.inputName=d,f.outputName=e,f):a.inputName!==d&&a.outputName!==e&&void 0===f.id?(f.selected=!0,f.id="",f.columnType="-",f.inputName=d,f.outputName=e,f):void 0}),K.push(f),o(K[c].inputName,K[c].selected)}}})}function q(a){G.$(P.body).find(P.input).each(function(){var b=$(this);if(b.attr("name")===a)return b.prop("checked",!1),u(),!1})}function r(){K.length?(T(K,function(a){a.exist=!1,T(I,function(b){a.inputName.toLowerCase()===b.inputName.toLowerCase()&&(a.exist=!0)})}),G.$(P.selectedList).html(i({fields:K}))):G.$(P.selectedList).html(h()),G.$(P.raw).val(S)}function s(){this.hide()}function t(a,b){K?a(K):b(""),K=null,X="inputName",Y=!1,M||b(),M=!1,
Z="",this.destroy()}function u(){var a=G.$(P.header).find(P.input),b=a.parent(P.checkbox),c=G.$(P.body).find(P.input),d=c.filter(":checked").length;0===d||d===c.length?(b.removeClass(Q.indeterminate),a.prop("checked",0!==d)):(b.addClass(Q.indeterminate),a.prop("checked",!1))}function v(){J=Z?a.filter(I,function(a){return a.inputName&&a.inputName.indexOf(Z)>-1}):a.map(I,function(a){return a})}function w(){J.sort(function(a,b){return Y?a[X]>b[X]?-1:1:b[X]>a[X]?-1:1})}function x(){if(J.length){var b="chkJoinOutputSelect-"+F;a.forEach(J,function(a,c){a.id=b+"-"+c}),J=J.filter(function(a){return!!a});var c=g({id:b,columns:J||[],sortField:X,sortType:Y,keyword:Z});G.$(P.wrap).html(c)}else G.$(P.wrap).html(h())}function y(){r(),z()}function z(){var a=G.$(P.selectedList),b=a.find(P.tableBody),c=b.find(P.table);a.toggleClass(Q.isOverflow,c.height()>b.height())}function A(){var a=T(K,function(a){return a.inputName+":"+a.outputName});S=a.join(", ")}function B(){O=G.$(P.body),N=O.find(P.editor),G.$(P.header).on("change",P.input,function(){var b=$(this),c=b.prop("checked");b.parent(P.checkbox).removeClass(Q.indeterminate),O.find(P.input).prop("checked",c),O.find("tr")[c?"addClass":"removeClass"](Q.warning),a.forEach(J,function(a){a.selected=c}),G.$(P.body).find(P.input).each(function(){var a=$(this);a.prop("checked",c),o(a.attr("name"),c)}),y()}).on("click",P.sort,function(){var a=$(this).attr("data-field");X===a?Y=!Y:(Y=!1,X=a),w(),x(),B(),u()}),O.on("change",P.input,function(){var a=$(this),b=a.prop("checked"),c=parseInt(a.attr("data-index"),10),d=I[c];o(d.inputName,a.prop("checked")),d&&(d.selected=b),a.parents("tr")[b?"addClass":"removeClass"](Q.warning),u(G)}).on("click",P.holder,function(){j(),k(this)}),N.on("click",".j-submit",a.bind(l)).on("click",".j-cancel",a.bind(j)).find("input").on("keydown",function(a){switch(a.which){case 27:j(),a.stopPropagation();break;case 13:l()}}).on("blur",a.bind(l)).on("focus",a.bind(n))}function C(a){S=a||"",p();var b={};U(K,function(a){b[a.inputName]=!0,b[a.outputName]=!0,U(J,function(b){b.inputName.toLowerCase()===a.inputName.toLowerCase()&&(b.outputName=a.outputName)})}),G.$(P.body).find(P.input).each(function(){var a=$(this),c=a.attr("name");a.prop("checked",!0===b[c]),o(c,!0===b[c])}),R||(G.$(P.body).each(function(){u()}),u())}function D(){G.$(P.selectedList).on("click",P.btnDelete,function(){var a=$(this),b=a.attr("data-name");o(b,!1),q(b),y()}).on("click",P.btnDeleteAll,function(){C()}),G.$(P.selectedRaw).on("focus",P.raw,function(){G.$(P.selectedRaw).removeClass(P.hasError).find(P.errMsg).addClass(Q.hide)}).on("blur",P.raw,function(){var b=a.trim($(this).val());if(R&&b.split(",").length>1)return void G.$(P.selectedRaw).addClass(Q.hasError).find(P.errMsg).removeClass(Q.hide);var c=b.split(","),d=[];T(c,function(a){a.indexOf(":")<0&&(a=a+":"+a),d.push(a)}),b=d.join(","),$(this).val(b),b!==S&&C(b)})}function E(){L=new b({selector:P.tab,afterShow:function(a){0==a?G.$(P.raw).blur():G.$(P.raw).focus()}}),v(),w(),x(),B(),u(),p(),y(),D();var c;G.$(P.search).on("keyup",function(){c&&(clearTimeout(c),c=0);var b=a.trim($(this).val());c=setTimeout(function(){Z=b,v(),w(),x(),B(),u()},100)}).focus().val(Z)}var F,G,H,I,J,K,L,M,N,O,P={search:".j-search-keyword",wrap:".dialog-columns-select-wrap",header:".header-wrap",body:".body-wrap",checkbox:".ui-checkbox",input:".ui-checkbox input",colType:".col-type",holder:".output-name-holder",editor:".output-name-editor",errorTip:".error-tip",sort:".sortable .sort",selectedWrap:".selected-wrap",selectedList:".selected-list",selectedRaw:".selected-raw",tab:".wrap-header .selected-tab li",raw:".txtRaw",btnDeleteAll:".table-header .btn-delete",btnDelete:".table-body .btn-delete",accordionWrap:".accordion-wrap",btnRefresh:".btn-refresh",indeterminate:".indeterminate",leftHeader:".left-wrap .wrap-header",errMsg:".err-msg",table:".table",tableHeader:".table-header",tableBody:".table-body"},Q={dialog:"dialog-join-output-select",indeterminate:"indeterminate",warning:"warning",hasError:"has-error",hide:"hide",disabled:"disabled",isOverflow:"is-overflow"},R=!1,S="",T=a.map,U=a.each,V=a.some,W=d.translate,X="inputName",Y=!1,Z="";return{show:function(b,d,g,h){return F=d,S=b||"",R=a.isBoolean(h)?h:null,new Promise(function(b,d){H=e.getColumns(F,g).then(function(e){I=e||[],a.each(I,function(a,b){a.index=b}),G=new c({title:W("joinOutputSelect"),className:Q.dialog,body:f({keyword:Z}),afterHide:function(){t.call(this,b,d)},afterShow:E,buttons:[{text:W("confirm"),type:"primary",click:s},{text:W("cancel"),click:function(){this.hide()}}]})})})}}}),define("properties/ItemColumnsOutputSelect",["zero/zero","zero/declare","../properties/ItemFeatureColumnSelect","../dialog/properties/featureColumnSelect","../dialog/properties/columnsOutputSelect"],function(a,b,c,d,e){"use strict";return b("properties/ItemColumnsOutputSelect",[c],{constructor:function(a){a=a||{},c.prototype.constructor.call(this,a),this.isSingle=!1,this.hasOutput=!0,this.dialog=e},getValue:function(){var b=this,c=b.selectedFields||[],d=[];return a.forEach(c,function(a){d.push(a.inputName+":"+a.outputName+":"+a.colType)}),d.join(",")}})}),define("properties/ItemCheckboxDisabled",["zero/zero","zero/declare","../properties/ItemCheckbox"],function(a,b,c){"use strict";return b("properties/ItemIoModeSelect",[c],{constructor:function(a){var b=this;return a=b.metadata=a||{},c.prototype.constructor.call(b,a),b.disable(),b}})}),define("ajax/rControl",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/rcontrol.json");return{getDatasetDisplay:function(a,b){return c.get({method:"getDataSetDisplay",nodeInstanceId:a,paramName:b}).then(function(a){return a?a.displays:[]})}}}),define("midway/properties/itemRDatasetDisplay",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f="";return b&&b.length&&(f+="<ul>",a.each(b,function(a){f+="<li><span>"+e(a.input)+"</span>";var b=a.fromName?d("fromName")+'"'+a.fromName+'"':"";f+='<em title="'+e(b)+'">'+e(b)+"</em></li>"}),f+="</ul>"),f+=""}(b.displays,b.displayText)}}),define("properties/ItemRDatasetDisplay",["zero/zero","zero/declare","../properties/ItemBase","../ajax/rControl","../midway/properties/itemRDatasetDisplay"],function(a,b,c,d,e){"use strict";return b("properties/ItemRDatasetDisplay",[c],{constructor:function(b){var d=this;b=b||{},c.prototype.constructor.call(d,b),d.$wrap.addClass("dms-prop-item-r-dataset");var e=a.bind(d.reload,d);return setTimeout(e,50),d},_render:function(a){var b=this;return b.$inputWrap.html(e({displays:a||[]})),b},reload:function(){var a=this;if(a.master&&a.master.nodeInstanceId)return d.getDatasetDisplay(a.master.nodeInstanceId,a.name).then(function(b){a.destroyed||a._render(b)}),a}})}),define("midway/properties/itemTags",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="dms-prop-tags"></div>'}}),define("properties/ItemTags",["zero/zero","zero/declare","zero/ui/Tags","../properties/ItemBase","../midway/properties/itemTags"],function(a,b,c,d,e){"use strict";return b("properties/ItemTags",[d],{template:e,constructor:function(a){var b=this;return d.prototype.constructor.call(b,a),b.render().setup(),b},render:function(){var a=this;return a.$wrap.addClass("dms-prop-item-tags"),a.$inputWrap.append(a.template()),a.$tagsWrap=a.$inputWrap.find(".dms-prop-tags"),a},setup:function(){var a=this;return a.initTags(),a},initTags:function(){this._initTags({autocomplete:!1,data:""})},_initTags:function(a){var b=this;b.tags=new c({container:b.$tagsWrap,autocomplete:!!a.autocomplete&&{data:a.acData,minLength:0,ignorecase:!0},validate:!!a.validate&&function(b,c){if($.isFunction(c)){for(var d=0,e=a.acData.length;d<e;d++)if(b.fileName===a.acData[d].fileName)return void c(!0);c(!1)}},data:a.data,tagNameProp:a.tagNameProp,on:{selected:function(a){b.onTagSelected(a)},remove:function(a){b.onTagRemove(a)}}})},onTagSelected:function(a){},onTagRemove:function(a){}})}),define("midway/properties/itemUploader",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="dms-prop-tags"></div><div class="dms-prop-button-container"><span class="icon-upload-l-24 dms-prop-button"></span><span class="dms-prop-loading icon-loading-spinner"></span><input type="file"style="display: none;"multiple accept=".pb,.so,.pmml,application/gzip,application/java-archive,application/json,text/plain" class="dms-prop-fileuploader"></div>'}}),define("properties/ItemUploader",["zero/zero","zero/declare","zero/ui/Tags","../global/event","../properties/ItemTags","../midway/properties/itemUploader"],function(a,b,c,d,e,f){"use strict";return b("properties/ItemUploader",[e],{template:f,constructor:function(a){e.prototype.constructor.call(this,a)},render:function(){var a=this;return e.prototype.render.apply(a,arguments),a.$button=a.$inputWrap.find(".dms-prop-button"),a.$loading=a.$inputWrap.find(".dms-prop-loading"),a.$fileuploader=a.$inputWrap.find(".dms-prop-fileuploader"),a},setup:function(){var a=this;return e.prototype.setup.apply(a,arguments),a.initUploader(),a},initUploader:function(){var a=this;a.$button.on("click",function(){a.isDisabled()||a.$fileuploader.click()}),a.$fileuploader.on("change",function(b){var c=this.files;a.$loading.show(),a.$button.hide(),a.doUpload(c).then(function(){a.$loading.hide(),a.$button.show(),a.$fileuploader.val("")})})},refreshNodes:function(a){if(a&&a.length){var b=this.master.experimentId;d.updateNodes(b,a)}return this},doUpload:function(a){}})}),define("ajax/resource",["zero/zero","./base","../global/notify","../global/utils"],function(a,b,c,d){"use strict";var e=b.create("/resource.json"),f=b.getProjectName();return{listResources:function(a){return e.get({method:"listResources",instanceId:a.instanceId},!0).then(function(b){return b?b.resources.filter(function(b){return b.nodeParam===a.nodeParam}):[]})},uploadResource:function(b){return new Promise(function(e,g){var h=new XMLHttpRequest,i=new FormData;h.open("POST","/resource.json",!0),h.onreadystatechange=function(){4==h.readyState&&200==h.status&&e(JSON.parse(h.responseText))},h.isSuccess=function(){var a=h.status;return a>=200&&a<300||304===a||!a&&"file:"===location.protocol||!a&&bomUtils.versions.safari},h.onreadystatechange=function(){if(4===h.readyState)if(h.isSuccess()){var b=h.responseText;b=a.getAny([function(){return JSON.parse(b)}])||b,b.success||(c.error(b.data.errorMessage),g(b)),e(b)}else g(h.responseText)},i.append("method","uploadResource"),i.append("instanceId",b.instanceId),i.append("param",b.param),i.append("fileContent",b.fileContent),i.append("forceUpdate",!0),i.append("ctoken",d.getCookie("ctoken")),i.append("projectName",f),h.send(i)})},linkResourceByPath:function(a){return e.get({method:"linkResourceByPath",instanceId:a.instanceId,param:a.param,fileName:a.fileName,filePath:a.fileName,forceUpdate:!0})},unlinkResource:function(a){return e.get({method:"unlinkResource",instanceId:a.instanceId,resourceId:a.resourceId})}}}),define("properties/ItemOdpsResourceSelect",["zero/zero","zero/declare","../ajax/odps","../ajax/resource","../properties/ItemUploader"],function(a,b,c,d,e){"use strict";return b("properties/ItemOdpsResourceSelect",[e],{constructor:function(a){e.prototype.constructor.call(this,a)},initTags:function(){var a=this;Promise.all([c.listResources(),d.listResources({instanceId:a.metadata.nodeInstanceId,nodeParam:a.metadata.name})]).then(function(b){a.destroyed||(b[0].forEach(function(a){a.fileName=a.name}),a._initTags({autocomplete:!0,validate:!1,acData:b[0],data:b[1],tagNameProp:"fileName"}))})},doUpload:function(a){var b=this;return a=Array.prototype.slice.call(a,0),Promise.all(a.map(function(a){return d.uploadResource({instanceId:b.metadata.nodeInstanceId,param:b.name,fileContent:a},!0).then(function(a){return!!a.success&&(b.tags.append(a.data.resource),b.refreshNodes(a.data.relatedNodeInstances),!0)},function(a){})}))},onTagSelected:function(a){var b=this;d.linkResourceByPath({instanceId:b.metadata.nodeInstanceId,param:b.name,fileName:a.fileName}).then(function(c){var d=c.resource;b.tags.findTag(a).data("data",d),b.refreshNodes(c.relatedNodeInstances)})},onTagRemove:function(a){var b=this;a.forEach(function(a){d.unlinkResource({instanceId:b.metadata.nodeInstanceId,param:b.name,resourceId:a.id}).then(function(a){b.refreshNodes(a.relatedNodeInstances)})})}})}),define("properties/ItemNfsResourceSelect",["zero/zero","zero/declare","../properties/ItemUploader","../ajax/resource"],function(a,b,c,d){"use strict";return b("properties/ItemNfsResourceSelect",[c],{constructor:function(a){c.prototype.constructor.call(this,a)},initTags:function(){var a=this;d.listResources({instanceId:a.metadata.nodeInstanceId,nodeParam:a.metadata.name}).then(function(b){a.destroyed||a._initTags({autocomplete:!1,validate:!1,data:b,tagNameProp:"fileName"})})},doUpload:function(a){var b=this;return a=Array.prototype.slice.call(a,0),Promise.all(a.map(function(a){return d.uploadResource({instanceId:b.metadata.nodeInstanceId,param:b.name,fileContent:a}).then(function(a){return!!a.success&&(b.tags.append(a.data.resource),b.refreshNodes(a.data.relatedNodeInstances),!0)})}))},onTagRemove:function(a){var b=this;a.forEach(function(a){d.unlinkResource({instanceId:b.metadata.nodeInstanceId,param:b.name,resourceId:a.id}).then(function(a){b.refreshNodes(a.relatedNodeInstances)})})}})}),define("midway/dialog/properties/volumeSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var c='<label for="dlVolumeProjects" class="select-hacker"><select id="dlVolumeProjects" class="form-control">';return a.each(b,function(a){c+='<option value="'+e(a)+'">'+e(a)+"</option>"}),c+='</select></label><div class="tree-wrap"></div><div class="create-form"><input type="text"class="form-control"id="txtVolumeName"placeholder="'+e(d("createVolumePlaceholder"))+'"><button type="button" class="btn btn-sm btn-primary btn-create">'+e(d("create"))+"</button></div>"}(b.projects)}}),define("dialog/properties/volumeSelect",["zero/zero","zero/ui/DialogEx","zero/ui/Tree","../../storage/globalCache","../../global/classNames","../../i18n","../../ajax/odpsControl","../../midway/dialog/properties/volumeSelect"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a=this;a.showLoading(),g.listProjects().then(function(b){a.set("body",h({projects:b})),n(),j(),k()},function(){a.hideLoading(),a.showEmpty()})}function j(){t=new c({canDnD:!1,hasIcon:!0,hasExpanderIcon:!0,getIconClass:function(a){return a.isBranch?e.getTreeBranchIcon(a):"icon-block"},onNodeDblclicked:function(a){a.isBranch?a.toggle():o()},onNodeClicked:function(a,b){$(b.target).is(".tree-node-expander")||a.isBranch&&a.toggle()},onNodeExpanded:function(a){var b,c,d=a.parent;d?(b=d.name,c=a.name):(b=a.name,c=""),g.listVolumes(q,s,b,c).then(function(a){var d;b&&c?d=a&&a.files||[]:b&&(d=a&&a.partitions||[]),l(b,c,d)})}}),t.placeAt(u.$(w.treeWrap)[0])}function k(){B=!0,u.showLoading(),t&&t.destroy();var a;a=s?new Promise(function(a){a(s)}):g.getVolumePath(q).then(function(a){return r=a.split("/"),s=r[0]||d.get(d.keys.projectName),u.$(w.project).val(s),s}),j(),a.then(function(a){g.listVolumes(q,a).then(function(a){u.$(w.treeWrap).removeClass(x.hide),a.volumePathPointer&&(r=a.volumePathPointer.split("/")),l(null,null,a.volumes)},function(){B=!0,u.$(w.treeWrap).addClass(x.hide),u.hideLoading()})})}function l(a,b,c){var d=y(c||[],function(c){var d={name:c};d.isBranch=!b,d.isBranch&&(d.isExpanded=!1);var e,f;return a&&b?(f="v-"+a+"-p-"+b,e=f+"-f-"+c,d.isFile=!0):a?(f="v-"+a,e=f+"-p-"+c,d.isPartition=!0):(f=null,e="v-"+c,d.isVolume=!0),d.id=e,d.parentId=f,d});t.addNodes(d);var e;if(r[0]===s&&z(d,function(a){var b=t.nodeById[a.id];if(b.isVolume&&b.name===r[1]||b.isPartition&&b.name===r[2]||b.isFile&&b.name===r[3])return b.isBranch&&b.expand(),b.select(),e=b,!0}),e&&e.isBranch||(B=!1,u.hideLoading()),e){var f=u.$(w.treeWrap),g=f.height();f.scrollTop(e.container.offsetTop-g/2)}}function m(){t&&t.destroy()}function n(){u.$(w.project).on("change",function(){s=$(this).val(),k()}).val(s),u.$(w.btnCreate).on("click",function(){var b=u.$(w.volumeName).val();(b=a.trim(b))&&g.createVolume(s,b).then(function(){u.$(w.volumeName).val(""),k()})})}function o(){var a=[],b=t.selectedNodes[0];if(b){for(;b;)a.unshift(b.name),b=b.parent;a.unshift(s),v(a.join("/")),u.hide()}}function p(a,c){return q=a,c.indexOf("/")>=0?(r=(""+c).split("/"),s=r[0]||d.get(d.keys.projectName)):(r=[],s=""),new Promise(function(a){v=a,u=new b({title:A("volumeSelect"),className:x.dialog,destroyOnHide:!0,canFullscreen:!1,afterShow:i,beforeHide:m,buttons:[{text:A("confirm"),type:"primary",click:o},{text:A("cancel"),click:function(){this.hide()}}]})})}var q,r,s,t,u,v,w={treeWrap:".tree-wrap",project:"#dlVolumeProjects",volumeName:"#txtVolumeName",btnCreate:".btn-create"},x={dialog:"dialog-volume-select",hide:"hide"},y=a.map,z=a.some,A=f.translate,B=!1;return{show:p}}),define("properties/ItemVolumeSelect",["zero/zero","zero/declare","../properties/ItemBaseString","../dialog/properties/volumeSelect","../midway/properties/itemString"],function(a,b,c,d,e){"use strict";return b("properties/ItemVolumeSelect",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b._render(e)._setup().render().setup(),b.dialog=d,b},render:function(){var a=this;return a.$wrap.addClass("dms-prop-item-volume"),a.$inputWrap.append('<span class="btn-select icon-folder"></span>'),a},setup:function(){var a=this;return a.$wrap.on("click",".btn-select",function(){a.metadata.isDisabled||a.showDialog()}),a},afterSelected:function(a){var b=this,c=b.metadata;return b.setValue(a),b.isValid=!0,b.isChanged=a!==c.value,c.value=a,b.notifyChange.call(b.master,b),b},showDialog:function(){var b=this;return b.dialog.show(b.master.nodeInstanceId,b.metadata.value,!1).then(a.bind(b.afterSelected,b)),b}})}),define("midway/dialog/properties/caffeModelSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e='<div class="list-wrap"><ul>';return a.each(b,function(a){e+='<li data-model="'+d(a)+'" '+d(c===a?"class=selected":"")+'><span class="icon icon-ok-l"></span><span class="text">'+d(a)+"</span></li>"}),e+="</ul></div>"}(b.models,b.selected)}}),define("dialog/properties/caffeModelSelect",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/odpsControl","../../midway/dialog/properties/caffeModelSelect"],function(a,b,c,d,e){"use strict";function f(){var a=this;a.showLoading(),d.getCaffeModel(j).then(function(b){b.length?a.set("body",e({selected:k,models:b})):a.showEmpty(),a.hideLoading(),g()},function(){a.hideLoading(),a.showEmpty()})}function g(){p.$(l.listItem).on("click",function(){var a=$(this);a.hasClass(m.selected)||(a.siblings(l.selected).removeClass(m.selected),a.addClass(m.selected),k=a.attr("data-model"))})}function h(){o(k),p.hide()}function i(a,c){return j=a,k=c||"",new Promise(function(a){o=a,p=new b({title:n("caffeModelSelect"),className:m.dialog,destroyOnHide:!0,canFullscreen:!1,afterShow:f,buttons:[{text:n("confirm"),type:"primary",click:h},{text:n("cancel"),click:function(){this.hide()}}]})})}var j,k,l={listItem:"li",selected:".selected"},m={selected:"selected",dialog:"dialog-caffe-select"},n=c.translate,o=null,p=null;return{show:i}}),define("properties/ItemCaffeModelSelect",["zero/zero","zero/declare","../properties/ItemBaseString","../dialog/properties/caffeModelSelect","../midway/properties/itemString"],function(a,b,c,d,e){"use strict";return b("properties/ItemCaffeModelSelect",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b._render(e)._setup().render().setup(),b.dialog=d,b},render:function(){var a=this;return a.$wrap.addClass("dms-prop-item-caffe"),a.$inputWrap.append('<span class="btn-select icon-folder"></span>'),a},setup:function(){var a=this;return a.$wrap.on("click",".btn-select",function(){a.metadata.isDisabled||a.showDialog()}),a},afterSelected:function(a){var b=this,c=b.metadata;return b.setValue(a),b.isValid=!0,b.isChanged=a!==c.value,c.value=a,b.notifyChange.call(b.master,b),b},showDialog:function(){var b=this;return b.dialog.show(b.master.nodeInstanceId,b.metadata.value).then(a.bind(b.afterSelected,b)),b}})}),define("midway/properties/itemCNNConfigList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="dms-prop-cnn-config-list"><div class="btn-add icon-plus-o"><ul class="layer-list"><li data-type="convolution">Convolution Layer</li><li data-type="innerProduct">InnerProduct Layer</li><li data-type="pooling">Pooling Layer</li><li data-type="dropout">Dropout Layer</li></ul></div><div class="dms-prop-cnn-config-empty hide">'+e(d("empty"))+"</div></div>"}()}}),define("midway/properties/itemCNNConfigItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){return'<div class="dms-prop-cnn-config-item '+d(a)+'"><div class="header"><span class="icon icon-arrow-down-l"></span>'+d(b)+'<span class="icon btn-delete icon-close-c"></span></div></div>'}(b.type,b.name)}});define("midway/properties/itemCNNConfigFiller",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e="",b=a.uuid();return e+='<label for="'+d(b)+'" class="control-label">'+d(c)+'</label><label for="'+d(b)+'" class="select-hacker"><select id="'+d(b)+'" class="form-control input-sm"><option value="constant">constant</option><option value="uniform">uniform</option><option value="gaussian">gaussian</option><option value="xavier">xavier</option></select></label><div class="form-horizontal hide" data-type="constant">',b=a.uuid(),e+='<div class="form-group sub-from-group"><label for="'+d(b)+'" class="control-label">value</label><input id="'+d(b)+'" type="number" name="value"class="form-control input-sm"value="0"></div></div><div class="form-horizontal hide" data-type="uniform">',b=a.uuid(),e+='<div class="form-group sub-from-group"><label for="'+d(b)+'" class="control-label">min</label><input id="'+d(b)+'" type="number" name="min"class="form-control input-sm"value="0"></div>',b=a.uuid(),e+='<div class="form-group sub-from-group"><label for="'+d(b)+'" class="control-label">max</label><input id="'+d(b)+'" type="number" name="max"class="form-control input-sm"value="1"></div></div><div class="form-horizontal hide" data-type="gaussian">',b=a.uuid(),e+='<div class="form-group sub-from-group"><label for="'+d(b)+'" class="control-label">mean</label><input id="'+d(b)+'" type="number" name="mean"class="form-control input-sm"value="0"></div>',b=a.uuid(),e+='<div class="form-group sub-from-group"><label for="'+d(b)+'" class="control-label">std</label><input id="'+d(b)+'" type="number" name="std"class="form-control input-sm"value="0.01"></div></div><div class="form-horizontal hide" data-type="xavier"></div>'}(b.uuid,b.name)}}),define("midway/properties/itemCNNConfigItemConvolution",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g,h,i,j,k,l,m,n){var o='<div class="form-horizontal">',b=a.uuid();return o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">output number</label><input id="'+e(b)+'" type="number" class="form-control input-sm"required="required"name="num_output"value="'+e(c)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">kernel size</label><input id="'+e(b)+'" type="number" class="form-control input-sm"required="required"name="kernel_size"value="'+e(f)+'"></div><div class="form-group config-filter" data-name="weight_filler"></div><div class="form-group config-filter" data-name="bias_filler"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">stride</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="stride"value="'+e(g)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">pad</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="pad"value="'+e(h)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">group</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="group"value="'+e(i)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">weight lr_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"required="required"name="weight_lr_mult"value="'+e(j)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">weight decay_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"required="required"name="weight_decay_mult"value="'+e(k)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">bias lr_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="bias_lr_mult"value="'+e(l)+'"></div>',b=a.uuid(),o+='<div class="form-group"><label for="'+e(b)+'" class="control-label">bias decay_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="bias_decay_mult"value="'+e(m)+'"></div>',b=a.uuid(),o+='<div class="form-group activation-layer"><label for="'+e(b)+'" class="control-label">activation layer</label><label for="'+e(b)+'" class="select-hacker"><select id="'+e(b)+'" class="form-control input-sm"name="activation_layer"><option value="">'+e(d("empty"))+"</option>",o+="ReLU"===n?'<option value="ReLU" selected>ReLU</option>':'<option value="ReLU">ReLU</option>',o+="",o+="Sigmoid"===n?'<option value="Sigmoid" selected>Sigmoid</option>':'<option value="Sigmoid">Sigmoid</option>',o+="",o+="TanH"===n?'<option value="TanH" selected>TanH</option>':'<option value="TanH">TanH</option>',o+="</select></label></div></div>"}(b.uuid,b.num_output,b.kernel_size,b.stride,b.pad,b.group,b.weight_lr_mult,b.weight_decay_mult,b.bias_lr_mult,b.bias_decay_mult,b.activation_layer)}}),define("midway/properties/itemCNNConfigItemInnerProduct",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g,h,i,j){var k='<div class="form-horizontal">',b=a.uuid();return k+='<div class="form-group"><label for="'+e(b)+'" class="control-label">num_output</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="num_output"required="required"value="'+e(c)+'"></div><div class="form-group config-filter" data-name="weight_filler"></div><div class="form-group config-filter" data-name="bias_filler"></div>',b=a.uuid(),k+='<div class="form-group"><label for="'+e(b)+'" class="control-label">weight lr_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"required="required"name="weight_lr_mult"value="'+e(f)+'"></div>',b=a.uuid(),k+='<div class="form-group"><label for="'+e(b)+'" class="control-label">weight decay_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"required="required"name="weight_decay_mult"value="'+e(g)+'"></div>',b=a.uuid(),k+='<div class="form-group"><label for="'+e(b)+'" class="control-label">bias lr_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="bias_lr_mult"value="'+e(h)+'"></div>',b=a.uuid(),k+='<div class="form-group"><label for="'+e(b)+'" class="control-label">bias decay_mult</label><input id="'+e(b)+'" type="number" class="form-control input-sm"name="bias_decay_mult"value="'+e(i)+'"></div>',b=a.uuid(),k+='<div class="form-group activation-layer"><label for="'+e(b)+'" class="control-label">activation layer</label><label for="'+e(b)+'" class="select-hacker"><select id="'+e(b)+'" class="form-control input-sm"name="activation_layer"><option value="">'+e(d("empty"))+"</option>",k+="ReLU"===j?'<option value="ReLU" selected>ReLU</option>':'<option value="ReLU">ReLU</option>',k+="",k+="Sigmoid"===j?'<option value="Sigmoid" selected>Sigmoid</option>':'<option value="Sigmoid">Sigmoid</option>',k+="",k+="TanH"===j?'<option value="TanH" selected>TanH</option>':'<option value="TanH">TanH</option>',k+="</select></label></div></div>"}(b.uuid,b.num_output,b.weight_lr_mult,b.weight_decay_mult,b.bias_lr_mult,b.bias_decay_mult,b.activation_layer)}}),define("midway/properties/itemCNNConfigItemPooling",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e,f){var g='<div class="form-horizontal">',b=a.uuid();return g+='<div class="form-group"><label for="'+d(b)+'" class="control-label">kernel size</label><input id="'+d(b)+'" type="number" class="form-control input-sm"name="kernel_size"required="required"value="'+d(c)+'"></div>',b=a.uuid(),g+='<div class="form-group"><label for="'+d(b)+'" class="control-label">pool</label><label for="'+d(b)+'" class="select-hacker"><select id="'+d(b)+'" class="form-control input-sm" name="pool"><option value="MAX" selected>MAX</option><option value="AVE">AVE</option><option value="STOCHASTIC">STOCHASTIC</option></select></label></div>',b=a.uuid(),g+='<div class="form-group"><label for="'+d(b)+'" class="control-label">pad</label><input id="'+d(b)+'" type="number" class="form-control input-sm"name="pad"value="'+d(e)+'"></div>',b=a.uuid(),g+='<div class="form-group"><label for="'+d(b)+'" class="control-label">stride</label><input id="'+d(b)+'" type="number" class="form-control input-sm"name="stride"value="'+d(f)+'"></div></div>'}(b.uuid,b.kernel_size,b.pad,b.stride)}}),define("midway/properties/itemCNNConfigItemDropout",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e='<div class="form-horizontal">',b=a.uuid();return e+='<div class="form-group"><label for="'+d(b)+'" class="control-label">dropout ratio</label><input id="'+d(b)+'" type="number" class="form-control input-sm"name="dropout_ratio"required="required"value="'+d(c)+'"></div></div>'}(b.uuid,b.dropout_ratio)}}),define("properties/ItemCNNConfig",["zero/zero","zero/declare","../i18n","../properties/ItemBase","../midway/properties/propertyErrorTip","../midway/properties/itemCNNConfigList","../midway/properties/itemCNNConfigItem","../midway/properties/itemCNNConfigFiller","../midway/properties/itemCNNConfigItemConvolution","../midway/properties/itemCNNConfigItemInnerProduct","../midway/properties/itemCNNConfigItemPooling","../midway/properties/itemCNNConfigItemDropout"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=c.translate,n={list:".dms-prop-cnn-config-list",item:".dms-prop-cnn-config-item",empty:".dms-prop-cnn-config-empty",header:".header",btnAddItem:".layer-list li",btnDelete:".btn-delete",errorTip:".dms-prop-error",filter:".config-filter",form:".form-horizontal",formGroup:".form-group",select:".select-hacker select"},o={hide:"hide",hasError:"has-error",collapsed:"collapsed"},p={convolution:{name:"Convolution Layer",type:"convolution",attributes:{num_output:"",weight_lr_mult:1,weight_decay_mult:1,
bias_lr_mult:1,bias_decay_mult:1,weight_filler:{name:"weight filler",type:"gaussian",mean:0,std:.01},bias_filler:{name:"bias filler",type:"constant",value:0},kernel_size:"",stride:1,pad:0,group:1,activation_layer:""},render:i},innerProduct:{name:"InnerProduct Layer",type:"innerProduct",attributes:{num_output:"",weight_lr_mult:0,weight_decay_mult:0,bias_lr_mult:0,bias_decay_mult:0,weight_filler:{name:"weight filler",type:"gaussian",mean:0,std:.01},bias_filler:{name:"bias filler",type:"constant",value:0},activation_layer:""},render:j},pooling:{name:"Pooling Layer",type:"pooling",attributes:{kernel_size:"",pool:"MAX",pad:"",stride:1},render:k},dropout:{name:"Dropout Layer",type:"dropout",attributes:{dropout_ratio:""},render:l}};return b("properties/ItemCNNConfig",[d],{constructor:function(a){try{this.valueAsObject=JSON.parse(a.value||"")}catch(a){this.valueAsObject=[]}d.prototype.constructor.call(this,a),this.render().setup()},render:function(){var b=this;return b.$wrap.addClass("dms-prop-item-cnn-config"),b.$inputWrap.append(f()),b.$listWrap=b.$inputWrap.find(n.list),b.valueAsObject.length?a.each(b.valueAsObject,function(a,c){b.renderItem(a,c)}):b.showEmpty(),b},setup:function(){var a=this;return a.$inputWrap.on("focus","input",function(){a.hideError(this)}).on("blur","input",function(){a.updateValue(this,!0)}).on("change","select",function(){a.updateValue(this,!1)}).on("click",n.header,function(){var a=$(this).parents(n.item);a.toggleClass(o.collapsed),a.hasClass(o.collapsed)&&setTimeout(function(){a.find(n.form)[0].scrollTop=1e4},250)}).on("click",n.btnAddItem,function(){var b=$(this).attr("data-type");b&&p[b]&&a.createItem(p[b])}).on("click",n.btnDelete,function(){return a.removeItem($(this).parents(n.item)),!1}),a},showError:function(a,b){var c=$(a).parents(n.formGroup),d=c.find(n.errorTip);d.length||(d=$(e({id:c.attr("id")})),c.append(d)),d.find("label").text(b),c.addClass(o.hasError)},hideError:function(a){$(a).parents(n.formGroup).removeClass(o.hasError).find(n.errorTip).remove()},updateValue:function(a,b){var c=$(a),d=a.value;if(c.attr("required")&&(isNaN(d)||""===d))return this.showError(a,m("msgRequired"));b&&(d=parseFloat(d));var e=c.parents(n.item).attr("data-index"),f=this.valueAsObject[e];if(f){var g=f.attributes,h=c.attr("name"),i=c.parents(n.formGroup),j=i.attr("data-name");if(j)if(c.is(n.select)){var k={type:d};i.find(n.form).filter('[data-type="'+d+'"]').find("input").each(function(){var a=$(this),b=a.attr("name");k[b]=parseFloat(a.val())}),g[j]=k}else g[j][h]=d;else g[h]=d}this.checkChanged()},checkChanged:function(){this.getValue()!==this.metadata.value&&(this.isValid=!0,this.isChanged=!0,this.notifyChange.call(this.master,this))},getValue:function(){return JSON.stringify(this.valueAsObject)},renderItem:function(a,b){var c=this,d=p[a.type];d&&(d=$.extend(!0,{},d,a),c.hideEmpty(),$(g(d)).attr("data-index",b).append(d.render(d.attributes)).appendTo(c.$listWrap).find(n.filter).each(function(){var b=$(this),e=b.attr("data-name"),f=d.attributes[e];f&&c.renderFiller(b,e,f),delete a.attributes[e].name}))},renderFiller:function(a,b,c){a.append(h(c)),a.find(n.select).val(c.type).attr("name",b).on("change",function(){var b=$(this).val();b&&a.find(n.form).addClass(o.hide).filter('[data-type="'+b+'"]').removeClass(o.hide)}),a.find(n.form).filter('[data-type="'+c.type+'"]').removeClass(o.hide).find("input").each(function(){var a=$(this),b=a.attr("name");b in c&&a.val(c[b])})},removeItem:function(a){var b=$(a),c=b.attr("data-index");this.valueAsObject.splice(c,1),b.hasClass(o.collapsed)?b.remove():(b.onCSSTransitionEnd(function(){b.remove()}),b.addClass(o.collapsed)),this.$listWrap.find(n.item).length||this.showEmpty(),this.checkChanged()},createItem:function(a){a=$.extend(!0,{},a),this.renderItem(a,this.valueAsObject.length),this.valueAsObject.push({type:a.type,attributes:a.attributes}),this.checkChanged()},showEmpty:function(){var a=this;return a.$listWrap.find(n.empty).removeClass(o.hide),a},hideEmpty:function(){var a=this;return a.$listWrap.find(n.empty).addClass(o.hide),a}})}),define("ajax/cnnModel",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/cnnModel.json");return{queryCnnResult:function(){return c.get({method:"queryCnnResult"}).then(function(a){return a?a.result:[]})}}}),define("midway/dialog/properties/cnnModelSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<div class="cnn-model-tree">';return b.length&&(c+="",a.each(b,function(b){c+='<dl class="cnn-model-sec '+d(b.opened?"is-opened":"")+'"><dt><span class="indictor"></span>'+d(b.title)+"</dt><dd>",b.models.length&&(c+='<ul class="cnn-model-list">',a.each(b.models,function(a){c+='<li data-path="'+d(a.path)+'"'+d(a.selected?"class=is-checked":"")+'><span class="icon icon-block"></span>'+d(a.fileName)+" ("+d(a.result)+")</li>"}),c+="</ul>"),c+="</dd></dl>"}),c+=""),c+="</div>"}(b.items)}}),define("dialog/properties/cnnModelSelect",["zero/zero","zero/ui/DialogEx","zero/ui/Accordion","../../i18n","../../ajax/cnnModel","../../midway/dialog/properties/cnnModelSelect"],function(a,b,c,d,e,f){"use strict";function g(a){a+="";var b=a.lastIndexOf("/");return b>=0?a.substr(b+1):a}function h(a,b){var c=this;k=a,c.showLoading(),e.queryCnnResult().then(function(a){return l(a,function(a){var c,d={};return c=n(a.models,function(a){return a.path=b?a.solverStatePath:a.modelPath,!!a.path}),d.title="["+a.experimentName+"] - ["+a.nodeInstanceName+"]",d.models=l(c,function(a){var b=a.path;return{path:b,fileName:g(b),result:a.trainResult,selected:k&&k===b}}),d})}).then(function(a){return m(a,function(a){return a.opened=m(a.models,function(a){return a.selected})}),a}).then(function(a){c.hideLoading(),c.set("body",f({items:a})),i.call(c)},function(){c.hideLoading(),c.showEmpty()})}function i(){var a=this;a.$(o.title).on("click",function(){$(this).parents(o.section).toggleClass(p.opened)}),a.$(o.item).on("click",function(){var b=$(this);b.hasClass(p.checked)||(a.$(o.item).removeClass(p.checked),b.addClass(p.checked),k=b.attr("data-path"))})}function j(a,c){return new Promise(function(d){new b({title:q(c?"cnnSolverStateSelect":"cnnModelSelect"),className:p.dialog,body:f({items:[]}),destroyOnHide:!0,canFullscreen:!1,afterShow:function(){h.call(this,a,c)},buttons:[{text:q("confirm"),type:"primary",click:function(){d({path:k}),this.hide()}},{text:q("cancel"),click:function(){this.hide()}}]})})}var k,l=a.map,m=a.some,n=a.filter,o={section:".cnn-model-sec",title:".cnn-model-sec dt",item:".cnn-model-list li"},p={dialog:"dialog-cnn-model-select",checked:"is-checked",opened:"is-opened"},q=d.translate;return{show:j}}),define("properties/ItemCNNModelSelect",["zero/zero","zero/declare","../properties/ItemBaseText","../dialog/properties/cnnModelSelect","../midway/properties/itemString"],function(a,b,c,d,e){"use strict";return b("properties/ItemCNNModelSelect",[c],{constructor:function(a){var b=this;return a=a||{},a.filepath=a.value,a.value=b.getFileName(a.value),c.prototype.constructor.call(b,a),b._render(e)._setup().render().setup(),b.dialog=d,b},render:function(){var a=this;return a.$wrap.addClass("dms-prop-item-cnn"),a.$inputWrap.append('<span class="btn-select icon-folder"></span>'),a},getValue:function(){return this.metadata.filepath},getFileName:function(a){a+="";var b=a.lastIndexOf("/");return b>=0?a.substr(b+1):a},setup:function(){var a=this;return a.$input.off("keydown").on("keydown",function(b){a.metadata.isDisabled||(8===b.which?a.setValue(""):13===b.which?a.onBlur():b.preventDefault())}),a.$wrap.on("click",".btn-select",function(){a.metadata.isDisabled||a.showDialog()}),a},afterSelected:function(a){var b=this,c=b.metadata,d=a.path,e=b.getFileName(d);return b.setValue(e),b.isValid=!0,b.isChanged=d!==c.filepath,b.metadata.filepath=d,c.value=e,b.notifyChange.call(b.master,b),b},showDialog:function(){var b=this;return b.dialog.show(b.metadata.filepath,!1).then(a.bind(b.afterSelected,b)),b}})}),define("properties/ItemCNNSolverStateSelect",["zero/zero","zero/declare","../properties/ItemCNNModelSelect"],function(a,b,c){"use strict";return b("properties/ItemCNNSolverStateSelect",[c],{constructor:function(a){return c.prototype.constructor.call(this,a)},showDialog:function(){var b=this;return b.dialog.show(b.metadata.filepath,!0).then(a.bind(b.afterSelected,b)),b}})}),define("midway/dialog/properties/createFunction",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="form-horizontal"><div class="form-group"><label for="txtUDFName" class="col-xs-3 control-label">'+e(d("UDFName"))+'</label><div class="col-xs-9"><input type="text"class="form-control"id="txtUDFName"maxlength="33"placeholder="'+e(d("UDFNameHolder"))+'"></div></div><div class="form-group"><label for="txtUDFClassName" class="col-xs-3 control-label">'+e(d("UDFClassName"))+'</label><div class="col-xs-9"><input type="text"class="form-control"id="txtUDFClassName"placeholder="'+e(d("UDFClassNameHolder"))+'"></div></div><div class="form-group"><label for="txtUDFType" class="col-xs-3 control-label">'+e(d("UDFType"))+'</label><div class="col-xs-9"><label for="txtUDFType" class="select-hacker"><select id="txtUDFType" class="form-control"><option value="jar">Java</option><option value="py">Python</option></select></label></div></div><div class="form-group"><label class="col-xs-3 control-label">'+e(d("UDFResource"))+'</label><form class="hide"enctype="multipart/form-data"><input type="file" name="resourceFile"accept="application/java-archive"class="uploader"></form><div class="col-xs-9"><button type="button" class="btn btn-primary btn-block btn-upload"><span class="text">'+e(d("upload"))+'</span><span class="icon icon-loading-spinner"></span></button><div class="udf-resource-list" tabindex="-1"></div></div></div></div>'}()}}),define("midway/dialog/properties/createFunctionResourceItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c){return'<div class="udf-resource-item" title="'+d(a)+'"><div class="ui-checkbox" data-name="'+d(a)+'"><input type="checkbox"id="udf-resource-item-'+d(b)+'"'+d(c?" checked ":"")+'><label for="udf-resource-item-'+d(b)+'"><span>'+d(a)+"</span></label></div></div>"}(b.name,b.index,b.selected)}}),define("dialog/properties/createFunction",["zero/zero","zero/ui/Dialog","../../i18n","../../ajax/odps","../../midway/dialog/properties/createFunction","../../midway/dialog/properties/createFunctionResourceItem"],function(a,b,c,d,e,f){"use strict";function g(a,b){a.next(".err-msg").remove(),a.after('<div class="err-msg"><span class="icon icon-close-c"></span>'+b+"</div>"),a.one("focus",function(){a.next(".err-msg").remove()})}function h(){j(),m.$(q.udfType).on("change",function(){var a="jar"===$(this).val()?"application/java-archive":".py";m.$(q.uploader).attr("accept",a),j()}),m.$(q.btnUpload).on("click",function(){$(this).hasClass(r.loading)||m.$(q.uploader).click()}),m.$(q.uploader).on("change",function(){var a=new FormData(this.parentNode),b=m.$(q.btnUpload).addClass(r.loading);a.append("resourceType",m.$(q.udfType).val()),$(this).val(""),d.uploadResource(a).then(function(a){k({name:a},!0),b.removeClass(r.loading)})})}function i(){var a=this,b=a.$(q.udfName),c=b.val();if(!c)return void g(b,p("UDFNameHolder"));if(o.test(c))return void g(b,p("errorStringXss"));var e=a.$(q.udfClassName),f=e.val();if(!f)return void g(e,p("UDFClassNameHolder"));if(o.test(f))return void g(e,p("errorStringXss"));var h=[];a.$(q.checkbox).each(function(){var a=$(this);a.find("input").prop("checked")&&h.push(a.attr("data-name"))}),h.length||g(a.$(q.resourceList),p("UDFResourceEmptyTip")),d.createFunction(c,f,h.join(",")).then(function(){n(),a.hide()})}function j(){var b=m.$(q.udfType).val();d.listResources(b).then(function(b){m.$(q.resourceList).find(q.resourceItem).remove(),a.each(b,function(a){k(a,!1)})})}function k(a,b){var c=m.$(q.resourceList);a.index=c.find(q.resourceItem).length,a.selected=b,c.prepend(f(a))}function l(){return new Promise(function(a){n=a,m=new b({title:p("createFunction"),className:"dlg-prop-create-fn",destroyOnHide:!0,body:e(),afterShow:h,buttons:[{text:p("new"),type:"primary",click:i},{text:p("cancel"),click:function(){this.hide()}}]})})}var m,n,o=/[<\/>\s]/,p=c.translate,q={resourceList:".udf-resource-list",resourceItem:".udf-resource-item",btnUpload:".btn-upload",uploader:".uploader",udfType:"#txtUDFType",udfName:"#txtUDFName",udfClassName:"#txtUDFClassName",checkbox:".ui-checkbox"},r={loading:"loading"};return{show:l}}),define("midway/properties/itemSqlFnList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="dms-prop-fn-list"><span class="btn-add icon-plus-o"></span><spanclass="icon icon-loading-spinner hide"></span><div class="dms-prop-fn-list-empty hide">'+e(d("addItemTipWithIcon"))+"</div></div>"}()}}),define("midway/properties/itemSqlFnListItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return'<div class="dms-prop-fn-list-item"><span class="icon icon-component"></span>'+d(a)+"</div>"}(b.name)}}),define("properties/ItemSqlFnList",["zero/zero","zero/declare","../ajax/odps","../properties/ItemBase","../dialog/properties/createFunction","../midway/properties/itemSqlFnList","../midway/properties/itemSqlFnListItem"],function(a,b,c,d,e,f,g){"use strict";var h={list:".dms-prop-fn-list",item:".dms-prop-fn-list-item",empty:".dms-prop-fn-list-empty",btnAdd:".btn-add",btnDelete:".btn-delete",loading:".icon-loading-spinner"},i={hide:"hide"};return b("properties/ItemSqlFnList",[d],{constructor:function(a){var b=this;return d.prototype.constructor.call(b,a),b.render().setup().reload(),b},render:function(){var a=this;return a.$inputWrap.append(f()),a.$listWrap=a.$inputWrap.find(h.list),a},setup:function(){var b=this,c=a.bind(b.createItem,b);return b.$inputWrap.on("click",h.empty,c).on("click",h.btnAdd,c).on("click",h.btnDelete,function(){b.removeItem(this)}),b},reload:function(){var b=this;b.showLoading(),c.listFunctions().then(function(c){b.$listWrap.find(h.item).remove(),b.hideLoading(),c&&c.length?a.each(c,function(a){b.renderItem(a)}):b.showEmpty()},function(){b.hideLoading(),b.showEmpty()})},renderItem:function(a){var b=this;return b.$listWrap.append(g(a)),b.hideEmpty(),b},removeItem:function(a){var b=this,d=$(a),e=d.attr("data-id");return c.delete(e).then(function(){d.parents(h.item).remove(),b.$listWrap.find(h.item).length||b.showEmpty()}),b},createItem:function(){var a=this;return e.show().then(function(){a.reload()}),a},showEmpty:function(){var a=this;return a.$listWrap.find(h.empty).removeClass(i.hide),a},hideEmpty:function(){var a=this;return a.$listWrap.find(h.empty).addClass(i.hide),a},showLoading:function(){var a=this;return a.$inputWrap.find(h.loading).removeClass(i.hide).end().find(h.btnAdd).addClass(i.hide),a},hideLoading:function(){var a=this;return a.$inputWrap.find(h.loading).addClass(i.hide).end().find(h.btnAdd).removeClass(i.hide),a}})}),define("midway/properties/deployStatus",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){var c='<span id="copy-node-id" class="deploy-date padding-left-8 tips-container"> '+d(a)+" ";return b&&(c+='<span class="d2-node-id"> '+d(b)+'<div class="tips"> D2上的节点ID, 点击可复制. </div></span>'),c+="</span>"}(b.date,b.nodeId)}}),define("midway/properties/D2Checkbox",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return'<div class="profile_checkbox"><div class="dms-prop-item"><div class="ui-checkbox"><input type="checkbox" id="d2_deploy"  data-type="deployPmml_'+d(a)+'"><label for="d2_deploy" data-type="deployPmml_'+d(a)+'">d2部署是否生成pmml</label></div></div><div class="dms-prop-item"><div class="ui-checkbox" ><input type="checkbox" id="use_user_project" data-type="user_project_generate_pmml_'+d(a)+'"><label for="use_user_project" data-type="user_project_generate_pmml_'+d(a)+'">使用当前project资源生成pmml</label></div></div></div>'}(b.expId)}}),define("ajax/offlineDeploy",["zero/zero","zero/json","./base"],function(a,b,c){"use strict";var d=c.create("/offlineDeploy.json");return{createOrGetNode:function(a,b){return d.get({method:"createOrGetNode",experimentId:a},!1,b)},updateProjectList:function(){return d.get({method:"updateProjectList"}).then(function(a){return a.projectList})},deleteNode:function(a){return d.get({method:"deleteNode",experimentId:a},!0).then(function(a){return a.successDelete})},deployNode:function(a,c){return d.post({method:"deployNode",experimentId:a.experimentId,nodeDetail:b.stringify(a)},!1,c)},changeOdpsProject:function(a,c,e,f,g){return d.post({method:"changeOdpsProject",experimentId:a,upstreamNodes:b.stringify(e),downstreamNodes:b.stringify(f),projectName:c},!1,g)},getRelatedNodes:function(a,b,c,e){return d.post({method:"getRelatedNodes",tableName:a,upStream:b,projectName:c},!1,e)},listTables:function(a,b){return d.post({method:"listTables",limit:100,keyword:a,projectName:b}).then(function(a){return a.tableList})},checkStatus:function(a){return d.post({method:"checkStatus",experimentId:a})}}}),define("ajax/experimentMeta",["zero/zero","zero/json","./base"],function(a,b,c){"use strict";var d=c.create("/experimentMeta.json");return{copyExperiment:function(a,b,c,e,f){return d.post({method:"copyExperiment",name:a,description:b,parentDirId:c,experimentId:e,projectName:f},!0).then(function(a){var b=a.documentNode;return b.parentId=b.parentDir,b.label=b.name,b})},queryExistTables:function(a){return d.get({method:"queryExistTables",templateId:a},!0).then(function(a){return a.exitTables||[]})},initTemplateAsync:function(a,b,c,e,f){return d.post({method:"initTemplateAsyn",name:a,templateId:e,projectName:f,description:b,parentDirId:c||0},!0).then(function(a){return a&&a.result||{}})},shareExperiment:function(a,b,c){var e={method:"shareExperiment",experimentId:a,targetUserNumber:b.join(",")};return c&&(e.targetProjectName=c),d.post(e,!0)},shareExperimentAsync:function(a,b,c){var e={method:"shareExperimentAsyn",experimentId:a,targetUserNumber:b.join(",")};return c&&(e.targetProjectName=c),d.post(e,!0).then(function(a){return a&&a.jobId||""})},saveExperimentVersion:function(a,b){return d.post({method:"saveExperimentVersion",experimentId:a,comment:b||""},!0).then(function(a){return a.version||{}})},revertToVersion:function(a,b){return d.post({method:"revertToVersion",experimentId:a,version:b},!0).then(function(a){return a&&a.documentNode||null})},queryAllExpVersions:function(a){return d.get({method:"queryAllExpVersions",experimentId:a}).then(function(a){return a})},deleteExpVersion:function(a,b){return d.post({method:"deleteExpVersion",experimentId:a,versionId:b},!0)},getTemplateCats:function(){return d.get({method:"listAllTemplateCats"}).then(function(a){return a&&a.cats||[]})},getTemplatesByCat:function(a,b,c){return d.get({method:"listTemplatesByCat",catId:a,pageNum:b,pageSize:c}).then(function(a){return a&&a.templates||[]})},copyNodeInstancesAsync:function(a,c,e,f){var g={method:"copyNodeInstancesAsyn",experimentId:a,copyNodes:b.stringify(e)};return f&&(g.copyGroupIds=f.join(",")),a!==c&&(g.targetExpId=c),d.post(g,!0).then(function(a){return a&&a.jobId||""})},replaceMetaInExistExpAsyn:function(a){return d.post({method:"replaceMetaInExistExpAsyn",experimentId:a},!0).then(function(a){return a&&a.jobId||0})}}}),define("properties/ItemDeployStatus",["zero/zero","zero/declare","../i18n","../properties/ItemHyperlink","../midway/properties/deployStatus","../midway/properties/D2Checkbox","../ajax/common","../ajax/offlineDeploy","../ajax/userProfile","../ajax/experimentMeta"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=c.translate;return b("properties/ItemBase",[d],{constructor:function(a){var b=this;a=a||{},a.label=k("offlineDeployStatus"),a.value="https://mydata.alipay.com",a.tooltip="",d.prototype.constructor.call(b,a),b.$wrap.addClass("dms-prop-item-deploy"),setTimeout(b.reload.bind(this),100)},initCheckbox:function(a,b){this.$wrap.length&&(this.$wrap.after(f({expId:b})),a.checkboxWrapper=this.$wrap.parent().find(".profile_checkbox"),a.checkboxWrapper.off(),a.checkboxWrapper.on("click",function(b){b.preventDefault(),b.stopPropagation();var c=$(b.target),d=c.data("type"),e=c.parent().find("input");a.userProfile[d]=String(!("true"===a.userProfile[d])),i.update(a.userProfile).then(function(b){e.prop("checked","true"===a.userProfile[d])})}))},bindCopyEvent:function(a,b){a.$wrap.find(".tips-container").on("click",function(){window.react_bridge.actions&&window.react_bridge.actions.common.utils.copy({content:b,fileName:"nodeId"})})},reload:function(){var a=this;if(a.master&&a.master.experimentId){var b=a.master.experimentId;a.initCheckbox(a,b),a.destroyed||(i.query().then(function(b){a.userProfile=b||{},a.checkboxWrapper||(a.checkboxWrapper=a.$wrap.parent().find(".profile_checkbox")),a.checkboxWrapper.find('input[type="checkbox"]').each(function(){var b=$(this).data("type");$(this).prop("checked","true"===a.userProfile[b])})}),h.checkStatus(b).then(function(b){var c;if(c=k("-1"===b.deployingStatus?"deployStatusUnDeploy":"deployStatusDeployed"),b.deployedTime){var d=moment(b.deployedTime).utc().utcOffset(-6).format("YY-MM-DD HH:mm");a.$link.parent().append(e({date:d,nodeId:b.nodeId})),"3"!==b.deployingStatus&&(a.$link.attr("href","http://d2.alibaba-inc.com/"),a.bindCopyEvent(a,b.nodeId))}a.$link.text(c)}))}return a},checkJob:function(a){function b(){g.queryAsynJobStatus(a).then(function(a){"running"===a.status?c():"failed"===a.status||(clearTimeout(d),window.location.reload())},function(){clearTimeout(d)})}function c(){d=setTimeout(b,3e3)}var d;c()}})}),define("midway/properties/itemExperimentVersion",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<table class="table table-bordered"><thead><tr><th>'+e(d("edition"))+"</th><th>"+e(d("rollback"))+"</th></tr></thead>";return b?f+='<tfoot><tr><td colspan="2"><span class="icon icon-loading-spinner"></span></button></td></tr></tfoot>':(f+="<tbody>",c&&c.length?(f+="",a.each(c,function(a){f+="<tr><td>"+e(a.version)+'</td><td><button data-version="'+e(a.version)+'" class="btn btn-sm btn-primary btn-Rollback"><span class="text">'+e(d("rollback"))+'</span><span class="icon icon-loading-spinner"></span></button></td></tr>'}),f+=""):f+='<tr class="warning"><td colspan="2">'+e(d("empty"))+"</td></tr>",f+="</tbody>"),f+="</table>"}(b.loading,b.versions)}}),define("properties/ItemExperimentVersion",["zero/zero","zero/declare","../properties/ItemBase","../midway/properties/itemExperimentVersion","../ajax/experiment","../ajax/experimentMeta","../global/event","../global/notify","../i18n"],function(a,b,c,d,e,f,g,h,i){"use strict";var j={btnRollback:".btn-Rollback"},k={loading:"loading"},l=i.translate;return b("properties/ItemExperimentVersion",[c],{constructor:function(b){var d=this,b=b||{};c.prototype.constructor.call(d,b);var e=a.bind(d.reload,d);setTimeout(e,10),d._renderLoading(),d._setup()},reload:function(){var a=this;if(!a.destroyed)return e.queryGraph(a.master.experimentId).then(function(b){a._renderTable(b)}),a},_renderLoading:function(){var a=this;return a.$wrap.addClass("dms-prop-item-version-table"),a.$inputWrap.html(d({loading:!0})),a},_renderTable:function(a){var b=this;return b.$wrap.addClass("dms-prop-item-version-table"),b.$inputWrap.html(d(a)),b},_setup:function(){var a=this;return a.$inputWrap.on("click",j.btnRollback,function(){if(!a.reverting){a.reverting=!0;var b=$(this);b.addClass(k.loading),f.revertToVersion(a.master.experimentId,b.attr("data-version")).then(function(a){a.label=a.name,a.parentId=a.parentDir,g.createExperimentTreeNode(a,{id:a.parentId}),g.tryOpenExperiment({id:a.experimentId,name:a.name}),b.removeClass(k.loading),h.success(l("rollbackSuccess"))},function(){b.removeClass(k.loading),h.error(l("rollbackFailure"))})}}),a}})}),define("global/form",[],function(){"use strict";function a(a){return $(a).find("input,select,textarea")}function b(a,c,d){var e=c[0];return a[e]=a[e]||{},1===c.length?a[e]=d:(c.shift(),b(a[e],c,d)),a}function c(a,b,c){var d=c?a.filter(b+":checked"):a.find(b+":checked");return{value:d.val(),text:d.parents("[bd-each]").length>0?"":d.data("text")||""}}function d(a,b,c){a.find(b).each(function(){this.checked=this.value===c})}function e(a,b,c){var d=c?a.filter(b+":checked"):a.find(b+":checked"),e=[],f=[],g=d.parents("[bd-each]").length>0;return d.each(function(){var a=$(this),b=a.data("text")||"";e.push(a.val()),b&&!g&&f.push(b)}),{value:e,text:f}}function f(a,b,c){if(c){var d=a.find(b),e=c.split(",");d.each(function(){this.checked=-1!==e.indexOf(this.value)})}}function g(a,b,c){var d=c?a.filter(b+" option:selected"):a.find(b+" option:selected");return{value:d.val(),text:d.parents("[bd-each]").length>0?"":d.html()||""}}return{form2json:function(d){var f,h=$(d.element),i=d.selectorProp||"name",j={},k=!1;h.length>0&&["INPUT","TEXTAREA","SELECT"].indexOf(h[0].tagName)>-1?(f=h,k=!0):f=a(h);for(var l=0;l<f.length;l++){var m,n,o=f[l],p=o.value,q=o.type,r="",s="";if(o.getAttribute(i)&&(r=o.getAttribute(i),s="["+i+'="'+r+'"]'),""!==r)if(m=r.match(/([^\.]+)/g),n=[].concat(m),"radio"===q||"checkbox"===q||"select-one"===q){var t;switch(o.type){case"radio":t=c(h,s,k);break;case"checkbox":t=e(h,s,k);break;case"select-one":t=g(h,s,k)}b(j,m,t.value),t.text.length>0&&(n[n.length-1]+="SelectedText",b(j,n,t.text))}else b(j,m,p)}return j},json2form:function(b){for(var c=$(b.element),e=b.selectorProp||"name",g=a(c),h=b.data,i=0;i<g.length;i++){var j,k,l=g[i];l.getAttribute(e)&&(j=l.getAttribute(e),k="["+e+'="'+j+'"]'),"INPUT"===l.tagName&&"radio"===l.type?d(c,k,_.get(h,j)):"INPUT"===l.tagName&&"checkbox"===l.type?f(c,k,_.get(h,j)):c.find(k).val(_.get(h,j))}}}}),define("midway/properties/itemFillMissingValueSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="dms-prop-fill-missing"><div class="dms-prop-subgroup" data-role="double"><h5>DOUBLE</h5><div class="dms-prop-item"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">原值</span></label></div><div class="dms-prop-input" data-role="origin"></div></div><div class="dms-prop-item"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">替换为</span></label></div><div class="dms-prop-input" data-role="replace_as"></div></div><div class="dms-prop-item dms-prop-item-string hidden" data-role="user-defined-container"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">自定义值</span></label></div><div class="dms-prop-input" data-role="user-defined"></div></div></div><div class="dms-prop-subgroup" data-role="bigint"><h5>BIGINT</h5><div class="dms-prop-item"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">原值</span></label></div><div class="dms-prop-input" data-role="origin"></div></div><div class="dms-prop-item"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">替换为</span></label></div><div class="dms-prop-input" data-role="replace_as"></div></div><div class="dms-prop-item dms-prop-item-string hidden" data-role="user-defined-container"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">自定义值</span></label></div><div class="dms-prop-input" data-role="user-defined"></div></div></div><div class="dms-prop-subgroup" data-role="string"><h5>STRING</h5><div class="dms-prop-item"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">原值</span></label></div><div class="dms-prop-input" data-role="origin"></div></div><div class="dms-prop-item dms-prop-item-string hidden" data-role="user-defined-container"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">自定义值</span></label></div><div class="dms-prop-input" data-role="user-defined"></div></div><div class="dms-prop-item dms-prop-item-string"><div class="dms-prop-label"><label for=""><span class="dms-prop-label-text">替换为</span></label></div><div class="dms-prop-input" data-role="replace_as"></div></div></div></div>'}}),define("properties/ItemFillMissingValueSelect",["zero/zero","zero/declare","../i18n","../global/form","./ItemBase","../midway/properties/itemFillMissingValueSelect","../midway/properties/itemSelect","../midway/properties/itemString","../midway/properties/itemNumber"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=(c.translate,{double:'[data-role="double"]',bigint:'[data-role="bigint"]',string:'[data-role="string"]',origin:'[data-role="origin"]',replaceAs:'[data-role="replace_as"]',userDefined:'[data-role="user-defined"]',userDefinedContainer:'[data-role="user-defined-container"]',subGroup:".dms-prop-subgroup"}),k={hidden:"hidden"},l={ORIGIN:[{text:"Null",value:"null"}],REPLACE_AS:[{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Mean",value:"mean"},{text:"自定义",value:"user-defined"}]},m={ORIGIN:[{text:"Null",value:"null"}],REPLACE_AS:[{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Mean",value:"mean"},{text:"自定义",value:"user-defined"}]},n={ORIGIN:[{text:"Null",value:"null"},{text:"空字符",value:"empty"},{text:"Null 和 空字符",value:"null-empty"},{text:"自定义",value:"user-defined"}],REPLACE_AS:[{text:"自定义",value:"user-defined"}]},o={DoubleRule:"DOUBLE",IntegerRule:"BIGINT",StringRule:"STRING"};return b("properties/ItemFillMissingValueSelect",[e],{subGroupMap:{},displayTypes:["DOUBLE","BIGINT","STRING"],constructor:function(a){var b=this;e.prototype.constructor.call(b,a);try{a.value&&(b.defaultValue=JSON.parse(a.value))}catch(a){console.error(a)}return b.render(),b.bindEvents(),b.setDefaultDisplay(),b.setDefaultValue(),b},render:function(){var a=this;a.$container=$(f(a.metadata)).appendTo(a.$inputWrap),a.$doubleContainer=a.$container.find(j.double),a.$bigintContainer=a.$container.find(j.bigint),a.$stringContainer=a.$container.find(j.string),a.subGroupMap.DOUBLE=a.$doubleContainer,a.subGroupMap.BIGINT=a.$bigintContainer,a.subGroupMap.STRING=a.$stringContainer,a.renderDouble(),a.renderBigint(),a.renderString()},reload:function(a){var b=this,c=b.getSelectedTypes(a.selectedFields);b.display(c),b.onBlur()},getSelectedTypes:function(a){var b=a.map(function(a){return a.type});return _.uniq(b)},setDefaultDisplay:function(){var a,b=this;b.defaultValue&&(a=Object.keys(b.defaultValue).filter(function(a){return!b.defaultValue[a].isHide}).map(function(a){return o[a]}),b.display(a))},display:function(a){var b=this;b.displayTypes=a,Object.keys(b.subGroupMap).forEach(function(c){-1!==a.indexOf(c)?b.subGroupMap[c].show():b.subGroupMap[c].hide()})},renderDouble:function(){var a=this;a.doubleOriginContainer=a.$doubleContainer.find(j.origin),a.doubleReplaceAsContainer=a.$doubleContainer.find(j.replaceAs),a.doubleUserDefinedContainer=a.$doubleContainer.find(j.userDefined),a.doubleOriginContainer.append(g({options:l.ORIGIN,id:"DoubleRule.origin_type"})),a.doubleReplaceAsContainer.append(g({options:l.REPLACE_AS,id:"DoubleRule.replaced_type"})),a.doubleUserDefinedContainer.append(i({id:"DoubleRule.replaced_value",value:""}))},renderBigint:function(){var a=this;a.bigintOriginContainer=a.$bigintContainer.find(j.origin),
a.bigintReplaceAsContainer=a.$bigintContainer.find(j.replaceAs),a.bigintUserDefinedContainer=a.$bigintContainer.find(j.userDefined),a.bigintOriginContainer.append(g({options:m.ORIGIN,id:"IntegerRule.origin_type"})),a.bigintReplaceAsContainer.append(g({options:m.REPLACE_AS,id:"IntegerRule.replaced_type"})),a.bigintUserDefinedContainer.append(i({id:"IntegerRule.replaced_value",value:""}))},renderString:function(){var a=this;a.stringOriginContainer=a.$stringContainer.find(j.origin),a.stringReplaceAsContainer=a.$stringContainer.find(j.replaceAs),a.stringUserDefinedContainer=a.$stringContainer.find(j.userDefined),a.stringOriginContainer.append(g({options:n.ORIGIN,id:"StringRule.origin_type"})),a.stringUserDefinedContainer.append(h({id:"StringRule.origin_value",value:""})),a.stringReplaceAsContainer.append(h({id:"StringRule.replaced_value",value:""}))},bindEvents:function(){var a=this;a.$container.on("change","select",a.onSelectChange.bind(a)),a.$container.on("blur","input",a.onBlur.bind(a))},onBlur:function(){var a=this;a.isChanged=!0,a.change()},onSelectChange:function(a,b){var c,d=this,e=$(a.currentTarget);c=e.parents(j.subGroup).find(j.userDefinedContainer),c.toggleClass(k.hidden,"user-defined"!==e.val()),b||(d.isChanged=!0,d.change())},change:function(){var a=this;return a.validate()&&a.notifyChange.call(a.master,a),a},validate:function(){return!0},getValue:function(){var a,b=this;return a=d.form2json({element:b.$container,selectorProp:"id"}),a=b.isHide(a),JSON.stringify(a)},setDefaultValue:function(){var a=this;a.defaultValue&&(d.json2form({element:a.$container,selectorProp:"id",data:a.defaultValue}),a.$container.find("select").trigger("change",!0))},isHide:function(a){var b=this;return Object.keys(a).forEach(function(c){a[c].isHide=-1===b.displayTypes.indexOf(o[c])}),a}})}),define("midway/properties/itemOssUrlString",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g){var h='<div>GPU计算资源在上海，建议您使用华东地区&nbsp;OSS&nbsp;域名，<a href="https://help.aliyun.com/document_detail/31837.html?spm=5176.2020520105.147.4.1suQya" target="_blank">点击查看</a></div><div class="dms-prop-ossurl"><div class="oss-url-header"><span>https://OSS_bucket.</span></div><div class="oss-url-path"><input type="text"id="'+d(a)+'"value="'+d(b)+'"placeholder="'+d(c||"")+'"'+d(e?" disabled ":"")+d(void 0!==f?"maxlength="+f+" ":"")+'class="form-control"></div>';return g||(h+='<span class="oss-url-bnt-clear btn-clear icon-close-o"></span>'),h+="</div>"}(b.id,b.value,b.placeholder,b.isDisabled,b.max,b.isEditMode)}}),define("properties/ItemOssUrlString",["zero/zero","zero/declare","../properties/ItemBaseString","../midway/properties/itemOssUrlString"],function(a,b,c,d){"use strict";return b("properties/ItemOssUrlString",[c],{constructor:function(a){var b=this;return a=a||{},c.prototype.constructor.call(b,a),b.$wrap.addClass("dms-prop-item-string"),b._render()._setup(),b},_render:function(a){var b=this;return b.$input=$(d(b.metadata)).appendTo(b.$inputWrap),b.$input=b.$input.find("input"),b},getValue:function(){return a.trim(this.$input.val())}})}),define("ajax/oss",["zero/zero","./base","../global/utils"],function(a,b,c){"use strict";function d(a){this.url=a}d.prototype.parse=function(){var a=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),b=this.url.match(a);return{scheme:b[2],authority:b[4],path:b[5],query:b[7],fragment:b[9]}},d.prototype.getParent=function(){var a=this.parse(),b=a.path.split("/").filter(function(a){return""!==a});return b.pop(),b=b.join("/"),b.length>0&&"/"!==b[b.length-1]&&(b+="/"),b.length>0&&"/"!==b[0]&&(b="/"+b),"/"===b[0]&&(b=b.substr(1)),b=a.scheme+"://"+(a.authority&&"/"===a.authority[a.length-1]?a.authority:a.authority+"/")+b};var e=b.create("/ram.json"),f=b.create("/oss.json");return{listRAMInfo:function(a){return e.get({action:"doListRAMInfo"},!0)},createRamRole:function(a){return e.post({action:"doCreateRAMRole",roleType:a.roleType,projectName:a.projectName,projectOwnerId:a.projectOwnerId,accessId:a.accessId,accessKey:a.accessKey,roleName:a.roleName},!0)},removeRAMRole:function(a){return e.post({action:"doRemoveRAMRole",roleId:a.roleId},!0)},queryRamRole:function(){return e.get({method:"getRole"}).then(function(a){return a?a.role:[]})},queryRamRole:function(){return e.get({method:"getRole"}).then(function(a){return a?a.role:[]})},queryListBuckets:function(a){return f.get({method:"listBuckets",nodeInstanceId:a}).then(function(a){return a&&a.buckets})},listChildren:function(a,b,c,e){return e=e||100,f.get({method:"listChildren",nodeInstanceId:a,ossUrl:b,nextMarker:c||"",limit:e}).then(function(a){return c||(a.paths=a.paths||{},a.paths.paths=a.paths.paths||[],a.paths.paths=[{name:"..",path:new d(b).getParent(),dir:!0}].concat(a.paths.paths),a.paths.paths=[{name:".",path:b,dir:!0}].concat(a.paths.paths)),a&&a.paths})},putFile:function(b){return new Promise(function(d,e){var f=new XMLHttpRequest,g=new FormData;f.open("POST","/oss.json",!0),f.onreadystatechange=function(){4==f.readyState&&200==f.status&&d(JSON.parse(f.responseText))},f.isSuccess=function(){var a=f.status;return a>=200&&a<300||304===a||!a&&"file:"===location.protocol||!a&&bomUtils.versions.safari},f.onreadystatechange=function(){if(4===f.readyState)if(f.isSuccess()){var b=f.responseText;b=a.getAny([function(){return JSON.parse(b)}])||b,d(b)}else e(f.responseText)},g.append("method","putFile"),g.append("content",b.fileContent),g.append("name",b.name),g.append("ossUrl",b.ossUrl),g.append("ctoken",c.getCookie("ctoken")),f.send(g)})}}}),define("midway/properties/itemOssRamRole",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){var f="";return f+=!a&&b?'<div class="dms-prop-ram">正在进行Oss授权检查</div>':a||!c?"<div class=\"dms-prop-ram\">您尚未设置访问&nbsp;OSS&nbsp;的默认授权，点击<a class='dms-prop-open-ram'>这里</a>进行设置。完成设置，请点击<a class='dms-prop-refresh-ram'>刷新</a>。</div>":'<div class="dms-prop-ram"><div class="dms-prop-ram-role" title="角色名称：'+d(e.roleName)+'">角色名称：'+d(e.roleName)+'</div><div class="dms-prop-ram-arn" title="ARN: '+d(e.arn)+'">ARN: '+d(e.arn)+"</div></div>",f+=""}(b.isEditMode,b.loading,b.hasRole,b.role)}}),define("midway/dialog/properties/ossOpenRamDialog",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return"<div class='row oss-open-ram'>\t<div class='col-md-1'>\t\t<i class='icon-warning warn-icon'></i>\t</div>\t<div class='col-md-11'>\t\t<div>产品需要创建访问OSS的默认角色</div>\t\t<div>OSS默认角色说明：<a target='_blank' href='https://help.aliyun.com/document_detail/49571.html#读OSSBucket'>OSS默认角色说明</a></div>\t\t<div><br /></div>\t\t<div><a href='https://ram.console.aliyun.com/#/role/authorize?request=%7B%22Requests%22%3A%20%7B%22request1%22%3A%20%7B%22RoleName%22%3A%20%22AliyunODPSPAIDefaultRole%22%2C%20%22TemplateId%22%3A%20%22PaiRole%22%7D%7D%2C%20%22ReturnUrl%22%3A%20%22https%3A//help.aliyun.com/document_detail/49571.html%23OSS%22%2C%20%22Service%22%3A%20%22ODPS%22%7D' target=\"_blank\" class=\"oss-open-ram-action\">点击前往RAM进行授权</a></div>\t</div></div>"}}),define("dialog/properties/ossOpenRamDialog",["zero/zero","zero/ui/DialogEx","../../i18n","../../midway/dialog/properties/ossOpenRamDialog"],function(a,b,c,d){"use strict";function e(){$(i.action).click(function(a){h&&h.hide()})}function f(){h=new b({title:"确认",destroyOnHide:!0,canFullscreen:!1,body:d(),afterShow:e,buttons:[{text:g("confirm"),type:"primary",click:function(){this.hide()}}]})}var g=c.translate,h=null,i={action:".oss-open-ram .oss-open-ram-action"};return{show:f}}),define("properties/ItemOssRamRole",["zero/zero","zero/declare","../ajax/oss","../properties/ItemBase.js","../midway/properties/itemOssRamRole","../dialog/properties/ossOpenRamDialog"],function(a,b,c,d,e,f){"use strict";var g={openRam:".dms-prop-open-ram",refreshRam:".dms-prop-refresh-ram"};return b("properties/ItemOssRamRole",[d],{constructor:function(a){var b=this;return a=a||{},b.dialog=f,d.prototype.constructor.call(b,a),this.load(),b},load:function(){var a=this;a.clear(),a.showLoading(),a.metadata.loading=!0,a.render().setup(),c.queryRamRole().then(function(b){a.metadata.hasRole=!!b,a.metadata.role=b,a.metadata.loading=!1,a.render().setup(),a.hideLoading()}).catch(function(){a.metadata.hasRole=!1,a.metadata.loading=!1,a.render().setup(),a.hideLoading()})},render:function(){var a=this;return a.$inputWrap.html(e(a.metadata)),a},setup:function(){var a=this;return a.$inputWrap.find(g.openRam).on("click",function(){a.dialog.show()}),a.$inputWrap.find(g.refreshRam).on("click",function(){a.load()}),a}})}),define("midway/dialog/properties/ossBucketSelect",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e="<div class='dms-prop-ossresource'>\t<div class='oss-resource-bucket'>\t\t<div class='oss-resource-bucket-header'>\t\t\t<span>选择访问OSS Bucket</span>\t\t</div>\t\t<div class='oss-resource-bucket-selector'>\t\t\t<label class=\"select-hacker\">\t\t\t<select class=\"form-control\">\t\t";return a.each(b,function(a){e+='\t\t\t\t <option value="'+d(a.path)+'" '+d(a.selected?" selected ":" ")+" >\t\t"+d(a.name)+"\t\t\t</option>\t\t"}),e+="\t\t\t</select>\t\t\t</label>\t\t</div>\t</div>\t<div class='oss-resource-folder'>\t\t<div class='oss-resource-folder-header'>\t\t\t<span>\t\t\t\t选择文件\t\t\t</span>\t\t</div>\t\t<div class='oss-resource-folder-path'>\t\t</div>\t\t<div class='oss-resource-folder-content'>\t\t</div>\t</div>\t",c&&(e+="\t<div class='oss-resource-uploader'>\t\t<div class='oss-resource-uploader-action'>\t\t\t<button class='btn btn-primary'><span class='oss-resource-uploader-state icon-upload-l-24'></span>&nbsp;&nbsp;点击上传</button>\t\t\t<input type=\"file\" style=\"display: none;\" class=\"oss-resource-fileuploader\">\t\t</div>\t</div>\t"),e+="</div>"}(b.buckets,b.hasUploader)}}),define("midway/dialog/properties/ossBucketFile",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){return'<li class="'+d(a?"selected":"")+'" \tid="'+d(b)+'"\ttype="'+d(c?1:0)+'">\t<span class="icon '+d(c?"icon-folder":"icon-file")+'"></span>\t<span class="name" >'+d(e)+"</span></li>"}(b.selected,b.path,b.dir,b.name)}}),define("dialog/properties/ossBucketSelect",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/oss","../../midway/dialog/properties/ossBucketSelect","../../midway/dialog/properties/ossBucketFile"],function(a,b,c,d,e,f){function g(a,b,c,d,e){this.selector=a,this.pathSelector=b,this.curBucket=d,this.nodeInstanceId=e,this.reload(c)}function h(a){this.url=a}function i(){u=!1}function j(b){x=new g(y.folder,y.folderPath,s||q.path,q,b),$(y.bucket).on("change",function(){var b=this;a.each(v,function(a){a.path===b.value?(a.selected=!0,q=a):a.selected=!1}),x.reload(q.path)}),t&&($(y.uploaderBtn).on("click",function(){A||$(y.uploaderInput).click()}),$(y.uploaderInput).on("change",function(a){var b=this.files;b.length>0&&(A=!0,$(y.uploaderIcon).removeClass(z.upload),$(y.uploaderIcon).addClass(z.uploading),d.putFile({ossUrl:x.getCurPath(),name:b[0].name,fileContent:b[0]}).then(function(){b.length>0&&(o(x.getCurPath()+b[0].name),A=!1,$(y.uploaderIcon).addClass(z.upload),$(y.uploaderIcon).removeClass(z.uploading),n.hide())}).catch(function(){A=!1,$(y.uploaderIcon).addClass(z.upload),$(y.uploaderIcon).removeClass(z.uploading)}))}))}function k(){var a=x&&x.getSelectedPath();a?o(a):p(),n.hide()}function l(){n.hide()}function m(){return e({buckets:v,hasUploader:t})}var n,o,p,q,r,s,t,u,v=[],w=c.translate;g.prototype.getCurPath=function(){return this.ossUrl},g.prototype.reload=function(a){this.current={},this.isLoading=!1,this.ossUrl=a,$(this.selector).empty(),$(this.selector).html("<ul></ul>"),$(this.selector).unbind("scroll").bind("scroll",this.scrollAction.bind(this)),this.loadData().then(this.render.bind(this))},g.prototype.processResult=function(b){var c=this,d=b.paths||[],e=new h(this.ossUrl),g=e.parseCurrent(),i="";return g=g.map(function(a,b){return i+=a,a=c.curBucket.path===a?c.curBucket.name+"/":a,a=b!==g.length-1?a.replace(/\//g,"&gt;"):a.replace(/\//g,""),'<a id="'+i.replace(/(:|\.|\[|\]|,|=|@|\/)/g,"")+'" style = "cursor: default;" >'+a+"</a>"}),{content:a.map(d,function(a){var c={},d=!1;return $(this.selector).children(":first").children("li").each(function(){d=$(this).hasClass("selected")}),a.path!==r||d||(a.selected=!0),c.html=f(a),c.data=b,c}),parent:g}},g.prototype.loadData=function(){var a=this;return a.current.end?Promise.resolve(null):(a.isLoading=!0,d.listChildren(this.nodeInstanceId,this.ossUrl,a.current.nextMarker,100).then(function(b){return a.current=b,a.isLoading=!1,a.processResult(b)}))},g.prototype.render=function(b){var c=a.map(b.content,function(a){return a.html});$(this.selector).children(":first").append((c||[]).join("")),$(this.pathSelector).empty(),$(this.pathSelector).append(b.parent),$(this.pathSelector).append('<span style="color:#EEE">（返回上一级）<span>'),this.addEvents()},g.prototype.scrollAction=function(){var a=$(this.selector).scrollTop()+$(this.selector).height(),b=$(this.selector).children(":first").height();!this.isLoading&&a>=b&&!this.current.end&&this.loadData().then(this.render.bind(this))},g.prototype.addEvents=function(){var a=this;$(this.selector).children(":first").children("li").each(function(){$(this).unbind("click").bind("click",a.clickItem.bind(a,this)),$(this).unbind("dblclick").bind("dblclick",a.dblClickItem.bind(a,this))});var b=new h(this.ossUrl),c=b.parseCurrent(),d="";c.map(function(b){d+=b,$(a.pathSelector+" #"+d.replace(/(:|\.|\[|\]|,|=|@|\/)/g,"")).click(function(a){this.reload(a)}.bind(a,d))})},g.prototype.getSelectedPath=function(){var a;return $(this.selector).children(":first").children("li").each(function(){$(this).hasClass("selected")&&(a=$(this).attr("id"))}),a},g.prototype.clickItem=function(a){$(a).attr("id"),$(a).attr("type");$(this.selector).children(":first").children("li").each(function(){$(this).removeClass("selected")}),$(a).addClass("selected")},g.prototype.dblClickItem=function(a){var b=$(a).attr("id");"1"===$(a).attr("type")&&this.reload(b)},h.prototype.parse=function(){var a=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),b=this.url.match(a);return{scheme:b[2],authority:b[4],path:b[5],query:b[7],fragment:b[9]}},h.prototype.getParent=function(){var a=this.parse(),b=a.path.split("/").filter(function(a){return""!==a});return b.pop(),b=b.join("/"),b.length>0&&"/"!==b[b.length-1]&&(b+="/"),b.length>0&&"/"!==b[0]&&(b="/"+b),"/"===b[0]&&(b=b.substr(1)),b=a.scheme+"://"+(a.authority&&"/"===a.authority[a.length-1]?a.authority:a.authority+"/")+b},h.prototype.parseCurrent=function(){var a=this.parse(),b=a.path.split("/").filter(function(a){return""!==a});return b=[a.scheme+"://"+a.authority].concat(b),b=b.map(function(a){return"/"!==a[a.length-1]?a+="/":a})};var x,y={bucket:".oss-resource-bucket-selector label select",folder:".oss-resource-folder-content",folderPath:".oss-resource-folder-path",uploaderBtn:".oss-resource-uploader-action button",uploaderInput:".oss-resource-uploader-action .oss-resource-fileuploader",uploaderIcon:".oss-resource-uploader-action .oss-resource-uploader-state"},z={upload:"icon-upload-l-24",uploading:"icon-loading-spinner"},A=!1;return{show:function(c,e,f){return t=f,r=null,s=null,d.queryListBuckets(e).then(function(b){var d=!1;return a.each(b,function(a){if(new RegExp("^"+a.path,"i").test(c||"")){if(c){var b=new h(c);s=b.getParent()}r=c,d=a.selected=!0,q=a}}),!d&&b&&b.length>0&&(b[0].selected=!0,q=b[0]),b}).then(function(a){return v=a,new Promise(function(a,c){if(o=a,p=c,u)return c();u=!0,n=new b({title:"OSS资源选择",destroyOnHide:!0,canFullscreen:!1,body:m(),afterShow:function(){j.call(this,e)},afterHide:i,buttons:[{text:w("confirm"),type:"primary",click:k},{text:w("cancel"),click:l}]})})})}}}),define("properties/ItemOssResourceSelect",["zero/zero","zero/declare","../dialog/properties/ossBucketSelect","../i18n","./ItemString"],function(a,b,c,d,e){"use strict";d.translate;return b("properties/ItemOssResourceSelect",[e],{constructor:function(a){a=this.metadata=a||{},this.hasUploader=!1,e.prototype.constructor.call(this,a),this.render(),this.setup()},render:function(){this.$wrap.addClass("dms-prop-item-label-select"),this.$inputWrap.append('<span class="btn-select icon-folder"></span>')},openDialog:function(){var a=this;a.metadata.isDisabled||c.show(a.metadata.value,a.metadata.nodeInstanceId,a.hasUploader).then(function(b){if(b&&b.length){var c=a.getValue(),d=b;c!==d&&(a.setValue(d),a.isChanged=!0,a.validate()&&a.notifyChange.call(a.master,a))}}).catch(function(a){})},setup:function(){var a=this;return a.$wrap.on("click",".btn-select",function(){a.openDialog()}),a.$wrap.on("dblclick",".btn-select",function(){a.openDialog()}),a}})}),define("properties/ItemOssResourceSelectOrUpload",["zero/zero","zero/declare","../dialog/properties/ossBucketSelect","../i18n","./ItemOssResourceSelect"],function(a,b,c,d,e){"use strict";d.translate;return b("properties/ItemOssResourceSelectOrUpload",[e],{constructor:function(a){e.prototype.constructor.call(this,a),this.hasUploader=!0}})}),define("midway/properties/itemNomoTags",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<table class="table table-bordered"><thead><tr><th>标签名</th><th>说明</th></tr></thead><tbody>';return a.each(b,function(a){c+="<tr><td>"+d(a.propertyName)+"</td><td>"+d(a.propertyDesc||"")+"</td></tr>"}),c+="</tbody></table>"}(b.rows)}}),define("properties/ItemNomoTags",["zero/zero","zero/declare","../properties/ItemBase","../midway/properties/itemNomoTags"],function(a,b,c,d){"use strict";return b("properties/ItemTableColumnInfo",[c],{constructor:function(a){a=a||{},c.prototype.constructor.call(this,a);var b;try{b=JSON.parse(a.value)}catch(a){b=[]}this.$inputWrap.html(d({rows:b}))}})}),define("midway/properties/itemBaseButton",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return"<button "+d(a?" disabled ":"")+'class="btn"></button>'}(b.isDisabled)}}),define("properties/ItemBaseButton",["zero/zero","zero/declare","../properties/ItemBase","../midway/properties/itemBaseButton"],function(a,b,c,d){"use strict";return b("properties/ItemBaseButton",[c],{constructor:function(a){var b=this;return c.prototype.constructor.call(b,a),b.render().setup(),b},render:function(){var a=this;return a.$input=$(d(a.metadata,!0)).prependTo(a.$inputWrap),a},setup:function(){var a=this;return a.metadata.isDisabled?a:(a.$input.on("click",function(){a.isDisabled()||(a.hideError(),a.onClick())}),a)},onClick:function(){return this},setButtonText:function(a){var b=this;return b.$input.html(a),b}})}),define("midway/dialog/properties/selectNomoTags",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="iframe-wrap"><iframe scrolling="no" frameborder="0" width="100%" height="100%" allowtransparency="true"></iframe></div>'}}),define("dialog/properties/selectNomoTags",["zero/zero","zero/ui/DialogEx","../../i18n","../../midway/dialog/properties/selectNomoTags"],function(a,b,c,d){"use strict";function e(a){i.showLoading();var b="?experimentId="+a.experimentId+"&nodeId="+a.nodeInstanceId;i.$("iframe").attr("src",k+b).on("load",function(){i.hideLoading()})}function f(a){i.showLoading();var b=i.$("iframe")[0],c=function(b){window.removeEventListener("message",c,!1),i.hideLoading(),i.hide(),a()};window.addEventListener("message",c,!1),b.contentWindow.postMessage({type:"onPaiSave"},j)}function g(a){return new Promise(function(c){i=new b({title:"来自 NOMO 的标签",className:"dialog-select-nomo-tags",destroyOnHide:!0,canFullscreen:!1,body:d(),afterShow:function(){e.call(this,a)},buttons:[{text:h("cancel"),click:function(){this.hide()}},{text:h("confirm"),type:"primary",click:function(){f(c)}}]})})}var h=c.translate,i=null,j=window.location.hostname.indexOf("alipay.net")>=0?"http://antdataassets.stable.alipay.net":"https://antdataassets.alipay.com",k=j+"/fm/tag/favAuth.htm";return{show:g}}),define("properties/ItemSelectNomoTags",["zero/zero","zero/declare","../i18n","../global/event","../properties/ItemBaseButton","../dialog/properties/selectNomoTags"],function(a,b,c,d,e,f){"use strict";var g=c.translate;return b("properties/ItemNomoTagSelectButton",[e],{constructor:function(a){a=a||{},e.prototype.constructor.call(this,a),this.setButtonText(g("selectTags"))},onClick:function(){var a=this.master,b=a.experimentId,c=a.nodeInstanceId;return f.show({experimentId:b,nodeInstanceId:c}).then(function(){d.focusNode(b,c,!0)}),this}})}),define("ajax/globalParameter",["zero/zero","zero/json","./base"],function(a,b,c){"use strict";var d=c.create("/globalParameter.json");return{queryGlobalParameters:function(a){return d.get({method:"queryGlobalParameterConfig",experimentId:a}).then(function(a){return a&&a.configs||[]})},saveGlobalParameter:function(a,b){return d.post({method:"addOrUpdateGlobalParameterConfig",experimentId:a,config:b})},deleteGlobalParameter:function(a,b){return d.post({method:"deleteGlobalParameter",experimentId:a,placeholder:b})},updateGlobalParameterValue:function(a,b,c){return d.post({method:"updateGlobalParameterValue",experimentId:a,placeholder:b,value:c},!0)}}}),define("ajax/groupLoop",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/groupLoop.json");return{queryGroupLoopConfig:function(a,b){return c.get({method:"queryGroupLoopConfig",groupId:b,experimentId:a}).then(function(a){if(a)return a&&a.groupLoopConfig||{configStr:"",groupId:b,singleParam:!0,checkedNodes:[]}})},queryGroupLoopConfigCandidates:function(a,b){var d={method:"queryGroupLoopConfigCandidates",experimentId:a};return b&&(d.groupId=b),c.get(d).then(function(a){if(a)return a&&a.loopNodeCandidates||[]})},updateGroupLoopConfig:function(a,b,d){return c.post({method:"updateGroupLoopConfig",groupId:b,experimentId:a,loopConfigJson:JSON.stringify(d)},!0)},loopExecute:function(a,b){return c.post({method:"loopExecute",groupId:b,experimentId:a})},queryLoopExecutionStatus:function(a,b){return c.post({method:"queryLoopExecutionStatus",groupId:b,experimentId:a}).then(function(a){if(a)return a})},queryNodeLog:function(a,b,d){return c.get({method:"queryNodeLog",nodeInstanceId:b,experimentId:a,mainRecordId:d})},stopLoopExecute:function(a,b){return c.post({method:"stopLoopExecute",groupId:b,experimentId:a})}}}),define("midway/dialog/properties/globalParam",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f,g){var h='<div class="form-group"><label for="globalParamPlaceholder"><span class="required">*</span>'+e(d("placeholder"))+"</label>";return h+=a?'<input class="form-control" id="globalParamPlaceholder" maxlength="50" value="'+e(b)+'"> ':'<input class="form-control" id="globalParamPlaceholder" maxlength="50"> ',h+='<p class="help-block">在实验运行中，任何出现"占位符"的参数都会被指定的"参数值"替换</p><p class="help-block">可以使用于任何组件，如SQL、PyODPS、随机森林等</p><p class="help-block">格式：${占位符}</p></div><div class="form-group"><label for="globalParamName"><span class="required">*</span>'+e(d("paramName"))+'</label><input class="form-control" id="globalParamName" maxlength="50" value="'+e(c||"")+'"></div><div class="form-group"><label for="globalParamValue">'+e(d("paramValue"))+'</label><input class="form-control" id="globalParamValue" value="'+e(f||"")+'"></div><div class="form-group"><label for="globalParamDesc">'+e(d("paramDesc"))+'</label><input class="form-control" id="globalParamDesc" maxlength="100" value="'+e(g||"")+'"></div><div class="form-group algo-select hide"><label>'+e(d("paramScope"))+"</label></div>"}(b.isEdit,b.placeholder,b.name,b.value,b.description)}}),define("midway/dialog/properties/globalParamAlgoList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g,h){var i='<div class="algo-list"><table class="table table-bordered"><thead><tr><th>'+e(d("algoNode"))+"</th><th>"+e(d("algoParams"))+'</th><th><span class="btn-add icon icon-plus-o"> </span></th></tr></thead>',c=a.uuid();return i+="<tbody>",a.each(b,function(d,g){i+='<tr data-node-id="'+e(d.nodeId)+'" data-param-id="'+e(d.paramId)+'">';var h=[];i+='<td><label for="'+e(c+"-algo-"+g)+'" class="select-hacker"><select id="'+e(c+"-algo-"+g)+'" data-type="algo" class="form-control">',a.each(f,function(a){i+=" ",a.nodeId===d.nodeId?(i+='<option value="'+e(a.nodeId)+'" selected>'+e(a.nodeName)+"</option>",h=a.paramCandidates,i+=" "):i+='<option value="'+e(a.nodeId)+'">'+e(a.nodeName)+"</option>",i+=" "}),i+='</select></label></td><td><label for="'+e(c+"-param-"+g)+'" class="select-hacker"><select id="'+e(c+"-param-"+g)+'" data-type="param" class="form-control">',a.each(h||[],function(a){i+=" ",a.paramId===d.paramId?i+='<option value="'+e(a.paramId)+'" selected>'+e(a.paramDisplayName)+"</option>":i+='<option value="'+e(a.paramId)+'">'+e(a.paramDisplayName)+"</option>",i+=" "}),i+="</select></label></td><td>",b.length>1&&(i+='<span class="icon icon-delete btn-delete"></span>'),i+="</td></tr>"}),i+="</tbody></table></div>"}(b.selected,b.uuid,b.candidates,b.params,b.item)}}),define("dialog/properties/globalParam",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/groupLoop","../../ajax/globalParameter","../../midway/dialog/properties/globalParam","../../midway/dialog/properties/globalParamAlgoList"],function(a,b,c,d,e,f,g){"use strict";function h(a){function b(a){var b=$(a).parents("tr");return{nodeId:parseInt(b.attr("data-node-id"),10),paramId:parseInt(b.attr("data-param-id"),10)}}function c(){if(e.length&&e[0].paramCandidates.length){var a=e[0],b=a.paramCandidates[0];q.push({nodeId:a.nodeId,paramId:b.paramId})}j(e)}o.showLoading();var e=[],f={};d.queryGroupLoopConfigCandidates(a.experimentId).then(function(b){o.hideLoading(),e=b.filter(function(a){if(a.nodeId&&a.paramCandidates&&a.paramCandidates.length)return f[a.nodeId]=a,!0}),a.item?(q=a.item.checkedNodes||[],j(e)):c()}),o.$(p.algoSelect).on("click",p.btnAdd,c).on("click",p.btnDelete,function(){var a=b(this),c=a.nodeId,d=a.paramId;q.some(function(a,b){return a.nodeId===c&&a.paramId===d&&(q.splice(b,1),!0)}),j(e)}).on("change","select",function(){var a=$(this),c="algo"===a.attr("data-type"),d=parseInt(a.val(),10),g=b(this),h=g.nodeId,i=g.paramId,k=c?d:h,l=c?f[d].paramCandidates[0].paramId:d;q.some(function(a){if(a.nodeId===h&&a.paramId===i)return a.nodeId=k,a.paramId=l,!0}),j(e)})}function i(){q=[]}function j(a){o.$(p.algoSelect).find(p.algoList).remove().end().append(g({candidates:a,selected:q}))}function k(a,b){a.next(".err-msg").remove(),a.after('<div class="err-msg"><span class="icon icon-close-c"></span>'+b+"</div>"),a.one("focus",function(){a.next(".err-msg").remove()})}function l(a,b,c){var d=o.$("#globalParamPlaceholder"),f=o.$("#globalParamName"),g=d.val().trim().replace(/\s/gi,""),h=f.val().trim(),i=o.$("#globalParamValue").val().trim(),j=o.$("#globalParamDesc").val().trim();if(!g)return void k(d,n("globalParamPlaceholderMissing"));if(!h)return void k(f,n("globalParamNameMissing"));var l={},m=[];q.forEach(function(a){if(a.nodeId&&a.paramId){var b=a.nodeId+"-"+a.paramId;l[b]||(m.push(a),l[b]=!0)}}),o.showLoading(),e.saveGlobalParameter(a.experimentId,JSON.stringify({placeholder:g.replace(/\s/gi,""),name:h,value:i,description:j})).then(function(){b.isEdit&&g!==b.placeholder?e.deleteGlobalParameter(a.experimentId,b.placeholder).then(function(){c()}):c(),o.hideLoading(),o.hide()})}function m(a){var c=a.isEdit?{isEdit:!0,name:a.item.name,value:a.item.value,description:a.item.description,placeholder:a.item.placeholder}:{};return new Promise(function(d){o=new b({title:n(a.isEdit?"editGlobalParam":"addGlobalParam"),className:"dialog-props-global-param",destroyOnHide:!0,canFullscreen:!1,body:f(c),afterShow:function(){h.call(this,a)},beforeHide:i,buttons:[{text:n("cancel"),click:function(){this.hide()}},{text:n("confirm"),type:"primary",click:function(){l(a,c,d)}}]})})}var n=c.translate,o=null,p={algoSelect:".algo-select",btnAdd:".btn-add",btnDelete:".btn-delete",algoList:".algo-list",algoItem:".algo-item"},q=[];return{show:m}}),define("properties/ItemAddGlobalParams",["zero/zero","zero/declare","../i18n","../global/event","../properties/ItemBaseButton","./ItemString","../ajax/globalParameter","../dialog/properties/globalParam"],function(a,b,c,d,e,f,g,h){"use strict";var i=c.translate;return b("properties/ItemAddGlobalParams",[e],{constructor:function(a){var b=this;a=a||{},e.prototype.constructor.call(this,a),b.setButtonText(i("addGlobalParam")),b.initWrap(),setTimeout(function(){b.reload()},50)},onClick:function(){var a=this,b=a.master.experimentId;return h.show({experimentId:b}).then(function(){a.reload()}),a},initWrap:function(){var a=this;a.$list=a.$wrap.addClass("dms-prop-item-global-params").append('<div class="param-list"></div>').find(".param-list"),a.$inputWrap.append('<a href="https://lark.alipay.com/ai/pai/global-parameter" target="_blank"><i class="icon-help-o"></i></a>')},reload:function(){var b=this,c=b.master.experimentId;g.queryGlobalParameters(c).then(function(d){b.$list.empty(),(d||[]).forEach(function(d){var e={id:a.uuid(),isIndented:!1,isDisabled:!1,isRequired:!1,tooltip:d.placeholder,longTooltip:d.description||"",label:d.name||"",name:d.placeholder,value:_.unescape(d.value||""),defaultValue:"",placeholder:""},h=new f(e);h.$wrap.find(".dms-prop-label").append('<span class="icon icon-edit btn-edit"></span>').append('<span class="icon icon-delete btn-delete"></span>').on("click",".btn-edit",function(){b.editParam(d)}).on("click",".btn-delete",function(){g.deleteGlobalParameter(c,d.placeholder).then(function(){h.$wrap.remove()})}),h.master=b.master,h.notifyChange=b.updateParamValue.bind(b),b.$list.append(h.$wrap)})})},editParam:function(a){var b=this,c=b.master.experimentId;h.show({experimentId:c,isEdit:!0,item:a}).then(function(){b.reload()})},updateParamValue:function(a){var b=this;if(!b.destroyed&&a.isChanged){var c=a.name;if(c){var d=a.getValue(),e=b.master.experimentId;a.showLoading&&a.showLoading(),g.updateGlobalParameterValue(e,c,d).then(function(){a.hideLoading&&a.hideLoading(),a.metadata.value=d},function(b){a.hideLoading&&a.hideLoading(),b=b||{},b.errorMessage=b.errorMessage||i("updateFail"),a.showError(b.errorMessage)})}}}})}),define("ajax/git",["zero/zero","../global/notify","./base"],function(a,b,c){"use strict";var d=c.create("/git.json");return{getCandidateClass:function(a,b,c){return d.get({method:"getCandidateClass",gitProjectName:c,nodeInstanceId:a,experimentId:b},!0).then(function(a){return a.classList||[]})},getGitBaseInfoByExperiment:function(a){return d.get({method:"getGitBaseInfoByExperiment",experimentId:a},!0).then(function(a){return window.GLOBALS.onlineExpGitInfo=a.gitInfo,window.GLOBALS.gitProjectName=a.gitInfo.gitProjectName,a.gitInfo||{}})},createCrepMonitor:function(a){return d.get({method:"createCrepMonitor",experimentId:a},!0).then(function(a){return a.monitorUrl||""})},compileCrepRepo:function(a){return d.get({method:"compileCrepRepo",gitProjectName:a},!0).then(function(a){return b.success("编译成功"),!0},function(a){return b.error("编译失败"),!1})}}}),
define("properties/ItemSelectGitClass",["zero/zero","zero/declare","../properties/ItemSelect","../storage/globalCache","../ajax/git"],function(a,b,c,d,e){"use strict";return b("properties/ItemSelectGitClass",[c],{constructor:function(a){var b=this;a=b.metadata=a||{};var f=d.get("current-experiment-id"),g=a.nodeInstanceId,h=window.GLOBALS.gitProjectName;return a.loader=e.getCandidateClass(g,f,h).then(function(c){a.options=c.map(function(a){return{value:a,text:a}}),b._reload()}),c.prototype.constructor.call(b,a),b}})}),define("ajax/expSchedule",["zero/zero","../global/notify","./base"],function(a,b,c){"use strict";var d=c.create("/expschedule.json");return{getConfig:function(a){return d.get({method:"getConfig",experimentId:a},!0).then(function(a){return a.config&&a.config.crontab||"暂无"})}}}),define("properties/ItemReactModal",["zero","zero/zero","zero/declare","zero/fmt/sprintf","../i18n","../properties/ItemBase","../ajax/expSchedule","../midway/properties/itemSelectFields","../midway/properties/itemSelectFieldsPreview"],function(a,b,c,d,e,f,g,h,i){"use strict";e.translate;return c("properties/ItemReactModal",[f],{constructor:function(a){a=a||{},f.prototype.constructor.call(this,a),this.revertOnFail=!0,this._render()._setup();var b=this;setTimeout(function(a){b.queryData()},0)},queryData:function(a){var b=this;if("crontab"===b.name){var c=b.master.experimentId;g.getConfig(c).then(function(a){b.updateButtonText(a)})}},_render:function(){var a=this;return a.$wrap.addClass("dms-prop-item-selece-fields"),a.$inputWrap.html(h(a.metadata,!0)),a.$previewToggler=a.$inputWrap.find(".btn-toggle"),a.$input=a.$inputWrap.find(".btn-select"),a.$preview=a.$inputWrap.find(".preview-wrap"),a.updateButtonText(),a},_setup:function(){var a=this;return a.$input.off(),a.$input.on("click",function(){a.isDisabled()||(a.hideError(),a.onClick())}),a},onClick:function(){var a=this;console.log(a);var b=a.getValue(),c=a.master.nodeInstanceId,d=a.master.experimentId;return a.disable(),window.react_bridge.actions&&(window.react_bridge.actions.properties[a.name]&&window.react_bridge.actions.properties[a.name].get({nodeInstId:c,experimentId:d,data:a.metadata,afterClose:a.upateAfterClose()}),"_statisticOperators"===a.name&&window.react_bridge.actions.properties.operators.get({nodeInstId:c,experimentId:d,selectedColsStr:b,afterClose:a.afterClose()})),a},afterClose:function(){var a=this;return function(b,c){b?a.enable():(a.enable(),a.metadata.currentValue=c,a.setButtonText(c))}},upateAfterClose:function(){var a=this;return function(b,c){b?a.enable():(a.enable(),a.metadata.currentValue=c,a.updateButtonText(c))}},getValue:function(a){return this.metadata.currentValue||this.metadata.value},setValue:function(a,b){var c=this;return c.metadata[a]=b,c},updateButtonText:function(a){this.$input.text(a||this.metadata.placeholder||this.metadata.value||"暂无")},revert:function(){var a=this;return a.parseValue(),a.updateButtonText(),a},setButtonText:function(a){var b=this;b.metadata;return b[b.name]=a,b.isValid=!0,b.isChanged=!0,b.isChanged&&b.setValue("value",a),b.notifyChange&&b.notifyChange.call(b.master,b),b},clear:function(){this.setButtonText("")}})}),define("properties/controlMapping",["../properties/ItemLabel","../properties/ItemString","../properties/ItemPassword","../properties/ItemNumber","../properties/ItemPercent","../properties/ItemSelect","../properties/ItemMultiSelect","../properties/ItemKeyValueGenerator","../properties/ItemCheckbox","../properties/ItemTextarea","../properties/ItemCodearea","../properties/ItemSqlEditor","../properties/ItemHyperlink","../properties/ItemDatetimePicker","../properties/ItemFeatureColumnSelect","../properties/ItemFeatureColumnSelectEx","../properties/ItemSimpleMultiColSelect","../properties/ItemLabelColumn","../properties/ItemSimpleColumn","../properties/ItemWeightColumn","../properties/ItemSourceTableInput","../properties/ItemSourcePartitionCheckbox","../properties/ItemSourcePartitionsInput","../properties/ItemTargetTableInput","../properties/ItemTableColumnInfo","../properties/ItemTableSchemaEditor","../properties/ItemJoinColumnSelect","../properties/ItemColumnsOutputSelect","../properties/ItemCheckboxDisabled","../properties/ItemRDatasetDisplay","../properties/ItemTags","../properties/ItemUploader","../properties/ItemOdpsResourceSelect","../properties/ItemNfsResourceSelect","../properties/ItemVolumeSelect","../properties/ItemCaffeModelSelect","../properties/ItemCNNConfig","../properties/ItemCNNModelSelect","../properties/ItemCNNSolverStateSelect","../properties/ItemSqlFnList","../properties/ItemDeployStatus","../properties/ItemExperimentVersion","../properties/ItemFillMissingValueSelect","../properties/ItemOssUrlString","../properties/ItemOssRamRole","../properties/ItemOssResourceSelect","../properties/ItemOssResourceSelectOrUpload","../properties/ItemNomoTags","../properties/ItemSelectNomoTags","../properties/ItemAddGlobalParams","../properties/ItemSelectGitClass","../properties/ItemReactModal"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z){"use strict";return{label:a,string:b,number:d,float:d,password:c,percent:e,select:f,multiSelect:g,jsonFormatGenerator:h,checkbox:i,textarea:j,codemirror:k,sqlEditor:l,hyperlinkDisplay:m,datetime:n,sourceTableInput:u,sourcePartitionCheckbox:v,sourcePartitionsInput:w,targetTableInput:x,sqlWriteTableInput:b,targetPartitionInput:b,labelColSelect:r,simpleColSelect:s,weightColSelect:t,featureColsSelect:o,featureSelect:o,featureColsWithContinuitySelect:p,simpleMultiColSelect:q,enableSparseCheckbox:i,tableColumnInfo:y,tableSchemaEditor:z,joinColumnSelect:A,joinOutputSelect:B,columnsOutputSelect:B,fieldRelSelect:f,fieldRelColumnSelect:s,fieldRelCheckbox:i,fieldRelMultiColSelect:q,ioModeSelect:i,comRocSelectCheckbox:i,comRocColInput:b,disabledCheckbox:C,appendIdInput:b,rInputDataSetDisplay:D,keepOriginalCheckBox:i,appendRowFromCheckbox:i,appendRowColumnSelect:B,rCodeMirror:k,tags:E,uploader:F,odpsResourceSelect:G,nfsResourceSelect:H,fieldRelNumberInput:d,fieldRelStringInput:b,volumesList:I,caffeModelSelect:J,cnnModelSelect:L,cnnSolverStateSelect:M,cnnConfig:K,udfPanel:N,deployStatus:O,enablePerformanceReport:i,experimentVersion:P,fillMissingValueSelect:Q,ossUrlInput:R,ossRamRole:S,ossResourceSelect:T,ossResourceSelectOrUpload:U,nomoTags:V,selectNomoTags:W,addGlobalParam:X,classNameSelect:Y,reactModal:Z}}),define("midway/properties/propertyCompositeItem",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="dms-prop-composite"></div>'}}),define("properties/CompositeItemBase",["zero/zero","zero/declare","../midway/properties/propertyCompositeItem","../properties/controlMapping"],function(a,b,c,d){"use strict";return b("properties/CompositeItemBase",[],{constructor:function(b){var e=this;b=e.metadata=b||{},a.forEach("controlId,name,type".split(","),function(a){e[a]=b[a]||""});var f=e.$wrap=$(c()),g=e.controls=[];return a.forEach(b.controls,function(b){var c,h=b.type;if(d.hasOwnProperty(h)&&(c=d[h])&&a.isFunction(c)){var i=new c(b);i.master=e,i.notifyChange=e.onPropItemChanged,f.append(i.$wrap),g.push(i)}}),e.isValid=!0,e.isChanged=!1,e.disabled=!1,e.visible=!0,e},onPropItemChanged:function(a){return this},validate:function(){var b=this;b.isValid=!1,b.isChanged=!1,b.hideError();var c=!0;return a.forEach(b.controls,function(a){if(!(c=a.validate()))return!1}),!!c&&(b.isValid=!0,b.isChanged=!0,!0)},getValue:function(){return this.metadata.value},reload:function(){return this},showError:function(a){var b=this;return b.currentControl&&b.currentControl.showError(a),b},hideError:function(){var b=this;return a.forEach(b.controls,function(a){a.hideError()}),b},_setDisabled:function(b){var c=this,d=b?"disable":"enable";return a.forEach(c.controls,function(a){a[d]()}),c.disabled=!!b,c},enable:function(){return this._setDisabled(!1)},disable:function(){return this._setDisabled(!0)},isDisabled:function(){return this.disabled},_setVisible:function(b){var c=this,d=b?"show":"hide";return a.forEach(c.controls,function(a){a[d]()}),c.visible=!!b,c},show:function(){return this._setVisible(!0)},hide:function(){return this._setVisible(!1)},isHidden:function(){return!this.visible},clear:function(){return!1},destroy:function(){var b=this;a.forEach(b.controls,function(a){a.destroy()}),b.$wrap.off().remove(),a.destroy(b)}})}),define("properties/ItemSplitFactorsInput",["zero/zero","zero/declare","zero/fmt/sprintf","../i18n","../properties/CompositeItemBase"],function(a,b,c,d,e){"use strict";var f=Object.prototype.hasOwnProperty,g=d.translate;return b("properties/ItemSplitFactorsInput",[e],{constructor:function(a){var b=this;return a=b.preProcess(a),e.prototype.constructor.call(b,a),b.controls[b.controls.length-1].disable(),b},preProcess:function(b){function c(b){if(b){var c=b.split("\n");return c.length>1?a.map(c,function(a){return"<p>"+a+"</p>"}).join(""):c[0]}return""}var d={};b=b||{},a.forEach("controlId,id,name,type,value,label,defaultValue".split(","),function(a){d[a]=f.call(b,a)?b[a]||"":""});var e=d.controls=[];return a.forEach("defaultValue,value,label,placeholder,tooltip".split(","),function(c){var d=f.call(b,c)?b[c]||"":"";a.forEach(d.split(","),function(a,b){e[b]||(e[b]={}),e[b][c]=a})}),a.forEach(e,function(e,f){e.type="percent",e.id=d.id+"-"+f,e.min=b.min,e.max=b.max,a.forEach("value,label,placeholder,tooltip,longTooltip".split(","),function(a){e[a]=e[a]||""}),e.longTooltip&&(e.longTooltip=c(e.longTooltip))}),d},validate:function(){var b=this;if(!e.prototype.validate.call(b))return!1;b.isValid=!1,b.isChanged=!1;var c=b.metadata,d=(b.currentControl,b.controls[b.controls.length-1]),f=0;if(a.forEach(b.controls,function(a){d!==a&&(f+=a.getValue())}),f>100)return b.showError(g("splitFactorsInputOverflow",c.label)),!1;var h=100-f;return d.setValue(h),!!d.validate()&&(b.isValid=!0,b.isChanged=c.value!==b.getValue(),!0)},onPropItemChanged:function(b){var c=this;return a.forEach(c.controls,function(a){if(b!==a){var c=a.getValue();isNaN(c)&&a.setValue(a.metadata.min)}}),c.currentControl=b,c.validate()&&c.notifyChange.call(c.master,c),c},getValue:function(){var b=[];return a.forEach(this.controls,function(a){b.push(a.getValue())}),b.join(",")},clear:function(){return this}})}),define("properties/compositeControlMapping",["../properties/ItemSplitFactorsInput"],function(a){"use strict";return{splitFactorsInput:a}}),define("properties/PanelBase",["zero/zero","zero/declare","../global/utils","../midway/properties/propertiesPanel","../midway/properties/propertiesGroup","../midway/properties/propertyItemPadding","../midway/properties/propertiesLoading","../properties/controlMapping","../properties/compositeControlMapping"],function(a,b,c,d,e,f,g,h,i){"use strict";var j={workspace:"#j-workspace",container:"#j-properties",loading:".dms-prop-loading"},k={hide:"hide",big:"has-big-right-side",isOpened:"is-opened"};return a.extend(h,i),b("properties/PanelBase",[],{showLoading:function(a){function b(){$(g({message:""})).appendTo(d)}var c=this,d=c.container||j.container;return a?c.loadingTimer=setTimeout(b,a):b(),c},hideLoading:function(){var a=this,b=a.container||j.container;return clearTimeout(a.loadingTimer),$(b).children(j.loading).remove(),delete a.loadingTimer,a},show:function(){var a=this,b=a.$wrap;return b&&b.hasClass(k.hide)&&b.removeClass(k.hide),a},hide:function(){var b=this,c=b.$wrap;return c&&(c.hasClass(k.hide)||c.addClass(k.hide)),a.forEach(this.controls,function(a){a.onPanelHide&&a.onPanelHide()}),$(j.workspace).removeClass(k.big),b},renderWrap:function(a){var b=this,c=b.container||j.container;return b.$wrap=$(d(a)).appendTo(c),$(j.container).addClass(k.isOpened),b},renderTabs:function(b){var c=this,d=c.controls=[],f=c.controlsKeyMap={},g=0;return a.forEach(b,function(b){var h=c.$wrap.find("#"+b.id);a.forEach(b.groups,function(b){var i=$(e());a.forEach(b.controls,function(a){var b=c.renderControl(a);b&&(b.tabIndex=g,d.push(b),f[a.id]=a.name,i.append(c.wrapControl(b)))}),i.appendTo(h)}),g+=1}),c.insertRobotEyes(),c},insertRobotEyes:function(){var a,b,c=this,d=c.controlsKeyMap,e=c.$wrap,f="prop-item-";e.find("[id^="+f+"]").each(function(){a=$(this),void 0!==(b=a.attr("id"))&&(b=f+d[b],a.attr("data-id",b.replace(" ","")))})},renderControl:function(b){var c,d=this,e=b.type;if(h.hasOwnProperty(e)&&(c=h[e])&&a.isFunction(c)){var f=new c(b,d);return f.master=d,f.notifyChange=d.onPropItemChanged,d.afterRenderControl(f),f}},afterRenderControl:function(a){return this},wrapControl:function(a){var b=a.$wrap,c=a.metadata,d=c.depth;for(d=d&&c.isIndented?d:1;d>1;)b=$(f()).append(b),d-=1;return b},getControlById:function(b){var c=this,d=c.controlById;return d||(d=c.controlById={},a.forEach(this.controls,function(a){d[a.controlId]=a})),d[b]},doUpdate:function(b){function d(){e(),b.metadata.value=h}function e(){b.hideLoading&&b.hideLoading()}var f=this,g=b.name;if(g){var h=b.getValue(),i="update"+c.ucFirst(g),j=f[i];if(b.showLoading&&b.showLoading(),j&&a.isFunction(j)){var k=j.call(f,h);if(k&&a.isFunction(k.then))return k.then(d,e),f}return e(),f}},onPropItemChanged:function(a){var b=this;if(!b.destroyed&&a.isChanged)return b.doUpdate(a),b},reload:function(){var b=this;return a.forEach(b.controls,function(b){a.isFunction(b.reload)&&b.reload()}),b},destroy:function(){var b=this;b.$wrap&&b.$wrap.off().remove(),a.forEach(b.controls||[],function(a){a.destroy()}),a.destroy(b),b.destroyed=!0,$(j.container).removeClass(k.isOpened)}})}),define("properties/Properties4Node",["zero/zero","zero/declare","zero/ui/Tab","../global/event","../ajax/uicontrol","../i18n","../toolbox/ComponentSocial","./PanelBase"],function(a,b,c,d,e,f,g,h){"use strict";var i={show:"show",hide:"hide",enable:"enable",disable:"disable",reload:"reload"},j={propTabItem:".dms-prop-tab li",footer:".dms-prop-footer"},k=f.translate;return b("properties/Properties4Node",[h],{constructor:function(a){var b=this;return a=a||{},a.isPreview?(b.isPreview=!0,b.container=a.container,b.init(a.data)):(b.experimentId=a.experimentId,b.nodeInstanceId=a.nodeInstanceId,e.queryUiControls(a.experimentId,a.nodeInstanceId).then(function(a){b.destroyed||a&&b.init(a).show()},function(){b&&b.destroy()})),b},init:function(a){var b=this;return a.tabs&&a.tabs.length?(a.isEditMode=!1,b.nodeName=a.social.name,b.relationFromMapping=a.relationFromMapping,b.relationToMapping=a.relationToMapping,b.renderWrap(a),a.tabs.length>1&&new c({selector:b.$wrap.find(j.propTabItem),afterShow:function(a){d.switchPropTab(a)}}),b.renderTabs(a.tabs),b.setupRelations(a.relations),b):(b.$wrap=$(""),b)},renderWrap:function(a){var b=this;return h.prototype.renderWrap.call(b,a),b.socialPanel=new g(a.social),b.$wrap.find(j.footer).append(b.socialPanel.$wrap),b},renderControl:function(a){var b=this;return $.extend(a,{nodeInstanceId:b.nodeInstanceId}),h.prototype.renderControl.call(b,a)},setupRelations:function(b){var c=this;return a.forEach(b,function(a){var b=c.getControlById(a.fromId);b&&c.checkRelation(b,"",!0)}),c},getRelationById:function(a){return this.relationFromMapping[a]},checkRelation:function(b,c,d){var e=this,f=""+b.getValue(),g=e.getRelationById(b.controlId)||[];a.forEach(g,function(b){var g=c;if(!c||c===i.show||c===i.enable){if(f!==b.value)return;g=b.relation}if(g){var h=e.getControlById(b.toId),j=h&&h[g];if(a.isFunction(j)){var k;j.call(h),k||e.checkRelation(h,c||g,d)}}})},checkReload:function(b,c){var d=this,e=d.getRelationById(b.controlId)||[];return a.forEach(e,function(e){var f=e.relation;if(f===i.reload){var g=d.getControlById(e.toId);if(g){a.isString(c)&&(f=c+"Reload");var h=g[f];a.isFunction(h)&&h.call(g,b)}}}),d},revert:function(a){var b=this;return a.revertOnFail&&(a.revert(),b.checkRelation(a)),b},onUpdateFail:function(a,b){var c=this,e=c.experimentId,f=c.nodeInstanceId;return a.hideLoading&&a.hideLoading(),c.revert(a),c.checkReload(a,"after"),b&&b.errorMessage&&a.showError(b.errorMessage),d.afterPropsSaved(e,f),c.doUpdateClean(a),c},onUpdateSuccess:function(a,b){var c=this;if(!c.destroyed){var e=c.experimentId,f=c.nodeInstanceId;return a.hideLoading&&a.hideLoading(),d.afterPropsSaved(e,f),c.checkReload(a),a.delayRelation&&c.checkRelation(a),a.metadata.value=a.newValue,b&&(b.relatedNodeInstances&&d.updateNodes(e,b.relatedNodeInstances),b.id=f),c.doUpdateClean(a),c}},doUpdateClean:function(a){var b=this;return delete a.newValue,a.isUpdating=!1,a.hasUpdateQueue&&b.doUpdate(a),b.isUpdating=!1,b.hasDestroyRequest&&b.destroy(),b},doUpdate:function(b){var c=this,f=b.name;if(f){b.hasUpdateQueue=b.isUpdating;var g=c.experimentId,h=c.nodeInstanceId,i=b.getValue();b.isUpdating=!0,b.newValue=i,b.delayRelation||c.checkRelation(b),b.showLoading&&b.showLoading(),c.checkReload(b,"before"),d.beforePropsSaving(g,h),c.isUpdating=!0,e.validateParam(g,h,f,""+i).then(function(d){d&&d.errorMessage?c.onUpdateFail(b,d):e.updateParam(g,h,f,""+i).then(a.bind(c.onUpdateSuccess,c,b),function(a){a=a||{},a.errorMessage=a.errorMessage||k("updateFail"),c.onUpdateFail(b,a)})},a.bind(c.onUpdateFail,c,b))}},onPropItemChanged:function(a,b){var c=this;if(!c.destroyed&&a.isChanged){if(b){var d=c.debounceTimers;d||(d=c.debounceTimers={});var e=d[a.controlId];e&&clearTimeout(e),d[a.controlId]=setTimeout(function(){c.doUpdate(a)},500)}else c.doUpdate(a);return c}},destroy:function(){var a=this;a.isUpdating?(a.hasDestroyRequest=!0,a.hide()):(a.socialPanel&&a.socialPanel.destroy&&a.socialPanel.destroy(),h.prototype.destroy.call(a))}})}),define("properties/Properties4Link",["zero/zero","zero/declare","./PanelBase","../i18n","../global/event"],function(a,b,c,d,e){"use strict";var f=a.each,g=d.translate,h={tabs:[{name:g("linkProperties"),groups:[{name:"group",controls:[{type:"string",label:g("comment"),name:"comment",placeholder:g("commentPlaceholder"),tooltip:"",longTooltip:"",min:0,max:33,isRequired:!1,isIndented:!1,isDisabled:!1}]}]}]};return b("properties/Properties4Link",[c],{constructor:function(a){return this.link=a,this.data=a.data,this.linkId=a.id,this.render()},render:function(){var a=this.processData();return this.renderWrap(a),this.renderTabs(a.tabs),this},processData:function(){var b=this.data,c=$.extend(!0,{},h);return c.isEditMode=!1,f(c.tabs,function(c){c.id=a.uuid(),f(c.groups,function(c){f(c.controls,function(c){c.id=a.uuid(),c.value=b[c.name]||""})})}),c},updateComment:function(a){this.link.canvas.updateLinkComment(this.link,a)}})}),define("midway/properties/globalParamTips",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="global-param-tips ui-popup bottom right"><h4>全局参数上线啦～</h4><p class="tip-text"><a href="https://lark.alipay.com/ai/pai/global-parameter" target="_blank">'+e(d("viewIntro"))+'<i class="icon icon-help-o"></i></a></p></div>'}()}}),define("midway/workspace/selectExperIntro",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="select-experiment ui-popup bottom center out"><h5>'+e(d("clickToSwitchExperiment"))+"</h5></div>"}()}}),define("midway/workspace/searchNodesIntro",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="search-node-tips ui-popup bottom right out"><h5>点击搜索定位画布中的节点</h5></div>'}}),define("global/newFeatureIntro",["zero/zero","../i18n","../midway/properties/globalParamTips","../midway/workspace/selectExperIntro","../midway/workspace/searchNodesIntro"],function(a,b,c,d,e){"use strict";var f={hasShowGlobalParamTips:c,selectExperiment:d,searchNodes:e};return function(a){var c=a.storageKey,d=f[c];if(d&&!localStorage.getItem(c)){var e=$(d());return e.append('<button class="btn btn-primary btn-know">'+b.translate("gotIt")+"</button>").find(".btn-know").on("click",function(){e.remove(),localStorage.setItem(c,!0)}).end().appendTo(a.$parent),e}}}),define("storage/openedExperimentsCache",["zero/zero","../global/config","./cacheBase"],function(a,b,c){"use strict";var d=c.create("opened-experiments");return d.add=function(b){return a.isArray(b)||(b=[b]),a.each(b,function(a){d.set(a.id,a)}),b},d}),define("properties/Properties4Experiment",["zero/zero","zero/declare","zero/ui/Tab","./PanelBase","../global/event","../global/environment","../global/newFeatureIntro","../storage/openedExperimentsCache","../i18n","../ajax/experiment","../ajax/globalParameter"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=a.each,m=i.translate,n={tabs:[{name:m("experimentProperties"),groups:[{name:"",controls:[{type:"label",label:m("projectName"),name:"projectName",isRequired:!0,isIndented:!1,isDisabled:!1},{type:"label",label:m("createDate"),name:"createDate",isRequired:!0,isIndented:!1,isDisabled:!1},{type:"string",label:m("name"),name:"name",placeholder:m("inputFilename"),min:1,max:33,isRequired:!0,isIndented:!1,isDisabled:!1},{type:"textarea",label:m("description"),name:"description",placeholder:m("descriptionPlaceholder"),min:0,max:1024,isRequired:!1,isIndented:!1,isDisabled:!1}]}]},{name:m("globalParam"),groups:[{name:"",controls:[{type:"addGlobalParam",name:"addGlobalParam",isRequired:!1,isIndented:!1,isDisabled:!1}]}]}]};return b("properties/Properties4Experiment",[d],{constructor:function(a){this.experiment=a,this.experimentId=a.id,this.render()},render:function(){var a=this.processData();return this.renderWrap(a),a.tabs.length>1&&new c({selector:this.$wrap.find(".dms-prop-tab li")}),this.renderTabs(a.tabs),g({storageKey:"hasShowGlobalParamTips",$parent:this.$wrap.find(".dms-prop-tab")}),this},processData:function(){var b=this,c=b.experiment,d=$.extend(!0,{},n);return f.isInternal&&!window.GLOBALS.isOnline&&(d.tabs[0].groups[0].controls.splice(2,0,{type:"deployStatus",name:"deployStatus",label:"",tooltip:"",longTooltip:"",isRequired:!1,isIndented:!1,isDisabled:!1}),d.tabs[0].groups[0].controls.push({type:"datetime",name:"bizDate",label:"bizDate",tooltip:"",longTooltip:"",placeholder:"YYYY-MM-DD HH:mm:ss",isRequired:!1,isIndented:!1,isDisabled:!1},{name:"crontab",label:"实验定时执行",value:"暂无",tooltip:"点击配置cron表达式",type:"reactModal",isRequired:!0,isIndented:!1,isDisabled:!1})),window.GLOBALS.isOnline&&d.tabs[0].groups[0].controls.push({type:"textarea",label:"git-Repo",name:"gitRepo",value:window.GLOBALS.onlineExpGitInfo.gitHttpUrl,isRequired:!1,isIndented:!1,isDisabled:!1}),d.isEditMode=!1,l(d.tabs,function(b){b.id=a.uuid(),l(b.groups,function(b){l(b.controls,function(b){b.id=a.uuid(),b.value=b.value||c[b.name]||"",b.tooltip=b.tooltip||"",b.longTooltip=b.longTooltip||"",b.placeholder=b.placeholder||"","createDate"!==b.name&&"projectName"!==b.name||(b.tooltip=b.value)})})}),d},afterRenderControl:function(a){return a&&"name"===a.metadata.name&&(this.propNameControl=a),this},setExperimentName:function(a){return this.propNameControl&&this.propNameControl.setValue(a),this},updateName:function(a){var b=this.experimentId;return j.updateName(b,a).then(function(){return e.renameExperiment(b,a),!0})},updateDescription:function(a){var b=this.experimentId;return j.updateDesc(b,a).then(function(){var c=h.get(b);return c&&(c.description=a),!0})},updateBizDate:function(a){var b=this.experimentId,c=h.get(b);if(!c||c.bizDate!==a)return a||j.deleteBizDate(b),j.updateBizDate(b,a).then(function(){return c&&(c.bizDate=a),!0})},updateProjectName:function(a){this.data.tabs[0].groups[0].controls[0].value=a,j.changeExperimentProject(this.experimentId,a)}})}),define("properties/resizeBar",["zero/zero","../layout/container"],function(){"use strict";function a(){var a=$(document);h.on("mousedown",j.resizeBar,function(){a.on("mousemove"+k,_.throttle(b,10)),a.on("mouseup"+k,c)}),$(window).on("resize",function(){e=$(this).width();var a=$(j.nodeSearch);e<1281?(h.width(f),i.css("right",f),a.hasClass("search")&&a.css("right",f),window.react_bridge&&window.react_bridge.actions.tabs.common.toggleToolbox({hideTool:!0})):(i.css("right",h.width()+f),a.hasClass("search")&&a.css("right",h.width()+f),window.react_bridge&&window.react_bridge.actions.tabs.common.toggleToolbox({hideTool:!1}))})}function b(a){var b=e-a.clientX,c=b-f,d=g+c;return m>b?(h.width(m),void i.css("right",m-f+g)):l<b?(h.width(l),void i.css("right",l-f+g)):(h.width(b),void i.css("right",d))}function c(){$(document).off(k)}function d(){i=$(j.bpmn),h=$(j.container),e=n.width(),g=parseInt(i.css("right"),10),f=h.width(),a()}var e,f,g,h,i,j={container:".pai-side-right",resizeBar:".resize-bar",bpmn:"#j-bpmn",nodeSearch:".node-search-block"},k=".properties-resize",l=550,m=280,n=$(window);d()}),define("properties/main",["zero/zero","zero/json","../storage/focusCache","../storage/persistence","../global/event","../properties/Properties4Node","../properties/Properties4Link","../properties/Properties4Experiment","../properties/resizeBar"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){return r&&r.experimentId&&r.nodeInstanceId}function k(){return q&&q.linkId}function l(){return s&&s.experimentId}function m(){j()&&r.hide()}function n(){k()&&q.hide()}function o(){l()&&s.hide()}function p(){l()&&(s.destroy(),s=null),j()&&(r.destroy(),r=null),k()&&(q.destroy(),q=null)}var q=null,r=null,s=null;e.onExperimentOpened(function(a){p(),s=new h(a)}),e.onExperimentClosed(p),e.onCanvasFocused(function(){if(n(),m(),l()){s.show();var a=s.experimentId;c.hasKey(a)&&c.del(a)}}),e.onNodeFocused(function(a,b,d){if(o(),n(),j()){if(!d&&a===r.experimentId&&b===r.nodeInstanceId)return r.show();var e=r;e.hide(),setTimeout(function(){e.destroy()},50)}r=new f({experimentId:a,nodeInstanceId:b}),c.set(a,{nodeInstanceId:b})}),e.onLinkFocused(function(a,b){o(),m();var d=b.id;if(k()){if(d===q.linkId)return q.show();q.destroy()}q=new g(b),c.set(a,{linkId:d})}),e.onPropsReload(function(a,b){j()&&a===r.experimentId&&b===r.nodeInstanceId&&(r.destroy(),r=new f({experimentId:a,nodeInstanceId:b}))}),e.onReloadExperimentProps(function(a){l()&&a===s.experimentId&&s.reload()}),e.onExperimentRenamed(function(a,b){s&&s.experimentId===a&&s.setExperimentName(b)})}),define("ajax/document",["zero/zero","./base"],function(a,b){"use strict";function c(b){var c=a.map(b&&b.documentList||[],function(a){var b={id:a.id,name:a.name,parentId:a.parentDir,projectName:a.projectName,deployStatus:a.deployingStatus};return a.isDir?(b.isBranch=!0,b.isExpanded=!1):b.experimentId=a.experimentId,b}),d=[];return a.each(c,function(a){!0!==a.isBranch&&d.push(a)}),a.each(c,function(a){!0===a.isBranch&&d.push(a)}),d}var d=b.create("/document.json");return{createDirectory:function(a,b){return d.post({method:"createDocumentDir",name:a,parentDirId:b}).then(function(a){return a.documentId})},createNode:function(a,b,c,e){return d.post({method:"createDocumentNode",name:a,description:b,parentDirId:c,projectName:e},!0).then(function(a){var b=a.documentNode;return b.parentId=b.parentDir,b.label=b.name,b})},getChildren:function(a,b){var e={method:"listDocumentDir"};return b?e.name=b:e.documentDirId=a,d.get(e).then(c)},query:function(a){return d.get({method:"queryDocument",documentId:a})},rename:function(a,b){return d.post({method:"renameDocument",documentId:a,newName:b})},renameSharedExperiment:function(a,b){return d.post({method:"renameSharedExperiment",experimentId:a,newName:b})},move:function(a,b){return d.post({method:"moveDocumentNode",documentId:a,targetDirId:b})},moveSharedExperiment:function(a,b){return d.post({method:"moveSharedExperiment",targetDirId:b,sharedExperimentId:a})},deleteNode:function(a){return d.post({method:"deleteDocumentNode",documentId:a})},deleteSharedExperiment:function(a){return d.post({method:"deleteSharedExperiment",experimentId:a})},deleteDirectory:function(a){return d.post({method:"deleteDocumentDir",documentId:a})},copyNode:function(a,b){return d.post({method:"copyDocumentNode",documentId:a,targetId:b})},copyDirectory:function(a,b){return d.post({method:"copyDocumentDir",documentId:a,targetId:b})},locateExperiment:function(a){return d.get({method:"revealInTree",experimentId:a}).then(function(a){return a&&a.parentIds||[]})},locateExperimentByModel:function(a){return d.get({method:"revealInTreeByModelId",modelId:a}).then(function(a){return a&&a.ids||[]})},querySharedExperiment:function(){return d.get({method:"querySharedExperiment"}).then(function(a){return a&&a.experiments||[]})},queryChildren:function(a){return d.get({method:"listAllDocumentDir",documentDirId:a}).then(c)},isOnlineExperiment:function(a){return d.get({method:"isOnlineLearningExperiment",experimentId:a}).then(function(a){return window.GLOBALS.isOnline=!!a.isOnlineExperiment,window.GLOBALS.monitorUrl=a&&a.monitorUrl,a&&a.isOnlineExperiment})}}}),define("midway/workspace/notice",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,e,f){var g='<div class="pai-notice '+d(a)+" "+d(b?"closeable":"")+" "+d(e?"bordered":"")+'">'+c(f)+" ";return b&&(g+='<span class="btn-close">×</span>'),g+="</div>"}(b.type,b.closeable,b.bordered,b.content)}}),define("global/notice",["zero/zero","../midway/workspace/notice"],function(a,b){function c(a,c,e){$(d.container).addClass("has-notice").find(d.instance).remove().end().prepend(b($.extend({},c,{content:a,type:e}))),c.closeable&&$(d.container).find(d.instance).on("click",".btn-close",function(){$(d.container).removeClass("has-notice").find(d.instance).remove()})}var d={container:"#j-bpmn",instance:".pai-notice"};return{warn:function(a,b){c(a,b,"warn")},info:function(a,b){c(a,b,"info")},error:function(a,b){c(a,b,"error")},success:function(a,b){c(a,b,"success")}}}),define("global/prefetch",["zero/zero","../ajax/common"],function(a,b){"use strict";var c=b.getProjectList();return{getProjectList:function(){return c}}}),define("midway/workspace/metadata",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<div class="pai-bpmn-metadata"><label>'+e(d("projectName"))+'</label><div class="box"><span class="text">'+e(b)+'</span><i class="arrow"></i><ul class="pai-dropdown">';return a.each(c,function(a){f+=" ",b===a.text?f+='<li class="selected" data-value="'+e(a.value)+'"><span class="icon icon-ok-l i-checked"></span><span class="text-item">'+e(a.text)+"</span></li>":f+='<li data-value="'+e(a.value)+'"><span class="icon icon-ok-l i-checked"></span><span class="text-item">'+e(a.text)+"</span></li>",f+=" "}),f+='<li class="add-odps"><span class="text-item">'+e(d("addODPSProject"))+"</span></li></ul></div></div>"}(b.currentProject,b.projectList)}}),define("ajax/dataSource",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/datasource.json");return{searchTable:function(a,b,d,e){return c.get({method:"searchTablesByKeyword",projectName:a,keyword:b,pageNum:d,pageSize:e},!0).then(function(a){return a?a.tableList||[]:[]})},queryFavorite:function(a){return c.get({method:"queryFavoriteTables",projectName:a}).then(function(a){return a&&a.tables||[]})},addToFavorite:function(a,b){return c.post({method:"addFavoriteTable",projectName:a,tableName:b}).then(function(a){return a&&a.id||0})},removeFromFavorite:function(a){return c.post({method:"deleteFavoriteTable",id:a}).then(function(a){return a?a.tableList||[]:[]})},getConfig:function(){return c.get({method:"queryDataSourceDefaultConfig"},!0).then(function(a){return a&&a.dataSourceConfig||{}})},createDataSource:function(a,b,d,e){return c.post({method:"createUserDataSource",createProjectName:a,accessId:b,accessKey:d,endpoint:e})},addTableToGraph:function(a,b,d,e,f){return c.post({method:"addOdpsSourceToGraph",isGlobalDataSource:f,experimentId:a,tableName:b,posX:d,posY:e})},
updateTableNameOnGraph:function(a,b,d){return c.post({method:"updateOdpsSourceInputTable",tableName:d,experimentId:a,nodeInstanceId:b})},deleteDataSource:function(a,b){return c.post({method:"deleteDataSource",projectName:a,tableName:b},!0)},deleteDataSourceConfig:function(a){return c.post({method:"deleteUserDataSourceConfig",datasourceId:a})},queryPublicDatasets:function(a,b){return c.get({method:"queryPublicDatasets",pageNum:a,pageSize:b}).then(function(a){return a&&a.publicDatasets||[]})}}}),define("midway/dialog/datasource/addODPSProject",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<form><div class="form-group"><label for="txtAccessId">'+e(d("accessId"))+'</label><input type="text" class="form-control" name="accessId" id="txtAccessId"placeholder="" disabled></div><div class="form-group"><label for="txtAccessKey">'+e(d("accessKey"))+'</label><input type="password" class="form-control" name="accessKey"id="txtAccessKey"placeholder="" disabled></div><div class="form-group"><label for="txtProjectName">'+e(d("odpsProjectName"))+'</label><input type="text" class="form-control" name="odpsProjectName"id="txtProjectName"placeholder=""></div><div class="form-group"><label for="txtODPSEndpoint">'+e(d("odpsEndpoint"))+'</label><input type="text" class="form-control" name="odpsEndpoint"id="txtODPSEndpoint"placeholder=""></div></form>'}()}}),define("dialog/datasource/addODPSProject",["zero/zero","zero/ui/DialogEx","../../i18n","../../global/utils","../../global/event","../../ajax/dataSource","../../midway/dialog/datasource/addODPSProject"],function(a,b,c,d,e,f,g){"use strict";function h(){var a=this;n=$(p.deployModal),m=!!n,m&&n.hide(),a.showLoading(),l=a.$("form").on("keydown",function(a){if(13===a.keyCode)return!1}).validate({rules:{accessId:{required:!0,letter:!0},accessKey:{required:!0,letter:!0},odpsProjectName:{required:!0,xss:!0},odpsEndpoint:{required:!0,url:!0}}}),f.getConfig().then(function(b){a.$(p.accessId).val(b.accessId||""),a.$(p.accessKey).val(b.accessKey||""),a.$(p.endpoint).val(b.odpsEndpoint||""),a.hideLoading()},function(){a.hideLoading()})}function i(){m&&(n.show(),n.parent().css("background","rgba(0,0,0,.5)"))}function j(){var a=this;if(l.form()){var b=a.$(p.accessId).val(),c=a.$(p.accessKey).val(),d=a.$(p.projectName).val(),e=a.$(p.endpoint).val();f.createDataSource(d,b,c,e).then(function(){window.location.reload()})}setTimeout(function(){i()},10)}function k(){new b({title:o("addODPSProject"),className:"dialog-add-odps-project",destroyOnHide:!0,body:g(),beforeShow:h,buttons:[{text:o("OK"),type:"primary",click:j},{text:o("cancel"),click:function(){this.hide(),i()}}]})}var l,m,n,o=c.translate,p={deployModal:".dialog-deploy",accessId:"#txtAccessId",accessKey:"#txtAccessKey",projectName:"#txtProjectName",endpoint:"#txtODPSEndpoint"};return{show:k}}),define("workspace/metadata",["zero","zero/zero","zero/ui/Confirm","../global/prefetch","../ajax/experiment","../midway/workspace/metadata","../dialog/datasource/addODPSProject"],function(a,b,c,d,e,f,g){"use strict";var h=a.Popup,i={container:"#j-bpmn",metadata:".pai-bpmn-metadata",addODPS:".add-odps"};return{show:function(a){d.getProjectList().then(function(b){function d(){m.find(".box").addClass("is-open"),$(document.body).on("click.switch-project",j)}function j(){m.find(".box").removeClass("is-open"),$(document.body).off(".switch-project")}var k,l={currentProject:a.projectName,projectList:b.projectList.map(function(a){return{text:a.name,value:a.name}})},m=$(i.container).prepend(f(l)).find(i.metadata);m.on("click",".box",function(){return $(this).hasClass("is-open")?j():d(),!1}).on("click","li",function(){j();var b=$(this);if(b.hasClass("add-odps"))g.show();else if(!b.hasClass("selected")){var d=b.attr("data-value");c({title:"切换项目",body:"确定将当前项目切换为：<strong>"+d+'</strong>？<p style="color:#ff6600">切换项目可能会导致中间数据和模型不可用，请谨慎操作！</p>',onAccept:function(){e.changeExperimentProject(a.id,d).then(function(){m.find(".box .text").text(d),b.siblings(".selected").removeClass("selected"),b.addClass("selected")})}})}return!1}).on("mouseover",i.addODPS,function(a){k||(k=new h({element:a.target,content:"找不到你的项目，可以手动添加",escape:!1,position:"right middle",align:"center",gap:2,onHidden:function(){k=null,setTimeout(this.destroy.bind(this),10)}}),k.delayedShow())})})},hide:function(){$(i.container).find(i.metadata).remove()}}}),define("midway/dialog/model/selectPublishModel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="form-horizontal"><div class="form-group"><label for="modelList" class="col-xs-3 control-label">选择部署模型</label><div class="col-xs-9"><label for="modelList" class="select-hacker"><select id="modelList" class="form-control target-project"></select></label></div></div></div>'}}),define("dialog/model/selectPublishModel",["zero/zero","zero/ui/DialogEx","../../i18n","../../midway/dialog/model/selectPublishModel","../../ajax/modelTree"],function(a,b,c,d,e){"use strict";function f(){var b=this;b.showLoading(),e.queryOwnModels(0,j).then(function(c){i=c.models;var d=a.map(i||[],function(a){return'<option data-id="'+a.id+'">'+a.name+"</option>"}).join("");b.$(k.modelList).html(d),b.hideLoading()})}function g(){}function h(a){j=a.expId,new b({title:a.title,className:"dialog-select-model",destroyOnHide:!0,body:d(),beforeShow:f,afterShow:function(){},afterHide:g,buttons:[{text:"下一步",type:"primary",click:function(){var b=this.$(k.modelList).find("option:selected").attr("data-id"),c=i.find(function(a){return a.id==b});c&&(a.okFun(c),this.hide())}},{text:l("cancel"),click:function(){this.hide()}}]})}var i,j,k={modelList:"#modelList"},l=c.translate;return{show:h}}),define("midway/workspace/toolbar",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f,g,h,i,j){var k="";return a&&!b&&(k+='<li class="btnDeploy deploy-item disabled hide '+e(c?"":"has-guide水哥说暂时屏蔽")+'" data-id="btnDeploy"><span class="icon icon-upload-l-24"></span><span class="text">'+e(d("deploy"))+'</span><ul class="pai-dropdown main-dropdown ui-popup out ui-transition top left"><li class="drop-item">离线任务<ul class="pai-dropdown sub-dropdown"><li id="forD2Tooltip"><a href="http://d2.alibaba-inc.com" target="_blank"><span class="text-item">D2</span></a><a href="https://lark.alipay.com/ai/pai/d2-experiment-deploy" class="help-icon" target="_blank"><span class="icon icon-help-o"></span></a></li><li class="deploy-mydata"><span class="text-item">金数宝</span><a href="https://lark.alipay.com/ai/pai/deploy-to-jinshubao" class="help-icon" target="_blank"><span class="icon icon-help-o"></span></a></li>',a&&f&&(k+='<li class="deploy-tmall"><a href="http://radon.tmall.com/deploy/mountPaiExperiment.htm?experimentId='+e(g)+"&userNumber="+e(h)+'&target=_blank"  target="_blank"><span class="text-item">供应链引擎</span></a></li>'),k+='</ul></li><li class="drop-item">在线任务<ul class="pai-dropdown sub-dropdown">',k+='<li class="btnDeployODPS">ODPS</li><li class="btnDeployOnService">数据市场</li></ul></li></ul><div class="deploy-guide"><div class="inner"><div class="header">部署为预测服务</div><p>支持实验直接部署为预测服务，您选定“预测”节点后点击部署，系统根据您所选定的预测节点裁剪部署分支，确定无误后发布为线上服务。</p><footer><a href="https://lark.alipay.com/laixiang.bx/doc/yijianbushu-od" target="_blank">文档详情</a><button type="button" class="btn btn-sm btn-primary">知道了</button></footer></div></div></li><li class="btnUnDeploy deploy-item disabled hide" data-id="btnUnDeploy"><span class="icon icon-publish-stop-24"></span><span class="text">'+e(d("unDeploy"))+'</span></li><li class="btnDeploying deploy-item disabled hide" data-id="btnDeploying"><div class="icon-piler"><span class="icon icon-publish-l-24"></span><span class="icon icon-rotating icon-publish-run-24"></span></div><span class="text">'+e(d("deploying"))+'</span></li><li class="btnPushDeploy deploy-item disabled hide"><a href="" target="_blank"><span class="icon icon-upload-l-24"></span><span class="text">'+e(d("pushDeploy"))+"</span></a></li>"),k+=" ",b?k+='\x3c!-- 在线实验相关 --\x3e<li class="onlineCompileLoading disabled online-exp-item disabled hide" title="正在编译ing" data-id="btnExecute"><span class="icon icon-loading-spinner"></span><span class="text">编译中</span></li><li class="onlineBtnCompile online-exp-item disabled hide" title="编译GitRepo中的Class" data-id="btnExecute"><span class="icon icon-publish-l-24"></span><span class="text">编译</span></li><li class="onlineBtnSubmit online-exp-item disabled hide" title="提交OnlineLearning实验" data-id="btnExecute"><span class="icon icon-upload-l-24"></span><span class="text">提交运行</span></li><li class="onlineBtnKill online-exp-item disabled hide" title="停止OnlineLearning" data-id="btnExecute"><span class="icon icon-stop-o-24"></span><span class="text">'+e(d("stop"))+'</span></li><li class="onlineBtnLog online-exp-item disabled hide" title="查看日志" data-id="btnExecute"><span class="icon icon-analysis"></span><span class="text">'+e(d("viewLog"))+'</span></li><li class="onlineBtnMonitor online-exp-item disabled hide" title="跳转查看监控" data-id="btnExecute"><span class="icon icon-report-24"></span><span class="text link">查看监控</span></li>':(k+='\x3c!-- 执行相关 --\x3e<li class="btnExecute execute-item disabled hide" title="'+e(d("executeToolTips"))+'" data-id="btnExecute"><span class="icon icon-run-o-24"></span><span class="text">'+e(d("execute"))+'</span></li><li class="btnReExecute execute-item disabled hide" title="'+e(d("recoverExeToolTips"))+'" data-id="btnReExecute"><span class="icon icon-rerun-24"></span><span class="text">'+e(d("recoverExe"))+'</span></li><li class="btnStop execute-item disabled hide" data-id="btnStop"><span class="icon icon-stop-o-24"></span><span class="text">'+e(d("stop"))+"</span></li>",j||(k+='<li class="btnReport" data-id="btnReport" title="'+e(d("viewModuleReportTips"))+'"><span class="icon icon-report-24"></span><span class="text">'+e(d("viewModuleReport"))+"</span></li>"),k+=" ",i&&a&&(k+='<li class="modelDoc" data-id="modelDoc" title="'+e(d("modelDocTip"))+'"><span class="icon icon-analysis"></span><span class="text">'+e(d("modelDoc"))+"</span></li>"),k+=" "),k+=""}(b.isInternal,b.isOnlineExperiment,b.hideDeployGuide,b.isTmall,b.expId,b.userId,b.isAntUser,b.hideModuleReport)}}),define("workspace/toolbar",["zero","zero/zero","zero/ui/Dropdown","../storage/persistence","../storage/globalCache","../global/utils","../global/event","../global/Track","../global/environment","../global/newFeatureIntro","../i18n","../dialog/model/selectPublishModel","../dialog/model/publishModel","../dialog/model/publishModelResult","../midway/workspace/toolbar","../ajax/experiment","../ajax/git"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(){var b=$(C.container).on("click"+A,C.dlScale,function(){$(this).toggleClass(D.isOpened)}).on("click"+A,C.dlScaleItem,function(){var a=parseFloat($(this).attr("data-value"));a&&g.canvasScaleTo(a,a)});$(document).on("click"+A,function(a){var b=$(C.container).find(C.toolbarCanvas).find(C.dlScale),c=$(a.target);!$(C.nodeSearchBlock).hasClass("search")||c.hasClass("search-keyword")||c.parent().hasClass("pai-dropdown")||($(C.nodeSearchBlock).removeClass("search").css("right",0).find(".btn-clear").click(),$(C.btnSearchNodes).parents(".pai-bpmn-toolbars").removeClass("search")),!b.length||b.is(a.target)||$.contains(b[0],a.target)||b.removeClass(D.isOpened)}),g.onCanvasScaled(function(a){$(C.container).find(C.toolbar).find(C.currentScale).text(Math.round(100*a)+"%")}),b.on("click",C.deployGuide,function(a){a.stopPropagation()}).on("click",C.deployGuide+" .btn",function(){d.set(d.keys.hideDeployGuide,!0),b.find(C.btnDeploy).removeClass("has-guide")}),b.on("click",C.benchmarkGuide,function(a){a.stopPropagation()}).on("click",C.benchmarkGuide+" .btn",function(){d.set(d.keys.hideBenchmarkGuide,!0);var c=b.find(C.btnBenchmark);c.removeClass("has-guide"),new a.Popup(c,{position:"middle top",align:"center",content:"模型优化,对比优化算法与参数配置"})})}function s(a){var b=$(a);return!b.hasClass(D.disabled)&&(b.addClass(D.disabled),!0)}function t(){$(C.container).find(C.btnExecute).addClass(D.disabled)}function u(){$(C.container).find(C.btnSubmit).addClass(D.disabled)}function v(a){return!!window.GLOBALS.isOnline||a}function w(){var a;return function(c){clearTimeout(a),a=setTimeout(function(){p.searchNodesByKeywords(e.get(e.keys.currentExperimentId),c).then(function(a){var d=a.nodes;if(g.searchedNode(d),!d.length&&c)return void $(C.searchResult).html("<li>抱歉，没有相关节点</li>");$(C.searchResult).html(b.map(d,function(a){return'<li data-id="'+a.id+'">'+a.name+"</li>"})).find("li").on("mouseenter",function(){g.toggleNodeClass($(this).attr("data-id"),"hovered",!0)}).on("mouseout",function(){g.toggleNodeClass($(this).attr("data-id"),"hovered",!1)}).on("click",function(){g.selectSearchedNode($(this).attr("data-id"))})})},300)}}var x,y=k.translate,z=f.log,A=".experiment-toolbar",B=".experiment-bottom-toolbar",C={wrap:"#j-container",container:"#j-bpmn",toolbar:".pai-bpmn-toolbar",toolbarExp:".pai-toolbar-experiment",toolbarCanvas:".pai-bnpm-actions",executeItem:".execute-item",deployItem:".deploy-item",onlineItem:".online-exp-item",btnBenchmark:".btnBenchmark",btnExecute:".btnExecute",btnSubmit:".onlineBtnSubmit",btnCompile:".onlineBtnCompile",btnCompileLoading:".onlineCompileLoading",btnMonitor:".onlineBtnMonitor",btnKill:".onlineBtnKill",btnLog:".onlineBtnLog",btnReExecute:".btnReExecute",btnStop:".btnStop",benchmarkGuide:".benchmark-guide",deployGuide:".deploy-guide",btnDeploy:".btnDeploy",btnDeployMyData:".deploy-mydata",btnDeployAsService:".btnDeployAsService",btnDeployODPS:".btnDeployODPS",btnDeployOnService:".btnDeployOnService",btnUnDeploy:".btnUnDeploy",btnDeploying:".btnDeploying",btnPushDeploy:".btnPushDeploy",deploySub:".btnDeploy .pai-dropdown li",forD2Tooltip:"#forD2Tooltip",searchKeyWord:"#searchKeyWord",searchInput:".search-keyword",nodeSearchBlock:".node-search-block",clearSearch:".node-search-block .btn-clear",searchResult:".node-search-block .pai-dropdown",btnReport:".btnReport",modelDoc:".modelDoc",btnShare:".btnShare",btnAddRemark:".btnAddRemark",btnGroupLoop:".btnGroupLoop",btnUnGroup:".btnUnGroup",btnGroup:".btnGroup",btnUnGroup:".btnUnGroup",btnGroupLoop:".btnGroupLoop",btnSearchNodes:".btnSearchNodes",btnZoomIn:".btnZoomIn",btnZoomOut:".btnZoomOut",btnRealSize:".btnRealSize",btnFitScreen:".btnFitScreen",btnAreaSelect:".btnAreaSelect",btnFullscreen:".btnFullscreen",btnExecuteSelectedNodes:".btnExecuteSelectedNodes",btnRollbackDeleteNode:".btnRollbackDeleteNode",btnLocateExperiment:".btnLocateExperiment",btnLocateModel:".btnLocateModel",text:".text",dlScale:".current-scale",dlScaleItem:".current-scale li",currentScale:".current-scale .current-value"},D={hide:"hide",selected:"selected",disabled:"disabled",isOpened:"is-opened",isFullscreen:"is-fullscreen"},E="",F="",G=!1;return G||(r(),G=!0),g.onReceivedStatus(function(a,b){if(E!==a.status||b){E=a.status;var c=D.disabled+" "+D.hide,d=$(C.container).find(C.toolbarExp).removeClass(D.hide);switch(d.find(C.executeItem).addClass(c),d.find(C.onlineItem).addClass(c),d.find(C.btnLog).removeClass(c),d.find(C.btnCompile).removeClass(c),d.find(C.btnMonitor).removeClass(c),E){case"running":d.find(C.btnStop).removeClass(c),d.find(C.btnKill).removeClass(c);break;case"preparing":d.find(C.btnExecute).removeClass(D.hide),d.find(C.btnKill).removeClass(D.hide);break;case"runningAndPreparing":d.find(C.btnStop).removeClass(D.hide),d.find(C.btnKill).removeClass(D.hide);break;case"default":default:d.find(C.btnExecute).removeClass(c),d.find(C.btnSubmit).removeClass(c)}}}),g.onDeployTick(function(a,b){a&&(F=a);var c=D.disabled+" "+D.hide,d=$(C.container).find(C.toolbarExp).removeClass(D.hide);d.find(C.deployItem).addClass(c);var e=b&&b.sourceType||0;if(1===e||2===e)d.find(C.btnPushDeploy).removeClass(c).find("a").attr("href",b.callBackUrl);else switch(F){case"-2":case"-1":d.find(C.btnDeploy).removeClass(c).find(C.text).text(y("deploy"));break;case"0":d.find(C.btnDeploying).removeClass(D.hide);break;case"1":d.find(C.btnDeploy).removeClass(c).find(C.text).text(y("reDeploy")),d.find(C.btnUnDeploy).removeClass(c)}}),g.onExecuteExperiment(u),g.onExecuteExperiment(t),g.onReExecuteExperiment(t),g.onExecuteFromNode(t),g.onExecuteToNode(t),g.onExecuteNode(t),g.onHighlightDeployNode(function(){$(C.container).find(C.toolbarExp).addClass(D.hide)}),g.onUnHighlightDeployNode(function(){$(C.container).find(C.toolbarExp).removeClass(D.hide)}),g.onSelectNodes(function(a){x=a,$(C.container).find(C.btnExecuteSelectedNodes).toggleClass("disabled",v(0===x.length))}),g.onToggleGroupLoop(function(a){$(C.container).find(C.btnGroupLoop).toggleClass("disabled",v(a))}),g.onToggleGroup(function(a){$(C.container).find(C.btnGroup).toggleClass("disabled",v(a))}),g.onToggleUnGroup(function(a){$(C.container).find(C.btnUnGroup).toggleClass("disabled",v(a))}),{enable:function(a){var b=this;b.enableBottomToolbar(),b.enableCanvasToolbar()},reloadBottomToolbar:function(a){var b=this;$(C.container).off(B).find(C.toolbarExp).html(o(a)),b.enableBottomToolbar()},enableBottomToolbar:function(b){$(C.container).on("click"+B,C.btnLog,function(){window.react_bridge&&window.react_bridge.actions&&window.react_bridge.actions.analysis.log.getOnlineLearningLog({experimentId:e.get(e.keys.currentExperimentId)})}).on("click"+B,C.btnMonitor,function(a){a.preventDefault(),a.stopPropagation();var b=$(this);if(s(this)){var c=e.get(e.keys.currentExperimentId);q.createCrepMonitor(c).then(function(a){a&&(window.open(a,"_blank"),window.react_bridge.actions.showLink(a))}).finally(function(){b.removeClass(D.disabled)})}}).on("click"+B,C.btnSubmit,function(){s(this)&&g.executeExperiment()}).on("click"+B,C.btnCompile,function(){var a=$(this).siblings(C.btnCompileLoading),b=$(this);s(this)&&(b.addClass("hide"),a.removeClass("hide"),q.compileCrepRepo(window.GLOBALS.gitProjectName).finally(function(){a.addClass("hide"),b.removeClass(D.hide),b.removeClass(D.disabled)}))}).on("click"+B,C.btnExecute,function(){s(this)&&(s($(this).siblings(C.btnReExecute)[0]),g.executeExperiment(),z("c132.d1"))}).on("click"+B,C.btnKill,function(){s(this)&&g.stopExecution(),z("c132.d2")}).on("click"+B,C.btnReExecute,function(){s(this)&&(s($(this).siblings(C.btnExecute)[0]),g.reExecuteExperiment())}).on("click"+B,C.btnStop,function(){s(this)&&g.stopExecution()}).on("click"+B,C.btnBenchmark,function(){g.selectBenchmark()}).on("click"+B,C.btnDeployMyData,function(){var a=$(this).parents(C.btnDeploy);s(a)&&(s(a.siblings(C.btnUnDeploy)),g.deployExperiment())}).on("click"+B,C.btnDeployODPS,function(){$(this).parents(C.btnDeploy);l.show({title:y("publishModel"),expId:e.get(e.keys.currentExperimentId),okFun:function(a){if(a.hasOnlineModel){new n(a).show()}else{new m(a).show()}}})}).on("click"+B,C.btnDeployOnService,function(){$(this).parents(C.btnDeploy);l.show({title:"部署到OneService",expId:e.get(e.keys.currentExperimentId),okFun:function(a){window.open("https://aiengine.alibaba.com/model/?apimodelid="+a.id,"_blank")}})}).on("click"+B,C.btnDeployAsService,function(a){a.stopPropagation(),g.selectDeployNode()}).on("click"+B,C.deploySub,function(a){$(this).index()<2&&a.stopPropagation()}).on("click"+B,C.btnUnDeploy,function(){s(this)&&(s($(this).siblings(C.btnDeploy)),g.unDeployExperiment())}).on("click"+B,C.btnReport,function(){g.generateReport({reportType:"module"})}).on("click"+B,C.modelDoc,function(){var a=e.get(e.keys.currentExperimentId);window.open("/modelReport/config/1?experimentId="+a,"_blank")}).on("click"+B,C.btnShare,function(){s(this)&&(s($(this).siblings(C.btnShare)),g.yunqiShare())}),i.isInternal&&!window.GLOBALS.isOnline&&new a.Popup(C.forD2Tooltip,{position:"middle center",align:"center",escape:!1,content:y("d2Tooltip")})},enableCanvasToolbar:function(){$(C.container).on("click"+A,C.btnAddRemark,function(){g.addRemark(0,0)}).on("click"+A,C.btnZoomIn,function(){g.zoomInCanvas(),z("c131.d1")}).on("click"+A,C.btnZoomOut,function(){g.zoomOutCanvas(),z("c131.d2")}).on("click"+A,C.btnFitScreen,function(){g.fitToWindow(),z("c131.d3")}).on("click"+A,C.btnRealSize,function(){g.restoreActualSize(),z("c131.d4")}).on("click"+A,C.btnFullscreen,function(){$(C.wrap).toggleClass(D.isFullscreen)}).on("click"+A,C.btnRollbackDeleteNode,function(){g.rollbackDeleteNode(e.get(e.keys.currentExperimentId)),z("c130.d1")}).on("click"+A,C.btnAreaSelect,function(){var a=$(this);a.toggleClass(D.selected),g.switchDragOrSelectMode(a.hasClass(D.selected)),z("c130.d2")}).on("click"+A,C.btnExecuteSelectedNodes,function(){$(this).hasClass("disabled")||g.executeNodes(x),z("c130.d3")}).on("click"+A,C.btnGroup,function(){$(this).hasClass("disabled")||(g.createGroup(),z("c130.d4"))}).on("click"+A,C.btnUnGroup,function(){$(this).hasClass("disabled")||(g.splitGroup(),z("c130.d5"))}).on("click"+A,C.btnGroupLoop,function(){$(this).hasClass("disabled")||(g.groupLoop(),z("c130.d6"))}).on("click"+A,C.btnLocateExperiment,function(){window.react_bridge.actions&&(window.react_bridge.actions.tabs.common.set({activeKey:"experiments"}),window.react_bridge.actions.tabs.experiments.openExperiment({experimentId:e.get(e.keys.currentExperimentId)})),z("c130.d7")}).on("click"+A,C.btnLocateModel,function(){window.react_bridge.actions&&!window.GLOBALS.isOnline&&(window.react_bridge.actions.tabs.common.set({activeKey:"experiments"}),window.react_bridge.actions.tabs.experiments.openModelByExpId({experimentId:e.get(e.keys.currentExperimentId)})),z("c130.d8")}).on("click"+A,C.btnSearchNodes,function(a){var b=$(this).parents(".pai-bpmn-toolbars");$(this).find(".search-node-tips .btn-know").click(),b.addClass("search"),$(C.nodeSearchBlock).addClass("search").css("right",$(C.container).css("right")).find(C.searchInput).focus(),a.stopPropagation(),z("c130.d9")}).find(C.toolbarCanvas).removeClass(D.disabled).end().find(C.toolbarExp).removeClass(D.disabled),$(C.clearSearch).on("click",function(a){$(this).siblings(C.searchKeyWord).val("").parent().siblings(C.searchResult).html(""),g.searchedNode([]),a.stopPropagation()}),$(C.searchKeyWord).on("keyup",function(a){var c=b.trim($(this).val());return w()(c),z("c130.d10",{keyWord:c}),!1}),E=""},disable:function(){$(C.container).off(A).off(B).find(C.toolbarCanvas).addClass(D.disabled).end().find(C.toolbarExp).addClass(D.disabled).addClass(D.hide),E=""}}}),define("midway/workspace/statusSucceed",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b){return'<span class="text-highlight">'+e(d("startTime"))+':</span><span class="text-gray">'+e(a)+'</span><span class="text-highlight">'+e(d("elapsed"))+':</span><span class="text-gray">'+e(b)+'</span><span class="text-highlight">'+e(d("succeed"))+'</span><span class="icon icon-ok-o text-success"></span>'}(b.start,b.elapsed)}}),define("midway/workspace/statusFailed",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b){return'<span class="text-highlight">'+e(d("startTime"))+':</span><span class="text-gray">'+e(a)+'</span><span class="text-highlight">'+e(d("elapsed"))+':</span><span class="text-gray">'+e(b)+'</span><span class="text-highlight">'+e(d("failed"))+'</span><span class="icon icon-close-c text-danger"></span>'}(b.start,b.elapsed)}}),define("midway/workspace/statusStopping",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<span class="text-highlight">'+e(d("stopping"))+'</span><span class="icon icon-loading-spinner"></span>'}()}}),define("midway/workspace/statusExecuting",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b){return'<span class="text-highlight">'+e(d("startTime"))+':</span><span class="text-gray">'+e(a)+'</span><span class="text-highlight">'+e(d("elapsed"))+':</span><span class="text-gray text-tick">'+e(b)+'</span><span class="text-highlight">'+e(d("executing"))+'</span><span class="icon icon-loading-spinner"></span>'}(b.start,b.elapsed)}}),define("midway/workspace/statusInitializing",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<span class="text-highlight">'+e(d("initializing"))+'</span><span class="icon icon-loading-spinner"></span>'}()}}),define("midway/workspace/statusPreparing",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){var b='<span class="text-highlight">'+e(d("preparing"))+"</span> ";return""!==a&&(b+='<span class="text-highlight">'+e(100*a.toFixed(2)+"%")+"</span> "),b+='<span class="icon icon-loading-spinner"></span>'}(b.preProcess)}}),define("workspace/statusBar",["zero/zero","../midway/workspace/statusSucceed","../midway/workspace/statusFailed","../midway/workspace/statusStopping","../midway/workspace/statusExecuting","../midway/workspace/statusInitializing","../midway/workspace/statusPreparing","../ajax/experiment","../global/utils","../global/event"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){q&&(clearTimeout(q),q=null),p=!1}function l(a){return i.padLeft(a,2,"0")}function m(a){a=a>0?a:0;var b,c,d;return d=a/1e3,b=Math.floor(d/3600),d%=3600,c=Math.floor(d/60),d=Math.floor(d%60),l(b||0)+":"+l(c||0)+":"+l(d||0)}var n={statusBar:"#j-bpmn .pai-bpmn-status",textTick:".text-tick"},o={hide:"hide"},p=!1,q=null,r={status:-1,show:function(){$(n.statusBar).removeClass(o.hide)},hide:function(){k(),$(n.statusBar).addClass(o.hide).empty()},initializing:function(){k(),$(n.statusBar).html(f()).removeClass(o.hide)},preparing:function(a){k();var b={preProcess:a};$(n.statusBar).html(g(b)).removeClass(o.hide)},executing:function(a){function b(){var a=m(d);g.text(a),d+=1e3,q=setTimeout(b,1e3)}if(!p){var c=a.start,d=a.time,f=m(d),g=$(n.statusBar).html(e({start:c,elapsed:f})).removeClass(o.hide).find(n.textTick);b(),p=!0}},stopping:function(){k(),$(n.statusBar).html(d()).removeClass(o.hide)},success:function(a){k();var c=new Date(a.start),d=new Date(a.end),e=m(d-c);c=a.start,$(n.statusBar).html(b({start:c,elapsed:e})).removeClass(o.hide)},failed:function(a){k();var b=new Date(a.start),d=new Date(a.end),e=m(d-b);b=a.start,$(n.statusBar).html(c({start:b,elapsed:e})).removeClass(o.hide)}};return j.onReceivedStatus(function(a){var b=a.status;if(r.status=b,"preparing"===b||"runningAndPreparing"===b){var c="";a.preProcess&&(c=a.preProcess),r.preparing(c)}else r.hide()}),r}),define("global/desktopNotify",["zero/zero"],function(a){"use strict";var b={hasPermission:function(){return window.Notification&&"granted"===Notification.permission},requestPermission:function(a){window.Notification&&"granted"!==Notification.permission?Notification.requestPermission(function(b){Notification.permission!==b&&(Notification.permission=b),"granted"===b&&a&&a()}):b.hasPermission()&&a&&a()},show:function(c,d,e){if(b.hasPermission()){d=d||{},d.lang="en_US"===a.CONFIG.locale?"en-US":"zh-CN",d.icon=APP_PATHS.assetsBase+"images/logo.png";var f=new Notification(c,d);e&&a.merge(f,e)}else b.requestPermission(function(){b.show(c,d)})}};return b}),define("storage/userSettings",["zero/zero","./cacheBase"],function(a,b){"use strict";var c=b.create("userSettings");return c.hasDesktopNotify=function(){return c.get("runResultNotifyType","").split(",").indexOf("desktop")>=0},c}),define("ajax/execution",["zero/zero","./base"],function(a,b){"use strict";function c(b){return"running"===b.status&&a.forEach(b.instStatus,function(a,c){b.instStatus[c]=b.status}),"failed"===b.status&&(window.react_bridge.actions&&window.react_bridge.actions.canvas.alert.show(),a.forEach(b.instStatus,function(a,c){b.instStatus[c]="ready"}),b.status="default"),"success"===b.status&&(a.forEach(b.instStatus,function(a,c){b.instStatus[c]="success"}),b.status="default"),b}var d=b.create("/execution.json");return{executePreCheck:function(a){return d.get({method:"executePreCheck",experimentId:a},!0).then(function(a){return a&&a.checkRes})},executeOnline:function(a){return d.post({method:"executeExperimentByType",executeType:21,experimentId:a})},execute:function(a){return d.post({method:"executeExperimentByType",executeType:1,experimentId:a})},queryOnlineLearningExecutionStatus:function(a){return d.get({method:"queryOnlineLearningExecutionStatus",experimentId:a},!0).then(function(a){return a&&window.GLOBALS.isOnline?c(a):a})},executeFromUnsuccess:function(a){return d.post({method:"executeExperimentByType",executeType:2,experimentId:a})},executeFromNode:function(a,b){return d.post({method:"executeExperimentByType",executeType:3,experimentId:a,nodeInstanceId:b})},executeToNode:function(a,b){return d.post({method:"executeExperimentByType",executeType:4,experimentId:a,nodeInstanceId:b})},executeNode:function(a,b){return d.post({method:"executeExperimentByType",executeType:5,experimentId:a,nodeInstanceId:b})},executePmml:function(a,b){return d.post({method:"executeExperimentByType",executeType:6,nodeInstanceId:b,experimentId:a})},tryExecuteAll:function(a){return d.post({method:"executeExperimentByType",executeType:7,experimentId:a})},tryExecuteFromNode:function(a,b){return d.post({method:"executeExperimentByType",executeType:8,experimentId:a,nodeInstanceId:b})},tryExecuteToNode:function(a,b){return d.post({method:"executeExperimentByType",executeType:9,experimentId:a,nodeInstanceId:b})},tryExecuteNode:function(a,b){return d.post({method:"executeExperimentByType",executeType:10,experimentId:a,nodeInstanceId:b})},stopExperiment:function(a){return d.post({method:"stopExperimentExecution",experimentId:a})},stopExecuteNode:function(a,b){return d.post({method:"stopNodeExecution",experimentId:a,nodeInstanceId:b})},queryNodeLog:function(a,b,c){var e={method:"queryNodeLog",experimentId:a,nodeInstanceId:b};return c&&(e.jobId=c),d.get(e)},queryExecutionStatus:function(a){return d.get({method:"queryExecutionStatus",experimentId:a},!0)},executeMultiNodes:function(a,b){return d.post({method:"executeMultiNodes",experimentId:a,nodeInstanceIds:b.join(",")})}}}),define("workspace/statusTicker",["zero/zero","../i18n","../global/event","../global/utils","../global/notify","../global/desktopNotify","../storage/openedExperimentsCache","../storage/userSettings","../ajax/execution"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){var c=b.groupStatus||{},d=a.keys(c),g=!1;if(a.some(d,function(a){return"running"===c[a]&&(g=!0),g}),("default"!==b.status||g)&&(m=setTimeout(a.bind(t.tick,t),o)),b.errorMessage&&(e.error(b.errorMessage),h.hasDesktopNotify())){var i="experiment-"+p+"-execute-result",j='"'+q+'"'+n("executeFailed");f.show(n("expExeFailed"),{tag:i,body:j+"\n"+b.errorMessage})}t.broadcast()}function k(a){return d.padLeft(a,2,"0")}function l(a){a=a>0?a:0;var b,c,d;return d=a/1e3,b=Math.floor(d/3600),d%=3600,c=Math.floor(d/60),d=Math.floor(d%60),k(b||0)+":"+k(c||0)+":"+k(d||0)}var m,n=b.translate,o=3e3,p=0,q="",r=null,s=!1,t={init:function(a){p=a.id,q=a.name,s=!0},tick:function(){m&&clearTimeout(m),window.GLOBALS.isOnline?i.queryOnlineLearningExecutionStatus(p).then(function(a){if(!a)return a;r=a,j(a)}):i.queryExecutionStatus(p).then(function(a){if(!a)return a;r=a,j(a)})},broadcast:function(b){if(r){c.broadcastStatus(r,b);var d=r.instStatus,e=r.execInfo,f=r.groupStatus||{};if(!d)return;var g=[];a.each(d,function(a,b){
var c=e[b];c.lastTime>=0&&(c.lastTime=l(c.lastTime)),c.name=c.name||"",c.defName=c.defName||"",g.push({id:b,execStatus:c,nodeInstanceStatus:a||""})}),a.each(a.keys(f),function(a){g.push({isGroup:!0,id:a,status:f[a]})}),c.updateNodes(p,g)}else t.tick()},clean:function(){m&&(clearTimeout(m),m=0),r=null,p=0}};return t}),define("workspace/progressBarDag",["zero/zero","zero/ui/progress","../storage/persistence","../global/event"],function(a,b,c,d){"use strict";function e(){l=b({exp:j,start:!1,parent:g.progressBar,minimum:.001,beforeShow:function(){f=+new Date,$(g.progressBar).removeClass(h.hide)},afterHide:function(){$(g.progressBar).addClass(h.hide);var a=+new Date-f;k.push(a)}})}var f,g={progressBar:"#j-dag-progress"},h={hide:"hide"},i=c.keys.loadExperimentDagBenchmark,j=c.getInt(i,500),k=[];d.onWindowClose(function(){k.push(j);var b=a.reduce(k,function(a,b){return a+b},0);j=Math.floor(b/k.length),c.set(i,j)});var l=null;return{start:function(){l||e(),l&&l.start()},end:function(){l&&l.end()},destroy:function(){l=null}}}),define("global/socket",["zero/zero"],function(a){function b(){return h=new WebSocket("ws://"+location.host+"/websocket/ws"),h.addEventListener?h.addEventListener("message",g):h.onmessage=g,h}function c(){return h||(h=b()),h}function d(){m.forEach(function(a){e(a)}),m=[]}function e(a){console.log(a),h.send("object"==typeof a?JSON.stringify(a):a)}function f(a){if(k>=l)throw new Error("Open WebSocket timeout");h.readyState!==WebSocket.OPEN?(k+=j,setTimeout(function(){f(a)},j)):(k=0,a())}function g(a){try{var b=a.data;if(b){JSON.parse(b)}}catch(a){}}var h,j=500,k=0,l=3e4,m=[],n={},o={send:function(a){return new Promise(function(g,h){try{var i=c();i.readyState===WebSocket.CLOSED&&(i=b()),i.readyState!==WebSocket.OPEN?(m.push(a),f(function(){d(),g()})):(e(a),g())}catch(a){h(a)}})},close:function(a,b){return new Promise(function(d,e){try{c().close(a,b),d()}catch(a){e(a)}})},on:function(a,b,c){n[a]||(n[a]=[]),n[a].push(b,c)},once:function(a,b,c){var d=function(){o.off(a,d),c?b.apply(c,arguments):b(arguments)};return o.on(a,d,c)},off:function(a,b,c){if(!(a||b||c))return void(n={});var d=n[a];if(d){if(!b&&!c)return void delete d[a];for(i=d.length-2;i>=0;i-=2)b&&d[i]!==b||c&&d[i+1]!==c||d.splice(i,2)}}};return o}),define("services/ws",["zero/zero","zero/declare","../global/Alert","../global/notify","../global/event","../global/environment","../ajax/base","../i18n"],function(a,b,c,d,e,f,g,h){function i(){var a=("http:"===location.protocol?"ws":"wss")+"://"+location.host+"/websocket/ws?t="+ +new Date;return t=null,t=new WebSocket(a),t.addEventListener?(t.addEventListener("open",k),t.addEventListener("error",l),t.addEventListener("close",m),t.addEventListener("message",n)):(t.onopen=k,t.onerror=l,t.onclose=m,t.onmessage=n),y=setTimeout(function(){z.available=!1,r()},3e3),t}function j(){setTimeout(i,3e3)}function k(){if(y&&(clearTimeout(y),y=0),v.length){var a=v.slice();v=[],a.forEach(function(a){o(a)})}}function l(a){"ECONNREFUSED"===a.code?j(a):(z.available=!1,r(a))}function m(a){1e3!==a.code||console.log("WebSocket Closed: ",a)}function n(a){try{var b=a.data;if(b){var e=JSON.parse(b),f=e.response;if(f){if("-1"===f.exceptionCode)return void(u||(u=new c({title:w("badCToken"),messageTitle:w("badCTokenTip",$("#logoutLink").attr("href")),messageContent:"",buttonText:w("refreshImmediately"),onOK:function(){u=null,window.location.reload()}})));if(f.exception_marking)return void d.error(f.exception_marking);if(f.success)s(e.request,f);else{if("DPC00002"===result.errorCode)return void(u||(u=new c({title:w("pageExpire"),messageTitle:w("pageExpireTip"),messageContent:"",buttonText:w("refreshImmediately"),onOK:function(){u=null,window.location.reload()}})));result.errorMessage&&d.error(result.errorMessage)}}}}catch(a){}}function o(a){if(t||i(),t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)v.push(a),i();else if(t.readyState===WebSocket.OPEN){var b="object"==typeof a?JSON.stringify(a):a;try{t.send(b)}catch(b){v.push(a),l(b)}}else v.push(a)}function p(a,b,c){if(a&&b){var d=x[a];d||(d=x[a]=[]),d.push(b,c)}}function q(a,b,c){if(!(a||b||c))return void(x={});var d=x[a];if(d)if(b||c)for(var e=d.length-2;e>=0;e-=2)b&&d[e]!==b||c&&d[e+1]!==c||d.splice(e,2);else delete x[event]}function r(a){s({method:z.INTERNAL_ERROR,error:a},{})}function s(a,b){var c=b.data||{},d=a.method;if(d&&x[d])for(var e=x[d],f=0,g=e.length;f<g;f+=2){var h=e[f],i=e[f+1];h&&(i?h.call(i,a,c):h(a,c))}}var t=null,u=null,v=[],w=h.translate,x={},y=0,z={INTERNAL_ERROR:"INTERNAL_ERROR",available:!0,send:o,on:p,off:q,trigger:s};return z}),define("services/base",["zero/zero","zero/declare","../global/environment","./ws"],function(a,b,c,d){var e=!1;return c.isInternal&&d.on(d.INTERNAL_ERROR,function(){e=!0}),b("services/base",[],{wsAvailable:function(){return!e&&d.available&&c.isInternal}})}),define("services/nodeLog",["zero/zero","zero/declare","../global/event","../ajax/base","../ajax/execution","../ajax/groupLoop","./base","./ws"],function(a,b,c,d,e,f,g,h){return b("services/nodeLog",[g],{constructor:function(a,b){this.method="queryNodeLog",this.experimentId=a.experimentId,this.nodeInstanceId=a.nodeInstanceId,this.mainRecordId=a.mainRecordId,this.jobId=a.jobId,this.callback=b,this.started=!1},getSendData:function(){return{ctoken:d.getToken(),method:this.method,experimentId:this.experimentId,nodeInstanceId:this.nodeInstanceId,mainRecordId:this.mainRecordId,jobId:this.jobId}},startWebSocket:function(){h.on(this.method,this.handleMessage,this);var a=this.getSendData();h.send(a)},stopWebSocket:function(){h.off(this.method,this.handleMessage,this);var a=this.getSendData();a.close=!0,h.send(a)},handleMessage:function(a,b){a.experimentId===this.experimentId&&a.nodeInstanceId===this.nodeInstanceId&&(!a.mainRecordId&&!a.jobId||a.mainRecordId&&a.mainRecordId===this.mainRecordId||a.jobId&&a.jobId===this.jobId)&&this.callback&&this.callback(b)},doAjax:function(){var a=this.mainRecordId?f.queryNodeLog(this.experimentId,this.nodeInstanceId,this.mainRecordId):e.queryNodeLog(this.experimentId,this.nodeInstanceId,this.jobId),b=this;a.then(function(a){b.callback&&b.callback(a)})},onReceivedStatus:function(a){a&&a.instStatus&&"running"===a.instStatus[this.nodeInstanceId]&&this.doAjax()},start:function(){this.started||(this.wsAvailable()?this.startWebSocket():(this.doAjax(),this.handleReceivedStatus=this.onReceivedStatus.bind(this),c.onReceivedStatus(this.handleReceivedStatus)),this.started=!0)},stop:function(){this.started&&(this.wsAvailable()?h.off(this.method,this.handleMessage,this):c.offReceivedStatus(this.handleReceivedStatus),this.started=!1)}})}),define("midway/dialog/experiment/nodeLog",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,f,g,h){var i="";if(b&&b.length){i+="";var f=a.uuid();i+='<div class="nav nav-tabs pai-tab"><li class="active" data-target="#'+e(f)+'"><a href="javascript:void(0);">'+e(d("all"))+"</a></li>";for(var h in g)i+='<li data-target="#'+e(f)+"-"+e(h)+'"><a href="javascript:void(0);">['+e(h)+"]</a></li>";i+='</div><div class="execution-log-list"><div id="'+e(f)+'" class="all">',a.each(b,function(a){i+='<div class="execution-log-item">'+c(a)+"</div>"}),i+="</div>";for(var h in g)i+='<div id="'+e(f)+"-"+e(h)+'" class="log-'+e(h)+'">',a.each(g[h],function(a){i+='<div class="execution-log-item">'+c(a)+"</div>"}),i+="</div>";i+="</div>"}else i+='<div class="is-empty">'+e(d("empty"))+"</div>";return i+=""}(b.allLogs,b.uuid,b.logMap,b.key)}}),define("dialog/experiment/nodeLog",["zero/zero","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../global/socket","../../global/uriReg","../../global/event","../../global/environment","../../ajax/base","../../ajax/execution","../../ajax/groupLoop","../../services/nodeLog","../../midway/dialog/experiment/nodeLog"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){y.$(".execution-log-list").on("scroll",function(){var a=$(this),b=a.children().not(".hide"),c=b.height(),d=a.height(),e=c-d,f=a.scrollTop();b.data("locked",e>f),b.data("scrollTop",f)})}function o(){var a=y.$(".execution-log-list"),b=a.children().not(".hide"),c=b.data("scrollTop");if(0===c||c)a.scrollTop(c);else{var d=b.height(),e=a.height(),f=d-e;0<f&&a.scrollTop(f)}}function p(b,c){c.append(a.map(b,function(a){return'<div class="execution-log-item">'+a+"</div>"}).join(""));var d=y.$(".execution-log-list"),e=c.height(),f=d.height(),g=e-f;0<g&&!0!==c.data("locked")&&(d.scrollTop(g),c.data("scrollTop",g))}function q(a){return a.replace(/(\s{3})/g,'<span class="spacing-3"></span>').replace(/(\s{2})/g,'<span class="spacing-2"></span>')}function r(a){var b=a.split(/\n|<br>|<br\s*\/>/g);if(b.length>1){var c="";return b.forEach(function(a){c+="<p>"+q(a)+"</p>"}),c}return q(a)}function s(a){var b=[],c=new RegExp(f,"gi");return C(a,function(a){a=a.replace(/^(\s*)/,"").replace(c,function(a){return'<a href="'+a+'" target="_blank">'+a+"</a>"}),a=a.match(/PAI|xlib/)?'<span class="line-pai">'+r(a)+"</span>":a.match(/(Error)|(Failed)|(Exception)/i)?'<span class="line-error">'+r(a)+"</span>":a.match(/Warn/i)?'<span class="line-warn">'+r(a)+"</span>":r(a),b.push(a)}),b}function t(){var a=0;y.tab&&(a=y.tab.activeIndex,y.tab.destroy()),y.tab=new c({selector:y.$(".nav-tabs li"),activeIndex:a,activeClassName:"active",afterShow:o})}function u(b){y.hideLoading();var c=!z||0===z.length;if(b&&b.allLogs)if(c){z=b.allLogs,A=b.logMap;var d={};C(b.logMap,function(a,b){d[b]=s(a,b)});var e=m({allLogs:s(z),logMap:d},!0);y.set("body",e),t(),setTimeout(n)}else{var f=[];C(b.allLogs,function(a){-1===z.indexOf(a)&&(f.push(a),z.push(a))}),f.length&&p(s(f),y.$(".all"));var g=!1;C(b.logMap,function(b,c){var d=A[c];if(d)f=[],C(b,function(a){-1===d.indexOf(a)&&(f.push(a),d.push(a))}),f.length&&p(s(f),y.$(".log-"+c));else{g=!0,A[c]=b;var e=a.uuid();y.$(".nav-tabs").append('<li data-target="#'+e+'"><a href="javascript:void(0);">['+c+"]</a></li>");var h=$('<div id="'+e+'" class="log-'+c+'"></div>');y.$(".execution-log-list").append(h),p(s(b),h)}}),g&&t()}}function v(a,b,c,d){z=[],A={},y.showLoading(),B=new l({experimentId:a,nodeInstanceId:b,mainRecordId:c,jobId:d},u),B.start()}function w(){this.tab&&(this.tab.destroy(),this.tab=null),z=null,A=null,B.stop()}function x(a,c,d,e){y=new b({title:D("viewLog"),className:"dialog-node-log",destroyOnHide:!0,canFullscreen:!0,beforeHide:w,afterShow:function(){v.call(this,a,c,d,e)},buttons:[{text:D("close"),click:function(){this.hide()}}]})}var y,z,A,B,C=a.each,D=d.translate;return{show:x}}),define("workspace/executor",["zero/zero","zero/ui/Confirm","../i18n","../global/event","../ajax/execution","../ajax/groupLoop","../dialog/experiment/nodeLog","zero/ui/DialogEx","./statusTicker"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return new Promise(function(c,d){b({title:E("execute"),body:a,onAccept:c,onCancel:d})})}function k(){return new Promise(function(a,b){e.executePreCheck(F.id).then(function(c){c&&"check"===c.type&&c.message?j(c.message).then(a,b):a()},a)})}function l(){d.broadcastStatus({status:6})}function m(){if(l(),G)return H.then(n);B()}function n(){if(l(),G)return H.then(n);k().then(function(){window.GLOBALS.isOnline?e.executeOnline(F.id).then(B,C):e.execute(F.id).then(B,C)},C)}function o(){if(l(),G)return H.then(o);k().then(function(){e.executeFromUnsuccess(F.id).then(B,C)},C)}function p(a){if(l(),G)return H.then(p);e.executeFromNode(F.id,a).then(B,C)}function q(a){if(l(),G)return H.then(q);e.executeToNode(F.id,a).then(B,C)}function r(a){if(l(),G)return H.then(r);e.executeNode(F.id,a).then(B,C)}function s(a){if(l(),G)return H.then(s);e.executeMultiNodes(F.id,a).then(B,C)}function t(a){e.stopExecuteNode(F.id,a).then(B,C)}function u(a){if(l(),G)return H.then(r);e.executePmml(F.id,a).then(B,C)}function v(){e.stopExperiment(F.id).then(function(){B()},C)}function w(a){if(l(),G)return H.then(w.bind(null,a));f.queryGroupLoopConfig(F.id,a).then(function(b){var c={checkedNodes:[],gridSearchParams:[],randomSearchParams:[]};b=$.extend(c,b);var e=0===b.checkedNodes.length&&0===b.gridSearchParams.length&&0===b.randomSearchParams.length;if("{}"===JSON.stringify(b)||e){new h({title:"请先配置参数",body:"<p>参数循环配置为空,请先配置参数循环参数,再运行</p>",destroyOnHide:!0,buttons:[{text:"开始配置",type:"primary",click:function(){this.hide(),window.react_bridge.actions&&(window.react_bridge.actions.global.setEvent({event:d}),window.react_bridge.actions.settings.groupLoop.get({experimentId:F.id,groupId:a}))}},{text:E("close"),click:function(){this.hide()}}]})}else f.loopExecute(F.id,a).then(B,C)})}function x(){if(l(),G)return H.then(x);k().then(function(){e.tryExecuteAll(F.id).then(B,C)},C)}function y(a){if(l(),G)return H.then(y);e.tryExecuteFromNode(F.id,a).then(B,C)}function z(a){if(l(),G)return H.then(z);e.tryExecuteToNode(F.id,a).then(B,C)}function A(a){if(l(),G)return H.then(A);e.tryExecuteNode(F.id,a).then(B,C)}function B(){i.tick()}function C(){i.broadcast(!0)}function D(a){g.show(F.id,a)}var E=c.translate,F=null,G=!1,H=null,I=null;d.onPropsSaving(function(){G=!0,H=new Promise(function(a){I=a})}),d.onPropsSaved(function(){G=!1,I&&I(G)}),d.onUpdateExperimentStatus(m),d.onExecuteExperiment(n),d.onReExecuteExperiment(o),d.onExecuteFromNode(p),d.onExecuteToNode(q),d.onExecuteNode(r),d.onExecuteNodes(s),d.onExecuteGroup(w),d.onTryExecuteExperiment(x),d.onTryExecuteFromNode(y),d.onTryExecuteToNode(z),d.onTryExecuteNode(A),d.onStopExecuteNode(t),d.onExecutePmml(u),d.onStopExecution(v),d.onShowNodeLog(D),d.onReceivedStatus(function(a){"default"===a.status&&F&&d.refreshMyModels(F.id)});var J={init:function(a){J.clean(),F=a},clean:function(){G=!1,F=null,H=null,I=null}};return J}),define("midway/dialog/experiment/cronSetting",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){var b='<div class="cron-setting nonselect"><div class="form-vertical">\x3c!--<div class="form-group j-cron-setting-type">--\x3e\x3c!--<label class="col-sm-2 control-label"></label>--\x3e\x3c!--<div class="col-sm-8 control-input cron-radios">--\x3e\x3c!--<label>--\x3e\x3c!--<input type="radio" name="settingType" value="0"/>--\x3e\x3c!--'+e(d("deployByUser"))+'--\x3e\x3c!--</label>--\x3e\x3c!--<label>--\x3e\x3c!--<input type="radio" name="settingType" value="1"/>--\x3e\x3c!--'+e(d("deployByTiming"))+'--\x3e\x3c!--</label>--\x3e\x3c!--</div>--\x3e\x3c!--</div>--\x3e<div class="j-form-group-wrapper">\x3c!--调度周期--\x3e<div class="form-group j-cron-setting-scheduling-cycle"><label for="cronSettingSchedulingCycle" class="col-sm-2 control-label">'+e(d("schedulingCycle"))+'</label><div class="col-sm-8 control-input"><select id="cronSettingSchedulingCycle" class="select-hacker">\x3c!--<option value="quarter">'+e(d("schedulingSeason"))+'</option>--\x3e<option value="month">'+e(d("schedulingMonth"))+'</option><option value="week">'+e(d("schedulingWeek"))+'</option><option value="date">'+e(d("schedulingDay"))+'</option><option value="hour">'+e(d("schedulingHour"))+'</option><option value="minute">'+e(d("schedulingMinute"))+'</option></select></div></div>\x3c!--选择月份--\x3e<div class="form-group hide j-cron-setting-select-month"><label for="cronSettingSelectMonth" class="col-sm-2 control-label">'+e(d("selectMonth"))+'</label><div class="col-sm-8 control-input"><select id="cronSettingSelectMonth" class="select-hacker"><option value="1">'+e(d("quarterly"))+"1"+e(d("schedulingMonth"))+'</option><option value="2">'+e(d("quarterly"))+"2"+e(d("schedulingMonth"))+'</option><option value="3">'+e(d("quarterly"))+"3"+e(d("schedulingMonth"))+'</option></select></div></div>\x3c!--选择时间--\x3e<div class="form-group hide j-cron-setting-select-weekday"><label for="cronSettingSelectWeekday" class="col-sm-2 control-label">'+e(d("selectWeekDay"))+'</label><div class="col-sm-8 control-input"><select id="cronSettingSelectWeekday" class="select-hacker"><option value="1">'+e(d("monday"))+'</option><option value="2">'+e(d("tuesday"))+'</option><option value="3">'+e(d("wednesday"))+'</option><option value="4">'+e(d("thursday"))+'</option><option value="5">'+e(d("friday"))+'</option><option value="6">'+e(d("saturday"))+'</option><option value="0">'+e(d("sunday"))+'</option></select></div></div>\x3c!--选择日期--\x3e<div class="form-group hide j-cron-setting-select-date"><label for="cronSettingSelectDate" class="col-sm-2 control-label">'+e(d("selectDate"))+'</label><div class="col-sm-8 control-input"><select id="cronSettingSelectDate" class="select-hacker">';return a.each([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],function(a){b+='<option value="'+e(a)+'">'+e(d("perMonth"))+e(a)+e(d("schedulingDay"))+"</option>"}),b+='<option value="L">'+e(d("monthEnd"))+'</option></select></div></div>\x3c!--具体时间--\x3e<div class="form-group hide j-cron-setting-detail-time"><label for="cronSettingDetailTimeHour" class="col-sm-2 control-label">'+e(d("detailTime"))+'</label><div class="col-sm-3 control-input"><select id="cronSettingDetailTimeHour" class="select-hacker">',a.each(["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div><div class="col-sm-1 control-input">:</div><div class="col-sm-3 control-input"><select id="cronSettingDetailTimeMinute" class="select-hacker">',a.each(["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div></div>\x3c!--开始时间--\x3e<div class="form-group hide j-cron-setting-begin-time"><label for="cronSettingBeginTimeHour" class="col-sm-2 control-label">'+e(d("beginTime"))+'</label><div class="col-sm-3 control-input"><select id="cronSettingBeginTimeHour" class="select-hacker">',a.each(["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div><div class="col-sm-1 control-input">:</div><div class="col-sm-3 control-input"><select id="cronSettingBeginTimeMinute" class="select-hacker">',a.each(["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div></div>\x3c!--间隔时间 小时--\x3e<div class="form-group hide j-cron-setting-intervals-hour"><label for="cronSettingIntervalsHour" class="col-sm-2 control-label">'+e(d("intervals"))+'</label><div class="col-sm-3 control-input"><select id="cronSettingIntervalsHour" class="select-hacker">',a.each([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div><div class="col-sm-1">'+e(d("hour"))+'</div></div>\x3c!--间隔时间 分钟--\x3e<div class="form-group hide j-cron-setting-interval-minute"><label for="cronSettingIntervalsMinute" class="col-sm-2 control-label">'+e(d("intervals"))+'</label><div class="col-sm-3 control-input"><select id="cronSettingIntervalsMinute" class="select-hacker">',a.each([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div><div class="col-sm-1">'+e(d("minute"))+'</div></div>\x3c!--结束时间--\x3e<div class="form-group hide j-cron-setting-end-time"><label for="cronSettingEndTimeHour" class="col-sm-2 control-label">'+e(d("endTime"))+'</label><div class="col-sm-3 control-input"><select id="cronSettingEndTimeHour" class="select-hacker">',a.each(["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],function(a){b+='<option value="'+e(a)+'">'+e(a)+"</option>"}),b+='</select></div><div class="col-sm-1 control-input">:</div><div class="col-sm-3 control-input"><input type="text" id="cronSettingEndTimeMinute" class="form-control" readonly value="59"/></div></div>\x3c!--时间表达式--\x3e<div class="form-group j-cron-setting-time-expression"><label for="cronSettingTimeExpression" class="col-sm-2 control-label">'+e(d("timeExpression"))+'</label><div class="col-sm-8 control-input"><input type="text" id="cronSettingTimeExpression" class="form-control" readonly/></div></div></div></div></div>'}()}}),define("dialog/experiment/CronSetting",["zero/zero","zero/declare","../../i18n","../../midway/dialog/experiment/cronSetting"],function(a,b,c,d){var e=(c.translate,{settingTypeCss:".j-cron-setting-type",formGroupCss:".form-group",formGroupWrapperCss:".j-form-group-wrapper",formGroupSettingTypeCss:'[name="settingType"]',formGroupSchedulingCycleCss:".j-cron-setting-scheduling-cycle",formGroupSelectMonthCss:".j-cron-setting-select-month",formGroupSelectDateCss:".j-cron-setting-select-date",formGroupDetailTimeCss:".j-cron-setting-detail-time",formGroupSelectWeekdayCss:".j-cron-setting-select-weekday",formGroupBeginTimeCss:".j-cron-setting-begin-time",formGroupEndTimeCss:".j-cron-setting-end-time",formGroupIntervalsHourCss:".j-cron-setting-intervals-hour",formGroupIntervalsMinuteCss:".j-cron-setting-interval-minute",formGroupTimeExpressionCss:".j-cron-setting-time-expression",cronSettingSchedulingCycleCss:"#cronSettingSchedulingCycle",cronSettingSelectMonthCss:"#cronSettingSelectMonth",cronSettingSelectDateCss:"#cronSettingSelectDate",cronSettingDetailTimeHourCss:"#cronSettingDetailTimeHour",cronSettingDetailTimeMinuteCss:"#cronSettingDetailTimeMinute",cronSettingSelectWeekdayCss:"#cronSettingSelectWeekday",cronSettingBeginTimeHourCss:"#cronSettingBeginTimeHour",cronSettingBeginTimeMinuteCss:"#cronSettingBeginTimeMinute",cronSettingEndTimeHourCss:"#cronSettingEndTimeHour",cronSettingIntervalsHourCss:"#cronSettingIntervalsHour",cronSettingIntervalsMinuteCss:"#cronSettingIntervalsMinute",cronSettingTimeExpressionCss:"#cronSettingTimeExpression"});return b("CronSetting",{constructor:function(a){this.$wrapper=$(d()).appendTo(a.container),this.$formGroups=this.$wrapper.find(e.formGroupCss+":not("+e.settingTypeCss+")"),this.defaultExpression=a.expression,this.settingType=1,this.cycle="month",this.month=1,this.day=1,this.hour="00",this.minute="00",this.weekday=1,this.beginHour="00",this.beginMinute="00",this.endHour="00",this.intervalsHour=1,this.intervalsMinute=1,this.expression="",this.events(),this.parseExpression(),this.initialize(),this.switchSettingTypeForm(),this.switchFormGroupByCycle(),this.setTimeExpressValue()},events:function(){var a=this;this.$wrapper.on("click",e.formGroupSettingTypeCss,function(b){var c=Number(b.target.value);c!==a.settingType&&(a.settingType=c,a.switchSettingTypeForm(),a.settingType&&a.switchFormGroupByCycle())}),$(e.cronSettingSchedulingCycleCss).on("change",function(b){var c=b.target.value.toLowerCase();c!==a.cycle.toLowerCase()&&(a.cycle=c,a.switchFormGroupByCycle())}),$(e.cronSettingSelectMonthCss).on("change",function(b){var c=b.target.value;c!==a.month&&(a.month=c,a.setTimeExpressValue())}),$(e.cronSettingSelectDateCss).on("change",function(b){var c=b.target.value;c!==a.day&&(a.day=c,a.setTimeExpressValue())}),$(e.cronSettingDetailTimeHourCss).on("change",function(b){var c=b.target.value;c!==a.hour&&(a.hour=c,a.setTimeExpressValue())}),$(e.cronSettingDetailTimeMinuteCss).on("change",function(b){var c=b.target.value;c!==a.minute&&(a.minute=c,a.setTimeExpressValue())}),$(e.cronSettingSelectWeekdayCss).on("change",function(b){var c=b.target.value;c!==a.weekday&&(a.weekday=c,a.setTimeExpressValue())}),$(e.cronSettingBeginTimeHourCss).on("change",function(b){var c=b.target.value;c!==a.beginHour&&(a.beginHour=c,a.setTimeExpressValue())}),$(e.cronSettingBeginTimeMinuteCss).on("change",function(b){var c=b.target.value;c!==a.beginMinute&&(a.beginMinute=c,a.setTimeExpressValue())}),$(e.cronSettingEndTimeHourCss).on("change",function(b){var c=b.target.value;c!==a.endHour&&(a.endHour=c,a.setTimeExpressValue())}),$(e.cronSettingIntervalsHourCss).on("change",function(b){var c=b.target.value;c!==a.intervalsHour&&(a.intervalsHour=c,a.setTimeExpressValue())}),$(e.cronSettingIntervalsMinuteCss).on("change",function(b){var c=b.target.value;c!==a.intervalsMinute&&(a.intervalsMinute=c,a.setTimeExpressValue())})},parseExpression:function(){var a,b=!1,c=!1,d=!1,e=!1,f=!1,g=!1,h=[];this.defaultExpression&&(h=this.defaultExpression.split(" "),b=/(\*|\d{1,2})\/\d{1,2}/.test(h[1]),c=/\d{2}\-\d{2}\/\d{1,2}/.test(h[2]),d=!b&&!c&&/\*/.test(h[3]),e=/\?/.test(h[3]),f=/\d{1,2}/.test(h[3])&&/\*/.test(h[4])&&/\?/.test(h[5]),g=/\d{1,2}\/\d{1,2}}/.test(h[4]),b&&(a=h[2].split("-"),this.beginHour=a[0],this.endHour=a[1],this.intervalsMinute=h[1].split("/")[1],this.cycle="minute"),c&&(a=h[2].match(/(\d{1,2})\-(\d{1,2})\/(\d{1,2})/),this.beginHour=a[1],this.endHour=a[2],this.intervalsHour=a[3],this.beginMinute=h[1],this.cycle="hour"),d&&(this.minute=h[1],this.hour=h[2],this.cycle="date"),e&&(this.minute=h[1],this.hour=h[2],this.weekday=h[5],this.cycle="week"),f&&(this.minute=h[1],this.hour=h[2],this.day=h[3],this.cycle="month"),g&&(this.minute=h[1],this.hour=h[2],this.day=h[3],this.month=h[4].split("/")[0],this.cycle="quarter"))},initialize:function(){this.$wrapper.find(e.formGroupSettingTypeCss).filter("[value="+this.settingType+"]").attr("checked",!0),$(e.cronSettingSchedulingCycleCss).val(this.cycle.toLowerCase()),$(e.cronSettingSelectMonthCss).val(this.month),$(e.cronSettingSelectDateCss).val(this.day),$(e.cronSettingDetailTimeHourCss).val(this.hour),$(e.cronSettingDetailTimeMinuteCss).val(this.minute),$(e.cronSettingBeginTimeHourCss).val(this.beginHour),$(e.cronSettingBeginTimeMinuteCss).val(this.beginMinute),$(e.cronSettingEndTimeHourCss).val(this.endHour),$(e.cronSettingIntervalsHourCss).val(this.intervalsHour),$(e.cronSettingIntervalsMinuteCss).val(this.intervalsMinute)},switchSettingTypeForm:function(){this.$formGroups[this.settingType?"removeClass":"addClass"]("hide")},switchFormGroupByCycle:function(){var a=[],b=this.cycle.toLowerCase();"quarter"===b&&(a=[e.formGroupSchedulingCycleCss,e.formGroupSelectMonthCss,e.formGroupSelectDateCss,e.formGroupDetailTimeCss,e.formGroupTimeExpressionCss]),"month"===b&&(a=[e.formGroupSchedulingCycleCss,e.formGroupSelectDateCss,e.formGroupDetailTimeCss,e.formGroupTimeExpressionCss]),"week"===b&&(a=[e.formGroupSchedulingCycleCss,e.formGroupSelectWeekdayCss,e.formGroupDetailTimeCss,e.formGroupTimeExpressionCss]),"date"===b&&(a=[e.formGroupSchedulingCycleCss,e.formGroupDetailTimeCss,e.formGroupTimeExpressionCss]),"hour"===b&&(a=[e.formGroupSchedulingCycleCss,e.formGroupBeginTimeCss,e.formGroupEndTimeCss,e.formGroupIntervalsHourCss,e.formGroupTimeExpressionCss],$(e.cronSettingBeginTimeMinuteCss).attr("disabled",!1)),"minute"===b&&(a=[e.formGroupSchedulingCycleCss,e.formGroupBeginTimeCss,e.formGroupEndTimeCss,e.formGroupIntervalsMinuteCss,e.formGroupTimeExpressionCss],$(e.cronSettingBeginTimeMinuteCss).val("00").attr("disabled",!0)),this.$formGroups.addClass("hide"),this.$wrapper.find(a.join(",")).removeClass("hide"),this.setTimeExpressValue()},setTimeExpressValue:function(){var a=this.cycle.toLowerCase(),b=$(e.cronSettingTimeExpressionCss);"quarter"===a&&(this.expression=["00",this.minute,this.hour,this.day,this.month+"/3","?"].join(" ")),"month"===a&&(this.expression=["00",this.minute,this.hour,this.day,"* ?"].join(" ")),"week"===a&&(this.expression=["00",this.minute,this.hour,"? *",this.weekday].join(" ")),"date"===a&&(this.expression=["00",this.minute,this.hour,"* * ?"].join(" ")),"hour"===a&&(this.expression=["00",this.beginMinute,this.beginHour+"-"+this.endHour+"/"+this.intervalsHour,"* * ?"].join(" ")),"minute"===a&&(this.expression=["00","*/"+this.intervalsMinute,this.beginHour+"-"+this.endHour,"* * ?"].join(" ")),b.val(this.expression)}})}),define("midway/dialog/experiment/deploy",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g,h,i,j,k,l){var m='<div class="pai-notice warn bordered" style="position:relative; top:0; margin:-20px -20px 20px -20px;">为了提供更稳定的部署环境, 我们升级了D2\b部署算法实验节点,本部署方式一个月后将会下线,请参考文档: <a href="https://lark.alipay.com/ai/pai/d2-experiment-deploy">部署到D2文档</a></div><div class="dialog-deploy-inner"><div class="dialog-deploy-left"><div class="dialog-deploy-sec"><span class="title">'+e(d("nodeId"))+'</span><input type="text" class="form-control" id="deployNodeId" value="'+e(b.nodeId)+'" disabled></div><div class="dialog-deploy-sec"><span class="title">'+e(d("nodeName"))+'</span><input type="text" class="form-control" id="deployNodeName" placeholder="'+e(d("nodeNamePlaceHolder"))+'" value="'+e(b.nodeName)+'"></div><div class="dialog-deploy-sec"><span class="title">'+e(d("nodeDescription"))+'</span><textarea class="form-control" id="deployNodeDesc" rows="3" placeholder="'+e(d("descriptionPlaceholder"))+'">'+e(b.nodeDescription)+'</textarea></div><div class="dialog-deploy-sec dialog-deploy-sec-project"><span class="title">'+e(d("modelProject"))+'</span><div class="dialog-deploy-project" tabindex="-1"></div><div class="btn-reload-project icon-refresh"></div></div><div class="dialog-deploy-sec odps-container"><span class="title">'+e(d("odpsProject"))+'</span><div class="dialog-odps-project" tabindex="-1"><div class="current"><span class="text">'+e(c&&c.name||"")+'</span><span class="select-arrow"></span></div><ul class="pai-dropdown">';a.each(f,function(a){m+='<li class="'+e(a.isDefault?"selected":"")+'" data-id="'+e(a.id)+'"><span class="icon icon-ok-l"></span><span class="text">'+e(a.name)+"</span></li>"}),m+='</ul></div><div class="extra-btn btn-add-project icon-plus-o"></div><div class="extra-btn btn-info icon-help-o"></div></div><div class="dialog-deploy-sec"><span class="title">'+e(d("accountType"))+"</span> ";var i=a.uuid();m+=" ";var g=a.uuid();return m+='<div class="ui-checkbox radio"><input type="radio" name="accountType" value="1" id="'+e(g)+'"><label for="'+e(g)+'"><span class="ui-checkbox-label">'+e(d("productAccount"))+'</span>(<a href="https://lark.alipay.com/ai/pai/deploy-to-jinshubao" target="_blank">'+e(d("userGuide"))+"</a>)</label></div>","ANT_CRO"!==h&&(m+='<div class="ui-checkbox radio"><input type="radio" name="accountType" value="0" id="'+e(i)+'"><label for="'+e(i)+'"><span class="ui-checkbox-label">'+e(d("personalAccount"))+"</span></label></div>"),
m+='</div><div class="dialog-deploy-sec"><span class="title"></span><span class="tip-info">蚂蚁同学推荐使用生产 Project 和生产账号部署</span></div><div class="dialog-deploy-sec hide"><div class="input-group deployACInput"><input type="text" class="form-control" placeholder="'+e(d("searchAndAddTable"))+'"><div class="btn-search input-group-addon"><span class="icon-search"></span></div><ul class="pai-dropdown"></ul></div></div></div><div class="dialog-deploy-right"><div class="dialog-deploy-sec hide"><span class="title">'+e(d("executeParameters"))+'</span><input type="text" class="form-control" id="deployNoeParam" value="'+e(b.nodeParameter)+'"><div class="tip-info">'+e(d("deployParameterDescription"))+'</div></div><div class="dialog-deploy-sec"><span class="title">'+e(d("executePlan"))+'</span><div class="deploy-cron-editor"></div></div></div><div style="clear:both" class="dependencies"><div class="dialog-deploy-sec"><span class="title">'+e(d("nodeInputs"))+'</span><table class="table-input table table-condensed table-bordered table-hover"><thead><tr><th style="width:30%">'+e(d("parentNodeOutputName"))+'<span class="icon-help-o"></span></th><th style="width:30%">'+e(d("nodeName"))+'</th><th style="width:17.5%">'+e(d("parentNodeId"))+'</th><th style="width:17.5%">'+e(d("owner"))+'</th><th style="width:5%">'+e(d("actions"))+"</th></tr></thead><tbody>",a.each(j,function(a){m+='<tr><td class="parentNodeOutputName" spellcheck="false" autocapitalize="none" autocorrect="off" autocomplete="off">'+e(b.inputTables.find(function(b){return b.tableName===a.tableName}).projectName)+"."+e(a.tableName)+"</td><td>"+e(a.nodeName)+"</td><td>"+e(a.nodeId)+"</td><td>"+e(a.nodeOwnerName)+'</td><td class="input-table-actions"><a tabindex="0"> 删除</a></td></tr>'}),m+='</tbody></table><div class="more-denpendencies"><input type="text" class="form-control" placeholder="'+e(d("addDenp"))+'"></div></div><div class="dialog-deploy-sec hide"><div class="input-group deployACOutput"><input type="text" class="form-control" placeholder="'+e(d("searchAndAddTable"))+'"><div class="btn-search input-group-addon"><span class="icon-search"></span></div><ul class="pai-dropdown"></ul></div></div><div class="dialog-deploy-sec"><span class="title">'+e(d("nodeOutputs"))+'</span><table class="table-output table table-condensed table-bordered table-hover"><thead><tr><th style="width:30%">'+e(d("nodeOutputName"))+'</th><th style="width:30%">'+e(d("downstreamNodeName"))+'</th><th style="width:20%">'+e(d("downstreamNodeId"))+'</th><th style="width:20%">'+e(d("owner"))+"</th></tr></thead><tbody>",a.each(k,function(a){m+="<tr><td>"+e(a.tableName)+"</td><td>"+e(a.nodeName)+"</td><td>"+e(a.nodeId)+"</td><td>"+e(a.nodeOwnerName)+"</td></tr>"}),m+="</tbody></table></div></div></div>",b.needRegisterModel&&(m+='<div class="dialog-deploy-sec reg-model"><span class="title">模型注册</span><div class="reg-model-container"><div class="dialog-deploy-sec"><span class="title">模型名称</span><input id="modelName" type="text" class="form-control" value="'+e(b.modelName)+'" /></div><div class="dialog-deploy-sec"><span class="title">风险等级</span><label for="modelSecurityLevel" class="select-hacker"><select id="modelSecurityLevel" class="form-control"><option value="I">关键风险(I)类</option><option value="II">非关键风险(II)类</option></select></label></div><div class="dialog-deploy-sec"><span class="title">模型分类</span><label for="modelType" class="select-hacker"><select id="modelType" class="form-control"><option value="BINARY">二分类</option><option value="MULTI_BINARY">多分类</option><option value="REGRESSION">回归</option><option value="CLUSTER">聚类</option></select></label></div><div class="dialog-deploy-sec"><span class="title">所有者</span><input type="text" id="userName" readonly class="form-control" value="'+e(b.userName)+'"></div><div class="dialog-deploy-sec"><span class="title">模型描述</span><input id="modelDesc" type="text" class="form-control" value="'+e(b.modelDesc)+'"></div></div>'),m+="</div>"}(b.nodeDetail,b.currentODPSProject,b.odpsProjectList,b.id2,b.userDepartment,b.id1,b.upstreamNodes,b.downstreamNodes,b.item)}}),define("midway/dialog/experiment/deployProjectList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f){var g='<div class="current"><span class="text">'+e(b?b.projectName:" ")+'</span><span class="select-arrow"></span></div><ul class="pai-dropdown">';return a.each(c,function(a){g+='<li class="'+e(a.isSelected?"selected":"")+'"data-id="'+e(a.projectId)+'"><span class="icon icon-ok-l"></span><span class="text">'+e(a.projectName)+"</span></li>"}),g+='<li class="btn-create-project"><a href="'+e(f)+'"target="_blank"><button class="btn btn-sm btn-block btn-primary">'+e(d("createProject"))+"</button></a></li></ul>"}(b.currentProject,b.projectList,b.createProjectUrl)}}),define("midway/dialog/experiment/deployNodeRow",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){return'<tr><td><div class="table-cell" title="'+d(a)+'">'+d(a)+'</div></td><td><div class="table-cell" title="'+d(b)+'">'+d(b)+'</div></td><td><div class="table-cell" title="'+d(c)+'">'+d(c)+'</div></td><td><div class="table-cell" title="'+d(e)+'">'+d(e)+'</div></td><td><span class="btn-delete-row icon-delete"></span></td></tr>'}(b.tableName,b.nodeName,b.nodeId,b.nodeOwnerName)}}),define("midway/dialog/experiment/deployFooter",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<a class="footer-link" href="https://lark.alipay.com/ai/pai/deploy-fandq" target="_blank">'+e(d("helpLink"))+"</a>"}()}}),define("midway/dialog/experiment/deployError",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){var b='<div class="deploy-tips error"><i class="icon icon-close-o"></i><div class="title">'+e(d("deployFailed"))+"</div>";return a&&(b+='<p class="msg">'+e(a)+"</p>"),b+="</div>"}(b.msg)}}),define("dialog/experiment/deployError",["zero/zero","zero/ui/Dialog","../../i18n","../../midway/dialog/experiment/deployError"],function(a,b,c,d){"use strict";function e(a,b){g?a():b()}function f(a){return g=!1,new Promise(function(c,f){new b({title:h("tips"),className:"dialog-deploy-tips",destroyOnHide:!0,body:d({msg:a}),afterHide:function(){e.call(this,c,f)},buttons:[{text:h("returnAndEdit"),type:"primary",click:function(){g=!0,this.hide()}},{text:h("close"),click:function(){this.hide()}}]})})}var g,h=c.translate;return{show:f}}),define("midway/dialog/experiment/deploySuccess",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return function(a){return'<div class="deploy-tips success"><i class="icon icon-ok-o"></i><div class="title">'+c(d("addDeployTaskSuccess"))+'</div><p class="msg">'+c(d("deploySucceedMsg",a))+"</p></div>"}(b.url)}}),define("dialog/experiment/deploySuccess",["zero/zero","zero/ui/Dialog","../../i18n","../../midway/dialog/experiment/deploySuccess"],function(a,b,c,d){"use strict";function e(a){new b({title:f("tips"),className:"dialog-deploy-tips",destroyOnHide:!0,body:d({url:a},!0),afterShow:function(){this.$element.find(".btn").eq(0).html(f("clickToView",a))},buttons:[{text:"",type:"primary"},{text:f("close"),click:function(){this.hide()}}]})}var f=c.translate;return{show:e}}),define("workspace/deployTicker",["zero/zero","zero/ui/DialogEx","../global/event","../global/notify","../i18n","../ajax/offlineDeploy"],function(a,b,c,d,e,f){"use strict";var g=e.translate,h=!0,i=null,j=0,k=0,l=3e3,m=null,n=null,o="https://mydata.alipay.com/project/list.htm",p={status:"",init:function(a){h=!0,i=a,j=a.id},tick:function(c){var e=this;k&&clearTimeout(k),c||(c=o),f.checkStatus(j).then(function(f){var i=f.deployingStatus;p.status=i,p.broadcast(),"0"!==i&&"2"!==i||(k=setTimeout(a.bind(p.tick,p),l)),h?h=!1:"-2"===i||"-1"===i?(m&&m.hide(!0),e.clean(),d.error(f.errorMessage||g("deployFailed"))):"1"===i?(m&&m.hide(!0),e.clean(),n||setTimeout(function(){n=new b({destroyOnHide:!0,canFullscreen:!0,title:g("offlineDeploy"),body:g("deploySuccess"),afterShow:function(){this.$element.find(".btn").eq(0).html(g("clickToView",c))},buttons:[{text:""},{text:g("close"),click:function(){this.hide()}}]})},300)):"0"===i?m&&(m.hide(!0),m=null):"2"===i&&(m||(m=new b({destroyOnHide:!0,canFullscreen:!0,hideOnClick:!1,title:g("offlineDeploy"),body:g("deployXmlPrepare"),afterShow:function(){this.$element.find(".btn").eq(0).html(g("clickToView",c))},buttons:[{text:""}]})))})},broadcast:function(a){c.deployTick(a||p.status,i)},clean:function(){k&&clearTimeout(k),k=0,p.status=""}};return p}),define("dialog/experiment/deploy",["zero","zero/zero","zero/ui/DialogEx","zero/ui/CronEditor","./CronSetting","../../i18n","../../global/config","../../ajax/offlineDeploy","../../midway/dialog/experiment/deploy","../../midway/dialog/experiment/deployProjectList","../../midway/dialog/experiment/deployNodeRow","../../midway/dialog/experiment/deployFooter","./deployError","./deploySuccess","../../workspace/deployTicker","../datasource/addODPSProject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(a,b){a?N.on("click",b):N.off("click",b)}function r(a){F?(J(a,function(a){a.projectId===F.projectId?(F=a,a.isSelected=!0):a.isSelected=!1}),F||(F=a[0],a[0].isSelected=!0)):K(a,function(a){if(a.isSelected)return F=a,!0}),F||(F=a[0]),F&&(F.isSelected=!0),z.$(P.deployProjectList).html(j({createProjectUrl:H,currentProject:F,projectList:a}))}function s(a){function b(){A.removeClass(Q.opened),q(!1,b)}function c(){u.call(A),A.hasClass(Q.opened)?b():(A.addClass(Q.opened),setTimeout(function(){q(!0,b)}))}function d(a,b){F.projectId=a,F.projectName=b,A.find(P.current).find(P.text).text(b)}function e(){var a=$(this);a.hasClass(Q.loading)||(a.addClass(Q.loading),h.updateProjectList().then(function(b){a.removeClass(Q.loading),r(b)}))}function f(){$(P.dialog).hide(),p.show(!0)}function g(a){$(a.target.parentNode.parentNode).remove()}function i(a){$(this);R||(R=new L({element:a.target,content:O("odpsTips"),escape:!1,position:"bottom right",align:"right",prefer:"counterclockwise",gap:2,onHidden:function(){R=null,setTimeout(this.destroy.bind(this),10)}}),R.delayedShow())}function j(a){$(this);R||(R=new L({element:a.target,content:"可以在下面添加更多依赖,用逗号作为分隔符",escape:!1,position:"bottom right",align:"right",prefer:"counterclockwise",gap:2,onHidden:function(){R=null,setTimeout(this.destroy.bind(this),10)}}),R.delayedShow())}function l(){C.removeClass(Q.opened),q(!1,l)}function m(){u.call(C[0]),C.hasClass(Q.opened)?l():(C.addClass(Q.opened),setTimeout(function(){q(!0,l)}))}function n(){D.removeClass(Q.opened),q(!1,n)}function o(){D.hasClass(Q.opened)||(D.addClass(Q.opened),setTimeout(function(){q(!0,n)}))}function s(){E.removeClass(Q.opened),q(!1,s)}function v(){E.hasClass(Q.opened)||(E.addClass(Q.opened),setTimeout(function(){q(!0,s)}))}function w(a,b){function c(a){var c=b?D:E,d="";J(a||[],function(a){d+="<li>"+a+"</li>"}),c.find(P.dropdown).html(d)}a||(c(),b?n():s()),h.listTables(a,G.name).then(function(a){c(a),a&&a.length?b?o():v():b?n():s()})}function x(a){for(var b=$(this).parents("tr"),c=b.data("tableInfo"),d=B.nodeDetail[a?"inputTables":"outputTables"],e=B[a?"upstreamNodes":"downstreamNodes"],f=d.length-1;f>=0;f--){if(d[f].tableName===c.tableName){d.splice(f,1);break}}for(var g=e.length-1;g>=0;g--){if(e[f].tableName===c.tableName){e.splice(f,1);break}}b.remove()}function y(a,b){h.getRelatedNodes(a,b,G.name,function(a){t(b?D:E,a.errorMessage)}).then(function(a){var c=a.odpsTable,d=a[b?"upstreamNode":"downstreamNode"],e=B.nodeDetail[b?"inputTables":"outputTables"],f=B[b?"upstreamNodes":"downstreamNodes"];if(!K(e,function(a){return a.tableName===c.tableName})){var g=b?H:M,h=$(k(d)).data("tableInfo",c);g.find("tbody").append(h),f.push(d),e.push(c)}}),b?n():s()}var z=a.$(P.wrap),A=z.find(P.deployProjectList);A.on("click",P.current,c).on("click",P.listItem,function(){var a=$(this);a.is(P.btnCreateProject)||(a.hasClass(Q.selected)||a.addClass(Q.selected).siblings(P.selected).removeClass(Q.selected),b(),d(a.attr("data-id"),a.find(P.text).text()))}),z.on("click",P.btnReloadProject,e),z.on("mouseover",P.helpIcon,i),z.on("mouseover",P.denpendenciesHelpIcon,j),z.on("click",P.btnAdd,f),z.on("click",P.inputTableDelBtn,g);var C=z.find(P.odpsProjectList);C.on("click",P.current,m).on("click",P.listItem,function(){var a=$(this);if(!a.hasClass(Q.selected)){var b=a.attr("data-id"),c=a.find(P.text).text();h.changeOdpsProject(B.experimentId,c,B.upstreamNodes,B.downstreamNodes,function(a){t(C,a.errorMessage)}).then(function(){a.addClass(Q.selected).siblings(P.selected).removeClass(Q.selected),G={id:b,name:c},C.find(P.current).find(P.text).text(c)})}l()});var D=z.find(P.inputTableName),E=z.find(P.outputTableName),H=z.find(P.inputTable),M=z.find(P.outputTable);H.on("click",P.btnDeleteRow,function(){x.call(this,!0)}),M.on("click",P.btnDeleteRow,function(){x.call(this,!1)});var N,S;D.on("click",function(){if(u.call(D),D.hasClass(Q.opened))return!1}).on("keydown",P.input,function(){var a=$(this);N&&clearTimeout(N),N=setTimeout(function(){w(I(a.val()),!0)},200)}).on("focus",P.input,function(){u.call(D);var a=$(this);setTimeout(function(){I(a.val())&&o()},200)}).on("click",P.btnSearch,function(){var a=$(this).siblings(P.input),b=I(a.val());b&&w(b,!0)}).on("click",P.listItem,function(){y($(this).text(),!0)}),E.on("click",function(){if(u.call(E),E.hasClass(Q.opened))return!1}).on("keydown",P.input,function(){var a=$(this);S&&clearTimeout(S),S=setTimeout(function(){w(I(a.val()),!1)},100)}).on("focus",P.input,function(){u.call(E);var a=$(this);setTimeout(function(){I(a.val())&&v()},100)}).on("click",P.btnSearch,function(){var a=$(this).siblings(P.input),b=I(a.val());b&&w(b,!1)}).on("click",P.listItem,function(){y($(this).text(),!1)})}function t(a,b){u.call(a[0]),a.parent().addClass("has-error"),a.after('<div class="err-msg"><span class="icon icon-close-c"></span>'+b+"</div>").on("focus.error-tips",u)}function u(){var a=$(this);a.parent().removeClass("has-error"),a.off(".error-tips").next(".err-msg").remove()}function v(a){var c=$(a.target);if(S||!T&&!c.hasClass("disabled")){c.addClass("disabled");var d=z.$(P.nodeName),e=z.$(P.nodeDesc),f=z.$(P.nodeParam),g=I(d.val());if(!g)return t(d,O("nodeNameEmpty")),c.removeClass("disabled"),!1;if(!/^[a-zA-Z]([a-zA-Z0-9_]+)?$/.test(g))return t(d,O("nodeNamePlaceHolder")),c.removeClass("disabled"),!1;var i=I(e.val());if(M.xss.test(i))return t(e,O("inputXss")),c.removeClass("disabled"),!1;var j=I(f.val());if(M.xss.test(j))return t(f,O("inputXss")),c.removeClass("disabled"),!1;if(!F){return t(z.$(P.wrap).find(P.deployProjectList),O("modelProjectEmpty")),c.removeClass("disabled"),!1}var k=b.extend(B.nodeDetail,{nodeName:g,nodeDescription:i,nodeParameter:j,scheduledCycle:z.cron.expression,deployPlatformProjectId:F.projectId,odpsProjectName:G.name,flag:z.$(P.accountType+":checked").val()});if(B.nodeDetail.needRegisterModel){var l=z.$("#modelName"),n=I(l.val());if(!n)return t(l,"请输入模型名称"),c.removeClass("disabled"),!1;k=b.extend(k,{modelName:n,userName:z.$("#userName").val(),modelDesc:z.$("#modelDesc").val(),modelType:z.$("#modelType").val(),modelSecurityLevel:z.$("#modelSecurityLevel").val()})}k.inputTables=[],z.$(".parentNodeOutputName").each(function(){var a=$(this).text().split(".");k.inputTables.push({projectName:a[0]||"",tableName:a[1]||"",fields:[]})});var p=z.$(P.dependenciesInput).val().trim();if(p.length>0){var q=k.experimentProjectName||k.odpsProjectName,r=p.split(",").filter(function(a){return a.trim().length>0}).map(function(a){if(-1!==a.indexOf(".")){var b=a.split(".");q=b[0]||"",a=b[1]||""}return{projectName:q,tableName:a,fields:[]}});k.inputTables=k.inputTables.concat(r)}if(0===k.inputTables.length)return window.alert("依赖父级节点不能为空"),!1;"ANT_CRO"===B.userDepartment&&(k.outputTables.length&&(k.outputTables=k.outputTables.map(function(a){return a.projectName.indexOf("_dev")>-1&&(a.projectName=k.odpsProjectName||k.experimentProjectName),a})),k.outputTableNamesFromOutputTables.length&&(k.outputTableNamesFromOutputTables=k.outputTableNamesFromOutputTables.map(function(a){if(a.indexOf("_dev.")>-1){return a.split(".")[1]}return a}))),T=!0,h.deployNode(k,function(a){E=!0,T=!1,c.removeClass("disabled"),z.hide(!1),setTimeout(function(){m.show(a.errorMessage).then(function(){E=!1,z.show()},function(){E=!1,z.options.animate=!1,z.show(),z.hide(!0)})},200)}).then(function(a){E=!1,C=!0,T=!1,c.removeClass("disabled"),z.hide(!0),setTimeout(function(){o.tick(a.url)},200)})}}function w(a,b){z=this,D||(r(B.deployPlatformProjectList),z.$(P.accountType+":eq("+("1"===B.nodeDetail.flag?"1":"0")+")").prop("checked",!0),a.needRegisterModel&&(z.$("#regModelRisk").val(a.modelSecurityLevel),z.$("#modelType").val(a.modelType)),"1"===b||S||$(".dialog-deploy #btnDeploy-mydata").attr("disabled",!0).addClass("disabled"),z.cron=new e({container:z.$(P.cronEditor)[0],expression:a.nodeDetail.scheduledCycle}),s(z),D=!0)}function x(a,b){E||(C?a():b())}function y(a,d){A=d,B=a,C=!1,D=!1,E=!1,F=null,G=null,a.nodeDetail=b.extend({nodeId:"",nodeName:"",nodeDescription:"",nodeParameter:"",scheduledCycle:"",userName:window.userAccount||"",modelName:"",modelDesc:"",modelType:"BINARY",modelSecurityLevel:"I"},a.nodeDetail),H=a.nodeDetail.createProjectUrl;var e=a.nodeDetail.odpsProjectName;return e&&K(a.odpsProjectList,function(a){if(a.name===e)return G=a,!0}),G||K(a.odpsProjectList,function(a){if(a.isDefault)return G=a,!0}),G||K(a.odpsProjectList,function(a){if("ANT_CRO"===B.userDepartment)return G=a,!0}),a.currentODPSProject=G||a.odpsProjectList[0],"ANT_CRO"===B.userDepartment&&(a.nodeDetail.outputTableNamesFromOutputTables.length&&(a.nodeDetail.outputTableNamesFromOutputTables=a.nodeDetail.outputTableNamesFromOutputTables.map(function(a){if(a.indexOf("_dev.")>-1){return a.split(".")[1]}return a})),a.downstreamNodes.length&&(a.downstreamNodes=a.downstreamNodes.map(function(a){if(a.tableName&&a.tableName.indexOf("_dev.")>-1){var b=a.tableName.split(".");a.tableName=b[1]}return a}))),new Promise(function(b,e){z=new c({destroyOnHide:!0,canFullscreen:!0,title:O("offlineDeploy"),className:"dialog-deploy",body:i(B),footer:l(),afterShow:function(){w.call(this,a,d)},afterHide:function(){x.call(this,b,e)},buttons:[{text:O("1"===d?"reDeploy":"deploy"),type:"primary",id:"btnDeploy-mydata",click:v},{text:O("close"),click:function(){this.hide()}}]})})}var z,A,B,C,D,E,F,G,H,I=b.trim,J=b.each,K=b.some,L=a.Popup,M=g.reg,N=$(window.document),O=f.translate,P={dialog:".dialog-deploy",wrap:".dialog-deploy-inner",helpIcon:".odps-container .icon-help-o",denpendenciesHelpIcon:".dependencies .icon-help-o",dependenciesInput:".more-denpendencies input",btnAdd:".btn-add-project",nodeName:"#deployNodeName",nodeDesc:"#deployNodeDesc",nodeParam:"#deployNoeParam",odpsProjectList:".dialog-odps-project",deployProjectList:".dialog-deploy-project",btnCreateProject:".btn-create-project",btnReloadProject:".btn-reload-project",accountType:'input[name="accountType"]',inputTable:".table-input",inputTableName:".deployACInput",inputTableDelBtn:".input-table-actions a",outputTable:".table-output",outputTableName:".deployACOutput",cronEditor:".deploy-cron-editor",btnSearch:".btn-search",btnDeleteRow:".btn-delete-row",dropdown:".pai-dropdown",listItem:".pai-dropdown li",text:".text",current:".current",selected:".selected",input:".form-control"},Q={loading:"loading",opened:"is-opened",selected:"selected"},R=null,S=["086670","86670","134533","123426","138351","103892"].indexOf(window.userNumber)>-1,T=!1;return{show:y}}),define("workspace/deployer",["zero/zero","../global/event","../ajax/offlineDeploy","../dialog/experiment/deploy","../dialog/experiment/deployError","./deployTicker"],function(a,b,c,d,e,f){"use strict";function g(a){a.nodeDetail.experimentId=j.id,d.show(a,f.status).then(function(){},function(){f.broadcast()})}function h(){c.createOrGetNode(j.id,function(a){e.show(a.errorMessage).then(function(){f.broadcast()},function(){f.broadcast()})}).then(function(a){a.experimentId=j.id,a.userDepartment=window.userDepartment||"",g(a)})}function i(){c.deleteNode(j.id).then(function(a){a?f.broadcast("-1"):f.broadcast("1")},function(){f.broadcast("1")})}var j;b.onDeployExperiment(h),b.onUnDeployExperiment(i);var k={init:function(a){k.clean(),j=a},clean:function(){j=null}};return k}),define("ajax/yunqiShare",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/experimentShare.json");return{share:function(a){return a.method="publishExperiment",c.post(a,!0)},checkStatus:function(a){return c.get({method:"getShareProcessState",processId:a})},getShareDetail:function(a,b){return c.get({method:"getExperimentDetail",experimentId:a,projectName:b}).then(function(a){return a&&a.experimentDetail||{}})},getTableInfo:function(a,b){return c.get({method:"getTableInfo",projectName:a,nodeInstanceId:b})},precheck:function(a){return c.get({method:"precheck",experimentId:a})}}}),define("ajax/analysis",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/analysis.json");return{explore:function(a,b,d,e){var f={method:"explore",nodeInstanceId:a,limit:d||1024};return b&&(f.sequence=b),e&&(f.loopTimestamp=e),c.get(f,!0).then(function(a){return a.warnMessage=a.warnMessage||"",a})},exploreTableName:function(a,b,d){var e={method:"exploreTableName",nodeInstanceId:a,sequence:b};return d&&(e.loopTimestamp=d),c.get(e)}}}),define("charts/theme.js",{color:["#61A5E8","#7ECF51","#EECB5F","#E4925D","#E16757","#9570E5","#605FF0","#85ca36","#1c9925","#0d8b5f","#0f9cd3","#2f7e9b","#2f677d","#9b7fed","#7453d6","#3b1d98","#27abb1","#017377","#015f63","#b86868","#5669b7","#e5aab4","#60b65f","#98d2b2","#c9c8bc","#45c3dc","#e17979","#5baa5a","#eaccc2","#ffaa74"],title:{textStyle:{fontWeight:"normal",color:"#00acee"}},dataRange:{color:["#1178ad","#72bbd0"]},toolbox:{color:["#00acee","#00acee","#00acee","#00acee"]},tooltip:{backgroundColor:"rgba(0,0,0,0.5)",axisPointer:{type:"shadow",lineStyle:{color:"#00acee",type:"dashed",width:1},crossStyle:{color:"#00acee"},shadowStyle:{color:"rgba(200,200,200,0.3)"}}},dataZoom:{dataBackgroundColor:"#eee",fillerColor:"rgba(144,197,237,0.2)",handleColor:"#00acee"},grid:{borderWidth:0},categoryAxis:{axisLine:{lineStyle:{color:"#d6d6d6",width:1}},axisTick:{show:!1,interval:"auto",inside:!1,length:5,lineStyle:{color:"#333",width:1}},axisLabel:{show:!0,interval:"auto",rotate:0,margin:8,textStyle:{color:"#b2b2b2"}},splitLine:{show:!0,lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#d6d6d6",width:1}},axisTick:{show:!0,inside:!1,length:10,lineStyle:{color:"#d6d6d6",width:1}},axisLabel:{show:!0,rotate:0,margin:20,textStyle:{color:"#7f7f7f"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{show:!0,lineStyle:{color:["#eee"]}}},timeline:{lineStyle:{color:"#00acee"},controlStyle:{normal:{color:"#00acee"},emphasis:{color:"#00acee"}}},k:{itemStyle:{normal:{color:"#1bb2d8",color0:"#99d2dd",lineStyle:{width:1,color:"#1c7099",color0:"#88b0bb"}}}},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#c12e34"}}},emphasis:{areaStyle:{color:"#99d2dd"},label:{textStyle:{color:"#c12e34"}}}}},force:{itemStyle:{normal:{linkStyle:{color:"#00acee"}}}},chord:{padding:4,itemStyle:{normal:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{axisLine:{show:!0,lineStyle:{color:[[.2,"#1bb2d8"],[.8,"#00acee"],[1,"#1c7099"]],width:8}},axisTick:{splitNumber:10,length:12,lineStyle:{color:"auto"}},axisLabel:{textStyle:{color:"auto"}},splitLine:{length:18,lineStyle:{color:"auto"}},pointer:{length:"90%",color:"auto"},title:{textStyle:{color:"#333"}},detail:{textStyle:{color:"auto"}}},markLine:{symbol:"none",symbolSize:[2,4],itemStyle:{normal:{borderWidth:1,label:{show:!1,position:"inside",textStyle:{color:"#333"}},lineStyle:{type:"dashed",shadowColor:"rgba(0,0,0,0)",shadowBlur:5,shadowOffsetX:3,shadowOffsetY:3}},emphasis:{label:{show:!1},lineStyle:{}}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}}),define("charts/bar",["zero/declare","./theme","../global/utils"],function(a,b,c){"use strict";var d={DEFAULT_SPLIT_NUMBER:15,IMAGE_NAME_PREFIX:"算法平台_",CHAR_LENGTH:8,GRID:{MIN:60,MAX:120}},e={grid:{borderWidth:0},xAxis:[{type:"category"}],yAxis:[{type:"value"}],series:[]},f={title:{show:!1},tooltip:{show:!1},dataZoom:{show:!1},toolbox:{show:!1},grid:{left:10,right:10,top:10,bottom:2},xAxis:[{show:!1}],yAxis:[{show:!1},{show:!1}],legend:{show:!1}},g={title:{show:!0},tooltip:{trigger:"axis"},toolbox:{show:!0,right:30,feature:{magicType:{show:!0,type:["line","bar"]},saveAsImage:{show:!0}}},xAxis:[{axisLabel:{show:!0,rotate:60}}],series:[]};return a("charts/Bar",{constructor:function(a){var c,d=$(a.element);c=a.overideBarOptions?$.extend(!0,{},e,a.mini?f:g,a):$.extend(!0,{},e,a,a.mini?f:g),this.smartAdapt(c),a.mini&&c.series&&c.series.length&&(c.dataZoom=null,c.tooltip.triggerOn="none",c.series.forEach(function(a){a.markLine={},a.markArea={},a.markPoint={},a.showSymbol=!1,a.hoverAnimation=!1})),this.echart=echarts.init(d.get(0),b),this.echart.setOption(c)},destroy:function(){if(this.echart)try{this.echart.dispose()}catch(a){console.warn(a)}},smartAdapt:function(a){var b=this,c=a.cancelSmart||{};return c.dataZoom||b.dataZoom(a),c.toolbox||b.toolbox(a),c.grid||b.grid(a),a},dataZoom:function(a){var b,c,e,f=a.xAxis[0].data||a.series[0].data,g={},h=f.length;h>d.DEFAULT_SPLIT_NUMBER?(b=d.DEFAULT_SPLIT_NUMBER,c=a.dataZoom&&a.dataZoom.end?a.dataZoom.end:null,e=Math.ceil(d.DEFAULT_SPLIT_NUMBER/h*100),g={show:!a.mini,start:0,end:c||e,realtime:!0}):b=h,$.extend(!0,a,{xAxis:[{splitNumber:b}],dataZoom:g})},grid:function(a){if(!a.mini){var b,c=this,e=a.dataZoom?a.dataZoom.height?a.dataZoom.height:30:0,f={};a.xAxis&&a.xAxis.forEach(function(a){b=c.textLength(a.data,a.axisLabel?a.axisLabel.rotate:0),b=d.GRID.MAX<b?d.GRID.MAX:b,b=d.GRID.MIN>b?d.GRID.MIN:b,"top"===a.position?f.y=b:f.y2=b+e}),$.extend(!0,a,{grid:f})}},toolbox:function(a){$.extend(!0,a,{toolbox:{feature:{magicType:{},saveAsImage:{name:d.IMAGE_NAME_PREFIX+a.imageName}}}})},changeSeries:function(a){this.echart.setOption({series:[{type:a}]})},textLength:function(a,b){var c,e=0;return a?(a.forEach(function(a){a+="",(c=a.length)>e&&(e=c)}),c=e*d.CHAR_LENGTH,b&&(c*=Math.sin(Math.PI*b/180)),Math.ceil(c)):0}})}),define("components/evaluate/util",[],function(){"use strict";return{getMaxDistancePoint:function(a){return _.max(a,function(a){return Math.abs(a.cn-a.cp)})},getLowerValue:function(a){return a.split(",")[0].slice(1)},getMaxF1ScorePoint:function(a){return _.max(a,function(a){return a.f1})}}}),define("midway/components/evaluate/tooltip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e){var f="";return a.each(b,function(a,b){f+='<dl class="echarts-tooltip-dl"><dt ',c&&(f+=' style="width:'+d(c)+';" '),f+=">"+d(b)+"</dt><dd ",e&&(f+=' style="width:'+d(e)+';" '),f+=">&nbsp;:&nbsp;"+d(a)+"</dd></dl>"}),f+=""}(b.infos,b.titleWidth,b.detailWidth)}}),define("components/evaluate/roc",["zero/declare","../../i18n","./util","../../midway/components/evaluate/tooltip"],function(a,b,c,d){"use strict";var e=b.translate;return a("evaluate/Roc",[],{constructor:function(){},parse:function(a,b){var f=[];a.forEach(function(a){f.push({fpr:a.fpr,r:a.r,dr:a.dr})}),f.sort(function(a,b){return a.fpr===b.fpr?a.r-b.r:a.fpr-b.fpr}),0!==f[0].r&&f.unshift({fpr:0,r:0,dr:"-"});var g="AUC值："+b.auc,h=e("RocChart");return{title:{text:h,subtext:g,left:10},name:h,imageName:h,dataZoom:{end:100},grid:{top:90,right:40,left:50},toolbox:{top:30},tooltip:{formatter:function(a){if(a&&a[0]){var b=f[a[0].dataIndex];return d({titleWidth:"70px",detailWidth:"100px",infos:{Threshold:c.getLowerValue(b.dr),Sensitivity:b.r,fpr:b.fpr}})}}},series:[{name:"ROC",itemStyle:{normal:{areaStyle:{type:"default"}}},data:f.map(function(a){return[a.fpr,a.r]}),type:"line",smooth:!0,symbol:"none"}],xAxis:[{type:"value",min:0,max:1,splitNumber:10}],yAxis:[{name:"sensitivity/fpr",min:0,max:1}]}},markRocPoints:function(a,b){var c=a.series[0].markPoint.data,d=Math.round(b.length/10);b.forEach(function(a){a.index%d==0&&c.push({xAxis:a.fpr,yAxis:a.r,value:a.r})})}})}),define("charts/ConfusionMatrixChart",["zero/declare","../global/utils"],function(a,b){"use strict";function c(a,b){if(!c.txt){var d=document.createElement("span");d.style.position="absolute",d.style.zIndex=-10,d.style.visibility="hidden",document.body.appendChild(d),c.txt=d}return c.txt.style.fontSize=b+"px",c.txt.textContent=a,c.txt.offsetWidth}var d={cellBackground:!1,margin:{top:50,right:50,bottom:50,left:50},width:400,height:400};return a("chart/ConfusionMatrixChart",[],{constructor:function(a){var b,c=this;if(b=c.data=a.data,c.options=$.extend(!0,{},d,a),c.container=a.container,c.labelsData=a.labels,!b)throw new Error("No data passed.");if(!Array.isArray(b)||!b.length||!Array.isArray(b[0]))throw new Error("Data type should be two-dimensional Array.");c.rowNum=b.length,c.colNum=b[0].length,c.labelsData||(c.labelsData=d3.range(c.rowNum)),c.render()},render:function(){var a=this,d=a.options,e=d.width,f=d.height,g=d.margin,h=d.columnTitle,i=d.rowTitle,j=a.data,k=a.container,l=a.labelsData,m=a.rowNum,n=a.colNum,o=0;l.map(function(a){c(a,12)>o&&(o=c(a,12))}),g.left=o+30,g.bottom=Math.floor(o*Math.sin(Math.PI/3))+20;var p=d3.select(k).append("svg").attr("class","confusion-matrix-chart").attr("width",e+g.left+g.right).attr("height",f+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")");p.append("rect").style("stroke","black").style("stroke-width","2px").attr("width",e).attr("height",f);var q=d3.scale.ordinal().domain(d3.range(n)).rangeBands([0,e]),r=d3.scale.ordinal().domain(d3.range(m)).rangeBands([0,f]),s=d3.scale.linear().domain([0,1]).range(["white","black"]),t=p.selectAll(".row").data(j).enter().append("g").attr("class","row").attr("transform",function(a,b){return"translate(0,"+r(b)+")"}),u=t.selectAll(".cell").data(function(a){return a}).enter().append("g").attr("class","cell").attr("transform",function(a,b){return"translate("+q(b)+", 0)"});u.append("rect").attr("width",q.rangeBand()).attr("height",r.rangeBand()).style("stroke-width",1).style("stroke","black"),u.append("text").attr("dy",".32em").attr("x",q.rangeBand()/2).attr("y",r.rangeBand()/2).attr("text-anchor","middle").style("fill",function(a,b){return d.cellBackground&&a>=.5?"white":"black"}).text(function(a,c){return b.toWeakFixed(a,3)}),d.cellBackground?t.selectAll(".cell").data(function(a,b){return j[b]}).style("fill",s):t.selectAll(".cell").style("fill","white");var v=p.append("g").attr("class","labels"),w=v.selectAll(".column-label").data(l).enter().append("g").attr("class","column-label").attr("transform",function(a,b){return"translate("+q(b)+","+f+")"});w.append("line").style("stroke","black").style("stroke-width","1px").attr("x1",q.rangeBand()/2).attr("x2",q.rangeBand()/2).attr("y1",0).attr("y2",5),w.append("text").attr("x",6).attr("y",r.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").attr("transform","rotate(-60)").text(function(a,b){return a});var x=v.selectAll(".row-label").data(l).enter().append("g").attr("class","row-label").attr("transform",function(a,b){return"translate(0,"+r(b)+")"})
;x.append("line").style("stroke","black").style("stroke-width","1px").attr("x1",0).attr("x2",-5).attr("y1",r.rangeBand()/2).attr("y2",r.rangeBand()/2),x.append("text").attr("x",-8).attr("y",r.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").text(function(a,b){return a}),v.selectAll(".column-title").data([h]).enter().append("g").attr("class","column-title").attr("transform",function(a,b){var c=f/2;return c>300&&(c=300),"translate(-20,"+c+") rotate(-90)"}).append("text").attr("text-anchor","middle").style("font-size","16px").style("fill","#f15e5e").style("letter-spacing","3px").text(function(a,b){return a}),v.selectAll(".row-title").data([i]).enter().append("g").attr("class","row-title").attr("transform",function(a,b){var c=e/2;return c>300&&(c=300),"translate("+c+","+-20+")"}).append("text").attr("text-anchor","middle").style("font-size","16px").style("fill","#f15e5e").style("letter-spacing","3px").text(function(a,b){return a})},destroy:function(){}})}),function(a,b){"use strict";"undefined"!=typeof define&&define.amd?define("components/../../../lib/canvg/rgbcolor",[],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.RGBColor=b()}("undefined"!=typeof window?window:this,function(){function a(b){this.ok=!1,"#"==b.charAt(0)&&(b=b.substr(1,6)),b=b.replace(/ /g,""),b=b.toLowerCase();var c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var d in c)b==d&&(b=c[d]);for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],f=0;f<e.length;f++){var g=e[f].re,h=e[f].process,i=g.exec(b);i&&(channels=h(i),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),c=this.b.toString(16);return 1==a.length&&(a="0"+a),1==b.length&&(b="0"+b),1==c.length&&(c="0"+c),"#"+a+b+c},this.getHelpXML=function(){for(var b=new Array,d=0;d<e.length;d++)for(var f=e[d].example,g=0;g<f.length;g++)b[b.length]=f[g];for(var h in c)b[b.length]=h;var i=document.createElement("ul");i.setAttribute("id","rgbcolor-examples");for(var d=0;d<b.length;d++)try{var j=document.createElement("li"),k=new a(b[d]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+k.toHex()+"; color:"+k.toHex(),l.appendChild(document.createTextNode("test"));var m=document.createTextNode(" "+b[d]+" -> "+k.toRGB()+" -> "+k.toHex());j.appendChild(l),j.appendChild(m),i.appendChild(j)}catch(a){}return i}}return a}),function(a,b){"use strict";"undefined"!=typeof define&&define.amd?define("components/../../../lib/canvg/StackBlur",[],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.BlurStack=b()}("undefined"!=typeof window?window:this,function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}return a}),function(a,b){"use strict";"undefined"!=typeof define&&define.amd?define("components/../../../lib/canvg/canvg",["./rgbcolor","./StackBlur"],b):"undefined"!=typeof module&&module.exports&&(module.exports=b(require("./rgbcolor"),require("./StackBlur"))),a.canvg=b(a.RGBColor,a.stackBlur)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=[0,0,0],c=function(c,d){var e=a.match(c);null!=e&&(b[d]+=e.length,a=a.replace(c," "))};return a=a.replace(/:not\(([^\)]*)\)/g,"     $1 "),a=a.replace(/{[\s\S]*/gm," "),c(g,1),c(h,0),c(j,1),c(k,2),c(l,1),c(m,1),a=a.replace(/[\*\s\+>~]/g," "),a=a.replace(/[#\.]/g," "),c(n,2),b.join("")}function d(d){var f={opts:d};f.FRAMERATE=30,f.MAX_VIRTUAL_PIXELS=3e4,f.log=function(a){},1==f.opts.log&&"undefined"!=typeof console&&(f.log=function(a){console.log(a)}),f.init=function(a){var b=0;f.UniqueId=function(){return"canvg"+ ++b},f.Definitions={},f.Styles={},f.StylesSpecificity={},f.Animations=[],f.Images=[],f.ctx=a,f.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},f.init(),f.ImagesLoaded=function(){for(var a=0;a<f.Images.length;a++)if(!f.Images[a].loaded)return!1;return!0},f.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},f.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},f.ajax=function(a){var b;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b?(b.open("GET",a,!1),b.send(null),b.responseText):null},f.parseXml=function(a){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,c=new Windows.Data.Xml.Dom.XmlLoadSettings;return c.prohibitDtd=!1,b.loadXml(a,c),b}if(window.DOMParser){return(new DOMParser).parseFromString(a,"text/xml")}a=a.replace(/<!DOCTYPE svg[^>]*>/,"");var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b},f.Property=function(a,b){this.name=a,this.value=b},f.Property.prototype.getValue=function(){return this.value},f.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},f.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},f.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:a},f.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a},f.Property.prototype.addOpacity=function(b){var c=this.value;if(null!=b.value&&""!=b.value&&"string"==typeof this.value){var d=new a(this.value);d.ok&&(c="rgba("+d.r+", "+d.g+", "+d.b+", "+b.numValue()+")")}return new f.Property(this.name,c)},f.Property.prototype.getDefinition=function(){var a=this.value.match(/#([^\)'"]+)/);return a&&(a=a[1]),a||(a=this.value),f.Definitions[a]},f.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},f.Property.prototype.getFillStyleDefinition=function(a,b){var c=this.getDefinition();if(null!=c&&c.createGradient)return c.createGradient(f.ctx,a,b);if(null!=c&&c.createPattern){if(c.getHrefAttribute().hasValue()){var d=c.attribute("patternTransform");c=c.getHrefAttribute().getDefinition(),d.hasValue()&&(c.attribute("patternTransform",!0).value=d.value)}return c.createPattern(f.ctx,a)}return null},f.Property.prototype.getDPI=function(a){return 96},f.Property.prototype.getEM=function(a){var b=12,c=new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);return c.hasValue()&&(b=c.toPixels(a)),b},f.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},f.Property.prototype.toPixels=function(a,b){if(!this.hasValue())return 0;var c=this.value+"";if(c.match(/em$/))return this.numValue()*this.getEM(a);if(c.match(/ex$/))return this.numValue()*this.getEM(a)/2;if(c.match(/px$/))return this.numValue();if(c.match(/pt$/))return this.numValue()*this.getDPI(a)*(1/72);if(c.match(/pc$/))return 15*this.numValue();if(c.match(/cm$/))return this.numValue()*this.getDPI(a)/2.54;if(c.match(/mm$/))return this.numValue()*this.getDPI(a)/25.4;if(c.match(/in$/))return this.numValue()*this.getDPI(a);if(c.match(/%$/))return this.numValue()*f.ViewPort.ComputeSize(a);var d=this.numValue();return b&&d<1?d*f.ViewPort.ComputeSize(a):d},f.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/s$/)?1e3*this.numValue():(a.match(/ms$/),this.numValue())},f.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var g={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return f.Property.prototype.toTextBaseline=function(){return this.hasValue()?g[this.value]:null},f.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(a,b,c,d,e,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",f.ctx.font);return{fontFamily:e||h.fontFamily,fontSize:d||h.fontSize,fontStyle:a||h.fontStyle,fontWeight:c||h.fontWeight,fontVariant:b||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var a=this;this.Parse=function(b){for(var c={},d=f.trim(f.compressSpaces(b||"")).split(" "),e={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<d.length;h++)e.fontStyle||-1==a.Styles.indexOf(d[h])?e.fontVariant||-1==a.Variants.indexOf(d[h])?e.fontWeight||-1==a.Weights.indexOf(d[h])?e.fontSize?"inherit"!=d[h]&&(g+=d[h]):("inherit"!=d[h]&&(c.fontSize=d[h].split("/")[0]),e.fontStyle=e.fontVariant=e.fontWeight=e.fontSize=!0):("inherit"!=d[h]&&(c.fontWeight=d[h]),e.fontStyle=e.fontVariant=e.fontWeight=!0):("inherit"!=d[h]&&(c.fontVariant=d[h]),e.fontStyle=e.fontVariant=!0):("inherit"!=d[h]&&(c.fontStyle=d[h]),e.fontStyle=!0);return""!=g&&(c.fontFamily=g),c}},f.ToNumberArray=function(a){for(var b=f.trim(f.compressSpaces((a||"").replace(/,/g," "))).split(" "),c=0;c<b.length;c++)b[c]=parseFloat(b[c]);return b},f.Point=function(a,b){this.x=a,this.y=b},f.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},f.Point.prototype.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c},f.CreatePoint=function(a){var b=f.ToNumberArray(a);return new f.Point(b[0],b[1])},f.CreatePath=function(a){for(var b=f.ToNumberArray(a),c=[],d=0;d<b.length;d+=2)c.push(new f.Point(b[d],b[d+1]));return c},f.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var j=[a,b],k=[c,d],l=[e,f],m=[g,h];for(this.addPoint(j[0],j[1]),this.addPoint(m[0],m[1]),i=0;i<=1;i++){var n=function(a){return Math.pow(1-a,3)*j[i]+3*Math.pow(1-a,2)*a*k[i]+3*(1-a)*Math.pow(a,2)*l[i]+Math.pow(a,3)*m[i]},o=6*j[i]-12*k[i]+6*l[i],p=-3*j[i]+9*k[i]-9*l[i]+3*m[i],q=3*k[i]-3*j[i];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(r<0)){var s=(-o+Math.sqrt(r))/(2*p);0<s&&s<1&&(0==i&&this.addX(n(s)),1==i&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);0<t&&t<1&&(0==i&&this.addX(n(t)),1==i&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;0<u&&u<1&&(0==i&&this.addX(n(u)),1==i&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},f.Transform=function(a){var b=this;this.Type={},this.Type.translate=function(a){this.p=f.CreatePoint(a),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(a){var b=f.ToNumberArray(a);this.angle=new f.Property("angle",b[0]),this.cx=b[1]||0,this.cy=b[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.unapply=function(a){a.translate(this.cx,this.cy),a.rotate(-1*this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(a){this.p=f.CreatePoint(a),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(a){this.m=f.ToNumberArray(a),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(a){var b=this.m[0],c=this.m[2],d=this.m[4],e=this.m[1],f=this.m[3],g=this.m[5],h=0,i=0,j=1,k=1/(b*(f*j-g*i)-c*(e*j-g*h)+d*(e*i-f*h));a.transform(k*(f*j-g*i),k*(g*h-e*j),k*(d*i-c*j),k*(b*j-d*h),k*(c*g-d*f),k*(d*e-b*g))},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(a){this.base=b.Type.matrix,this.base(a),this.angle=new f.Property("angle",a)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=b.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=b.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.unapply=function(a){for(var b=this.transforms.length-1;b>=0;b--)this.transforms[b].unapply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var c=f.trim(f.compressSpaces(a)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),d=0;d<c.length;d++){var e=f.trim(c[d].split("(")[0]),g=c[d].split("(")[1].replace(")",""),h=this.Type[e];if(void 0!==h){var i=new h(g);i.type=e,this.transforms.push(i)}}},f.AspectRatio=function(a,b,c,d,e,g,h,i,j,k){b=f.compressSpaces(b),b=b.replace(/^defer\s/,"");var l=b.split(" ")[0]||"xMidYMid",m=b.split(" ")[1]||"meet",n=c/d,o=e/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(d*=p,g*=p),"slice"==m&&(d*=q,g*=q),j=new f.Property("refX",j),k=new f.Property("refY",k),j.hasValue()&&k.hasValue()?a.translate(-p*j.toPixels("x"),-p*k.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(c/2-d/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,e/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(c-d,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,e-g)),"none"==l?a.scale(n,o):"meet"==m?a.scale(p,p):"slice"==m&&a.scale(q,q),a.translate(null==h?0:-h,null==i?0:-i)},f.Element={},f.EmptyProperty=new f.Property("EMPTY",""),f.Element.ElementBase=function(a){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(a,b){var c=this.attributes[a];return null!=c?c:(1==b&&(c=new f.Property(a,""),this.attributes[a]=c),c||f.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if("href"==a||a.match(/:href$/))return this.attributes[a];return f.EmptyProperty},this.style=function(a,b,c){var d=this.styles[a];if(null!=d)return d;var e=this.attribute(a);if(null!=e&&e.hasValue())return this.styles[a]=e,e;if(1!=c){var g=this.parent;if(null!=g){var h=g.style(a);if(null!=h&&h.hasValue())return h}}return 1==b&&(d=new f.Property(a,""),this.styles[a]=d),d||f.EmptyProperty},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(a.save(),this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").getDefinition();null!=c&&c.apply(a,this)}else this.setContext(a),this.renderChildren(a),this.clearContext(a);a.restore()}},this.setContext=function(a){},this.clearContext=function(a){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(a,b){var c=a;b&&(c=f.CreateElement(a)),c.parent=this,"title"!=c.type&&this.children.push(c)},this.addStylesFromStyleDefinition=function(){for(var b in f.Styles)if("@"!=b[0]&&e(a,b)){var c=f.Styles[b],d=f.StylesSpecificity[b];if(null!=c)for(var g in c){var h=this.stylesSpecificity[g];void 0===h&&(h="000"),d>h&&(this.styles[g]=c[g],this.stylesSpecificity[g]=d)}}};var b=new RegExp("^[A-Z-]+$"),c=function(a){return b.test(a)?a.toLowerCase():a};if(null!=a&&1==a.nodeType){for(var d=0;d<a.attributes.length;d++){var g=a.attributes[d],h=c(g.nodeName);this.attributes[h]=new f.Property(h,g.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var i=this.attribute("style").value.split(";"),d=0;d<i.length;d++)if(""!=f.trim(i[d])){var j=i[d].split(":"),k=f.trim(j[0]),l=f.trim(j[1]);this.styles[k]=new f.Property(k,l)}this.attribute("id").hasValue()&&null==f.Definitions[this.attribute("id").value]&&(f.Definitions[this.attribute("id").value]=this);for(var d=0;d<a.childNodes.length;d++){var m=a.childNodes[d];if(1==m.nodeType&&this.addChild(m,!0),this.captureTextNodes&&(3==m.nodeType||4==m.nodeType)){var n=m.value||m.text||m.textContent||"";""!=f.compressSpaces(n)&&this.addChild(new f.Element.tspan(m),!1)}}}},f.Element.RenderedElementBase=function(a){this.base=f.Element.ElementBase,this.base(a),this.setContext=function(a){if(this.style("fill").isUrlDefinition()){var b=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=b&&(a.fillStyle=b)}else if(this.style("fill").hasValue()){var c=this.style("fill");"currentColor"==c.value&&(c.value=this.style("color").value),"inherit"!=c.value&&(a.fillStyle="none"==c.value?"rgba(0,0,0,0)":c.value)}if(this.style("fill-opacity").hasValue()){var c=new f.Property("fill",a.fillStyle);c=c.addOpacity(this.style("fill-opacity")),a.fillStyle=c.value}if(this.style("stroke").isUrlDefinition()){var b=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=b&&(a.strokeStyle=b)}else if(this.style("stroke").hasValue()){var d=this.style("stroke");"currentColor"==d.value&&(d.value=this.style("color").value),"inherit"!=d.value&&(a.strokeStyle="none"==d.value?"rgba(0,0,0,0)":d.value)}if(this.style("stroke-opacity").hasValue()){var d=new f.Property("stroke",a.strokeStyle);d=d.addOpacity(this.style("stroke-opacity")),a.strokeStyle=d.value}if(this.style("stroke-width").hasValue()){var e=this.style("stroke-width").toPixels();a.lineWidth=0==e?.001:e}if(this.style("stroke-linecap").hasValue()&&(a.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(a.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(a.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var g=f.ToNumberArray(this.style("stroke-dasharray").value);void 0!==a.setLineDash?a.setLineDash(g):void 0!==a.webkitLineDash?a.webkitLineDash=g:void 0===a.mozDash||1==g.length&&0==g[0]||(a.mozDash=g);var h=this.style("stroke-dashoffset").numValueOrDefault(1);void 0!==a.lineDashOffset?a.lineDashOffset=h:void 0!==a.webkitLineDashOffset?a.webkitLineDashOffset=h:void 0!==a.mozDashOffset&&(a.mozDashOffset=h)}if(void 0!==a.font&&(a.font=f.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()){new f.Transform(this.style("transform",!1,!0).value).apply(a)}if(this.style("clip-path",!1,!0).hasValue()){var i=this.style("clip-path",!1,!0).getDefinition();null!=i&&i.apply(a)}this.style("opacity").hasValue()&&(a.globalAlpha=this.style("opacity").numValue())}},f.Element.RenderedElementBase.prototype=new f.Element.ElementBase,f.Element.PathElementBase=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.path=function(a){return null!=a&&a.beginPath(),new f.BoundingBox},this.renderChildren=function(a){this.path(a),f.Mouse.checkPath(this,a),""!=a.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?a.fill(this.style("fill-rule").value):a.fill()),""!=a.strokeStyle&&a.stroke();var b=this.getMarkers();if(null!=b){if(this.style("marker-start").isUrlDefinition()){var c=this.style("marker-start").getDefinition();c.render(a,b[0][0],b[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var c=this.style("marker-mid").getDefinition(),d=1;d<b.length-1;d++)c.render(a,b[d][0],b[d][1]);if(this.style("marker-end").isUrlDefinition()){var c=this.style("marker-end").getDefinition();c.render(a,b[b.length-1][0],b[b.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},f.Element.PathElementBase.prototype=new f.Element.RenderedElementBase,f.Element.svg=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.baseClearContext=this.clearContext,this.clearContext=function(a){this.baseClearContext(a),f.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(a){a.strokeStyle="rgba(0,0,0,0)",a.lineCap="butt",a.lineJoin="miter",a.miterLimit=4,void 0!==a.font&&void 0!==window.getComputedStyle&&(a.font=window.getComputedStyle(a.canvas).getPropertyValue("font")),this.baseSetContext(a),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),a.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var b=f.ViewPort.width(),c=f.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){b=this.attribute("width").toPixels("x"),c=this.attribute("height").toPixels("y");var d=0,e=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(d=-this.attribute("refX").toPixels("x"),e=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(a.beginPath(),a.moveTo(d,e),a.lineTo(b,e),a.lineTo(b,c),a.lineTo(d,c),a.closePath(),a.clip())}if(f.ViewPort.SetCurrent(b,c),this.attribute("viewBox").hasValue()){var g=f.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];b=g[2],c=g[3],f.AspectRatio(a,this.attribute("preserveAspectRatio").value,f.ViewPort.width(),b,f.ViewPort.height(),c,h,i,this.attribute("refX").value,this.attribute("refY").value),f.ViewPort.RemoveCurrent(),f.ViewPort.SetCurrent(g[2],g[3])}}},f.Element.svg.prototype=new f.Element.RenderedElementBase,f.Element.rect=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),h=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),g=Math.min(g,d/2),h=Math.min(h,e/2),null!=a&&(a.beginPath(),a.moveTo(b+g,c),a.lineTo(b+d-g,c),a.quadraticCurveTo(b+d,c,b+d,c+h),a.lineTo(b+d,c+e-h),a.quadraticCurveTo(b+d,c+e,b+d-g,c+e),a.lineTo(b+g,c+e),a.quadraticCurveTo(b,c+e,b,c+e-h),a.lineTo(b,c+h),a.quadraticCurveTo(b,c,b+g,c),a.closePath()),new f.BoundingBox(b,c,b+d,c+e)}},f.Element.rect.prototype=new f.Element.PathElementBase,f.Element.circle=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=this.attribute("cx").toPixels("x"),c=this.attribute("cy").toPixels("y"),d=this.attribute("r").toPixels();return null!=a&&(a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),a.closePath()),new f.BoundingBox(b-d,c-d,b+d,c+d)}},f.Element.circle.prototype=new f.Element.PathElementBase,f.Element.ellipse=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=(Math.sqrt(2)-1)/3*4,c=this.attribute("rx").toPixels("x"),d=this.attribute("ry").toPixels("y"),e=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(e,g-d),a.bezierCurveTo(e+b*c,g-d,e+c,g-b*d,e+c,g),a.bezierCurveTo(e+c,g+b*d,e+b*c,g+d,e,g+d),a.bezierCurveTo(e-b*c,g+d,e-c,g+b*d,e-c,g),a.bezierCurveTo(e-c,g-b*d,e-b*c,g-d,e,g-d),a.closePath()),new f.BoundingBox(e-c,g-d,e+c,g+d)}},f.Element.ellipse.prototype=new f.Element.PathElementBase,f.Element.line=function(a){this.base=f.Element.PathElementBase,this.base(a),this.getPoints=function(){return[new f.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new f.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(a){var b=this.getPoints();return null!=a&&(a.beginPath(),a.moveTo(b[0].x,b[0].y),a.lineTo(b[1].x,b[1].y)),new f.BoundingBox(b[0].x,b[0].y,b[1].x,b[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},f.Element.line.prototype=new f.Element.PathElementBase,f.Element.polyline=function(a){this.base=f.Element.PathElementBase,this.base(a),this.points=f.CreatePath(this.attribute("points").value),this.path=function(a){var b=new f.BoundingBox(this.points[0].x,this.points[0].y);null!=a&&(a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y));for(var c=1;c<this.points.length;c++)b.addPoint(this.points[c].x,this.points[c].y),null!=a&&a.lineTo(this.points[c].x,this.points[c].y);return b},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.length>0&&a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},f.Element.polyline.prototype=new f.Element.PathElementBase,f.Element.polygon=function(a){this.base=f.Element.polyline,this.base(a),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},f.Element.polygon.prototype=new f.Element.polyline,f.Element.path=function(a){this.base=f.Element.PathElementBase,this.base(a);var b=this.attribute("d").value;b=b.replace(/,/gm," ");for(var c=0;c<2;c++)b=b.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");b=b.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),b=b.replace(/([0-9])([+\-])/gm,"$1 $2");for(var c=0;c<2;c++)b=b.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");b=b.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),b=f.compressSpaces(b),b=f.trim(b),this.PathParser=new function(a){this.tokens=a.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new f.Point(0,0),this.control=new f.Point(0,0),this.current=new f.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var a=new f.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(a)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new f.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y),a},this.addMarker=function(a,b,c){
null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(b),this.path=function(a){var b=this.PathParser;b.reset();var c=new f.BoundingBox;for(null!=a&&a.beginPath();!b.isEnd();)switch(b.nextCommand(),b.command){case"M":case"m":var d=b.getAsCurrentPoint();for(b.addMarker(d),c.addPoint(d.x,d.y),null!=a&&a.moveTo(d.x,d.y),b.start=b.current;!b.isCommandOrEnd();){var d=b.getAsCurrentPoint();b.addMarker(d,b.start),c.addPoint(d.x,d.y),null!=a&&a.lineTo(d.x,d.y)}break;case"L":case"l":for(;!b.isCommandOrEnd();){var e=b.current,d=b.getAsCurrentPoint();b.addMarker(d,e),c.addPoint(d.x,d.y),null!=a&&a.lineTo(d.x,d.y)}break;case"H":case"h":for(;!b.isCommandOrEnd();){var g=new f.Point((b.isRelativeCommand()?b.current.x:0)+b.getScalar(),b.current.y);b.addMarker(g,b.current),b.current=g,c.addPoint(b.current.x,b.current.y),null!=a&&a.lineTo(b.current.x,b.current.y)}break;case"V":case"v":for(;!b.isCommandOrEnd();){var g=new f.Point(b.current.x,(b.isRelativeCommand()?b.current.y:0)+b.getScalar());b.addMarker(g,b.current),b.current=g,c.addPoint(b.current.x,b.current.y),null!=a&&a.lineTo(b.current.x,b.current.y)}break;case"C":case"c":for(;!b.isCommandOrEnd();){var h=b.current,i=b.getPoint(),j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,i),c.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":case"s":for(;!b.isCommandOrEnd();){var h=b.current,i=b.getReflectedControlPoint(),j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,i),c.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":case"q":for(;!b.isCommandOrEnd();){var h=b.current,j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,j),c.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":case"t":for(;!b.isCommandOrEnd();){var h=b.current,j=b.getReflectedControlPoint();b.control=j;var k=b.getAsCurrentPoint();b.addMarker(k,j,j),c.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":case"a":for(;!b.isCommandOrEnd();){var h=b.current,l=b.getScalar(),m=b.getScalar(),n=b.getScalar()*(Math.PI/180),o=b.getScalar(),p=b.getScalar(),k=b.getAsCurrentPoint(),q=new f.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new f.Point(s*l*q.y/m,s*-m*q.x/l),u=new f.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0);var C=1-p?1:-1,D=y+C*(B/2),E=new f.Point(u.x+l*Math.cos(D),u.y+m*Math.sin(D));if(b.addMarkerAngle(E,D-C*Math.PI/2),b.addMarkerAngle(k,D-C*Math.PI),c.addPoint(k.x,k.y),null!=a){var w=l>m?l:m,F=l>m?1:l/m,G=l>m?m/l:1;a.translate(u.x,u.y),a.rotate(n),a.scale(F,G),a.arc(0,0,w,y,y+B,1-p),a.scale(1/F,1/G),a.rotate(-n),a.translate(-u.x,-u.y)}}break;case"Z":case"z":null!=a&&a.closePath(),b.current=b.start}return c},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},f.Element.path.prototype=new f.Element.PathElementBase,f.Element.pattern=function(a){this.base=f.Element.ElementBase,this.base(a),this.createPattern=function(a,b){var c=this.attribute("width").toPixels("x",!0),d=this.attribute("height").toPixels("y",!0),e=new f.Element.svg;e.attributes.viewBox=new f.Property("viewBox",this.attribute("viewBox").value),e.attributes.width=new f.Property("width",c+"px"),e.attributes.height=new f.Property("height",d+"px"),e.attributes.transform=new f.Property("transform",this.attribute("patternTransform").value),e.children=this.children;var g=document.createElement("canvas");g.width=c,g.height=d;var h=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&h.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var i=-1;i<=1;i++)for(var j=-1;j<=1;j++)h.save(),e.attributes.x=new f.Property("x",i*g.width),e.attributes.y=new f.Property("y",j*g.height),e.render(h),h.restore();return a.createPattern(g,"repeat")}},f.Element.pattern.prototype=new f.Element.ElementBase,f.Element.marker=function(a){this.base=f.Element.ElementBase,this.base(a),this.baseRender=this.render,this.render=function(a,b,c){a.translate(b.x,b.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(c),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(a.lineWidth,a.lineWidth),a.save();var d=new f.Element.svg;d.attributes.viewBox=new f.Property("viewBox",this.attribute("viewBox").value),d.attributes.refX=new f.Property("refX",this.attribute("refX").value),d.attributes.refY=new f.Property("refY",this.attribute("refY").value),d.attributes.width=new f.Property("width",this.attribute("markerWidth").value),d.attributes.height=new f.Property("height",this.attribute("markerHeight").value),d.attributes.fill=new f.Property("fill",this.attribute("fill").valueOrDefault("black")),d.attributes.stroke=new f.Property("stroke",this.attribute("stroke").valueOrDefault("none")),d.children=this.children,d.render(a),a.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(1/a.lineWidth,1/a.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(-c),a.translate(-b.x,-b.y)}},f.Element.marker.prototype=new f.Element.ElementBase,f.Element.defs=function(a){this.base=f.Element.ElementBase,this.base(a),this.render=function(a){}},f.Element.defs.prototype=new f.Element.ElementBase,f.Element.GradientBase=function(a){this.base=f.Element.ElementBase,this.base(a),this.stops=[];for(var b=0;b<this.children.length;b++){var c=this.children[b];"stop"==c.type&&this.stops.push(c)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=a.attribute(c).value)}},this.createGradient=function(a,b,c){var d=this;this.getHrefAttribute().hasValue()&&(d=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(d));var e=function(a){if(c.hasValue()){return new f.Property("color",a).addOpacity(c).value}return a},g=this.getGradient(a,b);if(null==g)return e(d.stops[d.stops.length-1].color);for(var h=0;h<d.stops.length;h++)g.addColorStop(d.stops[h].offset,e(d.stops[h].color));if(this.attribute("gradientTransform").hasValue()){var i=f.ViewPort.viewPorts[0],j=new f.Element.rect;j.attributes.x=new f.Property("x",-f.MAX_VIRTUAL_PIXELS/3),j.attributes.y=new f.Property("y",-f.MAX_VIRTUAL_PIXELS/3),j.attributes.width=new f.Property("width",f.MAX_VIRTUAL_PIXELS),j.attributes.height=new f.Property("height",f.MAX_VIRTUAL_PIXELS);var k=new f.Element.g;k.attributes.transform=new f.Property("transform",this.attribute("gradientTransform").value),k.children=[j];var l=new f.Element.svg;l.attributes.x=new f.Property("x",0),l.attributes.y=new f.Property("y",0),l.attributes.width=new f.Property("width",i.width),l.attributes.height=new f.Property("height",i.height),l.children=[k];var m=document.createElement("canvas");m.width=i.width,m.height=i.height;var n=m.getContext("2d");return n.fillStyle=g,l.render(n),n.createPattern(m,"no-repeat")}return g}},f.Element.GradientBase.prototype=new f.Element.ElementBase,f.Element.linearGradient=function(a){this.base=f.Element.GradientBase,this.base(a),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(a,b){var c="objectBoundingBox"==this.gradientUnits()?b.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var d="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),f="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),g="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return d==f&&e==g?null:a.createLinearGradient(d,e,f,g)}},f.Element.linearGradient.prototype=new f.Element.GradientBase,f.Element.radialGradient=function(a){this.base=f.Element.GradientBase,this.base(a),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var d="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),f=d,g=e;this.attribute("fx").hasValue()&&(f="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var h="objectBoundingBox"==this.gradientUnits()?(c.width()+c.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(f,g,0,d,e,h)}},f.Element.radialGradient.prototype=new f.Element.GradientBase,f.Element.stop=function(a){this.base=f.Element.ElementBase,this.base(a),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var b=this.style("stop-color",!0);""===b.value&&(b.value="#000"),this.style("stop-opacity").hasValue()&&(b=b.addOpacity(this.style("stop-opacity"))),this.color=b.value},f.Element.stop.prototype=new f.Element.ElementBase,f.Element.AnimateBase=function(a){this.base=f.Element.ElementBase,this.base(a),f.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var a=this.attribute("attributeType").value,b=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(b,!0):this.parent.attribute(b,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(a){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+a;var b=!1;if(this.begin<this.duration){var c=this.calcValue();if(this.attribute("type").hasValue()){c=this.attribute("type").value+"("+c+")"}this.getProperty().value=c,b=!0}return b},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var a={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var b=a.progress*(this.values.value.length-1),c=Math.floor(b),d=Math.ceil(b);a.from=new f.Property("from",parseFloat(this.values.value[c])),a.to=new f.Property("to",parseFloat(this.values.value[d])),a.progress=(b-c)/(d-c)}else a.from=this.from,a.to=this.to;return a}},f.Element.AnimateBase.prototype=new f.Element.ElementBase,f.Element.animate=function(a){this.base=f.Element.AnimateBase,this.base(a),this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}},f.Element.animate.prototype=new f.Element.AnimateBase,f.Element.animateColor=function(b){this.base=f.Element.AnimateBase,this.base(b),this.calcValue=function(){var b=this.progress(),c=new a(b.from.value),d=new a(b.to.value);if(c.ok&&d.ok){var e=c.r+(d.r-c.r)*b.progress,f=c.g+(d.g-c.g)*b.progress,g=c.b+(d.b-c.b)*b.progress;return"rgb("+parseInt(e,10)+","+parseInt(f,10)+","+parseInt(g,10)+")"}return this.attribute("from").value}},f.Element.animateColor.prototype=new f.Element.AnimateBase,f.Element.animateTransform=function(a){this.base=f.Element.AnimateBase,this.base(a),this.calcValue=function(){for(var a=this.progress(),b=f.ToNumberArray(a.from.value),c=f.ToNumberArray(a.to.value),d="",e=0;e<b.length;e++)d+=b[e]+(c[e]-b[e])*a.progress+" ";return d}},f.Element.animateTransform.prototype=new f.Element.animate,f.Element.font=function(a){this.base=f.Element.ElementBase,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var b=0;b<this.children.length;b++){var c=this.children[b];"font-face"==c.type?(this.fontFace=c,c.style("font-family").hasValue()&&(f.Definitions[c.style("font-family").value]=this)):"missing-glyph"==c.type?this.missingGlyph=c:"glyph"==c.type&&(""!=c.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[c.unicode]&&(this.glyphs[c.unicode]=[]),this.glyphs[c.unicode][c.arabicForm]=c):this.glyphs[c.unicode]=c)}},f.Element.font.prototype=new f.Element.ElementBase,f.Element.fontface=function(a){this.base=f.Element.ElementBase,this.base(a),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},f.Element.fontface.prototype=new f.Element.ElementBase,f.Element.missingglyph=function(a){this.base=f.Element.path,this.base(a),this.horizAdvX=0},f.Element.missingglyph.prototype=new f.Element.path,f.Element.glyph=function(a){this.base=f.Element.path,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},f.Element.glyph.prototype=new f.Element.path,f.Element.text=function(a){this.captureTextNodes=!0,this.base=f.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a);var b=this.style("dominant-baseline").toTextBaseline();null==b&&(b=this.style("alignment-baseline").toTextBaseline()),null!=b&&(a.textBaseline=b)},this.getBoundingBox=function(){var a=this.attribute("x").toPixels("x"),b=this.attribute("y").toPixels("y"),c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize);return new f.BoundingBox(a,b-c,a+Math.floor(2*c/3)*this.children[0].getText().length,b)},this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(a,this,0);for(var b=0;b<this.children.length;b++)this.renderChild(a,this,this,b)},this.getAnchorDelta=function(a,b,c){var d=this.style("text-anchor").valueOrDefault("start");if("start"!=d){for(var e=0,f=c;f<b.children.length;f++){var g=b.children[f];if(f>c&&g.attribute("x").hasValue())break;e+=g.measureTextRecursive(a)}return-1*("end"==d?e:e/2)}return 0},this.renderChild=function(a,b,c,d){var e=c.children[d];e.attribute("x").hasValue()?(e.x=e.attribute("x").toPixels("x")+b.getAnchorDelta(a,c,d),e.attribute("dx").hasValue()&&(e.x+=e.attribute("dx").toPixels("x"))):(e.attribute("dx").hasValue()&&(b.x+=e.attribute("dx").toPixels("x")),e.x=b.x),b.x=e.x+e.measureText(a),e.attribute("y").hasValue()?(e.y=e.attribute("y").toPixels("y"),e.attribute("dy").hasValue()&&(e.y+=e.attribute("dy").toPixels("y"))):(e.attribute("dy").hasValue()&&(b.y+=e.attribute("dy").toPixels("y")),e.y=b.y),b.y=e.y,e.render(a);for(var d=0;d<e.children.length;d++)b.renderChild(a,b,e,d)}},f.Element.text.prototype=new f.Element.RenderedElementBase,f.Element.TextElementBase=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),void 0!==a.glyphs[d]&&null==(e=a.glyphs[d][f])&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d])}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e},this.renderChildren=function(a){var b=this.parent.style("font-family").getDefinition();if(null==b)""!=a.fillStyle&&a.fillText(f.compressSpaces(this.getText()),this.x,this.y),""!=a.strokeStyle&&a.strokeText(f.compressSpaces(this.getText()),this.x,this.y);else{var c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize),d=this.parent.style("font-style").valueOrDefault(f.Font.Parse(f.ctx.font).fontStyle),e=this.getText();b.isRTL&&(e=e.split("").reverse().join(""));for(var g=f.ToNumberArray(this.parent.attribute("dx").value),h=0;h<e.length;h++){var i=this.getGlyph(b,e,h),j=c/b.fontFace.unitsPerEm;a.translate(this.x,this.y),a.scale(j,-j);var k=a.lineWidth;a.lineWidth=a.lineWidth*b.fontFace.unitsPerEm/c,"italic"==d&&a.transform(1,0,.4,1,0,0),i.render(a),"italic"==d&&a.transform(1,0,-.4,1,0,0),a.lineWidth=k,a.scale(1/j,-1/j),a.translate(-this.x,-this.y),this.x+=c*(i.horizAdvX||b.horizAdvX)/b.fontFace.unitsPerEm,void 0===g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureTextRecursive=function(a){for(var b=this.measureText(a),c=0;c<this.children.length;c++)b+=this.children[c].measureTextRecursive(a);return b},this.measureText=function(a){var b=this.parent.style("font-family").getDefinition();if(null!=b){var c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize),d=0,e=this.getText();b.isRTL&&(e=e.split("").reverse().join(""));for(var g=f.ToNumberArray(this.parent.attribute("dx").value),h=0;h<e.length;h++){d+=(this.getGlyph(b,e,h).horizAdvX||b.horizAdvX)*c/b.fontFace.unitsPerEm,void 0===g[h]||isNaN(g[h])||(d+=g[h])}return d}var i=f.compressSpaces(this.getText());if(!a.measureText)return 10*i.length;a.save(),this.setContext(a);var j=a.measureText(i).width;return a.restore(),j}},f.Element.TextElementBase.prototype=new f.Element.RenderedElementBase,f.Element.tspan=function(a){this.captureTextNodes=!0,this.base=f.Element.TextElementBase,this.base(a),this.text=f.compressSpaces(a.value||a.text||a.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},f.Element.tspan.prototype=new f.Element.TextElementBase,f.Element.tref=function(a){this.base=f.Element.TextElementBase,this.base(a),this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}},f.Element.tref.prototype=new f.Element.TextElementBase,f.Element.a=function(a){this.base=f.Element.TextElementBase,this.base(a),this.hasText=a.childNodes.length>0;for(var b=0;b<a.childNodes.length;b++)3!=a.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?a.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(a){if(this.hasText){this.baseRenderChildren(a);var b=new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);f.Mouse.checkBoundingBox(this,new f.BoundingBox(this.x,this.y-b.toPixels("y"),this.x+this.measureText(a),this.y))}else if(this.children.length>0){var c=new f.Element.g;c.children=this.children,c.parent=this,c.render(a)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){f.ctx.canvas.style.cursor="pointer"}},f.Element.a.prototype=new f.Element.TextElementBase,f.Element.image=function(a){this.base=f.Element.RenderedElementBase,this.base(a);var b=this.getHrefAttribute().value;if(""!=b){var c=b.match(/\.svg$/);if(f.Images.push(this),this.loaded=!1,c)this.img=f.ajax(b),this.loaded=!0;else{this.img=document.createElement("img"),1==f.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0},this.img.onerror=function(){f.log('ERROR: image "'+b+'" not found'),d.loaded=!0},this.img.src=b}this.renderChildren=function(a){var b=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");0!=e&&0!=g&&(a.save(),c?a.drawSvg(this.img,b,d,e,g):(a.translate(b,d),f.AspectRatio(a,this.attribute("preserveAspectRatio").value,e,this.img.width,g,this.img.height,0,0),a.drawImage(this.img,0,0)),a.restore())},this.getBoundingBox=function(){var a=this.attribute("x").toPixels("x"),b=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y");return new f.BoundingBox(a,b,a+c,b+d)}}},f.Element.image.prototype=new f.Element.RenderedElementBase,f.Element.g=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.getBoundingBox=function(){for(var a=new f.BoundingBox,b=0;b<this.children.length;b++)a.addBoundingBox(this.children[b].getBoundingBox());return a}},f.Element.g.prototype=new f.Element.RenderedElementBase,f.Element.symbol=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.render=function(a){}},f.Element.symbol.prototype=new f.Element.RenderedElementBase,f.Element.style=function(a){this.base=f.Element.ElementBase,this.base(a);for(var b="",d=0;d<a.childNodes.length;d++)b+=a.childNodes[d].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),b=f.compressSpaces(b);for(var e=b.split("}"),d=0;d<e.length;d++)if(""!=f.trim(e[d]))for(var g=e[d].split("{"),h=g[0].split(","),i=g[1].split(";"),j=0;j<h.length;j++){var k=f.trim(h[j]);if(""!=k){for(var l=f.Styles[k]||{},m=0;m<i.length;m++){var n=i[m].indexOf(":"),o=i[m].substr(0,n),p=i[m].substr(n+1,i[m].length-n);null!=o&&null!=p&&(l[f.trim(o)]=new f.Property(f.trim(o),f.trim(p)))}if(f.Styles[k]=l,f.StylesSpecificity[k]=c(k),"@font-face"==k)for(var q=l["font-family"].value.replace(/"/g,""),r=l.src.value.split(","),s=0;s<r.length;s++)if(r[s].indexOf('format("svg")')>0)for(var t=r[s].indexOf("url"),u=r[s].indexOf(")",t),v=r[s].substr(t+5,u-t-6),w=f.parseXml(f.ajax(v)),x=w.getElementsByTagName("font"),y=0;y<x.length;y++){var z=f.CreateElement(x[y]);f.Definitions[q]=z}}}},f.Element.style.prototype=new f.Element.ElementBase,f.Element.use=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)},this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()},this.renderChildren=function(a){if(null!=b){var c=b;"symbol"==b.type&&(c=new f.Element.svg,c.type="svg",c.attributes.viewBox=new f.Property("viewBox",b.attribute("viewBox").value),c.attributes.preserveAspectRatio=new f.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),c.attributes.overflow=new f.Property("overflow",b.attribute("overflow").value),c.children=b.children),"svg"==c.type&&(this.attribute("width").hasValue()&&(c.attributes.width=new f.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(c.attributes.height=new f.Property("height",this.attribute("height").value)));var d=c.parent;c.parent=null,c.render(a),c.parent=d}}},f.Element.use.prototype=new f.Element.RenderedElementBase,f.Element.mask=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==e&&0==g){for(var h=new f.BoundingBox,i=0;i<this.children.length;i++)h.addBoundingBox(this.children[i].getBoundingBox());var c=Math.floor(h.x1),d=Math.floor(h.y1),e=Math.floor(h.width()),g=Math.floor(h.height())}var j=b.attribute("mask").value;b.attribute("mask").value="";var k=document.createElement("canvas");k.width=c+e,k.height=d+g;var l=k.getContext("2d");this.renderChildren(l);var m=document.createElement("canvas");m.width=c+e,m.height=d+g;var n=m.getContext("2d");b.render(n),n.globalCompositeOperation="destination-in",n.fillStyle=l.createPattern(k,"no-repeat"),n.fillRect(0,0,c+e,d+g),a.fillStyle=n.createPattern(m,"no-repeat"),a.fillRect(0,0,c+e,d+g),b.attribute("mask").value=j},this.render=function(a){}},f.Element.mask.prototype=new f.Element.ElementBase,f.Element.clipPath=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a){var b=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var c=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},b.call(a);for(var d=0;d<this.children.length;d++){var e=this.children[d];if(void 0!==e.path){var g=null;e.style("transform",!1,!0).hasValue()&&(g=new f.Transform(e.style("transform",!1,!0).value),g.apply(a)),e.path(a),CanvasRenderingContext2D.prototype.closePath=c,g&&g.unapply(a)}}c.call(a),a.clip(),CanvasRenderingContext2D.prototype.beginPath=b,CanvasRenderingContext2D.prototype.closePath=c},this.render=function(a){}},f.Element.clipPath.prototype=new f.Element.ElementBase,f.Element.filter=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b){var c=b.getBoundingBox(),d=Math.floor(c.x1),e=Math.floor(c.y1),f=Math.floor(c.width()),g=Math.floor(c.height()),h=b.style("filter").value;b.style("filter").value="";for(var i=0,j=0,k=0;k<this.children.length;k++){var l=this.children[k].extraFilterDistance||0;i=Math.max(i,l),j=Math.max(j,l)}var m=document.createElement("canvas");m.width=f+2*i,m.height=g+2*j;var n=m.getContext("2d");n.translate(-d+i,-e+j),b.render(n);for(var k=0;k<this.children.length;k++)"function"==typeof this.children[k].apply&&this.children[k].apply(n,0,0,f+2*i,g+2*j);a.drawImage(m,0,0,f+2*i,g+2*j,d-i,e-j,f+2*i,g+2*j),b.style("filter",!0).value=h},this.render=function(a){}},f.Element.filter.prototype=new f.Element.ElementBase,f.Element.feMorphology=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b,c,d,e){}},f.Element.feMorphology.prototype=new f.Element.ElementBase,f.Element.feComposite=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b,c,d,e){}},f.Element.feComposite.prototype=new f.Element.ElementBase,f.Element.feColorMatrix=function(a){function b(a,b,c,d,e,f){return a[c*d*4+4*b+f]}function c(a,b,c,d,e,f,g){a[c*d*4+4*b+f]=g}function d(a,b){var c=e[a];return c*(c<0?b-255:b)}this.base=f.Element.ElementBase,this.base(a);var e=f.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var g=e[0];e=[.213+.787*g,.715-.715*g,.072-.072*g,0,0,.213-.213*g,.715+.285*g,.072-.072*g,0,0,.213-.213*g,.715-.715*g,.072+.928*g,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var h=e[0]*Math.PI/180,i=function(a,b,c){return a+Math.cos(h)*b+Math.sin(h)*c};e=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,e,f,g,h){for(var i=a.getImageData(0,0,g,h),f=0;f<h;f++)for(var e=0;e<g;e++){var j=b(i.data,e,f,g,h,0),k=b(i.data,e,f,g,h,1),l=b(i.data,e,f,g,h,2),m=b(i.data,e,f,g,h,3);c(i.data,e,f,g,h,0,d(0,j)+d(1,k)+d(2,l)+d(3,m)+d(4,1)),c(i.data,e,f,g,h,1,d(5,j)+d(6,k)+d(7,l)+d(8,m)+d(9,1)),c(i.data,e,f,g,h,2,d(10,j)+d(11,k)+d(12,l)+d(13,m)+d(14,1)),c(i.data,e,f,g,h,3,d(15,j)+d(16,k)+d(17,l)+d(18,m)+d(19,1))}a.clearRect(0,0,g,h),a.putImageData(i,0,0)}},f.Element.feColorMatrix.prototype=new f.Element.ElementBase,f.Element.feGaussianBlur=function(a){this.base=f.Element.ElementBase,this.base(a),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(a,c,d,e,g){if(void 0===b.canvasRGBA)return void f.log("ERROR: StackBlur.js must be included for blur to work");a.canvas.id=f.UniqueId(),a.canvas.style.display="none",document.body.appendChild(a.canvas),b.canvasRGBA(a.canvas.id,c,d,e,g,this.blurRadius),document.body.removeChild(a.canvas)}},f.Element.feGaussianBlur.prototype=new f.Element.ElementBase,f.Element.title=function(a){},f.Element.title.prototype=new f.Element.ElementBase,f.Element.desc=function(a){},f.Element.desc.prototype=new f.Element.ElementBase,f.Element.MISSING=function(a){f.log("ERROR: Element '"+a.nodeName+"' not yet implemented.")},f.Element.MISSING.prototype=new f.Element.ElementBase,f.CreateElement=function(a){var b=a.nodeName.replace(/^[^:]+:/,"");b=b.replace(/\-/g,"");var c=null;return c=void 0!==f.Element[b]?new f.Element[b](a):new f.Element.MISSING(a),c.type=a.nodeName,c},f.load=function(a,b){f.loadXml(a,f.ajax(b))},f.loadXml=function(a,b){f.loadXmlDoc(a,f.parseXml(b))},f.loadXmlDoc=function(a,b){f.init(a);var c=function(b){for(var c=a.canvas;c;)b.x-=c.offsetLeft,b.y-=c.offsetTop,c=c.offsetParent;return window.scrollX&&(b.x+=window.scrollX),window.scrollY&&(b.y+=window.scrollY),b};1!=f.opts.ignoreMouse&&(a.canvas.onclick=function(a){var b=c(new f.Point(null!=a?a.clientX:event.clientX,null!=a?a.clientY:event.clientY));f.Mouse.onclick(b.x,b.y)},a.canvas.onmousemove=function(a){var b=c(new f.Point(null!=a?a.clientX:event.clientX,null!=a?a.clientY:event.clientY));f.Mouse.onmousemove(b.x,b.y)});var d=f.CreateElement(b.documentElement);d.root=!0,d.addStylesFromStyleDefinition();var e=!0,g=function(){f.ViewPort.Clear(),
a.canvas.parentNode&&f.ViewPort.SetCurrent(a.canvas.parentNode.clientWidth,a.canvas.parentNode.clientHeight),1!=f.opts.ignoreDimensions&&(d.style("width").hasValue()&&(a.canvas.width=d.style("width").toPixels("x"),a.canvas.style.width=a.canvas.width+"px"),d.style("height").hasValue()&&(a.canvas.height=d.style("height").toPixels("y"),a.canvas.style.height=a.canvas.height+"px"));var c=a.canvas.clientWidth||a.canvas.width,g=a.canvas.clientHeight||a.canvas.height;if(1==f.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(c=d.style("width").toPixels("x"),g=d.style("height").toPixels("y")),f.ViewPort.SetCurrent(c,g),null!=f.opts.offsetX&&(d.attribute("x",!0).value=f.opts.offsetX),null!=f.opts.offsetY&&(d.attribute("y",!0).value=f.opts.offsetY),null!=f.opts.scaleWidth||null!=f.opts.scaleHeight){var h=null,i=null,j=f.ToNumberArray(d.attribute("viewBox").value);null!=f.opts.scaleWidth&&(d.attribute("width").hasValue()?h=d.attribute("width").toPixels("x")/f.opts.scaleWidth:isNaN(j[2])||(h=j[2]/f.opts.scaleWidth)),null!=f.opts.scaleHeight&&(d.attribute("height").hasValue()?i=d.attribute("height").toPixels("y")/f.opts.scaleHeight:isNaN(j[3])||(i=j[3]/f.opts.scaleHeight)),null==h&&(h=i),null==i&&(i=h),d.attribute("width",!0).value=f.opts.scaleWidth,d.attribute("height",!0).value=f.opts.scaleHeight,d.style("transform",!0,!0).value+=" scale("+1/h+","+1/i+")"}1!=f.opts.ignoreClear&&a.clearRect(0,0,c,g),d.render(a),e&&(e=!1,"function"==typeof f.opts.renderCallback&&f.opts.renderCallback(b))},h=!0;f.ImagesLoaded()&&(h=!1,g()),f.intervalID=setInterval(function(){var a=!1;if(h&&f.ImagesLoaded()&&(h=!1,a=!0),1!=f.opts.ignoreMouse&&(a|=f.Mouse.hasEvents()),1!=f.opts.ignoreAnimation)for(var b=0;b<f.Animations.length;b++)a|=f.Animations[b].update(1e3/f.FRAMERATE);"function"==typeof f.opts.forceRedraw&&1==f.opts.forceRedraw()&&(a=!0),a&&(g(),f.Mouse.runEvents())},1e3/f.FRAMERATE)},f.stop=function(){f.intervalID&&clearInterval(f.intervalID)},f.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){a.onclick&&a.onclick()}})},this.onmousemove=function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){a.onmousemove&&a.onmousemove()}})},this.eventElements=[],this.checkPath=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[c]=a)}},this.checkBoundingBox=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInBox(d.x,d.y)&&(this.eventElements[c]=a)}},this.runEvents=function(){f.ctx.canvas.style.cursor="";for(var a=0;a<this.events.length;a++)for(var b=this.events[a],c=this.eventElements[a];c;)b.run(c),c=c.parent;this.events=[],this.eventElements=[]}},f}var e,f=function(a,b,c){if(null!=a||null!=b||null!=c){"string"==typeof a&&(a=document.getElementById(a)),null!=a.svg&&a.svg.stop();var e=d(c||{});1==a.childNodes.length&&"OBJECT"==a.childNodes[0].nodeName||(a.svg=e);var g=a.getContext("2d");void 0!==b.documentElement?e.loadXmlDoc(g,b):"<"==b.substr(0,1)?e.loadXml(g,b):e.load(g,b)}else for(var h=document.querySelectorAll("svg"),i=0;i<h.length;i++){var j=h[i],k=document.createElement("canvas");k.width=j.clientWidth,k.height=j.clientHeight,j.parentNode.insertBefore(k,j),j.parentNode.removeChild(j);var l=document.createElement("div");l.appendChild(j),f(k,l.innerHTML)}};void 0!==Element.prototype.matches?e=function(a,b){return a.matches(b)}:void 0!==Element.prototype.webkitMatchesSelector?e=function(a,b){return a.webkitMatchesSelector(b)}:void 0!==Element.prototype.mozMatchesSelector?e=function(a,b){return a.mozMatchesSelector(b)}:void 0!==Element.prototype.msMatchesSelector?e=function(a,b){return a.msMatchesSelector(b)}:void 0!==Element.prototype.oMatchesSelector?e=function(a,b){return a.oMatchesSelector(b)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(e=function(a,b){return $(a).is(b)}),void 0===e&&(e=Sizzle.matchesSelector));var g=/(\[[^\]]+\])/g,h=/(#[^\s\+>~\.\[:]+)/g,j=/(\.[^\s\+>~\.\[:]+)/g,k=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,l=/(:[\w-]+\([^\)]*\))/gi,m=/(:[^\s\+>~\.\[:]+)/g,n=/([^\s\+>~\.\[:]+)/g;return"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(a,b,c,d,e,g){var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:b,offsetY:c,scaleWidth:d,scaleHeight:e};for(var i in g)g.hasOwnProperty(i)&&(h[i]=g[i]);f(this.canvas,a,h)}),f}),function(a){"object"==typeof exports&&"module"==typeof module?module.exports=FitImage:"function"==typeof define&&define.amd?define("components/../../../lib/fit-image/index",["zero/zero"],a):"object"==typeof exports?exports.FitImage=a:window.FitImage=a}(function(){function a(a,b,c){if(!1==a instanceof Uint8ClampedArray){throw new Error("FitImage need an pixel data array to init!")}this.width=b,this.height=c,this.pixelData=a}return a.prototype.effectivePixelRect=function(a){void 0==a&&(a=0);for(var b=this.width,c=this.height,d=this.pixelData,e=[0,c],f=[0,0],g=[0,0],h=[b,0],i=0,j=0;j<d.length;j){i++,j+=3;if(0!==d[j++]){var k=i%b,l=(i-k)/b;e[1]>l&&(e[0]=k,e[1]=l),f[0]<k&&(f[0]=k,f[1]=l),g[1]<l&&(g[0]=k,g[1]=l),h[0]>k&&(h[0]=k,h[1]=l)}}return e[1]-=a,e[1]<0&&(e[1]=0),f[0]+=a,f[0]>b&&(f[0]=b),g[1]+=a,g[1]>c&&(g[1]=c),h[0]-=a,h[0]<0&&(h[0]=0),{p1:e,p2:f,p3:g,p4:h}},a}),define("global/html2picture",["zero/zero","zero/declare","./download"],function(a,b,c){"use strict";return b("global/html2picture",[],{constructor:function(a){this.$container=$("<div></div>"),a.classNames&&this.$container.addClass(a.classNames.join(" ")),$(a.parent||document.body).append(this.$container)},getContainer:function(){return this.$container},export:function(a,b,d){html2canvas(this.$container,{height:this.$container.height()+20,background:"#fff"}).then(function(e){c(e.toDataURL(b),a),d&&d()})}})}),define("components/svg2canvas/process2canvas",["zero/zero","zero/declare","../../../../lib/canvg/canvg","../../../../lib/fit-image/index","../../global/download","../../global/html2picture"],function(a,b,c,d,e,f){"use strict";return b("components/Process2Canvas",[],{constructor:function(a){this.originalDom=$(a),this.experimentDom=$(a).clone()},exports:function(){var a=this,b=$('<div"></div>'),d=this.originalDom,e=this.experimentDom;e=this._filterExperimentDom(e);var f=this._generateEmptyCanvas(e);b.width(d.width()),b.height(d.height()),b.css({position:"absolute",zIndex:-9999});var g=(new XMLSerializer).serializeToString(e[0]);g=g.replace(/xmlns=\"http:\/\/www\.w3\.org\/2000\/svg\"/,"");var f=document.createElement("canvas");c(f,g),$(f).css("position","absolute"),b.append(f);var h=this._generateForeignLayer(e);return b.append(h),new Promise(function(c,d){document.body.appendChild(b[0]),html2canvas(b[0],{useCORS:!0}).then(function(d){b.remove();var e=a._fitImage(d);c(e)})})},_filterExperimentDom:function(a){return a.find("foreignObject").remove(),a.find("path").attr("style","fill:none;stroke:rgb(128,128,128);stroke-width:1px;"),a},_generateEmptyCanvas:function(a){return $("<canvas></canvas>").css({position:"absolute",left:"0",top:"0"}),document.createElement("canvas")},_generateForeignLayer:function(a){var b=$(this.originalDom),c=b.offset(),d=$("<div></div>");return d.css("position","absolute"),d.width(b.width()),d.height(b.height()),$(".pane-node body .pane-node-content",b).each(function(a,b){var e=$(b),f=e.offset(),g=e.clone(),h=$("<div></div>");h.append(g),h.css("position","absolute");var i=f.left-c.left,j=f.top-c.top;h.css({left:i,top:j}),d.append(h)}),d},_fitImage:function(a){var b=a.getContext("2d"),c=a.width,e=a.height,f=b.getImageData(0,0,c,e),g=new d(f.data,c,e),h=g.effectivePixelRect(10),i=h.p1,j=h.p2,k=h.p3,l=h.p4,m=l[0],n=i[1],o=j[0]-l[0],p=k[1]-i[1],q=b.getImageData(m,n,o,p),r=document.createElement("canvas");return r.width=o,r.height=p,r.getContext("2d").putImageData(q,0,0),r}})}),define("components/svg2canvas/confusion2canvas",["zero/zero","zero/declare","../../../../lib/canvg/canvg","../../../../lib/fit-image/index","../../global/html2picture"],function(a,b,c,d,e){"use strict";return b("components/Confusion2Canvas",[],{constructor:function(a){this.$chartDom=$(a).clone()},exports:function(){var a=this.$chartDom.find(".confusion-matrix-chart"),b=document.createElement("canvas"),d=(new XMLSerializer).serializeToString(a[0]);return d=d.replace(/xmlns=\"http:\/\/www\.w3\.org\/2000\/svg\"/,""),c(b,d),b}})}),define("midway/dialog/experiment/yunqiShare",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f,g,h){return'<div><h5 class="red">本实验包括数据将分享到云栖社区数据公众号供所有人访问</h5><h4>'+e(d("basicInfo"))+"</h4><div><span>"+e(d("experimentName"))+":&nbsp;&nbsp;</span><span>"+e(a||"")+'</span><span class="basic-info-item">'+e(d("userAccount"))+":&nbsp;&nbsp;</span><span>"+e(b||"")+'</span><span class="basic-info-item">'+e(d("publishTime"))+":&nbsp;&nbsp;</span><span>"+e(c||"")+'</span></div><div class="form-item split-item"><span class="textarea-tip">'+e(d("scenarioDescription"))+':&nbsp;&nbsp;</span><textarea placeholder="'+e(d("scenarioTip"))+'" class="scenario-description form-block form-item form-control"></textarea></div><h4>'+e(d("dataType"))+'</h4><div class="form-item"><div class="form-block form-item left-block form-block-3"><span>'+e(d("experimentData"))+':&nbsp;&nbsp;</span><div class="experiment-data form-block"><div class="loading"></div></div></div><div class="form-block form-block-2"><div class="form-item"><span>'+e(d("dataCommingFrom"))+':&nbsp;&nbsp;</span><input placeholder="'+e(d("dataSourceTip"))+'" class="data-source form-block form-control"></input></div><div class="split-item"><span>'+e(d("dataLength"))+':&nbsp;&nbsp;</span><span class="data-length"></span></div><div class="split-item"><span>'+e(d("fieldNumber"))+':&nbsp;&nbsp;</span><span class="field-number"></span></div><div class="form-item split-item"><span class="textarea-tip">'+e(d("fieldMeaning"))+':&nbsp;&nbsp;</span><textarea placeholder="'+e(d("fieldTip"))+'" class="field-meaning form-block form-item form-control"></textarea></div></div></div><h4>'+e(d("experimentDescription"))+'</h4><div class="form-item"><div class="form-block form-item left-block form-block-3"><span>'+e(d("experimentProcess"))+':&nbsp;&nbsp;</span><div class="experiment-process form-block"><div class="loading"></div><div class="experiment-process-img"></div></div></div><div class="form-block form-block-2"><div><span>'+e(d("experimentalScene"))+":&nbsp;&nbsp;</span><span>"+e(f||"")+'</span></div><div class="split-item"><span>'+e(d("componentsUsed"))+":&nbsp;&nbsp;</span><span>"+e(g||"")+'</span></div><div class="split-item"><span>'+e(d("algorithmUsed"))+":&nbsp;&nbsp;</span><span>"+e(h||"")+'</span></div><div class="split-item form-item"><span>'+e(d("addTag"))+':&nbsp;&nbsp;</span><div class="form-block tag-box"></div></div></div></div><h4>'+e(d("resultsEvaluation"))+'</h4><div class="form-item"><div class="form-block form-item left-block experiment-evaluation-box form-block-3"><span>'+e(d("experimentalEvaluation"))+':&nbsp;&nbsp;</span><div class="experiment-evaluation form-block"><div class="loading"></div><div class="evaluation-img transparent"></div></div></div><div class="form-block form-item form-block-2"><span class="textarea-tip">'+e(d("experimentalEesults"))+':&nbsp;&nbsp;</span><textarea placeholder="'+e(d("resultTip"))+'" class="experiment-result form-block form-item form-control"></textarea></div></div></div>'}(b.experimentName,b.userAccount,b.publishTime,b.experimentalScene,b.componentsUsed,b.algorithmUsed)}}),define("components/common/asyncJobRunner",["zero/zero","zero/declare"],function(a,b){"use strict";return b("AsyncJobRunner",[],{jobGetter:null,constructor:function(a){this.jobGetter=a},run:function(a,b){this.jobId=a,this.callback=b,this.start()},start:function(){this.timer=setTimeout(this.doJob.bind(this),3e3)},stop:function(){clearTimeout(this.timer),this.timer=0},doJob:function(){var a=this;this.jobGetter(this.jobId).then(function(b){"running"===b.status?a.start():(a.stop(),a.callback(b))},function(){a.stop(),a.callback({})})}})}),define("midway/dialog/experiment/yunqiTicker",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div><div class="project-list-box hide"><h5>'+e(d("yunqiCreaterTip"))+'</h5><div class="project-list"></div></div><div class="progress-box"><h5>'+e(d("yunqiCreaterWaitTip"))+'</h5><br /><div class="progress"></div></div><div class="complete hide"><h5>'+e(d("yunqiCreaterComplete"))+"</h5></div></div>"}()}}),define("dialog/experiment/yunqiTicker",["zero/zero","zero/ui/DialogEx","zero/ui/Selector","zero/ui/progress","zero/querystring","../../i18n","../../ajax/common","../../ajax/yunqiShare","../../global/notify","../../global/utils","../../midway/dialog/experiment/yunqiTicker"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(){window.isDataSourceName;t.showLoading(),g.getProjectList().then(function(a){for(var b=a.projectList,d={},e=null,f=0;f<b.length;f++){var g=b[f],h=g.name;!f&&(e=h),void 0!==h&&(d[h]=h)}u=new c({container:t.$(A.projectList),menu:d}),u.select(e),t.hideLoading()})}function m(){!1===a.isFunction(x.onView)?t.hide():x.onView()}function l(){t.$(A.projectListBox).addClass(B.hide),t.$(A.progressBox).removeClass(B.hide),n(),q()}function n(){t.$element.find(A.btnPrimary).hide()}function o(){v.set(1),setTimeout(p,500)}function p(){var a=$('<button class="btn btn-sm '+B.btnPrimary+'">'+y+"</button>");a.on("click",m),t.$element.find(A.modalFooter).html(a),t.$(A.progressBox).addClass(B.hide),t.$(A.complete).removeClass(B.hide)}function q(){v=new d({parent:A.progress});var a=.01;v.set(a),r(a)}function r(a){.9<=a||(a+=.1,w=setTimeout(function(){v.inc(.2*a),r(a)},20*a*1e3))}function s(a){var c=a.title;x=a,y=a.successBtnText||z("show"),t=new b({title:c,className:B.dialogYunqiCreator,destroyOnHide:!0,body:k(),afterShow:l,afterHide:a.afterHide,buttons:[{text:z("cancel"),click:function(){this.hide()}}]})}var t,u,v,w,x,y,z=f.translate,A={projectList:".project-list",projectListBox:".project-list-box",progress:".progress",progressBox:".progress-box",complete:".complete",modalFooter:".modal-footer",btnPrimary:".btn-primary"},B={dialogYunqiCreator:"dialog-yunqi-creator",hide:"hide",btnPrimary:"btn-primary"};return{show:s,done:o,hide:function(){t.hide()}}}),define("dialog/experiment/yunqiShare",["zero/zero","zero/ui/DialogEx","zero/ui/DataTable","zero/ui/Confirm","zero/ui/Tags","../../i18n","../../ajax/yunqiShare","../../ajax/experiment","../../ajax/analysis","../../ajax/model","../../global/utils","../../global/notify","../../global/codeName","../../global/event","../../charts/bar","../../components/evaluate/roc","../../charts/ConfusionMatrixChart","../../components/svg2canvas/process2canvas","../../components/svg2canvas/confusion2canvas","../../midway/dialog/experiment/yunqiShare","../../components/common/asyncJobRunner","./yunqiTicker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(){S=new e({container:R.$(X.tagBox),placeholder:W("yunqiTagPlaceholder")}),S.on("change",function(a){6===a.length&&S.remove(a.pop())})}function x(){new Promise(function(a,b){return B(a,b)}).then(function(){return g.getShareDetail(Q.id,Q.projectName)}).then(function(a){R.$element.find(X.dialogBox).html(t(a)),A(),N(),w()}).then(function(){return J()}).then(function(a){a.records.length&&a.tableHeader.length?K(a):R.$(X.experimentData).html(W("emptyData"))}).then(function(){for(var a=[],b={},c=0;c<T.length;c++){var d=T[c],e=d.codeName,f=d.id;ga[f]=d;var g=m.getWithOutVersion(e),h=ea.indexOf(g);-1<h&&(-1===h&&(h=99999),b[h]=f,a.push(h))}if(0===a.length)throw R.$(X.evaluationBox).remove(),new Error("Break Promise!");a.sort(function(a,b){return a-b});var i=b[a[0]];U=i}).then(function(){if(!0===a.isUndefined(U))throw new Error("No eva node!");var b=ga[U],c=m.getWithOutVersion(b.codeName);return m.isSameCodeName("confusionmatrix",c)?new Promise(function(a,d){j.confusionMatrix(b.id,b.nodeDefId,Q.id).then(function(b){a({imgData:b,codeName:c})})}):m.isSameCodeName("evaluate",c)?new Promise(function(a,b){j.getEvaluate(U,Q.id).then(function(b){a({imgData:b,codeName:c})})}):void 0}).then(function(a){var b=a.imgData,c=m.getWithOutVersion(a.codeName);if(m.isSameCodeName("confusionmatrix",c)){var d=null;for(var e in b)b.hasOwnProperty(e)&&(d=b[e]);var f=[];for(var e in d.stats)d.stats.hasOwnProperty(e)&&f.push(d.stats[e].label);new q({container:R.$(X.evaluationImg)[0],data:d.matrix,labels:f,width:200,height:160,columnTitle:W("predicted"),rowTitle:W("actual")})}else{var g=C(b.points),h=(new p).parse(g,b.metric),i={element:R.$(X.evaluationImg)};$.extend(i,h),V=new o(i)}R.$(X.evaluateLoading).hide()},function(){R.$(X.evaluationBox).hide()})}function y(a,b,c,d){var e=c||a.width(),f=d||a.height(),g=b.width(),h=b.height(),i=g/h,j=e/f,k=0,l=0;j>i?(k=g,l=k/j):j<i&&(l=h,k=l*j),a.width(k),a.height(l)}function z(a){if(0===a)return"0 B";var b=1e3,c=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(a)/Math.log(b));return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]}function A(a){for(var b=null,c=0;c<T.length;c++){var d=T[c],e=m.getWithOutVersion(d.codeName),f=(m.getWithOutVersion(d.name),d.id);if("odps_source"===e){b=f;break}}g.getTableInfo(Q.projectName,b).then(function(a){var b=a.tableInfo.tableSize,c=a.tableInfo.column,d=z(b);R.$(X.dataLength).text(d);var e=c.length;R.$(X.fieldNumber).text(e)})}function B(a,b){var c=Q.id;h.queryGraph(c).then(function(b){T=b.nodes,a()},b)}function C(a){var b,c=a.length;return a=_.sortBy(a,"id"),a=a.map(function(a,d){for(b in a)_.isNumber(a[b])&&(a[b]=k.toWeakFixed(a[b],4));return a.index=d,a.xAxis=k.toWeakFixed((d+1)/c*100,2)+"%",a})}function D(){var a=R.$(X.experimentData);return new Promise(function(b,c){html2canvas(a,{background:"rgb( 255, 255, 255 )"}).then(function(a){b(a.toDataURL("image/png"))},function(){b("")})})}function E(){if(!0===a.isUndefined(U))return"";var b=ga[U],c=m.getWithOutVersion(b.codeName),d=R.$(X.evaluationBox);return new Promise(function(a,b){if(0===d.length)return void resove();if("confusionmatrix"===c){a(new s(d).exports().toDataURL("image/png"))}else a(V.echart.getDataURL())})}function F(){fa=!0,R.showLoading();var a={scenarioDescription:R.$(X.scenarioDescription).val(),dataSource:R.$(X.dataSource).val(),fieldMeaning:R.$(X.fieldMeaning).val(),experimentResult:R.$(X.experimentResult).val(),dataLength:R.$(X.dataLength).text(),fieldNumber:R.$(X.fieldNumber).text(),experimentId:Q.id,projectName:Q.projectName};D().then(function(b){a.experimentData=b}).then(function(){return R.$(X.experimentProcess).find("img").attr("src")}).then(function(b){a.experimentProcess=b}).then(function(){return E()}).then(function(b){a.experimentalEvaluation=b}).then(function(){var b=S.getAllData();a.tags=b}).then(function(){return g.share(a)}).then(function(a){return R.hideLoading(),a.processId},function(){return R.hideLoading(),!1}).then(function(a){if(!1!==a)return R.hide(),H(a)})}function G(){n.yunqiShareTick()}function H(a){var b=null;v.show({title:W("yunqiShare"),successBtnText:W("jumpToYunqi"),onView:function(){window.open(b)},afterHide:G}),new u(g.checkStatus).run(a,function(a){"done"!==a.status?(v.hide(),l.error(a.errorMsg)):(b=a.yunqiLink,v.done())})}function I(a,b){!1===fa&&G(),a()}function J(){for(var a=null,b=0;b<T.length;b++){var c=m.getWithOutVersion(T[b].codeName),d=T[b].id;if("odps_source"===c){a=d;break}}return i.explore(a)}function K(a){var b=R.$(X.experimentData),d={container:b,data:[],cols:[]};d.data=L(a),d.cols=M(a.tableHeader),$.extend(d,Y);for(var e=new c(d),f=e.$headTable.find("colgroup [data-field]"),g=0;g<f.length;g++){var h=$(f[g]);0===h.width()&&h.width($(f[g-1]).width())}}function L(a){var b=a.records,c=a.tableHeader;return b.forEach(function(a,d){b[d]=_.zipObject(c,a)}),b}function M(a){var b,c=[],d=a.length;return a.forEach(function(a,e){b=a.length*Z+aa+ca+ba,c.push({field:a,sort:!0,width:e!==d-1?b:"auto"})}),c}function N(){var a=$(X.paneSvg);new r(a).exports().then(function(a){var b=R.$(X.experimentProcess),c=R.$(X.processImg),d=$('<img src="'+a.toDataURL("image/png")+'"></img>');c.append(d),R.$(X.processLoading).addClass(da.hide),y(c,b,a.width,a.height)})}function O(){for(var a=["scenarioDescription","experimentResult"],b=!0,c=0;c<a.length;c++){var d=a[c],e=R.$(X[d]).val();""===e.trim()||void 0===e?(R.$(X[d]).addClass(da.errorInput),b=!1):R.$(X[d]).removeClass(da.errorInput)}return b}function P(a){return Q=a,new Promise(function(c,e){R=new b({title:W("shareToYunqi"),className:da.yunqiShareDialog,destroyOnHide:!0,body:t(a),afterShow:x,afterHide:function(){G(),I.call(this,c,e)},buttons:[{text:W("create"),type:"primary",click:function(){!1!==O()&&new d({title:W("tips"),backdrop:!1,body:W("yunqiShareWarn"),onAccept:F,className:da.yunqiComfirm})}},{text:W("close"),click:function(){this.hide()}}]})})}var Q,R,S,T,U,V,W=f.translate,X={dialogBox:".modal-body",paneStage:".pane-stage",experimentProcess:".experiment-process",processLoading:".experiment-process .loading",processImg:".experiment-process-img",paneSvg:".pane-svg",experimentData:".experiment-data",evaluationBox:".experiment-evaluation-box",evaluationImg:".evaluation-img",experimentEvaluation:".experiment-evaluation",processCanvas:".experiment-process canvas",evaluateLoading:".experiment-evaluation .loading",scenarioDescription:".scenario-description",dataSource:".data-source",fieldMeaning:".field-meaning",experimentResult:".experiment-result",tagBox:".tag-box",dataLength:".data-length",fieldNumber:".field-number"},Y={theme:"small",line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 40px)"},Z=7,aa=16,ba=1,ca=16,da={yunqiShareDialog:"dialog-yunqi-share",errorInput:"error-input",hide:"hide",transparent:"transparent",yunqiComfirm:"yunqi-confirm"},ea=["evaluate","confusionmatrix"],fa=!1,ga={};return{show:P}}),define("workspace/yunqiSharer",["zero/zero","../global/event","../ajax/yunqiShare","../dialog/experiment/yunqiShare"],function(a,b,c,d){"use strict";function e(){d.show(f)}var f;b.onYunqiShare(e);var g={init:function(a){g.clean(),f=a},clean:function(){f=null}};return g}),define("ajax/component",["zero/zero","./base","../i18n","../global/utils"],function(a,b,c,d){"use strict";function e(a){return{id:a.id,name:a.name,description:a.description||"",changeType:a.changeType||"",changeMessage:a.changeMessage||"",thumbUp:a.up,thumbDown:a.down,isLiked:!0===a.isUp,isUnLiked:!1===a.isUp,isDefine:!0}}var f=b.create("/node.json");c.translate;return{deleteNodeDef:function(a){return f.post({method:"deleteNodeDef",nodeDefIds:a,ids:a}).then(function(a){var b=[];return a&&a.affectExps&&(b=a.affectExps),b})},renameNodeDef:function(a,b){return f.post({method:"renameNodeDef",nodeDefId:a,newName:b})},queryRelatedExpCount:function(a){return f.get({method:"queryRelatedExpCount",nodeDefId:a,id:a,ids:a}).then(function(a){var b=0;return a&&a.count?(b=a.count,d.toInt(b)):b})},getChildren:function(b){var c={method:"listCatByParent"};return void 0!==b&&null!==b&&(c.catId=b),f.get(c).then(function(b){b=b||{};var c=a.map(b.cats||[],function(a){var b={name:a.name,id:a.id,category:a.category,isBranch:!0,isExpanded:!1,codeName:a.codeName};return a.parentCatId&&(b.parentId=a.parentCatId),b});c=a.filter(c,function(a){return-1===["hideNode","model","otherModel"].indexOf(a.category)});var d=a.map(b.defs||[],function(a){return{id:a.id,name:a.name,parentId:a.catId,category:a.category,isBranch:!1,codeName:a.codeName,social:e(a)}});return c=c.reverse(),d=d.reverse(),d.concat(c)})},getFavorites:function(){return f.get({method:"queryFavoriteNodes"}).then(function(b){return a.map(b.defs||[],function(a){return{id:a.id,name:a.name,category:a.category,isBranch:!1,social:e(a)}})})},addFavorite:function(a){return f.get({method:"addFavoriteNode",nodeDefId:a})},removeFavorite:function(a){return f.get({method:"removeFavoriteNode",nodeDefId:a})},getNodeGroups:function(){return f.get({method:"queryUserNodeGroupTemplates"}).then(function(b){return a.map(b.groupTemplates||[],function(a){return{id:a.id,name:a.name,isBranch:!1}})})},getPublicNodeGroups:function(){return f.get({method:"queryPublicNodeGroupTemplates"}).then(function(b){return a.map(b.groupTemplates||[],function(a){return{id:a.id,name:a.name,isBranch:!1}})})},uploadComponent:function(b,c){return new Promise(function(e,f){var g=new XMLHttpRequest,h=new FormData;g.open("POST","/algorithms.json",!0),g.onreadystatechange=function(){4==g.readyState&&200==g.status&&e(JSON.parse(g.responseText))},g.isSuccess=function(){var a=g.status;return a>=200&&a<300||304===a||!a&&"file:"===location.protocol||!a&&bomUtils.versions.safari},g.onreadystatechange=function(){if(4===g.readyState)if(g.isSuccess()){var b=g.responseText;b=a.getAny([function(){return JSON.parse(b)}])||b,e(b)}else f(g.responseText)},h.append("method","upload"),h.append("nodeDefBundleJson",JSON.stringify(b)),h.append("fileContent",c),h.append("ctoken",d.getCookie("ctoken")),g.send(h)})},unsubscribe:function(a){return a.action="unsubscribe",b.create("/algorithms.json").get(a).then(function(a){return"true"===a.unsubscribed.toLowerCase()})},subscribe:function(a){return a.action="subscribe",b.create("/algorithms.json").get(a).then(function(a){return"true"===a.subscribed.toLowerCase()})},share:function(a,c){var d={method:"shareNodeGroup",groupTemplateId:a,targetUserNumber:c.join(",")};return b.create("/nodeGroup.json").post(d).then(function(a){return a.success})},revealInTree:function(a){return f.get({method:"revealInTree",nodeDefId:a.id}).then(function(b){var c=b&&b.parentIds||[];return c.reverse(),c.push(a.id),c})},queryRecentlyUsedNodes:function(b){return f.get({method:"queryRecentlyUsedNodes"}).then(function(b){return a.map(b.defs||[],function(a){return{id:a.id,name:a.name,category:a.category,isBranch:!1,social:e(a)}})})},queryUserDefinedNodes:function(b){return f.get({method:"queryUserDefinedNodes"}).then(function(b){var c=a.map(b.defs||[],function(a){return{id:a.id,name:a.name,category:a.category,isBranch:!1,codeName:a.codeName,social:e(a)}});return c=c.reverse()})},removeUserDefinedNode:function(a){return f.get({method:"removeUserDefinedNode",nodeDefId:a.id}).then(function(a){console.log(a)})},deleteRecentUse:function(a){return f.get({method:"deleteFromRecentUsedNodes",nodeDefId:a.id})}}}),define("components/treeDataTable/treeData",["zero/zero","zero/declare","../../ajax/component"],function(a,b,c){"use strict";return b("component/treeData",{constructor:function(){},totalNum:0,getNodeData:function(b,c){!0===a.isUndefined(c)&&(c=!0);var b=b,d={},e=this;return new Promise(function(a,f){e._doGetData(b,d,c,function(){a(d)})})},_doGetData:function(a,b,d,e){this.totalNum++;var f=this;c.getChildren(a).then(function(a){f.totalNum--;for(var c=0;c<a.length;c++){var g=a[c],h=g.isBranch,i=(g.name,g.codeName),j=g.id;if(b[i]=g,!0===h&&!0===d){var k={};g.branch=k,function(a,b){f._doGetData(j,a,d,e)}(k)}}0===f.totalNum&&e()})}})}),define("dialog/experiment/createDirectory",["zero/zero","zero/ui/DialogSingleInput","../../i18n","../../global/event","../../global/config","../../ajax/document"],function(a,b,c,d,e,f){"use strict";function g(a,c){var e=a&&a.id||0;return new Promise(function(g){function j(b){var c=this;return b?i.xss.test(b)?c.showErrorTip(h("newDirectoryXss")):f.createDirectory(b,e).then(function(f){f&&(c.destroy(),g(),d.createExperimentTreeNode({parentId:e,name:b,id:f,isBranch:!0,isExpanded:!1},a))}):c.showErrorTip(h("newDirectoryPlaceholder")),!1}new b({backdrop:!c,title:h("newDirectory"),placeholder:h("newDirectoryPlaceholder"),callback:j})})}var h=c.translate,i=e.reg;return{show:g}}),define("midway/dialog/experiment/createExperiment",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="form-horizontal"><div class="form-group"><label for="txtExpName" class="col-xs-3 control-label">'+e(d("name"))+'</label><div class="col-xs-9"><input type="text"class="form-control"id="txtExpName"maxlength="33"placeholder="'+e(d("inputFilename"))+'"></div></div><div class="form-group"><label for="dlProjectList" class="col-xs-3 control-label">'+e(d("project"))+'</label><div class="col-xs-9"><label for="dlProjectList" class="select-hacker"><select id="dlProjectList" class="form-control target-project"></select></label></div></div><div class="form-group"><label for="dlProjectList" class="col-xs-3 control-label"></label><div class="col-xs-9"><a href="javascript:void(0);" class="j-link-add-odps">'+e(d("addODPSProject"))+'</a><span class="odps-tips"> </span></div></div><div class="form-group"><label for="txtExpDesc" class="col-xs-3 control-label">'+e(d("description"))+'</label><div class="col-xs-9"><textarea class="form-control"id="txtExpDesc"maxlength="33"placeholder="'+e(d("descriptionPlaceholder"))+'"></textarea></div></div><div class="form-group"><label class="col-xs-3 control-label">'+e(d("position"))+'</label><div class="col-xs-9 tree-wrap"><div class="tree-node-selector j-tree-wrap"></div><span class="icon icon-add-folder button-add-folder j-btn-add-folder"role="button"></span></div></div></div>'}()}}),define("dialog/experiment/createExperiment",["zero/zero","zero/ui/DialogEx","zero/ui/Tree","../../global/event","../../global/config","../../global/prefetch","../../ajax/document","../../ajax/experiment","../../ajax/experimentMeta","../../i18n","../../dialog/experiment/createDirectory","../../midway/dialog/experiment/createExperiment","../datasource/addODPSProject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b){a.next(".err-msg").remove(),a.after('<div class="err-msg"><span class="icon icon-close-c"></span>'+b+"</div>"),a.one("focus",function(){a.next(".err-msg").remove()})}function o(){function b(a,c){a&&t.addNodes([a]),c.isExpanded||c.expand(),d.offExperimentTreeNodeCreated(b)}var e=this,i=w.stack;f.getProjectList().then(function(b){var c=a.map(b.projectList,function(a){return"<option>"+a.name+"</option>"}).join("").concat('<option class="add-odps">'+z("addODPSProject")+"</option>");e.$(x.project).html(c).val(w.projectName||b.currentProject)}),w.isCopy?h.getExperiment(w.experimentId).then(function(a){var b=a.name+"_"+z("copySuffix");e.$(x.name).val(b),e.$(x.desc).val(a.description||"")}):w.isTemplate&&(e.$(x.name).val(w.name),e.$(x.desc).val(w.description||"")),t=new c({canDnD:!1,hasIcon:!0,hasExpanderIcon:!0,onNodeExpanded:function(b){g.queryChildren(b.id).then(function(b){if(t.addNodes(a.filter(b,function(a){return!0===a.isBranch})),i&&i.length){var c=i.pop(),d=t.nodeById[c];d&&(i.length&&d.expand(),d._setSelected())}})},onNodeDblclicked:function(a){a.isBranch&&a.toggle()},onNodeClicked:function(a,b){$(b.target).is(x.expander)||a.isBranch&&a.toggle()}}),t.addNodes({id:0,isBranch:!0,isExpanded:!1,name:z("experimentTreeRoot")}),t.placeAt(e.$(x.treeWrap)[0]),t.nodeById[0].expand(),e.$(x.btnAddFolder).on("click",function(){var a=t.selectedNode||t.nodeById[0];k.show(a,!0),d.onExperimentTreeNodeCreated(b)}),e.$(x.targetProject).on("change",function(a){var b=$(this);if(b.find(":selected").hasClass("add-odps"))return e.hide(),s(),!1;var c=b.val();-1===c.lastIndexOf("_dev")?e.$(x.odpsTips).text(c+"为生产Project,可能无权限,建议使用"+c+'_dev project进行实验。( 如果在列表中没有找到，可以尝试“添加ODPS项目" )'):e.$(x.odpsTips).text("")})}function p(){t.destroy(),t=null,w=null}function q(){var a=this,b=a.$(x.name),c=b.val();if(!c)return void n(b,z("inputFilename"));if(y.xss.test(c))return void n(b,z("newExperimentXss"));var d=a.$(x.desc),e=d.val();if(y.xss.test(e))return void n(d,z("errorStringXss"));a.showLoading()
;var f=t.selectedNode||t.nodeById[0],h=a.$(x.project).val(),j=w.isCopy?i.copyExperiment(c,e,f.id,w.experimentId,h):w.isTemplate?i.initTemplateAsync(c,e,f.id,w.templateId,h):g.createNode(c,e,f.id,h);w.isTemplate?j.then(function(b){a.hide(),u(b)},function(){a.hideLoading(),v()}):j.then(function(b){a.hideLoading(),a.hide(),u({treeNode:b,parentNode:f})},function(){a.hideLoading()})}function r(a){return w=a||{},new Promise(function(c,d){u=c,v=d,new b({title:z(w.isCopy?"copyExperiment":"newExperiment"),className:"dialog-new-experiment",destroyOnHide:!0,body:l(),beforeShow:o,afterShow:function(){var a=this;$(x.btnAddODPS).off("click.addODPS").on("click.addODPS",function(){a.hide(),s()})},afterHide:p,buttons:[{text:z(w.isCopy?"confirm":"new"),type:"primary",click:q},{text:z("cancel"),click:function(){a.isTemplate&&v(),this.hide()}}]})})}function s(){var a=setTimeout(function(){clearTimeout(a),m.show()},300)}var t,u,v,w,x={name:"#txtExpName",desc:"#txtExpDesc",project:"#dlProjectList",odpsTips:".odps-tips",targetProject:".target-project",expander:".tree-node-expander",treeWrap:".j-tree-wrap",btnAddFolder:".j-btn-add-folder",btnAddODPS:".j-link-add-odps"},y=e.reg,z=j.translate;return{show:r}}),define("workspace/yunqiCreator",["zero/zero","zero/querystring","../global/event","../global/environment","../global/codeName","../global/notify","../global/utils","../ajax/yunqiShare","../ajax/odpsControl","../ajax/experiment","../ajax/common","../components/treeDataTable/treeData","../dialog/experiment/createExperiment","../dialog/experiment/yunqiTicker","../components/common/asyncJobRunner","../i18n"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(a){var c=window.location.search;c=c.replace("?","");var d=b.parse(c),e=d.templateId;void 0!=e&&m.show({name:"",description:"",templateId:e,isTemplate:!0}).then(function(a){n.show({title:w("yunqiCreateExperiment")}),new o(k.queryAsynJobStatus).run(a.jobId,function(a){if("done"===a.status){var b=a.documentNode;y=b.experimentId,r()}else void 0===a.status&&(n.hide(),f.error(w("yunqiCreateError")))})})}function r(){var a=s(y);window.location.search=a}function s(a){var c=window.location.search;c=c.replace("?","");var d=b.parse(c);return delete d.templateId,a&&(d.experimentId=a),b.stringify(d)}function t(){(d.isBase||d.isBaseDP)&&($(v.btnShare).addClass(x.disabled),$(v.btnShare).removeClass(x.hide),h.precheck(u.id).then(function(a){!0===a.status&&$(v.btnShare).removeClass(x.disabled)}))}var u,v={btnShare:"#j-bpmn .btnShare"},w=p.translate,x={hide:"hide",disabled:"disabled"},y=null;c.onPageLoadComplete(q),c.onExperimentOpened(function(a){u=a,t()});var z={init:function(a){z.clean(),u=a},clean:function(){u=null}};return z}),define("midway/workspace/lockMask",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="pai-workspace-locked"><div class="message"><div class="text">'+e(a)+'</div><button class="btn btn-primary">'+e(d("continue"))+"</button></div></div>"}(b.message)}}),define("workspace/locker",["zero/zero","../midway/workspace/lockMask"],function(a,b){"use strict";var c={workspace:"#j-workspace",btnContinue:".btn"},d=null,e={init:function(a){e.clean(),a.lockIt&&(d=$(b({message:a.lockMessage||""})),d.on("click",c.btnContinue,function(){e.clean()}),d.appendTo(c.workspace))},clean:function(){d&&(d.off().remove(),d=null)}};return e}),define("ajax/nodeGroup",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/nodeGroup.json");return{createGroup:function(a,b,d){var e={method:"batchSetGroup",experimentId:a,nodeInstanceIds:b.join(",")};return d&&(e.groupName=d),c.post(e,!0).then(function(a){return a&&a.group||{}})},addNodesToGroup:function(a,b,d){return c.post({method:"batchSetGroup",groupId:b,experimentId:a,nodeInstanceIds:d.join(",")})},removeNodeFromGroup:function(a,b,d){return c.post({method:"batchDeleteGroup",groupId:b,experimentId:a,nodeInstanceIds:d.join(",")})},updateGroupName:function(a,b,d){return c.post({method:"updateGroupName",groupId:b,groupName:d,experimentId:a})},updateFoldStatus:function(a,b,d){return c.post({method:"updateGroupCollapsed",groupId:b,collapsed:!!d,experimentId:a})},saveGroupDefine:function(a,b,d,e,f){return c.post({method:"saveGroup",groupId:b,groupNodes:JSON.stringify(d),experimentId:a,centPosX:e,centPosY:f}).then(function(a){var b=a.groupTemplate;return{id:b.id,name:b.name}})},addGroupToExperiment:function(a,b,d,e){return c.post({method:"addNodeGroup",groupTemplateId:b,experimentId:a,centPosX:d,centPosY:e})},deleteGroupDefine:function(a){return c.post({method:"deleteNodeGroupTemplate",groupTemplateId:a})},renameGroupDefine:function(a,b){return c.post({method:"renameNodeGroupTemplate",groupTemplateId:a,newName:b})},generateGroupModel:function(a,b){return c.post({method:"generateGroupModel",groupId:a,projectName:b})}}}),define("ajax/benchmark",["zero/zero","./base"],function(a,b){"use strict";var c="/benchmark.json",d=b.create(c);return{queryCandidateNodes:function(a){var b=a.expId;return d.get({experimentId:b,method:"queryCandidateNodes"})},delConfig:function(a){return d.post({benchmarkId:a,method:"dropConfig"})},preCheckBenchmark:function(a,b,c){return d.get({experimentId:a,nodeInstId:b,method:"preCheckBenchmark"},!0,null,!0)},queryBenchmarkExecuteDetail:function(a,b,c,e){return d.get({method:"queryBenchmarkExecuteDetail",benchmarkId:a,codeName:c,groupId:b,evaluationTable:e})},generateAlgoNode:function(a,b){return d.post({method:"generateAlgoNode",benchmarkId:a,loopSubRecordId:b})}}}),define("midway/canvas/node",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f){var g='<g class="pane-scalable"><foreignObject width="180" height="30"><body xmlns="http://www.w3.org/1999/xhtml"><div class="pane-node-content '+d(a)+d(b?" has-status":"")+'"><span class="icon node-img '+d(c)+'  "></span><span class="name">'+d(e)+'</span><span class="status '+d(b)+'"></span><div class="pane-port-list in"></div><div class="pane-port-list out"></div></div><div class="pane-node-bulb"><span class="icon icon-bulb"></span></div></body></foreignObject>';return g+="running"===f?'<g class="loading-svg"  transform="translate(155,6)" fill="none" fill-rule="evenodd" style="vector-effect: none;"  stroke="#108ee9"  stroke-width="2">                  <circle   stroke-opacity="0.5" cx="9" cy="9" r="9" stroke="#ccc"></circle><path d="M18,9 C18,4.03 13.97,0 9,0"><animateTransform  attributeName="transform"  type="rotate" from="0 9 9"  to="360 9 9"  begin="0s" dur="1s" repeatCount="indefinite" /></path></g>  ':'<g class="loading-svg" stroke="#108ee9" fill="none" fill-rule="evenodd"  stroke-width="2" transform="translate(155,6)" style="vector-effect: none; " ></g>',g+="</g>"}(b.nodeClass,b.statusIcon,b.iconName,b.name,b.nodeInstanceStatus)}}),define("midway/canvas/group",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q){var r='<g class="pane-scalable"><foreignObject width="'+d(a.width)+'" height="'+d(a.height)+'" transform="translate(0,0)"><body xmlns="http://www.w3.org/1999/xhtml"><div class="pane-group-content'+d(b?" collapsed":"")+'"><span class="btn-toggle"></span><div class="header"><span class="icon icon-ok-o"></span><span class="icon icon-close-o"></span><span class="name" title="'+d(b?c:"")+'">'+d(c)+'</span></div><ul class="actions"><li class="btnLoopConfig"><span class="icon icon-sheet-1"></span><div class="tips">'+d(e.config)+'</div></li><li class="btnLoopExecute"><span class="icon icon-arrow-right-o"></span><div class="tips">'+d(e.execute)+'</div></li><li class="btnLoopStop"><span class="icon icon-stop-o"></span><div class="tips">'+d(e.stop)+'</div></li><li class="btnLoopResult"><a href="/groupLoop.htm?projectName='+d(f)+"&experimentId="+d(g)+"&groupId="+d(h)+'" target="_blank"><span class="icon icon-report"></span></a><div class="tips">'+d(e.viewResult)+'</div></li></ul></div></body></foreignObject><g class="pane-group-in-ports"></g><g class="pane-group-out-ports"></g>',i=.5;r+=" ";var k=.5;r+=" ";var j=a.width-1;r+=" ";var l=a.height-1;r+=" ";var m=3;r+=" ";var o=3;r+=" ";var n=i+j;r+=" ";var p=k+l;return r+=" ",r+='<path class="pane-group-border" transform="translate(0,0)" d="'+d(["M",i+m,k,"L",n-m,k,"Q",n,k,n,k+o,"L",n,k+l-o,"Q",n,p,n-m,p,"L",i+m,p,"Q",i,p,i,p-m,"L",i,k+o,"Q",i,k,i+m,k,"Z"].join(" "))+'"></path></g>'}(b.size,b.collapsed,b.name,b.i18n,b.projectName,b.experimentId,b.id,b.x,b.w,b.y,b.h,b.rx,b.r,b.ry,b.b,b.d)}}),define("midway/canvas/remark",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,e,f){var g='<foreignObject width="'+d(a.width)+'" height="'+d(a.height)+'"><body xmlns="http://www.w3.org/1999/xhtml"><div class="pane-remark-content ';return b&&(g+=" init "),g+='">'+c(e(f))+'</div><div class="pane-remark-arrow"></div></body></foreignObject>'}(b.size,b.init,b.marked,b.name)}}),define("midway/canvas/port",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){return'<div class="pane-port-wrap"><div class="pane-port'+d(a?" is-connected":"")+'"data-id="'+d(b)+'"><span class="port-magnet"></span></div></div>'}(b.connected,b.id)}}),define("midway/canvas/link",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<path class="connector-wrap"></path><path class="connector"></path><path class="source-marker"></path><path class="target-marker"></path><rect class="comment-bg"/><text class="comment"/>'}}),define("midway/workspace/maskLoading",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="pai-mask"><div class="pai-mask-loading"><span class="icon-loading-spinner fa fa-spin"></span></div></div>'}}),define("midway/dialog/experiment/cyclicParams",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e,f,g,h,i){var j='<div class="form-horizontal"><div class="param-type"><div class="form-group "><label class="col-xs-3 control-label">参数类型</label><div class="col-xs-9"><label class="radio-inline"><input type="radio" name="paramType"id="rdParamTypeSingle"value="1" '+d(b?"checked":"")+'><span>单参数</span></label><label class="radio-inline"><input type="radio" name="paramType" id="rdParamTypeMulti"value="2" '+d(b?"":"checked")+'><span>多参数</span></label></div></div><div class="btn-add icon icon-plus-o'+d(b?" hide":"")+'"></div></div>',f=[];if(j+="",b){j+='<div class="single-param"><div class="param-item"><div class="form-group"><label for="dlAlgoList" class="col-xs-3 control-label">选择参数</label>';var e=c[0];j+='<div class="col-xs-4"><label for="dlAlgoList" class="select-hacker"><select id="dlAlgoList"class="form-control"data-index="0"name="nodeId">',a.each(e.nodeOptions,function(a){j+="",a.nodeId===e.nodeId?(j+="",f=a.paramOptions,j+='<option value="'+d(a.nodeId)+'" selected>'+d(a.nodeName)+"</option>"):j+='<option value="'+d(a.nodeId)+'">'+d(a.nodeName)+"</option>",j+=""}),j+='</select></label></div><div class="col-xs-5"><label for="dlParamsList" class="select-hacker"><select id="dlParamsList"class="form-control"data-index="0"name="paramId">',a.each(f,function(a){j+="",a.paramId===e.paramId?j+='<option value="'+d(a.paramId)+'" selected>'+d(a.paramLabel)+"</option>":j+='<option value="'+d(a.paramId)+'">'+d(a.paramLabel)+"</option>",j+=""}),j+='</select></label></div></div></div><div class="param-item"><div class="form-group"><label for="txtSingleParamValue" class="col-xs-3 control-label">参数值</label><div class="col-xs-9"><textarea class="form-control"id="txtSingleParamValue"placeholder="参数格式: 1,2,3,4">'+d(g)+'</textarea></div></div><span class="i-help icon icon-help-o"title="提示: 参数值以半角逗号分割<br>例如: 1,2,3,4<br>如果参数本身包含逗号，请参考多参数的配置来避免混淆"></span></div></div>'}else{j+='<div class="multi-param">';var i=c.length;j+="",a.each(c,function(b,c){j+='<div class="param-item"><div class="form-group"><label for="dlAlgoList'+d(c)+'"class="col-xs-3 control-label">参数'+d(c+1)+'</label><div class="col-xs-4"><label for="dlAlgoList'+d(c)+'" class="select-hacker"><select id="dlAlgoList'+d(c)+'"data-index="'+d(c)+'"name="nodeId"class="form-control">',a.each(b.nodeOptions,function(a){j+="",a.nodeId===b.nodeId?(j+="",f=a.paramOptions,j+='<option value="'+d(a.nodeId)+'" selected>'+d(a.nodeName)+"</option>"):j+='<option value="'+d(a.nodeId)+'">'+d(a.nodeName)+"</option>",j+=""}),j+='</select></label></div><div class="col-xs-5"><label for="dlParamsList'+d(c)+'" class="select-hacker"><select id="dlParamsList'+d(c)+'"data-index="'+d(c)+'"name="paramId"class="form-control">',a.each(f,function(a){j+="",a.paramId===b.paramId?j+='<option value="'+d(a.paramId)+'" selected>'+d(a.paramLabel)+"</option>":j+='<option value="'+d(a.paramId)+'">'+d(a.paramLabel)+"</option>",j+=""}),j+="</select></label></div></div>",i>1&&(j+='<div class="btn-delete icon icon-close-o"data-index="'+d(c)+'"></div>'),j+="</div>"}),j+='<div class="multi-param-value"><div class="form-group"><label for="txtMultiParamValue" class="col-xs-3 control-label">参数值</label><div class="col-xs-9"><textarea class="form-control"id="txtMultiParamValue"placeholder="参数格式: 5#10#2,3&&6#20#11,3">'+d(g)+'</textarea></div></div><span class="i-help icon icon-help-o" title="多参数循环允许同时配置多个参数的值,<br> 每一组之间的参数用#号分割组与组之间用&&号分割.<br> ,号为保留符号，仅用于参数内部。     <br>比如：配置三个参数 p1，p2，p3 的格式：5#10#2,3&&6#20#1,3<br>表示两组参数对：<br>第一组：p1=5,p2=10,p3=2,3<br>第二组：p1=6,p2=20,p3=1,3<br><br>注意：参数值必须按照参数顺序指定"></span></div></div>'}return j+='<div class="search-num"><div class="form-group"><label for="randomSearchIterNum" class="col-xs-3 control-label">搜索次数</label><div class="col-xs-9"><input class="form-control"rows="1"    id="randomSearchIterNum"placeholder="RandomSearch搜索次数(可选)"value="'+d(h)+'"/></div></div><span class="i-help icon icon-help-o" title= " ',j+=b?"<p> 参数以半角逗号分隔；连续值的范围使用开闭区间表示法，例如(0,1.0]表示大于0小于等于1.0的实数；枚举值用大括号扩起来，用半角逗号分隔，例如{l1,l2,None}。 </p><p> 举例：参数p1的配置为 100,110,[120,200] 搜索次数为32，则会从120到200之间产生32个随机整数，再加上100和110，共计会有34组循环参数。 </p><p> 注意：参数里有小数点会解析为Double类型，没有则解析为Integer类型。 </p>":"<p> 多参数循环允许同时配置多个参数的值，每一组之间的参数用,号分割组与组之间用;号分割。 连续值的范围使用开闭区间表示法，例如(0,1.0]表示大于0小于等于1.0的实数；枚举值用大括号扩起来，用,分隔，例如{l1,l2,None}。</p><p> 举例：配置三个参数 p1，p2，p3 的格式：5,10,[11,30];8,{11,12,15},(20,60] 搜索次数设为32 则会产生两组参数对，每组参数搜索32/2=16次</p><p>第一组：p1=5,p2=[11,30],p3=8 其中p2的值会从11到30中随机选取16个值，构建起16组参数（每组参数中p1都为5，p3都为8）</p><p> 第二组：p1=8,p2={11,12,15},p3=(20,60] 其中p2的值从11,12,15中随机选取，p3的值从21到60中随机选取，构建起16组参数（每组参数中p1都为5）</p><p>  注意：参数里有小数点会解析为Double类型，没有则解析为Integer类型。</p>",j+='"></span></div></div>'}(b.single,b.params,b.item,b.paramOptions,b.value,b.randomSearchIterNum,b.count)}}),define("dialog/experiment/cyclicParams",["zero","zero/zero","zero/ui/DialogEx","../../global/event","../../ajax/groupLoop","../../midway/dialog/experiment/cyclicParams","../../workspace/statusTicker","../../i18n"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a=B.$("#randomSearchIterNum"),b=a.val();return""===b||b>0&&b<64?(A.randomSearchIterNum=parseInt(b,10),!1):(o(a,"迭代次数应为正整数"),!0)}function j(a){var c=this;if(!A.configStr)return void o(c.$("textarea"),"请填写参数");i()||(c.showLoading(),b.each(A.checkedNodes,function(a){delete a.nodeOptions}),e.updateGroupLoopConfig(w.experimentId,w.groupId,A).then(function(){d.executeGroup(w.groupId),c.hide(),c.hideLoading(),v()},function(){c.hideLoading()}))}function k(){var a=this;if(!A.configStr)return void o(a.$("textarea"),"请填写参数");i()||(a.showLoading(),b.each(A.checkedNodes,function(a){delete a.nodeOptions}),e.updateGroupLoopConfig(w.experimentId,w.groupId,A).then(function(){a.hide(),a.hideLoading(),v()},function(){a.hideLoading()}))}function l(){var a=this;a.showLoading(),m(a),Promise.all([e.queryGroupLoopConfig(w.experimentId,w.groupId),e.queryGroupLoopConfigCandidates(w.experimentId,w.groupId)]).then(function(c){if(A=c[0],x=c[1],y={},z={},x&&x.length){b.each(x,function(a){y[a.nodeId]=a,b.each(a.paramCandidates,function(a){z[a.paramId]=a})});var d=A.checkedNodes;if(!d||!d.length){var e=x[0],f=e.paramCandidates[0];A.checkedNodes=[{nodeId:e.nodeId,paramId:f.paramId,paramName:f.paramName}]}n(a,x,A)}else a.showEmpty();a.hideLoading()})}function m(a){a.$element.on("click",u.paramType,function(){var b=$(this);A.singleParam="1"===b.val(),n(a,x,A,"#"+b.attr("id"))}),a.$element.on("change","select",function(){var b=$(this),c=parseInt(b.attr("data-index"),10),d=parseInt(b.val(),10),e=b.attr("name"),f=A.checkedNodes[c];if(f){if(f[e]=d,"paramId"===e)f.paramName=z[d].paramName;else{var g=y[d],h=g.paramCandidates[0];f.paramId=h.paramId,f.paramName=h.paramName}n(a,x,A,"#"+b.attr("id"))}}),a.$element.on("change","textarea",function(){A.configStr=$(this).val()}),a.$element.on("click",u.btnAdd,function(){var c={};b.some(x,function(a){if(!C[a.nodeId])return c.nodeId=a.nodeId,b.some(a.paramCandidates,function(a){if(!D[a.paramId])return c.paramId=a.paramId,c.paramName=a.paramName,!0}),A.checkedNodes.push(c),!0}),n(a,x,A)}),a.$element.on("click",u.btnDelete,function(){var b=parseInt($(this).attr("data-index"),10);A.checkedNodes.splice(b,1),n(a,x,A)})}function n(a,c,d,e){var g={value:d.configStr||"",randomSearchIterNum:d.randomSearchIterNum||"",groupId:d.groupId,params:p(c,d.checkedNodes),single:d.singleParam};a.set("body",f(g)),a.$(u.helpIcon).each(function(){var a=$(this);a.attr("title")&&new s(a,{position:"middle center",align:"center",escape:!1})}),e&&a.$(e).focus(),a.$(u.btnAdd).toggleClass("hide",d.singleParam||b.keys(C).length===x.length)}function o(a,b){a.next(".err-msg").remove(),a.after('<div class="err-msg"><span class="icon icon-close-c"></span>'+b+"</div>"),a.one("focus",function(){a.next(".err-msg").remove()})}function p(a,c){return C={},D={},b.each(c,function(a){D[a.paramId]=!0}),b.each(a,function(a){b.every(a.paramCandidates,function(a){return D[a.paramId]})&&(C[a.nodeId]=!0)}),b.map(c,function(c){var d=[];return b.each(a,function(a){if(c.nodeId===a.nodeId||!C[a.nodeId]){var e=[];b.each(a.paramCandidates,function(a){c.paramId!==a.paramId&&D[a.paramId]||e.push({paramId:a.paramId,paramName:a.paramName,paramLabel:a.paramDisplayName})}),d.push({nodeId:a.nodeId,nodeName:a.nodeName,paramOptions:e})}}),c.nodeOptions=d,c})}function q(){v=null}function r(a){const b=a.experimentId,e=a.groupId;if(!window.react_bridge.actions)return new Promise(function(b){w=a,v=b,B=new c({destroyOnHide:!0,title:t("configCyclicParams"),className:"dialog-cyclic-params",afterShow:l,afterHide:q,buttons:[{text:t("groupLoopRun"),click:j,type:"primary"},{text:t("save"),click:k},{text:t("cancel"),click:function(){this.hide()}}]})});window.react_bridge.actions.global.setEvent({event:d}),window.react_bridge.actions.settings.groupLoop.get({experimentId:b,groupId:e,afterClose:function(){g.tick()}})}var s=a.Popup,t=h.translate,u={paramType:"input[name=paramType]",btnAdd:".btn-add",btnDelete:".btn-delete",helpIcon:".i-help",randomSearchIterNum:"#randomSearchIterNum"},v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null;return{show:r}}),define("workspace/canvas/hotkeys",["zero/zero","../../global/event","../../global/nodeMenuChecker"],function(a,b,c){"use strict";function d(a){return a&&a.isGroup&&a.isGroup()}function e(a){return a&&a.isRemark&&a.isRemark()}function f(a){return a&&a.isNode()}function g(a){if(h){var g=h.paper.options.gridSize;switch(a.keyCode){case 8:case 46:a.preventDefault();var i=h.focusedCell;if(i&&i.isLink())return void h.linkContextMenu.deleteLink(i.data);h.blankContextMenu.deleteNodes(h.selectedNodes);break;case 67:(a.metaKey||a.ctrlKey)&&h.blankContextMenu.copyNodes(h.selectedNodes);break;case 86:(a.metaKey||a.ctrlKey)&&h.blankContextMenu.pasteNodes();break;case 76:if(a.metaKey||a.ctrlKey){var j=h.focusedCell;f(j)&&!d(j)&&!e(j)&&c.canViewLog(j.data.codeName)&&b.showNodeLog(j.data.id)}break;case 82:if(a.ctrlKey&&a.shiftKey){var j=h.focusedCell;f(j)&&!d(j)&&!e(j)&&"running"!==j.data.nodeInstanceStatus&&c.canExecuteNode(j.data.codeName)&&b.executeNode(j.data.id)}break;case 37:var k=h.getSelectedNodes();h.selectionHandler.updateNodesPosition(k,0-g,0);break;case 38:var k=h.getSelectedNodes();h.selectionHandler.updateNodesPosition(k,0,0-g);break;case 39:var k=h.getSelectedNodes();h.selectionHandler.updateNodesPosition(k,g,0);break;case 40:var k=h.getSelectedNodes();h.selectionHandler.updateNodesPosition(k,0,g)}}}var h,i={init:function(a){return h=a,$("#j-bpmn").on("keydown",g),i},destroy:function(){h=null,$("#j-bpmn").off("keydown",g)}};return i}),define("midway/workspace/nodeInfo",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,f,g,h){var i='<div class="pai-node-info"><table><tbody><tr><td>'+e(d("nodeName"))+':</td><td><div class="node-name">'+e(a)+"</div></td></tr>";if(b.defName&&(i+="<tr><td>"+e(d("algoName"))+":</td><td>"+c(b.defName)+"</td></tr>"),i+="",b.startTime&&(i+="<tr><td>"+e(d("startDatetime"))+":</td><td>"+e(b.startTime)+"</td></tr>"),i+="",b.jobStatus&&(i+="<tr><td>"+e(d("executeStatus"))+":</td><td>"+e(d(b.jobStatus))+"</td></tr>"),i+="",b.quickViewData){i+="";for(var f in b.quickViewData)i+="<tr><td>"+e(f)+":</td><td>"+e(b.quickViewData[f])+"</td></tr>";i+=""}return i+="",g&&h&&(i+='<tr class="benchmark-status"><td colspan="2" ><div><span>  '+e(d("benchmark"))+e(d("benchmark_"+h))+" </span></div></td></tr>"),i+="</tbody></table></div>"}(b.name,b.execStatus,b.key,b.showBenchmarkStatus,b.benchmarkStatus)}}),define("workspace/canvas/tooltips",["zero","zero/zero","../../global/config","../../storage/componentCache","../../midway/workspace/nodeInfo","../../ajax/benchmark"],function(a,b,c,d,e,f){"use strict";function g(b,g,h){if(b.isNode()){i();var n=g.elem,o=h.target,p=j.paper.sx;if(g.isBulbElem(o))return;var q=g.findPortByElem(o);if(q&&q.description){var r=g.isOutPortElem(o),s=panejs.utils.getOffsetUntil(o,n),t=o.offsetWidth||o.clientWidth,u=o.offsetHeight||o.clientHeight;k=new a.Popup({element:n,content:q.description,position:r?"bottom center":"top center",gap:(s.top+u/2+6)*p,offset:(s.left+t/2)*p,onHidden:function(){setTimeout(this.destroy.bind(this),10)}}),k.delayedShow()}else{if(b.isSuperNode&&b.isSuperNode())return;var v=b.data;if(v.execStatus||(v.execStatus={}),!v.execStatus.defName){var w=v.isModel?c.NS.model+v.nodeDefId:v.nodeDefId,x=d.get(w);x&&(v.execStatus.defName=x.name)}if(j.benchmarkNodes&&j.benchmarkNodes[v.id]){(new Date).valueOf()-(j.queryCandidateNodesTime||0)>3900&&(j.queryCandidateNodesTime=(new Date).valueOf(),f.queryCandidateNodes({expId:j.experimentId}).then(function(a){j.benchmarkNodes=a.candidateNodes}),v.benchmarkStatus=m[j.benchmarkNodes[v.id].benchmarkRecordStatus||j.benchmarkNodes[v.id].benchmarkStatus],v.showBenchmarkStatus=!!j.benchmarkNodes[v.id]&&"preparing"!==v.benchmarkStatus)}l=new a.Popup({element:n,content:e(v),escape:!1,align:"left",position:"bottom left",fallback:"bottom left",maxSearchDepth:1,gap:31*p,offset:15*p,delay:{show:100},onHidden:function(){setTimeout(this.destroy.bind(this),10)}}),l.delayedShow()}}}function h(a){a.isNode()&&i()}function i(){k&&(k.isHidden()?k.destroy():k.delayedHide(),k=null),l&&(l.isHidden()?l.destroy():l.delayedHide(),l=null)}var j,k=null,l=null,m={default:"config",editing:"config",testing:"running",running:"running",failed:"finish",success:"finish"},n={init:function(a){return j=a,j.paper.on("cell:mouseover",g).on("cell:mouseout",h),n},hide:i,destroy:function(){i(),j=null}};return n}),define("ajax/recommend",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/recom.json");return{queryRecommendationNodes:function(b,d){return c.get({method:"queryRecomNode",nodeInstanceId:b,port:d,maxSize:5}).then(function(b){var c=b.allPorts||{},e=b.recomInPort||{};return a.map(b.recomModels,function(b){var f=c[b.id],g=[],h=[];a.each(f,function(a){1===a.ioType?g.push(a):2===a.ioType&&h.push(a)});var i=null,j=e[b.id];return a.some(g,function(a){if(a.sequence===j)return i=a,!0}),b.inPorts=g,b.outPorts=h,b.recommendPort=i,b.recommendSequence=j,b.sourcePortSequence=d,b})})}}}),define("workspace/canvas/recommend",["zero","zero/zero","../../i18n","../../global/config","../../ajax/recommend"],function(a,b,c,d,e){"use strict";function f(a,b,c){a.isNode()&&b.isBulbElem(c.target)&&(u||(u=new q({element:c.target,content:r("recommendationTip"),escape:!1,position:"top center",align:"center",prefer:"counterclockwise",gap:2,onHidden:function(){u=null,setTimeout(this.destroy.bind(this),10)}}),u.delayedShow()))}function g(a,b){if(a.isNode()){p.some(a.getVisiblePorts(!1),function(a){return!v.isPortConnected(a.id,!0)})&&!a.emptyRecommendation&&(y=a,b.setRecommendable(!0))}}function h(a,b){a==y&&(b.setRecommendable(!1),y=null)}function i(){x&&(v.model.beginUpdate(),p.forEach(A,function(a){a.eachLink(function(a){a.removeFromParent()}),a.removeFromParent()}),v.model.endUpdate(),v.adjustPaper(),x.setRecommending(!1),t(window.document,"click",i),w=null,x=null,A=[],B=[])}function j(a,b,c){if(!(v.isLink(a)||v.isGroup(a)||v.isRemark(a)))if(a.isNode()&&b.isBulbElem(c.target)){if(w===a||z[a.id])return;i(),c.stopPropagation(),b.setRecommending(!0);var d=v.getNodeId(a),f=[],g=[];a.eachOutPort(function(a){v.isPortConnected(a.id,!0)||(g.push(a.sequence),f.push(e.queryRecommendationNodes(d,a.sequence)))}),z[a.id]=!0,Promise.all(f).then(function(c){var d=!1,e={};p.forEach(c,function(a,b){a.length>0&&(d=!0,e[g[b]]=a)}),d?(w=a,x=b,s(window.document,"click",i),k(e)):(b.setRecommending(!1),b.setRecommendable(!1),a.emptyRecommendation=!0),z[a.id]=!1})}else i()}function k(a){var b=0,c=180,d=30,e=0,f=d,g=10,h=120;w.eachOutPort(function(d){p.forEach(a[d.sequence],function(){b+=1,e+=c+g})}),e-=g;var i=w.getPosition(),j=i.x-e/2+c/2,k=i.y+h,n=new panejs.geometry.Rect(j,k,e,f),o=v.model.filterCell(function(a){return v.model.isNode(a)}),q=v.paper.getWrap(),r=p.getBounds(q),s=v.paper.toLocalPoint({x:r.left+r.width,y:r.top+r.height}),t=l(n.clone(),s.y,o),u=t?t.x:n.x,x=t?t.y:n.y;m(a,u,x,g+c)}function l(a,b,c){return a.y+a.height>b?null:p.every(c,function(b){return!b.getBBox().intersect(a)})?a:(a.y+=30,l(a,b,c))}function m(a,b,c,d){var e=b,f=c;A=[],B=[],v.model.beginUpdate(),w.eachOutPort(function(b){p.forEach(a[b.sequence],function(a){a.positionX=e,a.positionY=f,a.sourcePort=b,a.isRecommendation=!0,A.push(v.addRecommendNode(a)),e+=d})}),v.model.endUpdate(),v.model.beginUpdate(),p.forEach(A,function(a){var b=a.data,c=b.sourcePort,d=b.recommendPort;v.setPortConnected(a,d.id,!1,!0);var e=v.addRecommendLink({isRecommendation:!0,sourceNode:w,targetNode:a,sourcePort:c,targetPort:d});B.push(e)}),v.model.endUpdate(),v.adjustPaper(),n()}function n(){p.forEach(A,function(a){o(a,v.paper.getView(a))}),p.forEach(B,function(a){o(a,v.paper.getView(a))})}function o(a,b){b&&(s(b.elem,"click",function(){var b=v.isLink(a)?a.getTerminalNode(!1):a,c=w,d=c.getPosition(),e=b.getPosition(),f=c.getVisiblePorts(!1),g=b.data,h=d.x,i=e.y,j=f.length;if(j>1){var k=g.sourcePortSequence,l=Math.ceil(j/2);h+=Math.round(200/j)*(k-l)}v.createNode(g,!1,h,i).then(function(a){var b=null;a.eachInPort(function(a){a.sequence===g.recommendSequence&&(b=a)}),v.createLink({source:v.getNodeId(c),target:v.getNodeId(a),outputPortId:g.sourcePort.id,inputPortId:b.id})})}),s(b.elem,"mouseover",function(){var c="hovered";if(!p.hasClass(b.elem,c)){p.addClass(b.elem,c),a.eachLink(function(a){var b=v.paper.getView(a);b&&p.addClass(b.elem,c)});var d=a.getTerminalNode(!1),e=v.paper.getView(d);e&&p.addClass(e.elem,c)}}),s(b.elem,"mouseout",function(c){var d="hovered";if(!p.containsElement(b.elem,c.relatedTarget||c.toElement)&&p.hasClass(b.elem,d)){p.removeClass(b.elem,d),a.eachLink(function(a){var b=v.paper.getView(a);b&&p.removeClass(b.elem,d)});var e=a.getTerminalNode(!1),f=v.paper.getView(e);f&&p.removeClass(f.elem,d)}}))}var p=panejs.utils,q=a.Popup,r=c.translate,s=p.addEventListener,t=p.removeEventListener,u=null,v=null,w=null,x=null,y=null,z={},A=null,B=null,C={init:function(a){return v=a,v.paper.on("cell:pointerDown",j).on("cell:mouseover",f).on("cell:mouseenter",g).on("cell:mouseleave",h),C},destroy:function(){v=null,w=null,x=null}};return C}),define("ajax/onlineDeploy",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/onlineDeploy.json");return{queryCanDeployPredictNodes:function(a){return c.get({method:"queryCanDeployPredictNodes",experimentId:a}).then(function(a){return a?a.predicts:[]})},extractDeployNodes:function(a,b){return c.get({method:"extractDeployNodes",experimentId:a,predictId:b},!0).then(function(a){return a?a.result:{}})}}}),define("midway/dialog/experiment/selectDeployNode",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<div class="form-group"><label for="dl-deploy-node">请选择一个预测节点</label><label for="dl-deploy-node" class="select-hacker"><select id="dl-deploy-node" class="form-control" data-id="prop-item-transformType">';return a.each(b,function(a){c+='<option value="'+d(a.id)+'">'+d(a.name)+"</option>"}),c+="</select></label></div>"}(b.list)}}),define("dialog/experiment/selectDeployNode",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/onlineDeploy","../../midway/dialog/experiment/selectDeployNode"],function(a,b,c,d,e){"use strict";function f(a,b){d.queryCanDeployPredictNodes(b.experimentId).then(function(b){a.set("body",e({list:b})),b.length&&a.$(k.dlSelectNode).val(b[0].id)})}function g(){var a=this,b=a.$(k.dlSelectNode).val();a.hide(),i(b)}function h(a){return new Promise(function(c){i=c,new b({title:"部署为预测服务",className:"dialog-select-deploy-node",destroyOnHide:!0,body:e({list:[]}),afterShow:function(){f(this,a)},buttons:[{text:j("ok"),type:"primary",click:g},{text:j("close"),click:function(){this.hide()}}]})})}var i,j=c.translate,k={dlSelectNode:"#dl-deploy-node"};return{show:h}}),define("midway/dialog/experiment/selectBenchmarkNode",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<div class="form-group"><label for="dl-deploy-node">请在配置模型优化前,请先选择基准算法:</label><label for="benchmark-node" class="select-hacker"><select id="benchmark-node" class="form-control" data-id="prop-item-transformType">';return a.each(b,function(a){c+='<option value="'+d(a.nodeInstId)+'">'+d(a.nodeInstName)+"</option>"}),c+="</select></label></div>"}(b.list)}}),define("dialog/experiment/selectBenchmarkNode",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/benchmark","../../midway/dialog/experiment/selectBenchmarkNode"],function(a,b,c,d,e){"use strict";function f(a,b){d.queryCandidateNodes({expId:b}).then(function(b){j=b.candidateNodes,a.set("body",e({list:j})),b.length&&a.$(n.dlSelectNode).val(b[0].nodeInstId)})}function g(){var a=this,b=a.$(n.dlSelectNode).val(),c=j[b].benchmarkId;d.preCheckBenchmark(k,b).then(function(){var d="/benchmark.htm#/config?expId="+k+"&nodeInstId="+b+"&benchmarkId="+c+"&projectName="+l;window.open(d,"_blank").focus(),a.hide()})}function h(a){return k=a.expId,l=a.projectName,new Promise(function(a){i=i,new b({title:"选择节点",className:"dialog-select-deploy-node",destroyOnHide:!0,body:e({list:[]}),afterShow:function(){f(this,k)},buttons:[{text:m("ok"),type:"primary",
click:g},{text:m("close"),click:function(){this.hide()}}]})})}var i,j,k,l,m=c.translate,n={dlSelectNode:"#benchmark-node"};return{show:h}}),define("workspace/canvas/onGlobalEvent",["zero/zero","zero/ui/DialogSingleInput","../../i18n","../../global/Track","../../global/event","../../global/config","../../storage/globalCache","../../ajax/onlineDeploy","../../ajax/experiment","../../dialog/experiment/selectDeployNode","../../dialog/experiment/selectBenchmarkNode","../../dialog/experiment/cyclicParams","../../global/environment","../../global/nodeMenuChecker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){return g.get(g.keys.projectName)}function p(a){var b=s.toLocalPoint({x:a.x,y:a.y}),c={};return c.x=b.x-180*a.rateX,c.y=b.y-30*a.rateY,c}function q(){return s&&s.experimentId>0}function r(a){s.showMaskLoading(),h.extractDeployNodes(s.experimentId,a).then(function(b){s.hideMaskLoading();var c=[b.modelNode.id,b.predictNode.id];b.featureNodes.forEach(function(a){c.push(a.id)});var d=[],f=[],g=(b.deps||[]).map(function(a){return d.push(a.toInId),f.push(a.fromOutId),a.fromInstanceId+"-"+a.fromOutId+"-"+a.toInstanceId+"-"+a.toInId});e.highlightDeployNode({nodeInstanceId:a,experimentId:s.experimentId,links:g,nodes:c,inPorts:d,outPorts:f,cannotDeployNodes:b.cannotDeployNodeIds||[]})},function(){s.hideMaskLoading()})}var s,t=f.reg,u=c.translate,v=4,w=.2,x=.1,y=.1;e.onAddRemark(function(a,b){q()&&s.createRemark(a,b)}),e.onComponentDrop(function(a){if(q()){var b=p(a);a.isGroup?s.dropGroupToCanvas(a.nodeDefId,parseInt(b.x,10),parseInt(b.y,10)):s.createNode(a.nodeDefId,a.isModel,parseInt(b.x,10),parseInt(b.y,10)).then(function(b){if(s.onSelectionChanged([b]),s.onFocusChanged(b),m.isInternal){var c=parseInt(window.localStorage.getItem("promotionCount")||0,10);n.isBinaryAlgo(b.data&&b.data.codeName)&&c<4&&window.react_bridge.actions.showPopUp({x:a.x,y:a.y-15,title:"二分类模型寻优上线了",okText:"知道了",content:'                  <p style="width:200px">                    二分类模型寻优上线了！可以帮您自动寻找优秀的二分类算法和参数！                  </p>                  <p style="width:200px">了解详情：<a href="https://www.atatech.org/articles/92734" target="_blank">链接</a></p>',callback:function(a){a?c=5:c+=1,window.localStorage.setItem("promotionCount",c)}})}})}}),e.onTableDrop(function(a){if(q()){var b=p(a),c=a.projectName===o()?a.tableName:a.projectName+"."+a.tableName,d=a.isGlobalDataSource||!1;s.dropDataTable(c,parseInt(b.x,10),parseInt(b.y,10),d)}}),e.onCanvasZoomIn(function(){q()&&s.paperScroll.zoom(y,{minScale:w,maxScale:v,scaleGrid:x})}),e.onCanvasZoomOut(function(){q()&&s.paperScroll.zoom(-y,{minScale:w,maxScale:v,scaleGrid:x})}),e.onCanvasScaleTo(function(a){q()&&s.paperScroll.zoom(a,{absolute:!0,minScale:w,maxScale:v,scaleGrid:x})}),e.onRestoreActualSize(function(){q()&&s.paperScroll.zoom(1,{absolute:!0,minScale:w,maxScale:v,scaleGrid:x})}),e.onFitToWindow(function(a,b){q()&&s.paperScroll.zoomToFit({padding:20,minScale:a||w,maxScale:b||v,scaleGrid:x})}),e.onSwitchDragOrSelectMode(function(a){q()&&s.selectionHandler.switchMode(a)}),e.onUpdateNodes(function(b,c){q()&&b===s.experimentId&&c&&a.isArray(c)&&s.updateNodeStatus(c)}),e.onWindowResize(function(){q()&&(s.paperScroll.adjustClientSize(),s.paperScroll.adjustPadding())}),e.onWindowClose(function(){q()&&s.saveCanvasStatus()}),e.onHighlightDeployNode(function(a){s.highlightDeploy(a)}),e.onUnHighlightDeployNode(function(){s.unHighlightDeploy()}),e.onDeployOnlineService(r),e.onSelectDeployNode(function(){j.show({experimentId:s.experimentId}).then(r)}),e.onSelectBenchmark(function(){k.show({expId:s.experimentId,projectName:s.metadata.projectName})}),e.onRollbackDeleteNode(function(a){i.redoDeleteNodeInstance(a).then(function(a){a&&a.length&&s.addNodes(a)})}),e.onCreateGroup(function(a){new b({title:u("groupName"),inputValue:"Group",afterHide:function(){this.destroy()},callback:function(b){return!!b&&(t.xss.test(b)?(this.showErrorTip(u("inputXss")),!1):void s.createGroup(a||s.selectedNodes,{name:b,collapsed:!1}))}})}),e.onSplitGroup(function(a){s.removeGroup(a||s.selectedNodes[0])}),e.onGroupLoop(function(){var a,b,c=s.selectedNodes,d=c[0];d.isGroup&&d.isGroup()?a=d:(d=c.find(function(a){return!!a.data.groupId}),a=d?d.parent:s.createGroup(c,{name:u("groupLoop")+"  ( "+moment().format("YYYY-MM-DD hh:mm:ss")+" )",collapsed:!1})),b=setInterval(function(){a.data.id&&(clearInterval(b),l.show({groupId:a.data.id,experimentId:a.data.experimentId}))},150),setTimeout(function(){clearInterval(b)},4e3)}),e.onSearchedNode(function(b){var c=s.nodeById;a.keys(c).forEach(function(d){var e=$(s.paper.getView(c[d]).elem).find(".pane-node-content");a.some(b,function(a){return a.id==d})?e.addClass("searched"):e.removeClass("searched")})}),e.onToggleNodeClass(function(a,b,c){var d=s.getNodeById(a);if(d){var e=s.paper.getView(d).elem.classList;c?e.add(b):e.remove(b)}}),e.onSelectSearchedNode(function(b){var c=s.nodeById;a.keys(c).forEach(function(a){var d=c[a],e=s.paper.getView(d).elem.classList;b==a?(s.paperScroll.center(d.data.positionX,d.data.positionY),e.add("selected"),s.onSelectionChanged([d]),s.onFocusChanged(d)):e.remove("selected")})});var z={init:function(a){return s=a,z},destroy:function(){s=null}};return z}),define("workspace/canvas/contextMenu",["zero/zero","zero/declare"],function(a,b){"use strict";return b("workspace/Canvas/ContextMenu",[],{constructor:function(a){this.canvas=a,this.paper=a.paper,this.model=a.model,this.init().setup()},init:function(){return this},setup:function(){return this},destroy:function(){this.menu&&this.menu.destroy(),a.destroy(this)},isGroup:function(a){return a&&a.isGroup&&a.isGroup()},isRemark:function(a){return a&&a.isRemark&&a.isRemark()},isNode:function(a){return a&&a.isNode()},isLink:function(a){return a&&a.isLink()},getExperimentId:function(){return this.canvas.experimentId},getSelectedNodes:function(){return this.canvas.getSelectedNodes()},hasSelectedNodes:function(){return this.canvas.hasSelectedNodes()}})}),define("midway/dialog/experiment/saveVersion",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="form-group"><label class="word">'+e(d("description"))+'</label><textarea id="versionComment" class="form-control" rows="3"placeholder="'+e(d("descriptionPlaceholder"))+'"></textarea></div>'}()}}),define("dialog/experiment/saveVersion",["zero/zero","zero/ui/DialogEx","../../global/notify","../../global/config","../../i18n","../../ajax/experimentMeta","../../midway/dialog/experiment/saveVersion"],function(a,b,c,d,e,f,g){"use strict";function h(a,b){a.next(".err-msg").remove(),a.after('<div class="err-msg"><span class="icon icon-close-c"></span>'+b+"</div>"),a.next(".err-msg").show(),a.one("focus",function(){a.next(".err-msg").remove()})}function i(){var a=this,b=$(n.comment).val();if(m.xss.test(b))return void h(a.$(n.comment),l("newProjectNameXss"));a.showLoading(),f.saveExperimentVersion(k,b).then(function(){a.hideLoading(),c.success(l("saveVersionSuccess")),a.hide()},function(){a.hideLoading()})}function j(a){k=a,new b({title:l("saveVersion"),className:"dialog-save-version",destroyOnHide:!0,canFullscreen:!1,body:g(),buttons:[{text:l("submit"),type:"primary",click:i},{text:l("close"),click:function(){this.hide()}}]})}var k,l=e.translate,m=d.reg,n={formGroup:".form-group",comment:"#versionComment"};return{show:j}}),define("midway/dialog/experiment/loadVersion",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var c='<table class="table table-bordered table-hover"><thead><tr><th style="width: 40px;">#</th><th>'+e(d("introduction"))+'</th><th style="width: 150px;">'+e(d("createTime"))+'</th><th style="width: 100px;">'+e(d("actions"))+"</th></tr></thead>";return b&&(c+="<tbody>",a.each(b,function(a){c+="<tr><td>"+e(a.version)+"</td><td>"+e(a.comment)+"</td><td>"+e(a.gmtCreate)+'</td><td class="actions"><a href="javascript:void(0);" data-id="'+e(a.experimentId)+'"data-version="'+e(a.version)+'" class="btn-open">'+e(d("open"))+'</a><span class="split"></span><a href="javascript:void(0);" data-id="'+e(a.experimentId)+'"data-versionId="'+e(a.id)+'" class="btn-delete">'+e(d("delete"))+"</a></td></tr>"}),c+="</tbody>"),c+="</table>"}(b.versions)}}),define("dialog/experiment/loadVersion",["zero/zero","zero/ui/DialogEx","zero/ui/DataTable","../../global/notify","../../i18n","../../ajax/experimentMeta","../../ajax/experiment","../../global/event","../../global/config","../../midway/dialog/experiment/loadVersion"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){var a=this;f.queryAllExpVersions(m).then(function(b){a.hideLoading(),a.set("body",j({versions:b.versions})),a.$(o.container).on("click",o.btnOpen,function(){a.showLoading();var b=$(this),c=b.attr("data-id"),d=b.attr("data-version");f.revertToVersion(c,d).then(function(b){h.tryOpenExperiment({id:b.experimentId,name:b.name}),b.label=b.name,b.parentId=b.parentDir,h.createExperimentTreeNode(b,{id:b.parentId}),a.hideLoading(),a.hide()},function(){a.hideLoading()})}).on("click",o.btnDelete,function(){a.showLoading();var b=$(this),c=b.attr("data-id"),d=b.attr("data-versionId");f.deleteExpVersion(c,d).then(function(){a.hideLoading(),b.parents("tr").remove()},function(){a.hideLoading()})})},function(){a.hideLoading()})}function l(a){m=a,new b({title:n("loadVersion"),className:"dialog-load-version",body:j({versions:null}),afterShow:k,buttons:[{text:n("close"),click:function(){this.hide()}}]})}var m,n=e.translate,o={container:".table",btnOpen:".btn-open",btnDelete:".btn-delete"};return{show:l}}),define("workspace/canvas/blankContextMenu",["zero/zero","zero/declare","zero/ui/Confirm","zero/ui/ContextMenu","../../i18n","../../global/Track","../../global/event","../../global/notify","../../ajax/common","../../ajax/experiment","../../ajax/experimentMeta","./contextMenu","../../storage/persistence","../../properties/ItemExperimentVersion","../../dialog/experiment/saveVersion","../../dialog/experiment/loadVersion"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q=e.translate;return b("workspace/Canvas/BlankContentMenu",[l],{constructor:function(a){l.prototype.constructor.call(this,a)},init:function(){var a=this;return this.menu=new d({key:"blank",items:[{key:"executeNodes",icon:"arrow-right-o",label:q("executeSelectedNodes"),disabled:function(){return!a.hasSelectedNodes()}},{key:"copyNodes",icon:"copy-node",accessKey:"Ctrl + C",label:q("copyNodes"),disabled:function(){return!a.hasSelectedNodes()}},{key:"pasteNodes",icon:"download",accessKey:"Ctrl + V",label:q("pasteNodes"),disabled:function(){return!m.getObject("node-clipboard-data")}},{key:"addRemark",icon:"sheet-1",label:q("addRemark")}],on:{copyNodes:a.copyNodes.bind(a),executeNodes:function(){a.executeNodes()},pasteNodes:function(){a.pasteNodes(a.localPosition)},rollbackDeleteNode:function(){a.rollbackDeleteNode()},saveVersion:function(){a.saveVersion()},loadVersion:function(){a.loadVersion()},addRemark:function(){g.addRemark(a.localPosition.x,a.localPosition.y)},zoomIn:function(){return g.zoomInCanvas(),!1},zoomOut:function(){return g.zoomOutCanvas(),!1},realSize:function(){return g.restoreActualSize(),!1},scaleToFitCanvas:function(){return g.fitToWindow(),!1},locateExperiment:function(){experimentTracker.click("LocateExperiment"),g.locateExperiment(a.getExperimentId())},locateModel:function(){experimentTracker.click("LocateModel"),g.locateModel(a.getExperimentId())}}}),a},setup:function(){var a=this;return a.paper.on("blank:contextmenu",function(b,c,d){b.preventDefault(),a.localPosition={x:c,y:d},a.menu.show(b.pageX,b.pageY)}),a},executeNodes:function(){var b=this,c=b.canvas,d=a.map(b.getSelectedNodes(),function(a){return c.getNodeId(a)});g.executeNodes(d)},copyNodes:function(b){var c=this,d=c.canvas,e=null,f=[],g={},h=b||c.getSelectedNodes();return h=h.filter(function(a){return!!a}),a.each(h,function(a){var b=a.getBBox(),h=a.getPosition(),i=c.isGroup(a);e=e?e.union(b):b,f.push({id:d.getNodeId(a),isGroup:i,x:h.x,y:h.y}),i&&a.eachChild(function(a){var b=d.getNodeId(a);if(!g[b]){var c=a.getPosition();f.push({id:b,x:c.x,y:c.y}),g[b]=!0}})}),e&&m.setObject("node-clipboard-data",{experimentId:c.getExperimentId(),nodes:f,offsetX:10,offsetY:10,diffX:35,diffY:35,width:e.width,height:e.height,startX:e.x,startY:e.y}),c},pasteNodes:function(a){var b=this,c=b.canvas,d=c.paper,e=m.getObject("node-clipboard-data");if(e){if(b.pasting)return b.pastingQueue||(b.pastingQueue=[]),b.pastingQueue.push(a),b;b.pasting=!0,c.showMaskLoading();var f,g;if(a)f=a.x-e.startX,g=a.y-e.startY;else{var h=d.getWrap(),l=panejs.utils.getBounds(h),n=c.toLocalPoint({x:l.left,y:l.top}),o=new panejs.geometry.Rect(Math.round(n.x),Math.round(n.y),Math.round(h.clientWidth/d.sx),Math.round(h.clientHeight/d.sy)),p=new panejs.geometry.Rect(e.startX+e.diffX,e.startY+e.diffY,e.width,e.height);o.containsRect(p)||(e.diffX=n.x+e.offsetX-e.startX,e.diffY=n.y+e.offsetY-e.startY,e.offsetX+=190),f=e.diffX,g=e.diffY,e.diffX+=35,e.diffY+=35,m.setObject("node-clipboard-data",e)}var q=[],r=[];panejs.utils.forEach(e.nodes,function(a){a.isGroup?r.push(a.id):q.push({id:a.id,positionX:a.x+f,positionY:a.y+g})});var s=function(a,d){if(b.pasting=!1,c.hideMaskLoading(),!d){var e=b.pastingQueue&&b.pastingQueue.length>0;c.pasteNodes(a,!e),e&&b.pasteNodes(b.pastingQueue.pop())}};q.length>5?k.copyNodeInstancesAsync(e.experimentId,b.getExperimentId(),q,r).then(function(a){function b(){i.queryAsynJobStatus(a).then(function(a){"running"===a.status?c():"failed"===a.status?s(null,!0):(clearTimeout(d),s(a))},function(){clearTimeout(d),s(null,!0)})}function c(){d=setTimeout(b,3e3)}var d;c()},function(){s(null,!0)}):j.copyNodeInstances(e.experimentId,b.getExperimentId(),q,r).then(function(a){s(a)},function(){s(null,!0)})}return b},rollbackDeleteNode:function(){var a=this;j.redoDeleteNodeInstance(this.getExperimentId()).then(function(b){b&&b.length&&a.canvas.addNodes(b)})},deleteNodes:function(b){var d=[],e=[],f=[];a.each(b,function(a){this.isRemark(a)?e.push(a):this.isGroup(a)?f.push(a):d.push(a)},this);var g=this.canvas,h=null;f.length&&(h=new Promise(function(a){c({title:q("delete"),body:q("confirmDeleteNode"),onAccept:function(){a()}})})),h?h.then(function(){var a=g.deleteGroups(f,!1);d=d.concat(a.nodes),e=e.concat(a.remarks),e.length&&g.deleteRemarks(e),d.length&&g.deleteNodes(d)}):(e.length&&g.deleteRemarks(e),d.length&&g.deleteNodes(d))},saveVersion:function(){var a=this.getExperimentId();o.show(a)},loadVersion:function(){var a=this.getExperimentId();p.show(a)}})}),define("dialog/experiment/renameNode",["zero/zero","zero/ui/DialogSingleInput","../../i18n","../../global/config","../../ajax/experiment"],function(a,b,c,d,e){"use strict";function f(a,c){return new Promise(function(d){new b({title:g("rename"),inputValue:c.name,afterHide:function(){this.destroy()},callback:function(b){var f=this;return!!b&&(h.xss.test(b)?(f.showErrorTip(g("inputXss")),!1):void e.renameNodeInstance(a,c.id,b).then(function(){d(b)}))}})})}var g=c.translate,h=d.reg;return{show:f}}),define("midway/dialog/experiment/scatterDiagram",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="scatter-diagram-chart"><div class="chart-box"></div><div class="feature-box"></div></div>'}}),define("graph/newScatterDiagram",["zero/zero","zero/declare"],function(a,b){"use strict";var c,d={margin:20,top:20,bottom:20};return b("graph/newScatterDiagram",[],{constructor:function(a){if(!a||!a.selector)throw"newScatterDiagram Error: NO selector!";this.options=$.extend({},d,a),this.$container=$(a.selector),c=this.$container.height();var b=$("<div></div>").width(c).height(c).css("margin","0 auto");this.$container.append(b),this.echart=echarts.init(b[0])},draw:function(a,b){this.traits=b,this.data=a,this._chartData=this._initChartData(this.data,this.traits),this._chartOptions=this._initOptions(this._chartData,this.traits),this.echart.setOption(this._chartOptions)},_initChartData:function(a,b){b.length;return b.map(function(c){return b.map(function(b){return a.map(function(a,d){return[a[c],a[b],a._category]}).reduce(function(a,b){return b[2]?(a[b[2]]||(a[b[2]]=[]),a[b[2]].push(b.slice(0,2)),a):(a.no_label||(a={},a.no_label=[]),a.no_label.push(b.slice(0,2)),a)},{})})})},_initOptions:function(a,b){var d={grid:[],xAxis:[{gridIndex:0,min:0,max:20}],yAxis:[{gridIndex:0,min:0,max:15}],series:[{name:"I",type:"scatter",xAxisIndex:0,yAxisIndex:0,data:[]}],tooltip:{show:!0,formatter:"{a}:  {c}"},legend:{data:b,left:"center"},animation:!1},e=b.length,f=Math.floor((c-50)/e),g=(this.options.margin,[]),h=[],i=[],j=[],k=[];return a.forEach(function(a,c){a.forEach(function(a,d){var f=e*c+d,l=e*(e-c-1)+d,m=e*(e-c-1)+d;j=j.concat(Object.keys(a).map(function(e){return{name:"label: "+e+", "+b[d]+"/"+b[c],type:"scatter",xAxisIndex:l,yAxisIndex:m,data:a[e],symbolSize:4,symbol:"circle"}})),c===e-1?i.push({name:b[d],nameGap:10,nameLocation:"middle",gridIndex:f,min:"dataMin",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{interval:2,show:!1}}):i.push({gridIndex:f,min:"dataMin",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}}),0===d?h.push({gridIndex:f,axisLine:{show:!1},min:"dataMin",splitNumber:3,axisTick:{show:!0,interval:2},name:b[e-c-1],nameRotate:90,nameGap:30,nameLocation:"middle",axisLabel:{show:!0,interval:2,formatter:function(a){return a>1e6?(a/1e6).toFixed(0)+"m":a>1e3?(a/1e3).toFixed(0)+"k":a%1!=0?_.round(Number(a),2):a}}}):(h.push({name:b[c],gridIndex:f,min:"dataMin",splitNumber:3,axisLine:{show:!1},name:"  ",axisTick:{show:!1},axisLabel:{show:!1}}),k.push({show:!1})),g.push({x:10+90/e*d+"%",y:6+90/e*c+"%",width:70/e+"%",height:70/e+"%"})})}),d.grid=g,d.xAxis=i,d.yAxis=h,d.series=j,d.title=k,d},clear:function(){this.echart.clear()}})}),define("dialog/experiment/scatterDiagram",["zero/zero","zero/declare","zero/ui/DialogEx","../../midway/dialog/experiment/scatterDiagram","../../i18n","../../graph/newScatterDiagram","../../ajax/model"],function(a,b,c,d,e,f,g){"use strict";var h=e.translate,i={scatterDiagramChart:".scatter-diagram-chart .chart-box",features:".feature-box input",featureBox:".feature-box"},j={scatterDiagram:"dialog-scatter-diagram"};return b("experiment/scatterDiagram",[],{features:[],constructor:function(a,b){this.dialog=null,this.params=a},show:function(){this._initDialog(),this._initScatterDiagram(),this._initDom()},_initScatterDiagram:function(){this.newScatterDiagram=new f({selector:i.scatterDiagramChart})},_initDom:function(){this.dialog.$element.on("change",i.features,this._drawChart.bind(this))},_getCurrentFeature:function(){var a=this.dialog.$(i.features),b=[];return a.each(function(a,c){if(!0===c.checked){var d=$(c);b.push(d.attr("data-value"))}}),b},_loadData:function(){var a=this,b=this.params.nodeInstanceId,c=this.params.experimentId,d=this.params.projectName;g.queryScatterData(b,c,d).then(function(b){a.data=b,a._showFeatures();var c=a._processData();a.processedData=c,a._drawChart()})},_drawChart:function(){var a=this._getCurrentFeature(),b=this.processedData;this.dialog.showLoading();var c=this;setTimeout(function(){c.newScatterDiagram.clear(),c.newScatterDiagram.draw(b,a),c.dialog.hideLoading()},50)},_showFeatures:function(){for(var a=this.data,b=a.scatterDiagram.features,c=$("<div></div>"),d=0;d<b.length;d++){var e=b[d],f="checked='checked'";d>5&&(f="");var g=$("<label><input "+f+" type='checkbox' data-value="+e.featureName+"></input><span>"+e.featureName+"</span></label>");c.append(g)}this.dialog.$(i.featureBox).html(c)},_processData:function(){var b=this.data,c=b.scatterDiagram,d=c.features,e=c.label,f=!1,g=[];if(!0===a.isUndefined(e)||!0===a.isNull(e))f=!0;else var h=e.values,i=e.distribution.split(",");for(var j=d[0].values,k=0;k<j.length;k++){for(var l={},m=0;m<d.length;m++){var n=d[m],o=n.featureName,p=n.values;l[o]=p[k]}var q=0;!0!==f&&(q=i[h[k]]),l._category=q,g.push(l)}return g},_initDialog:function(){this.dialog=new c({title:h("scatterDiagram"),className:j.scatterDiagram,body:d(),buttons:[],destroyOnHide:!0,afterShow:this._loadData.bind(this)}),this.dialog.showLoading()}})}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("global/smart-table-scroll.min.js",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.SmartTableScroll=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){return function(b,c,d,h){return null==d?f(b,c,a):g(b,c,e(d,h,1),a)}}var e=a("lodash._basecallback"),f=a("lodash._binaryindex"),g=a("lodash._binaryindexby"),h=d();b.exports=h},{"lodash._basecallback":2,"lodash._binaryindex":13,"lodash._binaryindexby":14}],2:[function(a,b,c){function d(a){return null==a?"":a+""}function e(a,b,c){var d=typeof a;return"function"==d?void 0===b?a:w(a,b,c):null==a?t:"object"==d?h(a):void 0===b?u(a):i(a,b)}function f(a,b,c){if(null!=a){void 0!==c&&c in p(a)&&(b=[c]);for(var d=0,e=b.length;null!=a&&d<e;)a=a[b[d++]];return d&&d==e?a:void 0}}function g(a,b,c){var d=b.length,e=d,f=!c;if(null==a)return!e;for(a=p(a);d--;){var g=b[d];if(f&&g[2]?g[1]!==a[g[0]]:!(g[0]in a))return!1}for(;++d<e;){g=b[d];var h=g[0],i=a[h],j=g[1];if(f&&g[2]){if(void 0===i&&!(h in a))return!1}else{var k=c?c(i,j,h):void 0;if(!(void 0===k?v(j,i,c,!0):k))return!1}}return!0}function h(a){var b=m(a);if(1==b.length&&b[0][2]){var c=b[0][0],d=b[0][1];return function(a){return null!=a&&(a[c]===d&&(void 0!==d||c in p(a)))}}return function(a){return g(a,b)}}function i(a,b){var c=x(a),d=n(a)&&o(b),e=a+"";return a=q(a),function(g){if(null==g)return!1;var h=e;if(g=p(g),(c||!d)&&!(h in g)){if(null==(g=1==a.length?g:f(g,l(a,0,-1))))return!1;h=r(a),g=p(g)}return g[h]===b?void 0!==b||h in g:v(b,g[h],void 0,!0)}}function j(a){return function(b){return null==b?void 0:b[a]}}function k(a){var b=a+"";return a=q(a),function(c){return f(c,a,b)}}function l(a,b,c){var d=-1,e=a.length;b=null==b?0:+b||0,b<0&&(b=-b>e?0:e+b),c=void 0===c||c>e?e:+c||0,c<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function m(a){for(var b=y(a),c=b.length;c--;)b[c][2]=o(b[c][1]);return b}function n(a,b){var c=typeof a;return!!("string"==c&&A.test(a)||"number"==c)||!x(a)&&(!z.test(a)||null!=b&&a in p(b))}function o(a){return a===a&&!s(a)}function p(a){return s(a)?a:Object(a)}function q(a){if(x(a))return a;var b=[];return d(a).replace(B,function(a,c,d,e){b.push(d?e.replace(C,"$1"):c||a)}),b}function r(a){var b=a?a.length:0;return b?a[b-1]:void 0}function s(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function t(a){return a}function u(a){return n(a)?j(a):k(a)}var v=a("lodash._baseisequal"),w=a("lodash._bindcallback"),x=a("lodash.isarray"),y=a("lodash.pairs"),z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,A=/^\w*$/,B=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,C=/\\(\\)?/g;b.exports=e},{"lodash._baseisequal":3,"lodash._bindcallback":8,"lodash.isarray":15,"lodash.pairs":9}],3:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function f(a,b,c,e,h,i){return a===b||(null==a||null==b||!k(a)&&!d(b)?a!==a&&b!==b:g(a,b,f,c,e,h,i))}function g(a,b,c,d,e,f,g){var k=l(a),n=l(b),q=p,r=p;k||(q=z.call(a),q==o?q=u:q!=u&&(k=m(a))),n||(r=z.call(b),r==o?r=u:r!=u&&(n=m(b)));var s=q==u,t=r==u,v=q==r;if(v&&!k&&!s)return i(a,b,q);if(!e){var w=s&&y.call(a,"__wrapped__"),x=t&&y.call(b,"__wrapped__");if(w||x)return c(w?a.value():a,x?b.value():b,d,e,f,g)}if(!v)return!1;f||(f=[]),g||(g=[]);for(var A=f.length;A--;)if(f[A]==a)return g[A]==b;f.push(a),g.push(b);var B=(k?h:j)(a,b,c,d,e,f,g);return f.pop(),g.pop(),B}function h(a,b,c,d,f,g,h){var i=-1,j=a.length,k=b.length;if(j!=k&&!(f&&k>j))return!1;for(;++i<j;){var l=a[i],m=b[i],n=d?d(f?m:l,f?l:m,i):void 0;if(void 0!==n){if(n)continue;return!1}if(f){if(!e(b,function(a){return l===a||c(l,a,d,f,g,h)}))return!1}else if(l!==m&&!c(l,m,d,f,g,h))return!1}return!0}function i(a,b,c){switch(c){case q:case r:return+a==+b;case s:return a.name==b.name&&a.message==b.message;case t:return a!=+a?b!=+b:a==+b;case v:case w:return a==b+""}return!1}function j(a,b,c,d,e,f,g){var h=n(a),i=h.length;if(i!=n(b).length&&!e)return!1;for(var j=i;j--;){var k=h[j];if(!(e?k in b:y.call(b,k)))return!1}for(var l=e;++j<i;){k=h[j];var m=a[k],o=b[k],p=d?d(e?o:m,e?m:o,k):void 0;if(!(void 0===p?c(m,o,d,e,f,g):p))return!1;l||(l="constructor"==k)}if(!l){var q=a.constructor,r=b.constructor;if(q!=r&&"constructor"in a&&"constructor"in b&&!("function"==typeof q&&q instanceof q&&"function"==typeof r&&r instanceof r))return!1}return!0}function k(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var l=a("lodash.isarray"),m=a("lodash.istypedarray"),n=a("lodash.keys"),o="[object Arguments]",p="[object Array]",q="[object Boolean]",r="[object Date]",s="[object Error]",t="[object Number]",u="[object Object]",v="[object RegExp]",w="[object String]",x=Object.prototype,y=x.hasOwnProperty,z=x.toString;b.exports=f},{"lodash.isarray":15,"lodash.istypedarray":4,"lodash.keys":5}],4:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=j}function f(a){return d(a)&&e(a.length)&&!!g[i.call(a)]}var g={};g["[object Float32Array]"]=g["[object Float64Array]"]=g["[object Int8Array]"]=g["[object Int16Array]"]=g["[object Int32Array]"]=g["[object Uint8Array]"]=g["[object Uint8ClampedArray]"]=g["[object Uint16Array]"]=g["[object Uint32Array]"]=!0,g["[object Arguments]"]=g["[object Array]"]=g["[object ArrayBuffer]"]=g["[object Boolean]"]=g["[object Date]"]=g["[object Error]"]=g["[object Function]"]=g["[object Map]"]=g["[object Number]"]=g["[object Object]"]=g["[object RegExp]"]=g["[object Set]"]=g["[object String]"]=g["[object WeakMap]"]=!1;var h=Object.prototype,i=h.toString,j=9007199254740991;b.exports=f},{}],5:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){return null!=a&&g(s(a))}function f(a,b){return a="number"==typeof a||n.test(a)?+a:-1,b=null==b?r:b,a>-1&&a%1==0&&a<b}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=r}function h(a){for(var b=j(a),c=b.length,d=c&&a.length,e=!!d&&g(d)&&(m(a)||l(a)),h=-1,i=[];++h<c;){var k=b[h];(e&&f(k,d)||p.call(a,k))&&i.push(k)}return i}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&g(b)&&(m(a)||l(a))&&b||0;for(var c=a.constructor,d=-1,e="function"==typeof c&&c.prototype===a,h=Array(b),j=b>0;++d<b;)h[d]=d+"";for(var k in a)j&&f(k,b)||"constructor"==k&&(e||!p.call(a,k))||h.push(k);return h}var k=a("lodash._getnative"),l=a("lodash.isarguments"),m=a("lodash.isarray"),n=/^\d+$/,o=Object.prototype,p=o.hasOwnProperty,q=k(Object,"keys"),r=9007199254740991,s=d("length"),t=q?function(a){var b=null==a?void 0:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?h(a):i(a)?q(a):[]}:h;b.exports=t},{"lodash._getnative":6,"lodash.isarguments":7,"lodash.isarray":15}],6:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){var c=null==a?void 0:a[b];return h(c)?c:void 0}function f(a){return g(a)&&n.call(a)==i}function g(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function h(a){return null!=a&&(f(a)?o.test(l.call(a)):d(a)&&j.test(a))}var i="[object Function]",j=/^\[object .+?Constructor\]$/,k=Object.prototype,l=Function.prototype.toString,m=k.hasOwnProperty,n=k.toString,o=RegExp("^"+l.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=e},{}],7:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a){return null!=a&&g(m(a))}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=l}function h(a){return d(a)&&f(a)&&j.call(a,"callee")&&!k.call(a,"callee")}var i=Object.prototype,j=i.hasOwnProperty,k=i.propertyIsEnumerable,l=9007199254740991,m=e("length");b.exports=h},{}],8:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function e(a){return a}b.exports=d},{}],9:[function(a,b,c){function d(a){return e(a)?a:Object(a)}function e(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function f(a){a=d(a);for(var b=-1,c=g(a),e=c.length,f=Array(e);++b<e;){var h=c[b];f[b]=[h,a[h]]}return f}var g=a("lodash.keys");b.exports=f},{"lodash.keys":10}],10:[function(a,b,c){arguments[4][5][0].apply(c,arguments)},{dup:5,"lodash._getnative":11,"lodash.isarguments":12,"lodash.isarray":15}],11:[function(a,b,c){arguments[4][6][0].apply(c,arguments)},{dup:6}],12:[function(a,b,c){arguments[4][7][0].apply(c,arguments)},{dup:7}],13:[function(a,b,c){function d(a,b,c){var d=0,g=a?a.length:d;if("number"==typeof b&&b===b&&g<=h){for(;d<g;){var i=d+g>>>1,j=a[i];(c?j<=b:j<b)&&null!==j?d=i+1:g=i}return g}return f(a,b,e,c)}function e(a){return a}var f=a("lodash._binaryindexby"),g=4294967295,h=g>>>1;b.exports=d},{"lodash._binaryindexby":14}],14:[function(a,b,c){function d(a,b,c,d){b=c(b);for(var g=0,i=a?a.length:0,j=b!==b,k=null===b,l=void 0===b;g<i;){var m=e((g+i)/2),n=c(a[m]),o=void 0!==n,p=n===n;if(j)var q=p||d;else q=k?p&&o&&(d||null!=n):l?p&&(d||o):null!=n&&(d?n<=b:n<b);q?g=m+1:i=m}return f(i,h)}var e=Math.floor,f=Math.min,g=4294967295,h=g-1;b.exports=d},{}],15:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){var c=null==a?void 0:a[b];return i(c)?c:void 0}function f(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=s}function g(a){return h(a)&&p.call(a)==k}function h(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function i(a){return null!=a&&(g(a)?q.test(n.call(a)):d(a)&&l.test(a))}var j="[object Array]",k="[object Function]",l=/^\[object .+?Constructor\]$/,m=Object.prototype,n=Function.prototype.toString,o=m.hasOwnProperty,p=m.toString,q=RegExp("^"+n.call(o).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),r=e(Array,"isArray"),s=9007199254740991,t=r||function(a){return d(a)&&f(a.length)&&p.call(a)==j};b.exports=t},{}],16:[function(a,b,c){"use strict";var d=a("lodash.sortedindex"),e={heightFn:function(){return 10},availableNodes:100},f=function(a){if(!a.el)throw new Error("Need to pass `el` into ScrollableTable.");if(!a.data)throw new Error("Need to pass `data` into ScrollableTable.");if(!a.buildRow)throw new Error("Need to pass `buildRow` into ScrollableTable.");if(!a.updateRow)throw new Error("Need to pass `updateRow` into ScrollableTable.");for(var b in e)this[b]=e[b];for(var b in a)this[b]=a[b];this.rowsWithNodes=[],this.tops=[],this.el.className=this.el.className+" sts-container",this.reset()};f.prototype.reset=function(){for(this.yPosition=0,this.setHeights();this.el.firstChild;)this.el.remove(this.el.firstChild);for(var a=0;a<this.data.length;a++)this.data[a].__node=null;this.rowsWithNodes=[]
;var b=Math.min(this.availableNodes,this.data.length);for(a=0;a<b;a++){var c=this.buildRow(this.data[a]);c.style.top=this.data[a].__top+"px",c.className=c.className+" sts-row",this.el.appendChild(c),this.rowsWithNodes.push(a),this.data[a].__node=c}this.bottomEl=document.createElement("div"),this.bottomEl.className="sts-bottom-anchor",this.bottomEl.style.top=this.totalHeight+"px",this.el.appendChild(this.bottomEl),this.el.addEventListener("scroll",this.updateVisibleRows.bind(this))},f.prototype.updateVisibleRows=function(a){if(!this.isUpdating){this.isUpdating=!0;var b=this.el.scrollTop+this.el.clientHeight/2,c=d(this.tops,b),e=0,f=Math.max(0,c-Math.ceil(this.availableNodes/2)),g=Math.min(this.data.length,c+Math.ceil(this.availableNodes/2));if(this.lastMidNdx===c)return void(this.isUpdating=!1);this.lastMidNdx=c;for(var h=f;h<g;h++)if(!this.data[h].__node){for(;this.rowsWithNodes[e]>f&&this.rowsWithNodes[e]<g;)e++;this.data[h].__node=this.data[this.rowsWithNodes[e]].__node,this.updateRow(this.data[h],this.data[h].__node),this.data[h].__node.style.top=this.data[h].__top+"px",this.data[this.rowsWithNodes[e]].__node=null,this.rowsWithNodes[e]=h,e++}this.isUpdating=!1}},f.prototype.setHeights=function(){this.totalHeight=0,this.tops=[];for(var a=0;a<this.data.length;a++)this.data[a].__top=this.totalHeight,this.tops.push(this.totalHeight),this.totalHeight+=this.heightFn(this.data[a]);return this.totalHeight},f.prototype.updateData=function(a){var b,c,d=[];if(!this.isUpdating){if(this.isUpdating=!0,a.length<this.rowsWithNodes.length)for(b=this.rowsWithNodes.length-1;b>=a.length;b--){var e=this.data[this.rowsWithNodes[b]].__node;e.parentNode.removeChild(e),this.data[this.rowsWithNodes[b]].__node=null,this.rowsWithNodes.pop()}for(b=0;b<Math.min(this.rowsWithNodes.length,a.length);b++)d.push(this.data[this.rowsWithNodes[b]].__node),this.data[this.rowsWithNodes[b]].__node=null,this.rowsWithNodes[b]=b;if(d.length<a.length&&d.length<this.availableNodes)for(b=d.length;b<Math.min(this.availableNodes,a.length);b++)c=this.buildRow(a[b]),c.className=c.className+" sts-row",this.el.appendChild(c),d.push(c),this.rowsWithNodes.push(b);for(this.data=a,this.setHeights(),b=0;b<d.length;b++)this.data[b].__node=d[b],this.updateRow(this.data[b],this.data[b].__node),this.data[b].__node.style.top=this.data[b].__top+"px";this.bottomEl.style.top=this.totalHeight+"px",this.isUpdating=!1,this.updateVisibleRows()}},b.exports=f},{"lodash.sortedindex":1}]},{},[16])(16)}),define("global/natsort",[],function(){return function(a){function b(a){return a.toLocaleLowerCase?a.toLocaleLowerCase():a.toLowerCase()}function c(a){return a.replace(l,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function d(a,b){return(!a.match(g)||1===b)&&parseFloat(a)||a.replace(h," ").replace(i,"")||0}a=a||{};var e=a.desc?-1:1,f=-e,g=/^0/,h=/\s+/g,i=/^\s+|\s+$/g,j=/[^\x00-\x80]/,k=/^0x[0-9a-f]+$/i,l=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,m=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,n=a.insensitive?function(a){return b(""+a).replace(i,"")}:function(a){return(""+a).replace(i,"")};return function(a,b){var g=n(a),h=n(b);if(!g&&!h)return 0;if(!g&&h)return f;if(g&&!h)return e;var i=c(g),l=c(h),o=parseInt(g.match(k),16)||1!==i.length&&Date.parse(g),p=parseInt(h.match(k),16)||o&&h.match(m)&&Date.parse(h)||null;if(p){if(o<p)return f;if(o>p)return e}for(var q=i.length,r=l.length,s=0,t=Math.max(q,r);s<t;s++){var u=d(i[s]||"",q),v=d(l[s]||"",r);if(isNaN(u)!==isNaN(v))return isNaN(u)?e:f;if(j.test(u+v)&&u.localeCompare){var w=u.localeCompare(v);if(w>0)return e;if(w<0)return f;if(s===t-1)return 0}else{if(u<v)return f;if(u>v)return e}}return 0}}}),define("midway/dialog/output/dataExplorationRow",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,e,f){var g='<div class="dt-row" style="width: '+d(b)+'px;">';return a.forEach(e,function(a){g+='<div class="dt-col" style="width: '+c(a.width)+'px;"><pre class="data-pre'+c(a.width>=f?" tips":"")+'">'+d(a.content)+"</pre></div>"}),g+="</div>"}(b.width,b.items,b.maxWidth)}}),define("midway/dialog/output/dataExplorationHeader",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,e,f,g){var h='<div class="dt-row" style="width: '+d(b+6)+'px;">';return a.forEach(e,function(a,b){h+='<div class="dt-col" style="width: '+c(a.width)+'px;">'+d(a.content)+'<span class="sorter'+c(f===b?" sorted-"+g:"")+'" data-index="'+c(b)+'"><span class="asc"></span><span class="desc"></span></span></div>'}),h+="</div>"}(b.width,b.items,b.sortIndex,b.sortOrder)}}),define("midway/dialog/output/dataExploration",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){var b="";return a&&(b+='<div class="tooltips warning"><span class="icon icon-warning-o"></span><p class="text">'+d(a)+"</p></div>"),b+='<div class="exploration-table"><div class="header"></div><div class="inner"></div></div>'}(b.warnMessage)}}),define("dialog/output/dataExploration",["zero","zero/zero","zero/json","zero/querystring","zero/ui/DialogEx","zero/ui/Clipboard","zero/ui/Message","../../global/smart-table-scroll.min.js","../../i18n","../../global/utils","../../global/natsort","../../global/environment","../../ajax/analysis","../../midway/dialog/output/dataExplorationRow","../../midway/dialog/output/dataExplorationHeader","../../midway/dialog/output/dataExploration"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(a){var b=[],c=a.tableHeader;a.records;return a.records.forEach(function(a){a.forEach(function(a,c){var d=b[c];(!d||String(d).length<String(a).length)&&(b[c]=a)})}),b.map(function(a,b){var d=c[b];return Math.max(j.getTextWidth(d)+24,j.getTextWidth(a))+20})}function r(a){return a.map(function(a,b){return{content:a,width:L[b]}})}function s(){K=null,I=null,J=null,T=!1}function t(){u(100),m.exploreTableName(F,H||1,G).then(function(a){C(a.tableName)})}function u(a){E.showLoading(),K=null,T=!0,m.explore(F,H||1,a,G).then(v,x)}function v(a){E.hideLoading(),a&&a.tableHeader&&a.tableHeader.length?(I=z(a),L=q(a),M=L.reduce(function(a,b){return a+b},0),E.set("body",p(a)),E.$(P.tableHeader).html(o({width:M,sortIndex:Q,sortOrder:R,items:r(a.tableHeader)})).on("click",".sorter .asc",function(){var a=$(this).parent(".sorter"),b=parseInt(a.attr("data-index"),10);a.hasClass("sorted-asc")?(Q=0,R="asc",E.$(P.tableHeader).find(".dt-col:eq(0) .sorter").addClass("sorted-asc"),a.removeClass("sorted-asc")):(Q=b,R="asc",E.$(P.tableHeader).find(".sorted-asc").removeClass("sorted-asc").end().find(".sorted-desc").removeClass("sorted-desc"),a.addClass("sorted-asc")),w(I)}).on("click",".sorter .desc",function(){var a=$(this).parent(".sorter"),b=parseInt(a.attr("data-index"),10);a.hasClass("sorted-desc")?(Q=0,R="asc",E.$(P.tableHeader).find(".dt-col:eq(0) .sorter").addClass("sorted-asc"),a.removeClass("sorted-desc")):(Q=b,R="desc",E.$(P.tableHeader).find(".sorted-asc").removeClass("sorted-asc").end().find(".sorted-desc").removeClass("sorted-desc"),a.addClass("sorted-desc")),w(I)}),E.$(P.tableBody).off().on("mousewheel scroll",function(){E.$(P.tableHeader).scrollLeft(this.scrollLeft)}).on("mouseenter",".tips",function(){new N(this,{position:"bottom center",fallback:"bottom center",hoverable:!0,content:$(this).html(),classNames:{popup:"ui-popup log-popup"},escape:function(a){return a=_.escape(a),a.length>100?"<pre>"+a+"</pre>":a}}).delayedShow()}),C(a.tableName),w(a),E.hideLoading()):E.showEmpty()}function w(a){var b=E.$(P.tableBody),c=a.records;if(Q>=0&&(0!==Q||"asc"!==R)){var d=k({desc:"desc"===R});c=c.slice(0).sort(function(a,b){return d(a[Q],b[Q])}),J={records:c,tableHeader:a.tableHeader}}else J=I;K?K.updateData(c):K=new h({el:b[0],availableNodes:Math.ceil(2*b.outerHeight()/U),data:c,heightFn:function(){return U},buildRow:function(a){return $(n({width:M,maxWidth:V,items:r(a)}))[0]},updateRow:function(a,b){b.childNodes.forEach(function(b,c){b.textContent=a[c]})}}),E.hideLoading()}function x(){E.hideLoading(),E.showEmpty()}function y(){S=$(P.buttons);const a=S[1],b=S[2];a.addEventListener("copy",function(a){a.preventDefault(),a.clipboardData&&a.clipboardData.setData("text/plain",B(J))}),b.addEventListener("copy",function(a){a.preventDefault(),a.clipboardData&&a.clipboardData.setData("text/plain",A(J))})}function z(a){return a.tableHeader.unshift(O("tableIndex")),a.records.forEach(function(a,b){a.unshift(b+1)}),a}function A(a){var b=a.tableHeader,c=a.records.slice(0,100),d=[];d.push(b);var e=d.concat(c),f="";return f=e.reduce(function(a,b){return a+="<tr><td>"+b.join("<td>")+"</td></tr>"},"<table>"),f+="</table>"}function B(a){return[a.tableHeader].concat(a.records).map(function(a){return a.join(",")}).join("\n ")}function C(a){var b=a?O("dataExploration")+" - "+a+" - ("+O("onlyShowTheFirst1024")+")":O("dataExploration")+" - ("+O("onlyShowTheFirst1024")+")";E.$element.find(P.title).text(b)}function D(a){var b=document.createElement("textarea");b.setAttribute("contenteditable",!0),b.textContent=a,document.body.appendChild(b),setTimeout(function(){b.select();var a=document.execCommand("copy",!1);if(document.body.removeChild(b),a){(new g).show()}else console.log("Error",a);E.hideLoading()},50)}var E,F,G,H,I,J,K,L,M,N=a.Popup,O=i.translate,P={title:".modal-title",tableHeader:".exploration-table .header",tableBody:".exploration-table .inner",buttons:".modal-footer button"},Q=0,R="asc",S=null,T=!1,U=32,V=400;return{showDeprecated:function(a,b,c,f){if(F=a,G=c,H=b,Q=0,R="asc",d.parse(window.location.search).react&&window.actions)window.actions.analysis.dataExplore.get({projectName:f,loopTimestamp:G,nodeInstanceId:F});else{var g=[],h=l.isAntLab||l.isAntCloud;h||g.push({text:O("display1w"),type:"primary",click:function(){u(1e4)}}),g.push({text:O("display1k"),type:"primary",click:function(){u(1024)}}),h||g.push({text:O("copyas")+"csv",click:function(){D(B(J))}},{text:O("copyas")+"excel",click:function(){D(A(J))}}),g.push({text:O("close"),click:function(){this.hide()}}),E=new e({destroyOnHide:!0,canFullscreen:!0,className:"dialog-data-exploration",title:O("dataExploration"),afterShow:t,beforeHide:s,buttons:g}),h?j.disableCopy(E.$element):y()}},show:function(a,b,c,d){window.react_bridge.actions.modals.showDataProfiler({projectName:d||window.currentProject||window.GLOBALS.projectName,nodeInstanceId:a,sequence:b,loopTimestamp:c})}}}),define("midway/components/binning/detail",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="binning-detail" data-feature="'+e(a)+'"><a href="javascript:void(0);" class="back">&lsaquo; '+e(d("backToList"))+'</a><ul class="nav nav-tabs pai-tab"><li class="active" data-target=".bins-list"><a href="javascript:void(0);">'+e(d("list"))+'</a></li><li data-target=".bins-chart"><a href="javascript:void(0);">'+e(d("charts"))+'</a></li></ul><ul class="sibling-nav"><li><a href="javascript:void(0);" data-role="prev-detail">&lsaquo; '+e(d("prev"))+'</a></li><li><a href="javascript:void(0);"  data-role="next-detail">'+e(d("next"))+' &rsaquo; </a></li></ul><div class="bins-list"><ul class="binning-actions"><li data-role="binning" data-binning="merge" class="disabled"><i class="icon icon-merge-cell"></i><span>'+e(d("merge"))+'</span></li><li data-role="binning" data-binning="split" class="disabled"><i class="icon icon-separate-cell"></i><span>'+e(d("split"))+'</span></li><li data-role="binning" data-binning="down"><i class="icon icon-arrow-reduce"></i><span>'+e(d("down"))+'</span></li><li data-role="binning" data-binning="up"><i class="icon icon-arrow-rise"></i><span>'+e(d("up"))+'</span></li><li data-role="binning" data-binning="selectAll"><i class="icon icon-ok-s"></i><span>'+e(d("selectAll"))+'</span></li><li data-role="binning" data-binning="unselectAll" style="display:none;"><i class="icon icon-s"></i><span>'+e(d("unselectAll"))+'</span></li><li data-role="binning" data-binning="collapse"  style="display:none;"><i class="icon icon-node-expand"></i><span>'+e(d("collapse"))+'</span></li><li data-role="binning" data-binning="expand"><i class="icon icon-node-collapse"></i><span>'+e(d("expand"))+'</span></li><li data-role="binning" data-binning="undo" class="disabled"><i class="icon icon-undo"></i><span>'+e(d("undo"))+'</span></li><li data-role="binning" data-binning="redo" class="disabled"><i class="icon icon-redo"></i><span>'+e(d("redo"))+'</span></li><li data-role="binning" data-binning="edit"><i class="icon icon-edit"></i><span>'+e(d("editConstraint"))+'</span></li>\x3c!-- 全选复制  --\x3e<li class="copy" data-role="binning" data-binning="copy" ><i class="icon icon-copy-l"></i><span>'+e(d("selectAndCopy"))+'</span></li><li data-role="binning" data-binning="save" class="disabled"><i class="icon icon-save"></i><span>'+e(d("save"))+'</span></li><li data-role="binning" data-binning="rerun" class="disabled"><i class="icon icon-run-o-24"></i><span>'+e(d("reExecute"))+'</span></li><li data-role="binning" data-binning="exportBinning"><i class="icon icon-download"></i><span>'+e(d("exportBinningAndConstraint"))+'</span></li>\x3c!--<li data-role="binning" data-binning="exportBinning">--\x3e\x3c!--<i class="icon icon-download"></i>--\x3e\x3c!--<span>'+e(d("exportBinning"))+'</span>--\x3e\x3c!--</li>--\x3e\x3c!--<li data-role="binning" data-binning="exportConstraint">--\x3e\x3c!--<i class="icon icon-download"></i>--\x3e\x3c!--<span>'+e(d("exportConstraint"))+'</span>--\x3e\x3c!--</li>--\x3e</ul><div class="binning-body"><div class="bins-table-container"><div class="bins-table-container-scroll"><div class="bins-table-container-inner"><div class="bins-table"></div><div class="total-table"></div></div></div></div><div class="actions"><div class="custom-binning-actions action-box"><h5 class="action-title">'+e(d("customBinning"))+'</h5><div class="action-body"><div class="custom-binning-block" data-custom-type="number"><div class="custom-binning-group"><div class=""><label title="'+e(d("binBoundariesPlaceholder"))+'" for="custom-binning-boundaries">'+e(d("binBoundaries"))+'</label></div><div class="input-group"><input type="text" class="form-control" id="custom-binning-boundaries" placeholder="'+e(d("binBoundariesPlaceholder"))+'"><span class="input-group-btn"><button data-role="boundaries-button" class="btn btn-default" type="button">'+e(d("add"))+'</button></span></div>\x3c!-- /input-group --\x3e</div><div class="custom-binning-group"><div class=""><label for="custom-binning-start">'+e(d("binStart"))+'</label><label for="custom-binning-stop">'+e(d("binStop"))+'</label><label for="custom-binning-step">'+e(d("step"))+'</label></div><div class="input-group custom-binning-steps"><input type="text" class="form-control" id="custom-binning-start" placeholder=""><input type="text" class="form-control" id="custom-binning-stop" placeholder=""><input type="text" class="form-control" id="custom-binning-step" placeholder=""><span class="input-group-btn"><button data-role="steps-button" class="btn btn-default" type="button">'+e(d("add"))+'</button></span></div>\x3c!-- /input-group --\x3e</div></div><div class="custom-binning-block" data-custom-type="string"><div class="custom-binning-group"><div class=""><label title="'+e(d("newStringBin"))+'" for="custom-binning-boundaries">'+e(d("newBin"))+'</label></div><div class="input-group"><input type="text" class="form-control" id="custom-binning-strings" placeholder="'+e(d("newStringBin"))+'"><span class="input-group-btn"><button data-role="string-bin-button" class="btn btn-default" type="button">'+e(d("add"))+'</button></span></div>\x3c!-- /input-group --\x3e</div></div></div></div><div class="constraint-actions action-box"><h5 class="action-title">'+e(d("constraintActions"))+'</h5><div class="action-body"><div class="sub">'+e(d("ConstrainTheSelectedBinsTo"))+'</div><ul><li data-role="constraint" data-type="ascending"><a href="javascript:void(0);"><i>&lt; bin</i><span>'+e(d("EnforceAscendingPattern"))+'</span></a></li><li data-role="constraint" data-type="descending"><a href="javascript:void(0);"><i>&gt; bin</i><span>'+e(d("EnforceDescendingPattern"))+'</span></a></li><li data-role="constraint" data-type="equal"><a href="javascript:void(0);"><i>= bin</i><span>'+e(d("AssignCommonWeight"))+'</span></a></li><li data-role="constraint" data-type="zero"><a href="javascript:void(0);"><i>0</i><span>'+e(d("AssignWeightOfZero"))+'</span></a></li><li data-role="constraint" data-type="ws"><a href="javascript:void(0);"><i>= weight</i><span>'+e(d("AssignSlapOnWeight"))+'</span></a></li><li data-role="constraint" data-type="woe"><a href="javascript:void(0);"><i>WoE</i><span>'+e(d("PreserveOrderingByWoE"))+'</span></a></li><li data-role="constraint" data-type="remove"><a href="javascript:void(0);"><i class="icon icon-delete"></i><span>'+e(d("RemoveConstraints"))+'</span></a></li></ul></div></div></div></div></div><div class="bins-chart"></div><div class="json-editor"><div class="editor-header"><h5>'+e(d("editJSON"))+'</h5><i data-role="editor-close" class="icon icon-close-o"></i></div><div class="editor-body"><textarea></textarea></div><div class="editor-footer"><div class="editor-alert" data-role="editor-alert">'+e(d("jsonEditAlert"))+'</div><button data-role="editor-save" type="button" class="btn-primary btn btn-sm ">'+e(d("save"))+'</button><button data-role="editor-close" type="button" class="btn btn-sm">'+e(d("close"))+"</button></div></div></div>"}(b.featureName)}}),define("components/binning/common",[],function(){"use strict";return{statusFields:{operator:"const_operator",value:"const_value",isCustomBinning:"isCustomBinning",isModified:"isModified",lastModified:"lastModified",hasConstraint:"hasConstraint"},operatorMap:{ascending:"< bin",descending:"> bin",zero:"= 0",equal:"= bin",ws:"= weight",woe:"woe"}}}),define("components/common/binningUtil",[],function(){function a(a,b){var d,e=c(a);return a.bin.else||(a.bin.else={_placeholder:!0,value:[]}),a.bin.else.index=-2,a.bin.else._value="ELSE",a.bin.null||(a.bin.null={_placeholder:!0}),a.bin.null.index=-1,a.bin.null._value="NULL",a.bin.norm||(a.bin.norm=[]),d=a.bin.norm.map(function(a,b){if(a.index=void 0!==a.index?a.index:b,a.id=void 0!==a.id||a.children?a.id:b,a._value=a.value.toString(),!e){var c=a.value.split(",");a.left=c[0].charAt(0),a.lowValue=c[0].slice(1),a.lessThan=c[1].slice(0,-1),a.right=c[1].slice(-1),"-inf"!==a.lowValue&&(a.lowValue=parseFloat(a.lowValue)),"+inf"!==a.lessThan&&(a.lessThan=parseFloat(a.lessThan))}return a}),b?[a.bin.null].concat(d,a.bin.else):d.concat(a.bin.else,a.bin.null)}function b(a,b){b.bin&&(b.bin.norm=a.filter(function(a){return!e(a)}),b.bin.else=a.filter(function(a){return f(a)})[0],b.bin.null=a.filter(function(a){return g(a)})[0],b.binCount=b.bin.norm.length+(b.bin.null&&!b.bin.null._placeholder?1:0)+(b.bin.else&&!b.bin.null._placeholder?1:0))}function c(a){if(a.bin&&a.bin.norm&&a.bin.norm[0]){var b=a.bin.norm[0];if(l(b.value))return!0;if(m(b.value)&&("("===b.value.charAt(0)||"["===b.value.charAt(0)))return!1;new Error("分箱格式不正确...")}else new Error("特征",a.name,"没有分箱信息...")}function d(a){return a.find(function(a){return 0===a.id})}function e(a){return-1===a.index||-2===a.index}function f(a){return-2===a.index}function g(a){return-1===a.index}function h(b){var c=a(b,!0),e=d(c),f={toolbox:{feature:{restore:{show:!0}}},title:{text:b.name},name:b.name,imageName:b.name,legend:{data:[],selected:{}},xAxis:[{data:_.pluck(c,"_value")}],yAxis:[{},{type:"value",scale:!0}]},g=[{name:"Positive",data:_.pluck(c,"p"),type:"bar",stack:b.name,yAxisIndex:1},{name:"Negative",data:_.pluck(c,"n"),type:"bar",stack:b.name,yAxisIndex:1},{name:"IV",data:_.pluck(c,"iv"),type:"line",yAxisIndex:0},{name:"WOE",data:_.pluck(c,"woe"),type:"line",yAxisIndex:0}],h=[{name:"Total",data:_.pluck(c,"total"),type:"bar",stack:b.name}];return e&&void 0===e.p?f.series=h:f.series=g,f.legend.data=["WOE","Positive","Negative","IV"],f.legend.selected={IV:!1},f}function i(b,c){var d=a(b,!0),e=[],f={toolbox:{feature:{restore:{show:!0}}},title:{text:b.name},name:b.name,imageName:b.name,legend:{data:[],selected:{}},xAxis:[{data:_.pluck(d,"_value")}],yAxis:[{},{type:"value",scale:!0}]};return c.forEach(function(a){e.push({name:a,data:_.pluck(d,a),type:"line",yAxisIndex:0})}),f.series=e,f.legend.data=c,f}function j(b,c){var e,f,g=[],h=[],i=[],j=b[0];b.forEach(function(b){var c=a(b,!0);g.push(c)});var l={toolbox:{feature:{restore:{show:!0}}},name:j.name,imageName:j.name,legend:{data:[],selected:{}},xAxis:[{data:_.pluck(k(g),"_value")}],yAxis:[{},{type:"value",scale:!0}]};return g.forEach(function(a,b){var d=c[b],e=[{name:"Positive ("+d+")",data:_.pluck(a,"p"),type:"bar",stack:d,yAxisIndex:1},{name:"Negative ("+d+")",data:_.pluck(a,"n"),type:"bar",stack:d,yAxisIndex:1},{name:"IV ("+d+")",data:_.pluck(a,"iv"),type:"line",yAxisIndex:0},{name:"WOE ("+d+")",data:_.pluck(a,"woe"),type:"line",yAxisIndex:0}],f=[{name:"Total ("+d+")",data:_.pluck(a,"total"),type:"bar"}];h=h.concat(e),i=i.concat(f)}),e=d(g[0]),f=e&&void 0===e.p,l.series=f?i:h,l.legend.data=_.pluck(l.series,"name"),f?l.legend.data.forEach(function(a){l.legend.selected[a]=!0}):l.legend.data.reverse().forEach(function(a){var b=!1;0===a.indexOf("WOE")&&(b=!0),l.legend.selected[a]=b}),l}function k(a){for(var b=a[0],c=1,d=a.length;c<d;c++)b.length<a[c].length&&(b=a[c]);return b}var l=_.isArray,m=_.isString;return{parseFeatureForChart:h,parseFeatureForCumulateGroupChart:i,parsefeatureListForChart:j,isEnumerable:c,featureToBins:a,binsToFeature:b,isElseOrNullBin:e,isElse:f,isNull:g}}),define("components/binning/utils",["./common","../common/binningUtil"],function(a,b){"use strict";function c(a){return["iv","n","nrateOfTotal","p","prate","prateOfTotal","total","totalRate","totalRate","woe"].forEach(function(b){a[b]&&(a[b]=void 0)}),a}function d(a,b){var c,d,e={name:a.name},f=[],g=[],h=[],i=[];return b.forEach(function(a){switch(c=parseFloat(a[q.value]),d=a.index,a[q.operator]){case r.ascending:o(d,c,f);break;case r.descending:o(d,c,g);break;case r.zero:i.push(d+":0");break;case r.equal:p(d,c,h);break;case r.ws:i.push(d+":"+c)}}),f.length&&(e["<"]=f),g.length&&(e[">"]=g),i.length&&(e["="]=i),h.length&&(e["%"]=m(h)),e}function e(a,b){var c,d,e,f,g,h,i;for(Array.isArray(a)||(a=[a]),a=j(a),c=0,e=b.length;c<e;c++){for(g=b[c],i=!1,d=0,f=a.length;d<f;d++)if(h=a[d],g.index===h.index){g[q.operator]=h[q.operator],g[q.value]=h[q.value],i=!0;break}i||(g[q.operator]="",g[q.value]="")}}function f(a,c){c.forEach(function(c){var d=a.filter(function(a){return a.name===c.name}),f=b.featureToBins(c);e(d,f),c[q.hasConstraint]=n(d),b.binsToFeature(f,c)})}function g(a){return 0==a.split(":")[1]}function h(a){return 0!=a.split(":")[1]}function i(a){return parseInt(a.split(":")[0])}function j(a){var b,c,d,e,f,j,m=[];return a.forEach(function(a){a.type?"pattern"===a.type?(b=a["<"],c=a[">"],d=a[0]):"inweights"===a.type?e=a.weights:"ratio"===a.type&&(f=a.weights):(b=a["<"],c=a[">"],d=a["="]?a["="].filter(g).map(i):void 0,e=a["="]?a["="].filter(h):void 0,f=a["%"])}),b&&b.forEach(function(a){k(a,"ascending",m)}),c&&c.forEach(function(a){k(a,"descending",m)}),d&&d.forEach(function(a){j={},j.index=a,j[q.operator]=r.zero,j[q.value]="",m.push(j)}),e&&e.forEach(function(a){var b=a.split(":"),c=b[0],d=b[1];j={},j.index=parseInt(c),j[q.operator]=r.ws,j[q.value]=d,m.push(j)}),f&&(f=l(f),_.isArray(f)&&f.forEach(function(a){k(a,"equal",m)})),m}function k(a,b,c){var d,e,f;for(d=0,e=a.length;d<e-1;d++)f={},f.index=a[d],f[q.operator]=r[b],f[q.value]=a[d+1],c.push(f)}function l(a){var b=[];return a.forEach(function(a,c){b[c]=a.map(function(a){return parseInt(a.split(":")[0])})}),b}function m(a){return a.forEach(function(b,c){a[c]=b.map(function(a){return a+":1.0"})}),a}function n(a){return a=j(a),a.length>0}function o(a,b,c){var d,e,f,g=!1;for(d=0,e=c.length;d<e;d++)if(f=c[d],f[f.length-1]===a){f.push(b),g=!0;break}g||c.push([a,b])}function p(a,b,c){var d=!1;c.forEach(function(c){-1!==c.indexOf(a)&&-1===c.indexOf(b)?(c.push(b),d=!0):-1===c.indexOf(a)&&-1!==c.indexOf(b)&&(c.push(a),d=!0)}),d||c.push([a,b])}var q=a.statusFields,r=a.operatorMap,s={clearBin:c,getConstraintFromFeature:d,setConstraintToFeature:e,setConstraintsToFeatures:f};return $.extend(s,b)}),define("components/binning/ConstraintActions",["zero/declare","zero/ui/DialogSingleInput","../../i18n","../../global/utils","./common","./utils"],function(a,b,c,d,e,f){"use strict";var g={constantButton:'[data-role="constraint"]',jsonEditor:".json-editor",close:'[data-role="editor-close"]',save:'[data-role="editor-save"]',alert:'[data-role="editor-alert"]',textarea:"textarea"},h=e.statusFields,i=e.operatorMap,j=c.translate,k=_.isNumber,l=_.isString;return a("binning/ConstraintActions",[],{constructor:function(a){this.parent=a.parent,this.binsTable=a.binsTable,this.stack=a.stack,this.$container=a.$container,this.$editor=this.$container.find(g.jsonEditor),this.$textarea=this.$editor.find(g.textarea),this.$alert=this.$editor.find(g.alert),this.bindEvents()},remove:function(a){var b,c;for(b=a.length-1;b>=0;b--)c=a[b],c[h.operator]="",c[h.value]=""},refresh:function(a,b){var c;return a.forEach(function(a){void 0!==a[h.value]&&"ws"!==a[h.operator]&&(c=b[a[h.value]],void 0!==c?k(c)?a[h.value]=c:a[h.value]=void 0:(c=b[a[h.value]+".0"],l(c)?a[h.value]=parseInt(c.charAt(0)):a[h.value]=void 0))}),a},bindEvents:function(){var a=this,b=a.$container,c=a.binsTable;c.on("change",a.onCellChange.bind(a)),c.on("updated",a.onTableUpdated.bind(a)),b.on("click.constraint",g.constantButton,a.onConstraint.bind(a)),b.on("click.constraint",g.close,a.hideEditor.bind(a)),b.on("click.constraint",g.save,a.onSave.bind(a))},onCellChange:function(a,b){var c,d=this;c=d.binsTable.getTableData(),d.updateFeatureConstraintStatus(),d.parent.saveStack(c),d.updateTextarea(),d.emptyCheck(a,b)},emptyCheck:function(a,b){a.data("field")!==h.operator||""!==b&&0!==b||a.next().find(".text").html("")},updateFeatureConstraintStatus:function(){var a,b,c,d,e=this;for(a=e.binsTable.getTableData(),b=0,c=a.length;b<c;b++)if(d=a[b],""===d[h.operator]&&(d[h.operator]=void 0),void 0!==d[h.operator])return void(e.parent.currentFeature[h.hasConstraint]=!0);e.parent.currentFeature[h.hasConstraint]=!1},onTableUpdated:function(){this.updateTextarea()},onConstraint:function(a){var b=this,c=$(a.currentTarget),e=c.data("type"),f="do"+d.ucFirst(e),g=b.binsTable.getSelectedRows();b[f](g,e)},doAscending:function(a,b){this.nextIndex(a,b),this.updateTable()},doDescending:function(a,b){this.nextIndex(a,b),this.updateTable()},doEqual:function(a,b){this.nextIndex(a,b),this.updateTable()},doZero:function(a,b){var c,d;for(c=a.length-1;c>=0;c--)d=a[c],d[h.operator]=i[b],d[h.value]="";this.updateTable()},doRemove:function(a){this.remove(a),this.updateTable()},doWoe:function(a,b){var c=this;a=a.filter(function(a){return k(a.woe)}),a=_.sortBy(a,"woe"),c.nextIndex(a,"ascending"),a=_.sortBy(a,"index"),this.updateTable()},doWs:function(a,c){var d=this;new b({backdrop:!1,title:j("SlapOnWeight"),placeholder:j("PleaseEnterAWeight"),callback:d._doWs.bind(d,a,c)})},_doWs:function(a,b,c){var d,e;for(d=a.length-1;d>=0;d--)e=a[d],e[h.operator]=i[b],e[h.value]=c;this.updateTable()},nextIndex:function(a,b){var c,d;for(c=a.length-2;c>=0;c--)d=a[c],d[h.operator]=i[b],d[h.value]=a[c+1].index},updateTable:function(a){var b=this;a||(a=b.binsTable.getTableData()),b.binsTable.update(a,!0),b.updateFeatureConstraintStatus(),b.parent.saveStack(a)},edit:function(){this.updateTextarea(),this.showEditor()},updateTextarea:function(){var a,b=this,c=b.parent.currentFeature,e=b.binsTable.getTableData();a=f.getConstraintFromFeature(c,e),a=JSON.stringify(a),b.$textarea.val(d.JSONFormat(a))},onSave:function(){var a=this,b=a.$textarea.val();try{b=JSON.parse(b),a.$alert.hide()}catch(b){return console.warn(b),void a.$alert.show()}var c=a.binsTable.getTableData();f.setConstraintToFeature(b,c),a.updateTable(c)},showEditor:function(){this.$editor.animate({right:0},300)},hideEditor:function(){var a=this.$editor.outerWidth()+10;this.$editor.animate({right:-a},300)},destroy:function(){this.$container.off(".constraint")}})}),define("components/binning/CustomBinning",["zero/declare","zero/ui/DialogSingleInput","../../i18n","../../global/utils","./utils","./common"],function(a,b,c,d,e,f){"use strict";var g={actionsBox:".custom-binning-actions",numberType:'[data-custom-type="number"]',stringType:'[data-custom-type="string"]',stringBinButton:'[data-role="string-bin-button"]',boundariesButton:'[data-role="boundaries-button"]',stepsButton:'[data-role="steps-button"]',stringsInput:"#custom-binning-strings",boundariesInput:"#custom-binning-boundaries",startInput:"#custom-binning-start",stopInput:"#custom-binning-stop",stepInput:"#custom-binning-step"},h=f.statusFields,i=c.translate;return a("binning/CustomBinning",[],{constructor:function(a){var b=this.$container=a.$container;this.parent=a.parent,this.binsTable=a.binsTable,this.stack=a.stack,this.$actionsBox=b.find(g.actionsBox),this.$numberType=b.find(g.numberType),this.$stringType=b.find(g.stringType),this.$stringsInput=b.find(g.stringsInput),this.$boundariesInput=b.find(g.boundariesInput),this.$startInput=b.find(g.startInput),this.$stopInput=b.find(g.stopInput),this.$stepInput=b.find(g.stepInput),this.dispatchCustomBinning(),this.bindEvents()},dispatchCustomBinning:function(){var a=this;"string"===a.parent.currentFeature.type?a.switchToString():a.switchToNumber()},switchToString:function(){this.$numberType.hide(),this.$stringType.show()},switchToNumber:function(){this.$numberType.show(),this.$stringType.hide()},bindEvents:function(){var a=this,b=a.$container;b.on("click.customBinning",g.boundariesButton,a.onBoundaries.bind(a)),b.on("click.customBinning",g.stepsButton,a.onSteps.bind(a)),b.on("click.customBinning",g.stringBinButton,a.onStringBins.bind(a))},onBoundaries:function(){var a,b,c=this,d=c.$boundariesInput.val();if(a=c.string2Array(d),void 0===(a=c.getValidBoundaries(a)))return void alert(i("customBinningAlert",i("binBoundaries")));b=c.getNewNumberBins(a),c.update(b)},onSteps:function(){var a,b,c=this,e=[],f=parseFloat(c.$startInput.val()),g=parseFloat(c.$stopInput.val()),h=parseFloat(c.$stepInput.val());if(!c.isNumber(f))return void alert(i("customBinningAlert",i("binStart")));if(!c.isNumber(g))return void alert(i("customBinningAlert",i("stopStart")));if(!c.isNumber(h))return void alert(i("customBinningAlert",i("step")));for(e=e.concat(f),a=f;a<g;)a=d.accAdd(a,h),e.push(a);e.pop(),e=e.concat(g),b=c.getNewNumberBins(e),c.update(b)},onStringBins:function(){var a,b,c=this;a=[c.$stringsInput.val()],b=c.getNewStringBins(a),c.update(b)},getNewStringBins:function(a){var b=this,c=b.parent.currentFeature.bin.norm||[],d=c.slice(0);return a.forEach(function(a){if(""!==a){var b=!1;c.forEach(function(c){c.value&&-1!==c.value.indexOf(a)&&(b=!0)}),b||d.push(a)}}),d.map(function(a,b){return{id:b,index:b,value:a.value||[a]}})},getNewNumberBins:function(a){var b,c,d,e,f,g=this,h=[],i=g.parent.currentFeature.bin.norm||[];for(c=0,d=i.length;c<d;c++)e=i[c],b="-inf"===e.lowValue?-1/0:parseFloat(e.lowValue),h.push(b),"+inf"===e.lessThan&&h.push(1/0);return h=h.concat(a),h=_.sortBy(h),h=_.uniq(h),f=g.generateNewNumberBins(h),g.mergeConstraintInfo(f,i),f},generateNewNumberBins:function(a){var b,c,d,e=this,f=e.parent,g=[],h=a.length;for(a[0]===-1/0&&(a[0]="-inf"),a[h-1]===1/0&&(a[h-1]="+inf"),b=0;b<h-1;b++)c=a[b],d=a[b+1],g.push({id:b,index:b,value:f.getLeftOperator(c)+c+","+d+f.getRightOperator(d),lowValue:c,lessThan:d});return g},mergeConstraintInfo:function(a,b){var c,d,e,f,g,i;for(c=0,d=b.length;c<d;c++)for(g=b[c],e=c,
f=a.length;e<f;e++)i=a[e],i.lowValue===g.lowValue&&i.lessThan===g.lessThan&&(i[h.operator]=g[h.operator],i[h.value]=g[h.value])},string2Array:function(a){return a=a.replace(/[,，、]\s*/g," "),a.split(" ")},getValidBoundaries:function(a){var b,c,d,e=this,f=[];for(b=0,c=a.length;b<c&&""!==(d=a[b]);b++){if(d=parseFloat(d),!e.isNumber(d))return;f.push(d)}return f},isNumber:function(a){return!isNaN(a)&&isFinite(a)},update:function(a){var b=this,c=b.parent,d=[].concat(a,e.clearBin(c.currentFeature.bin.else),e.clearBin(c.currentFeature.bin.null));b.binsTable.update(d,!0),c.currentBins=d,c.currentFeature[h.isCustomBinning]=!0,c.saveStack()},destroy:function(){this.$container.off(".customBinning")}})}),define("components/binning/Detail",["zero/declare","zero/ui/datatable/plugins/Resizer","zero/ui/datatable/editors/Text","zero/ui/datatable/editors/Dropdown","zero/ui/DataTable","zero/ui/Undo","zero/ui/Tab","../../global/utils","../../i18n","../../charts/bar","../../midway/components/binning/detail","./ConstraintActions","./CustomBinning","./common","./utils"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";var p={ATTR_COPY:"data-clipboard-text"},q={binsTable:".bins-table",totalTable:".total-table",binning:'[data-role="binning"]',selectAll:'[data-binning="selectAll"]',unselectAll:'[data-binning="unselectAll"]',collapse:'[data-binning="collapse"]',expand:'[data-binning="expand"]',merge:'[data-binning="merge"]',split:'[data-binning="split"]',down:'[data-binning="down"]',up:'[data-binning="up"]',undo:'[data-binning="undo"]',redo:'[data-binning="redo"]',edit:'[data-binning="edit"]',save:'[data-binning="save"]',rerun:'[data-binning="rerun"]',export:'[data-binning="export"]',tabSelector:".nav-tabs li",container:".bins-chart",selectAndCopy:".copy"},r={active:"active",disabled:"disabled",animated:"animated",flash:"flash"},s=_.cloneDeep,t=i.translate,u=n.statusFields,v={theme:"small",tree:!0,line:!0,grid:!0,resizable:!0,crossHover:!1,multiSelect:!0,defaultsort:!0,cols:[{title:"Index",field:"index",sort:!0,width:65},{title:"Label",field:"value",sort:!0,width:90,parse:function(a,b){var c=a;return-2===b.index?c="ELSE":-1===b.index&&(c="NULL"),c}},{title:"Operator",field:u.operator,group:"Constraint",type:"dropdown",source:["< bin","> bin","= 0","= bin","= weight",""],width:100},{title:"Value",field:u.value,group:"Constraint",type:"text",validate:function(a,b){var c=/^-?\d+\.?\d*$/;return-1===["< bin","> bin","= bin","= weight"].indexOf(b[u.operator])||c.test(a)},width:80},{title:"WoE",field:"woe",group:"WoE",sort:!0,width:70,type:"text",editable:function(a,b){return-1===b.index||-2===b.index},beforeSave:function(a,b){return""!==a&&void 0!==a?parseInt(a):void 0},parse:function(a){return a?h.toFixedNumber(a,3):a}},{title:"Chart",field:"woe",group:"WoE",parse:function(a){var b=30,c=a>=0?b*a:0,d=a<=0?Math.abs(b*a):0;return'<div class="woe-bar negative"><span class="bar" style="width: '+Math.min(b,d)+'px"></span></div><div class="woe-bar positive"><span class="bar" style="width: '+Math.min(b,c)+'px"></span></div>'},width:90},{title:"Total",field:"total",group:"Number",sort:!0,width:60},{title:"Positive",field:"p",group:"Number",sort:!0,width:75},{title:"Negative",field:"n",group:"Number",sort:!0,width:75},{title:"Total",field:"totalRate",group:"Rate",sort:!0,width:60,parse:function(a){return a?h.toFixedNumber(a,2)+"%":a}},{title:"Positive",field:"prateOfTotal",group:"Rate",sort:!0,width:80,parse:function(a){return a?h.toFixedNumber(a,2)+"%":a}},{title:"Negative",field:"nrateOfTotal",group:"Rate",sort:!0,width:80,parse:function(a){return a?h.toFixedNumber(a,2)+"%":a}},{title:"Positive",field:"prate",group:"Percentage",sort:!0,width:70,parse:function(a){return""!==a?h.toFixedNumber(100*a,2)+"%":void 0}},{title:"Chart",field:"prate",group:"Percentage",sort:!0,width:80,parse:function(a){var b=30,c=a?b*a:0,d=a?b*(1-a):0;return'<div class="percentage-bar positive"><span class="bar" style="width: '+Math.min(b,c)+'px"></span></div><div class="percentage-bar negative"><span class="bar" style="width: '+Math.min(b,d)+'px"></span></div>'}},{title:"I.V.",field:"iv",sort:!0,parse:function(a){return a?h.toFixedNumber(a,3):a}}]},w=a("binning/Detail",[],{constructor:function(a){var b,c,d=this,e=a.feature,h=a.$wrapper;b=k({featureName:e.name}),c=d.$container=$(b).appendTo(h),d.isLeftOpen=e.isLeftOpen,void 0===d.isLeftOpen&&(d.isLeftOpen=!0),d.tab=new g({selector:c.find(q.tabSelector),activeClassName:r.active,activeIndex:a.activeIndex}),d.$binsTable=c.find(q.binsTable),d.$totalTable=c.find(q.totalTable),d.$binning=c.find(q.binning),d.$selectAll=c.find(q.selectAll),d.$unselectAll=c.find(q.unselectAll),d.$collapse=c.find(q.collapse),d.$expand=c.find(q.expand),d.$merge=c.find(q.merge),d.$split=c.find(q.split),d.$down=c.find(q.down),d.$up=c.find(q.up),d.$undo=c.find(q.undo),d.$redo=c.find(q.redo),d.$save=c.find(q.save),d.$rerun=c.find(q.rerun),d.$export=c.find(q.export),d.$chart=c.find(q.container),d.parent=a.parent,d.nodeData=a.nodeData,d.currentFeature=e,d.isEnum=o.isEnumerable(e),d.currentBins=o.featureToBins(e),d.clearSelect(d.currentBins),d.currentSummary=d.getTotal(d.currentBins),d.stack=new f,d.initActions(),d.renderBinsTable(),d.renderTotalTable(),d.renderChart(),d.saveTrack(),d.bindEvents(),d.constraint=new l({$container:c,binsTable:d.binsTable,stack:d.stack,currentFeature:d.currentFeature,parent:d}),d.customBinning=new m({$container:c,binsTable:d.binsTable,stack:d.stack,currentFeature:d.currentFeature,parent:d})},show:function(){this.$container.show()},hide:function(){this.$container.hide()},initActions:function(){var a=this;a.$selectAll.show(),a.$unselectAll.hide(),a.$expand.show(),a.$collapse.hide()},clearSelect:function(a){a.forEach(function(a){a[e.status_props.isSelected]=!1})},renderBinsTable:function(){var a=this,b=a.preParseData(a.currentBins),c={container:a.$binsTable,data:b,height:"calc(100% - 60px)",selectable:function(a){return!a.level}};c=$.extend({},v,c),a.binsTable=new e(c)},preParseData:function(a){var b=this,c=b.currentSummary.total,d=b.currentSummary.p,e=b.currentSummary.n;return a.map(function(a){return a.totalRate=void 0===a.total?void 0:h.toFixedNumber(a.total/c*100,2),a.prateOfTotal=void 0===a.p?void 0:h.toFixedNumber(a.p/d*100,2),a.nrateOfTotal=void 0===a.n?void 0:h.toFixedNumber(a.n/e*100,2),a})},renderTotalTable:function(){var a=this,b={container:a.$totalTable,data:[a.currentSummary],headless:!0,selectable:function(){return!1},cols:[{},{},{title:"Operator",type:""},{title:"Value",type:""}]};b=$.extend(!0,{},v,b),a.totalTable=new e(b)},renderChart:function(){var a=this,b=o.parseFeatureForChart(a.currentFeature),c={element:a.$chart};$.extend(b,c);try{a.chart=new j(b)}catch(a){console.error&&console.error(a)}},bindEvents:function(){var a=this,b=a.$container;a.stack.on("execute",a.onFeatureChange.bind(a)).on("undo",a.onFeatureChange.bind(a)).on("redo",a.onFeatureChange.bind(a)),a.binsTable.on("rowSelect",a.onRowSelect.bind(a)).on("updated",a.onBinsTableUpdate.bind(a)).on("collapse",a.onBinsTableCollapse.bind(a)),b.on("click.detail",q.binning,a.onBinning.bind(a)).on("click",q.selectAndCopy,a.onCopy.bind(a))},onCopy:function(a){var b=this,c=b.binsTable,d=$(a.currentTarget);c.selectAll();var e=c.getSelectedTsvRows();d.attr(p.ATTR_COPY,e),c.selectCopy(q.selectAndCopy,p.ATTR_COPY)},onRowSelect:function(a){var b,c,d,e=this,f=a.selectedData,g=f.length;e.mergeButtonDisabledCheck(),g>0&&(b=f[0]&&f[0].index,c=f[g-1]&&f[g-1].index,d=e.binsTable.getTableData(),e.moveButtonDisableCheck(b,c,d))},onBinsTableUpdate:function(){var a=this,b=a.binsTable;a.currentBins=b.getTableData(),a.currentSummary=a.getTotal(a.currentBins),a.totalTable.update([a.currentSummary])},onBinsTableCollapse:function(){this.saveStack()},saveStack:function(){var a=this;return a.currentBins=a.binsTable.getTableData(),a.saveTrack(),a.currentBins},getTotal:function(a){var b={p:void 0,n:void 0,prate:void 0,totalRate:100,prateOfTotal:void 0,nrateOfTotal:void 0,total:0,iv:void 0};return a.forEach(function(a){var c=_.isString(a.iv)?parseFloat(a.iv):a.iv;void 0!==a.p&&(b.p=void 0===b.p?0:b.p,b.p+=a.p),void 0!==a.n&&(b.n=void 0===b.n?0:b.n,b.n+=a.n),b.total+=a.total?a.total:0,void 0!==c&&(b.iv=void 0===b.iv?0:b.iv,b.iv+=c||0)}),b.p&&(b.prate=b.p/b.total,b.prateOfTotal=100),b.n&&(b.nrateOfTotal=100),b.index="Total",b},getFirstNormBin:function(a){return a.find(function(a){return 0===a.id})},saveTrack:function(){var a=this;a.stack.execute({currentBins:s(a.currentBins),currentFeature:s(a.currentFeature)})},updateBinsTable:function(a){var b=this;b.binsTable.update(a||b.currentBins,!0)},onBinning:function(a){var b=this,c=$(a.currentTarget).data("binning"),d=$(a.currentTarget);b["on"+h.ucFirst(c)](d)},onMerge:function(){var a=this,b=a.binsTable.getSelectedRows(),c=!1,d=[];b.length<2||(b=b.filter(function(a){return!o.isElseOrNullBin(a)}),a.isEnum?a.currentBins=a.mergeData(a.currentBins,b):(b=a.splitArray(b,"index"),b.reverse().forEach(function(b){b.length>1?a.currentBins=a.mergeData(a.currentBins,b):(c=!0,d.push(b[0].id))})),a.indicesMap={},a.reIndex(a.currentBins),a.constraint.refresh(a.currentBins,a.indicesMap),c?d.forEach(function(b,c){a.$binsTable.find('[data-id="'+b+'"]').removeClass(r.active).addClass(r.animated).addClass(r.flash).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oAnimationEnd oanimationend animationend",function(){$(this).removeClass(r.animated).removeClass(r.flash),0===c&&(a.updateBinsTable(),a.saveTrack())})}):(a.updateBinsTable(),a.saveTrack()))},onSplit:function(){var a=this,b=a.binsTable.getSelectedRows();b.length<1||!a.hasChildRow(b)||(a.currentBins=a.splitData(a.currentBins,b),a.indicesMap={},a.reIndex(a.currentBins),a.constraint.refresh(a.currentBins,a.indicesMap),a.updateBinsTable(),a.saveTrack())},onDown:function(a){var b,c=this,d=c.binsTable.getSelectedRows(),e=d.length,f=d[0].index,g=d[e-1].index,h=c.binsTable.getTableData();if(0!==e&&!a.hasClass(r.disabled)){if(g<0)return void alert(t("notSupportMove"));h[g+1].index=h[g+1].index-e,d.forEach(function(a){a.index++}),b=h.slice(0,-2),b=_.sortBy(b,"index"),h=b.concat(h.slice(-2)),c.updateBinsTable(h),c.saveStack(),c.moveButtonDisableCheck(f+1,g+1,h)}},onUp:function(a){var b,c=this,d=c.binsTable.getSelectedRows(),e=d.length,f=d[0].index,g=d[e-1].index,h=c.binsTable.getTableData();if(0!==e&&!a.hasClass(r.disabled)){if(g<0)return void alert(t("notSupportMove"));h[f-1].index=h[f-1].index+e,d.forEach(function(a){a.index--}),b=h.slice(0,-2),b=_.sortBy(b,"index"),h=b.concat(h.slice(-2)),c.updateBinsTable(h),c.saveStack(),c.moveButtonDisableCheck(f-1,g-1,h)}},onSelectAll:function(){this.binsTable.selectAll(),this.$selectAll.hide(),this.$unselectAll.show()},onUnselectAll:function(){this.binsTable.unselectAll(),this.$selectAll.show(),this.$unselectAll.hide()},onCollapse:function(){this.binsTable.collapseAll(),this.$collapse.hide(),this.$expand.show()},onExpand:function(){this.binsTable.expandAll(),this.$collapse.show(),this.$expand.hide()},onUndo:function(){var a=this,b=a.stack;b.canUndo()&&(b.undo(),a.updateBinsTable())},onRedo:function(){var a=this,b=a.stack;b.canRedo()&&(b.redo(),a.updateBinsTable())},onEdit:function(){this.constraint.edit()},onSave:function(a){var b=this,c=b.parent;!a.hasClass(r.disabled)&&b.binsTable.validate()&&(b.update(),c.save().then(function(c){b.currentFeature[u.isModified]=!1,a.toggleClass(r.disabled,c)}))},onRerun:function(a){var b=this,c=b.parent;a.hasClass(r.disabled)||(b.update(),c.rerun())},update:function(){this.updateFeatures(),this.updateConstraints(),this.renderChart()},onExportBinning:function(){var a=this,b=a.parent;a.binsTable.validate()&&b.exportAll()},onExportConstraint:function(){this.parent.exportConstraint()},updateDetailPanel:function(a){var b=this;b.currentFeature=a,b.$save.toggleClass(r.disabled,!a[u.isModified])},updateFeatures:function(){var a=this,b=a.currentBins,c=a.parent.featuresData,d=a.currentFeature,e=a.currentSummary;d.bin&&(o.binsToFeature(b,d),d.iv=e.iv),c.forEach(function(a,b){if(a.name===d.name)return c[b]=d,!0})},updateConstraints:function(){var a,b=this,c=b.currentFeature,d=b.binsTable.getTableData();a=o.getConstraintFromFeature(c,d),b.parent.constraintData=b.mergeConstraint(a)},mergeConstraint:function(a){var b,c=this,d=c.currentFeature.name,e=c.parent.constraintData;return b=e.filter(function(a){return a.name!==d}),b.concat(a)},hasChildRow:function(a){var b=!1;return a.forEach(function(a){if(a.children)return void(b=!0)}),b},mergeData:function(a,b){var c,d,f,g,h=this;c=b.map(function(a){return a.index}),b=b.map(function(a){return a[e.status_props.isSelected]=void 0,a}),h.constraint.remove(b),d=h.createNewRow(b);for(var i=0,j=a.length;i<j;i++)if(a[i].index===b[0].index){f=i;break}return g=a.filter(function(a){return-1===c.indexOf(a.index)}),d.children=h.flatten(b),h.collapseRow(d),g=g.slice(0,f).concat(d,g.slice(f))},collapseRow:function(a){a&&(a[e.status_props.isCollapsed]=!0,a.children&&a.children.forEach(function(a){a[e.status_props.isHide]=!0}))},splitData:function(a,b){var c,d;for(c=b.length-1;c>=0;c--)d=b[c],d.children&&(a=a.slice(0,d.index).concat(d.children,a.slice(d.index+1)),d.children.forEach(function(a){a[e.status_props.isHide]=void 0}));return a},createNewRow:function(a){var b,c,d,e=this,f=e.currentSummary,g=f.total,i=a.length-1,j=0,k=0,l=0,m=0,n=0,o="",p=[];return a.forEach(function(a){j+=a.total,k+=a.p||0,l+=a.n||0,m+=a.prateOfTotal||0,n+=a.nrateOfTotal||0,e.isEnum&&(p=p.concat(a.value))}),void 0===a[0].p&&(k=void 0,m=void 0),void 0===a[0].n&&(l=void 0,n=void 0),b=Math.log(k/f.p/(l/f.n)),c=(k/f.p-l/f.n)*b,d=j?k/j:0,o=e.isEnum?p:e.getLeftOperator(a[0].lowValue)+a[0].lowValue+","+a[i].lessThan+e.getRightOperator(a[i].lessThan),{index:a[0].index,value:o,_value:o,lowValue:a[0].lowValue,lessThan:a[i].lessThan,p:k,n:l,prateOfTotal:m,nrateOfTotal:n,prate:_.isNaN(d)?void 0:d,woe:_.isNaN(b)?void 0:h.toFixedNumber(b,4),iv:_.isNaN(c)?void 0:h.toFixedNumber(c,4),total:j,totalRate:h.toFixedNumber(j/g*100,2)}},getLeftOperator:function(a){return"-inf"===a?"(":this.isLeftOpen?"(":"["},getRightOperator:function(a){return"+inf"===a?")":this.isLeftOpen?"]":")"},reIndex:function(a,b){var c,d=this,e=0,f=d.indicesMap;a.forEach(function(a,g){o.isElseOrNullBin(a)?(e++,f[a.index]=a.index):(c=a.index,a.index=void 0!==b?b+"."+(g-e):g-e,f[c]=a.index),a.children&&d.reIndex(a.children,a.index)})},flatten:function(a){var b=[];return a.forEach(function(a){a.children&&(b=b.concat(a.children),a.children=void 0,a.out=!0)}),b=a.concat(b),b=b.filter(function(a){return void 0===a.out}).sort(function(a,b){return a.id>b.id})},splitArray:function(a,b){if(!a||!a.length)return[];var c=[],d=[],e=a[0][b]-1;return a.forEach(function(a){a[b]===e+1?d.push(a):(c.push(d),d=[a]),e=a[b]}),c.push(d),c},onFeatureChange:function(a){var b,c,d=this,e=d.stack,f=e.canRedo(),g=e.canUndo();d.currentBins=a.currentBins,b=d.currentFeature=a.currentFeature,c=b[u.isCustomBinning],b[u.isModified]=g,b[u.lastModified]=g?(new Date).toLocaleString():"",d.$undo.toggleClass(r.disabled,!g),d.$save.toggleClass(r.disabled,!g),d.$redo.toggleClass(r.disabled,!f),d.$rerun.toggleClass(r.disabled,!c),d.update()},mergeButtonDisabledCheck:function(){var a=this,b=a.binsTable,c=b.getSelectedRows();c.length>1?a.$merge.removeClass(r.disabled):a.$merge.addClass(r.disabled),c.length>0&&a.hasChildRow(c)?a.$split.removeClass(r.disabled):a.$split.addClass(r.disabled)},moveButtonDisableCheck:function(a,b,c){var d=this;d.$up.removeClass(r.disabled),d.$down.removeClass(r.disabled),b===c.length-3&&d.$down.addClass(r.disabled),0===a&&d.$up.addClass(r.disabled)},destroy:function(){var a=this,b=a.binsTable,c=a.totalTable,d=a.tab,e=a.chart,f=a.customBinning,g=a.constraint;a.$container.off(".detail"),d&&(d.destroy&&d.destroy(),d=null),g&&(g.destroy(),g=null),f&&(f.destroy(),f=null),b&&(b.destroy(),b=null),c&&(c.destroy(),c=null),e&&(e.destroy(),e=null)}});return w.TABLE_OPTIONS=v,w}),define("midway/dialog/experiment/binningPreview",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="J-binning-preview binning-preview"></div>'}}),define("dialog/experiment/binningPreview",["zero/zero","zero/declare","zero/ui/Dialog","zero/ui/DataTable","../../midway/dialog/experiment/binningPreview","../../global/html2picture","../../i18n","../../charts/bar","../../components/binning/Detail","../../components/binning/utils"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=g.translate,l={doSave:".J-do-save",detailChart:".J-binning-preview"},m={binningPreviewDialog:"dialog-binning-preview"};return b("experiment/binningPreview",[],{constructor:function(a){this.featureData=a.featureData,this.featureConfig=a.featureConfig,this.dataDetails=a.dataDetails},show:function(){this._initDialog(),this._initHtml2Picture(),this._renderBinningData()},_initHtml2Picture:function(){var a=this.dialog;this.html2picture=new f({parent:a.$element.find(l.detailChart)})},_doSave:function(){this.html2picture.export("binningPreview.png","image/png")},_renderBinningData:function(){var a=this.html2picture,b=a.getContainer(),c=$("<div>");b.append(c);var e={container:c,data:this.featureData};e=$.extend({},this.featureConfig,e),this.featureTable=new d(e);for(var f=0;f<this.featureData.length;f++){var g=this.dataDetails[f],k=$("<div>");k.css({width:600,height:600});var l=$("<div>");b.append(l);var e={container:l,data:g};e=$.extend({},i.TABLE_OPTIONS,e),this.table=new d(e),b.append(k);var m=j.parseFeatureForChart(this.featureData[f]),n={element:k};$.extend(m,n);try{this.chart=new h(m)}catch(a){console.error&&console.error(a)}}},_initDialog:function(){this.dialog=new c({title:k("resultPreview"),body:e(),destroyOnHide:!0,className:m.binningPreviewDialog,buttons:[{text:k("save"),type:"primary",click:this._doSave.bind(this)},{text:k("close"),click:function(){this.hide()}}]})},destroy:function(){var a=this.table;a&&(a.destroy(),a=null)}})}),define("components/binning/Features",["zero/declare","zero/ui/datatable/plugins/Resizer","zero/ui/DataTable","zero/ui/DialogEx","../../i18n","../../global/utils","./Detail","./common","../../dialog/experiment/binningPreview","../../midway/dialog/experiment/binningPreview"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=e.translate,k=h.statusFields,l={ATTR_COPY:"data-clipboard-text"},m={crossHover:!1,grid:!0,resizable:!0,defaultsort:!0,height:"calc(100% - 40px)",cols:[{field:"name",title:j("name"),width:110,sort:!0},{field:"type",title:j("type"),width:90,sort:!0},{field:"binDivideType",title:j("binDivideType"),width:105,sort:!0,parse:function(a){return a?j(a):""}},{field:"iv",title:"IV",width:100,sort:!0,parse:function(a){return a?f.toFixedNumber(a,3):a}},{field:"binCount",title:j("bins"),width:90,sort:!0},{field:k.isModified,title:j("editStatus"),width:105,sort:!0,parse:function(a,b){return b[k.isModified]?j("modifying"):""}},{field:k.hasConstraint,title:j("editConstraint"),width:105,sort:!0,parse:function(a,b){return b[k.hasConstraint]?j("yes"):""}},{field:k.lastModified,title:j("lastModified"),width:170,sort:!0}],showActions:!0,actions:[{key:"detail",name:j("detail")}]},n={tr:'[data-role="tbody"] tr',detail:'[data-key="detail"]',binning:'[data-role="binning"]',save:'[data-binning="save"]',rerun:'[data-binning="rerun"]',export:'[data-binning="export"]',exportReport:'[data-binning="exportReport"]',selectAndCopy:".copy",details:".binning-details"},o={disabled:"disabled"};return a("binning/Features",[],{constructor:function(a){var b=this,d=b.tableConfig=$.extend({},a.tableOptions,m);b.parent=a.parent,b.$container=a.container,b.table=new c(d),b.$save=b.$container.find(n.save),b.$rerun=b.$container.find(n.rerun),b.$export=b.$container.find(n.export),b.exportReport=b.$container.find(n.exportReport),b.$details=b.$container.find(n.details),b.bindEvents(),b.dialog=a.dialog},bindEvents:function(){var a=this;a.$container.on("dblclick.features",n.tr,a.onRowDblClick.bind(a)).on("click.features",n.binning,a.onBinning.bind(a)).on("click",n.selectAndCopy,a.onCopy.bind(a))},onBinningPreview:function(){var a,b=this,c=b.parent,d=b.$container,e=b.table.getRows();c.dialog.showLoading(),setTimeout(function(){new i({featureData:b.table.getRows(),featureConfig:m,dataDetails:e.map(function(f){if(c.detailInstances={},!c.detailInstances[f.name])return a=new g({parent:d,$wrapper:c.$details,feature:f,featuresData:e,constraintData:b.constraintData}),c.detailInstances[f.name]=a,a.binsTable.getRows()})}).show(),c.dialog.hideLoading()},50)},onCopy:function(a){var b=this,c=b.table,d=$(a.currentTarget);c.selectAll();var e=c.getSelectedTsvRows();d.attr(l.ATTR_COPY,e),c.selectCopy(n.selectAndCopy,l.ATTR_COPY)},onRowDblClick:function(a){var b=$(a.currentTarget);b.data("row")[c.status_props.isSelected]=!0,b.find(n.detail).trigger("click")},onBinning:function(a){var b=this,c=$(a.currentTarget),d=c.data("binning");b["on"+f.ucFirst(d)](c)},onSave:function(a){var b=this,c=b.parent;a.hasClass(o.disabled)||c.save()},onRerun:function(a){var b=this,c=b.parent;a.hasClass(o.disabled)||c.rerun()},onExportBinning:function(){this.parent.exportAll()},onExportReport:function(){this.parent.exportReport()},onExportConstraint:function(){this.parent.exportConstraint()},onDelete:function(){},update:function(a,b){var d=this,e=d.tableConfig;e.data=a,e.status=b,d.table=new c(e),d.$save.toggleClass(o.disabled,!d.parent.checkModified()),d.$rerun.toggleClass(o.disabled,!d.parent.checkCustomBinning())},destroy:function(){this.$container.off(".features"),this.table.destroy()}})}),define("midway/components/binning/binning",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert"><span>'+e(d("needRecoverTip"))+'</span><button type="button" class="btn btn-primary" data-role="recover">'+e(d("recover"))+'</button></div><span class="label label-success" data-note="saveSucceed">'+e(d("saveSucceed"))+'</span><span class="label label-danger" data-note="danger">'+e(d("saveFailed"))+'</span><div class="binning-list"><ul class="binning-actions">\x3c!--&lt;!&ndash; 分箱可视化 &ndash;&gt;--\x3e\x3c!--<li class="binningPreview" data-role="binning" data-binning="binningPreview">--\x3e\x3c!--<i class="icon icon-report-24"></i>--\x3e\x3c!--<span>'+e(d("binningPreview"))+'</span>--\x3e\x3c!--</li>--\x3e\x3c!-- 全选复制  --\x3e<li class="copy" data-role="binning" data-binning="copy"><i class="icon icon-copy-l"></i><span>'+e(d("selectAndCopy"))+'</span></li>\x3c!--by zhiqin--\x3e\x3c!--批量操作--\x3e<li class="quick-woe-li j-quick-woe disabled" data-binning="quick"><i class="arrow-down"></i><span>'+e(d("quickWoe"))+'</span><div class="quick-woe-menus"><ul><li data-role="constraint" data-type="ascending"><a href="javascript:void(0);"><i>&lt; bin</i><span>'+e(d("EnforceAscendingPattern"))+'</span></a></li><li data-role="constraint" data-type="descending"><a href="javascript:void(0);"><i>&gt; bin</i><span>'+e(d("EnforceDescendingPattern"))+'</span></a></li><li data-role="constraint" data-type="equal"><a href="javascript:void(0);"><i>= bin</i><span>'+e(d("AssignCommonWeight"))+'</span></a></li><li data-role="constraint" data-type="zero"><a href="javascript:void(0);"><i>0</i><span>'+e(d("AssignWeightOfZero"))+'</span></a></li><li data-role="constraint" data-type="ws"><a href="javascript:void(0);"><i>= weight</i><span>'+e(d("AssignSlapOnWeight"))+'</span></a></li><li data-role="constraint" data-type="woe"><a href="javascript:void(0);"><i>WoE</i><span>'+e(d("PreserveOrderingByWoE"))+'</span></a></li><li data-role="constraint" data-type="remove"><a href="javascript:void(0);"><i class="icon icon-delete"></i><span>'+e(d("RemoveConstraints"))+'</span></a></li></ul></div></li><li data-role="binning" data-binning="save" class="disabled"><i class="icon icon-save"></i><span>'+e(d("saveBatch"))+'</span></li><li data-role="binning" data-binning="rerun" class="disabled"><i class="icon icon-run-o-24"></i><span>'+e(d("reExecuteBatch"))+'</span></li><li data-role="binning" data-binning="exportBinning"><i class="icon icon-download"></i><span>'+e(d("exportBinningAndConstraint"))+'</span></li>\x3c!--by zhiqin--\x3e\x3c!--保存分箱WOE--\x3e\x3c!--<li data-role="binning" data-binning="save" class="j-save-woe">--\x3e\x3c!--<i class="icon icon-save"></i>--\x3e\x3c!--<span>'+e(d("saveWoe"))+'</span>--\x3e\x3c!--</li>--\x3e\x3c!-- 导出分箱报告 --\x3e\x3c!--<li data-role="binning" data-binning="exportReport">--\x3e\x3c!--<i class="icon icon-download"></i>--\x3e\x3c!--<span>'+e(d("exportBinningReport"))+'</span>--\x3e\x3c!--</li>--\x3e</ul><div class="feature-table"></div></div><div class="binning-details"></div>'}()}}),define("midway/components/common/woePreviewChart",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e,f,g){var h='<div class="woe-preview-item"><div class="woe-preview-data"><h2>'+d(b)+"&nbsp;&nbsp;";return c&&(h+="<span>iv: "+d(c)+"</span>"),h+='</h2><table class="table"><thead><tr><th>Interval</th><th>Total</th><th>IV</th></tr></thead><tbody>',a.each(e,function(a,b){h+="<tr><td>"+d(a.value)+"</td><td>"+d(a.total)+"</td><td>"+d(a.iv||"0")+"</td></tr>"}),h+="</tbody></table>",f.iv&&(h+="<div><span>null:"+d(f.iv)+"</span></div>"),h+="",f.iv&&(h+="<div><p>else:"+d(g.iv)+"</p></div>"),h+='</div><div class="woe-preview-chart"></div></div>'}(b.label,b.iv,b.normVal,b.nullVal,b.elseVal)}}),define("midway/components/common/woePreviewSection",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="woe-preview-section"></div>'}}),define("components/common/WoePreviewDialog",["zero/zero","zero/declare","zero/ui/DialogEx","../../global/download","../../i18n","../../charts/bar","../../midway/components/common/woePreviewChart","../../midway/components/common/woePreviewSection"],function(a,b,c,d,e,f,g,h){"use strict";var i=e.translate,j={container:".modal-body",section:".woe-preview-section",woeChart:".woe-preview-chart"},k=b("report/Chart",[f],{constructor:function(a){f.prototype.constructor.call(this,a)},smartAdapt:function(a){a.toolbox={show:!1},a.tooltip={show:!1},a.title={show:!1}}});return b("report/woePreview",[],{constructor:function(a){this.dialog=null,this.params=a,this.data=a.data,this.chartDataMap=a.chartDataMap},show:function(){this.dialog=new c({title:i("resultPreview"),className:"dialog-woe-preview",destroyOnHide:!0,canFullscreen:!0,afterShow:this.afterShow.bind(this),buttons:[{text:i("save"),type:"primary",click:this.doSave.bind(this)},{text:i("close"),click:function(){this.hide()}}]})},afterShow:function(){var a=0,b=this;this.dialog.showLoading(),setTimeout(function(){b.createSection(a);for(var c in b.chartDataMap)b.renderChart(c,a),a++,b.createSection(a);b.dialog.hideLoading()},100)},createSection:function(a){a%30==0&&(this.$currentSection=$(h()).appendTo(this.dialog.$element.find(j.container)))},doSave:function(){this.doExport(0)},doExport:function(a){var b=this,c=b.dialog,e=c.$(j.section),f=e.eq(a),g=e.length,h="binningPreview"+(g>1?"-part"+(a+1):"")+".png";c.showLoading(),html2canvas($(f),{height:$(f).height()+20,background:"#fff"}).then(function(i){d(i.toDataURL("image/png"),h),a+=1,1!==g&&f.hide(),g>1&&a<g?b.doExport(a):(1!==g&&e.show(),c.hideLoading())})},renderChart:function(a,b){var c=this.chartDataMap,d=c[a].container,e=this.data.features,f=e[b],h=f.bin,i=h.norm,l=h.else,m=h.null,n=$(g({label:a,iv:f.iv,normVal:i,elseVal:l,nullVal:m}));this.$currentSection.append(n),new k($.extend(!0,{},d,{element:n.find(j.woeChart),animation:!1}))}})}),define("components/binning/BatchOperator",["zero/zero","zero/declare","zero/ui/Undo","zero/ui/DialogSingleInput","../../i18n","../common/binningUtil","./common","./utils"],function(a,b,c,d,e,f,g,h){var i=e.translate,j={quickWoe:".j-quick-woe",quickWoeLi:'.j-quick-woe [data-role="constraint"]',save:'[data-binning="save"]'},k=g.statusFields,l=g.operatorMap;return b("binning/BatchOperator",{constructor:function(a){this.context=a.context,this.binTable=a.binTable,this.selectedFeatures=[],this.undo=new c,this.events()},events:function(){var a=this;a.binTable.on("rowSelect",function(b){var c=a.binTable.getSelectedRows(),d=c.length;a.selectedFeatures=b.selectedData,$(j.quickWoe)[d>0?"removeClass":"addClass"]("disabled")}),$(j.quickWoeLi).off("click.liBatchOperator").on("click.liBatchOperator",function(b){var c=$(this).data("type"),e=a.binTable.getTableData(),f=a.binTable.getSelectedRows(),g=a.binTable.getSelectedRowsIndex(),h=a.getDetailFeatures(f);if("ws"===c.toLowerCase())return void new d({backdrop:!1,title:i("SlapOnWeight"),placeholder:i("PleaseEnterAWeight"),callback:function(b){a.updateFeature(e,h,c,g,b),a.binTable.update(e,a.binTable.getStatus())}});a.updateFeature(e,h,c,g),a.binTable.update(e,a.binTable.getStatus())})},getDetailFeatures:function(a){for(var b=[],c=0;c<a.length;c++)b.push(h.featureToBins(a[c]));return b},updateFeature:function(a,b,c,d,e){for(var f,g,i,m=this,n=c,o=0;o<=b.length-1;o++){f=b[o],"woe"===n&&(c="ascending",f=f.filter(function(a){return _.isNumber(a.woe)}),f=_.sortBy(f,"woe"));for(var p=d[o]-1,q=0;q<=f.length-1;q++){var r=q+1;r===f.length&&(r=0),f[q][k.operator]=l[c],f[q][k.value]=void 0!==e?e:f[r].index,g=""!==f[q][k.operator]&&void 0!==f[q][k.operator],a[p][k.hasConstraint]=g,a[p][k.isModified]=g,a[p][k.lastModified]=g?(new Date).toLocaleString():"","woe"===n&&(f=_.sortBy(f,"index")),i=h.getConstraintFromFeature(a[p],f),m.updateConstraint(a[p].name,i)}}$(j.save).toggleClass("disabled",!g)},updateConstraint:function(a,b){var c=this.context.constraintData.filter(function(b){return b.name!==a});this.context.constraintData=c.concat(b)}})}),define("dialog/binning",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","zero/ui/Message","zero/ui/Confirm","../i18n","../components/binning/Features","../components/binning/Detail","../midway/components/binning/binning","../ajax/model","../global/download","../global/utils","../components/binning/utils","../workspace/statusTicker","../components/binning/common","../components/common/WoePreviewDialog","../components/common/binningUtil","../components/binning/BatchOperator"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";var t,u="-binning-and-constraints.txt",v="-binning.txt",w="-constraints.txt",x="binningExport.txt",y={dialogBody:".modal-body",binningList:".binning-list",binslist:".bins-list",featureTable:".feature-table",details:".binning-details",back:".back",prevDetail:'[data-role="prev-detail"]',nextDetail:'[data-role="next-detail"]',copy:".copy",title:".modal-title",warning:".alert-warning",labelSuccess:'[data-note="saveSucceed"]',labelFailed:".label-danger",loading:".modal-loading",recover:'[data-role="recover"]',saveWoe:".j-save-woe",quickWoe:".j-quick-woe",tab:".pai-tab li"},z={dialog:"binning-dialog",active:"active",splitScreen:"split-screen",disabled:"disabled"},A=p.statusFields,B=g.translate,C=_.cloneDeep,D=b("dialog/Binning",[],{constructor:function(){},show:function(a){var b,d=this;d.activeTabKey=0,d.nodeData=a,d.detailInstances={},b=d.dialog=new c({title:B("binning"),canFullscreen:!0,className:z.dialog,body:j(),beforeHide:d.onBeforeHide.bind(d),destroyOnHide:!0,afterShow:d.onAfterShow.bind(d),buttons:[{text:B("close"),click:function(){b.hide()}}]}).on("fullScreen",d.fullScreen.bind(d))},fullScreen:function(a){},onBeforeHide:function(){var a=this,b=a.dialog,c=a.features,d=a.detailInstances;if(!b.forceClose&&a.checkModified())return f({title:B("close"),body:B("hasNotSaved"),onAccept:function(){b.forceClose=!0,b.hide()}}),!1;if(d){for(var e in d)d[e].destroy();d=null}c&&(c.destroy(),c=null)},onAfterShow:function(){var a=this,b=a.dialog;a.$dialog=$(b.$element),b.showLoading(),a.bindEvents(),a.render()},render:function(){var a=this,b=a.nodeData
;k.getBinning(b.nodeInstanceId,b.experimentId).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog,d=b.$dialog;c.hideLoading(),d.find(y.warning).hide(),d.find(y.binningList).show(),b.featuresData=a.features,b.addIndex(b.featuresData),b.constraintData=b.filterConstraints(a.features,a.constrains||[]),n.setConstraintsToFeatures(b.constraintData,b.featuresData),b.$binningList=d.find(y.binningList),b.$featureTable=d.find(y.featureTable),b.$details=d.find(y.details),b.$copy=d.find(y.copy),b.$title=d.find(y.title),b.$labelSuccess=d.find(y.labelSuccess),b.$labelFailed=d.find(y.labelFailed),b.$copyLabelSuccess=d.find(y.copyLabelSuccess),b.$title.text(b.binningName=a.binningName),b.features=new h({parent:b,dialog:c,container:b.$binningList,tableOptions:{container:b.$featureTable,data:b.featuresData,on:{detail:b.viewDetail.bind(b)}}}),new s({context:b,binTable:b.features.table})},renderFailed:function(){var a=this,b=a.dialog,c=a.$dialog;b&&b.hideLoading(),c&&c.find(y.warning).show(),c&&c.find(y.binningList).hide()},addIndex:function(a){return a.map(function(a,b){return a.index=b,a})},filterConstraints:function(a,b){var c=_.pluck(a,"name");return b.filter(function(a){return-1!==c.indexOf(a.name)})},viewDetail:function(a){var b=this,c=b.features.table;b.featureTableStatus=c.getStatus(),b.featuresData=c.getTableData(),b.$details.show(),b.$binningList.hide(),b.currentFeatureIndex=a.index,c.destroy(),b.createDetail(a)},nextDetail:function(){var a,b=this;b.currentFeatureIndex<b.featuresData.length-1&&(a=b.featuresData[++b.currentFeatureIndex],b.createDetail(a))},prevDetail:function(){var a,b=this;b.currentFeatureIndex>0&&(a=b.featuresData[--b.currentFeatureIndex],b.createDetail(a))},createDetail:function(a){var b,c=this;c.$title.text(B("binningDetail",a.name)),c.detailInstances[a.name]?(c.currentDetail=c.detailInstances[a.name],c.currentDetail.updateDetailPanel(a)):(b=new i({parent:c,$wrapper:c.$details,feature:a,featuresData:c.featuresData,activeIndex:c.activeTabKey}),c.currentDetail=c.detailInstances[a.name]=b),c.showCurrentDetail(a.name),c.siblingNavStatus()},siblingNavStatus:function(){var a=this;a.$dialog.find(y.prevDetail).toggleClass(z.disabled,a.currentFeatureIndex<=0),a.$dialog.find(y.nextDetail).toggleClass(z.disabled,a.currentFeatureIndex>=a.featuresData.length-1)},showCurrentDetail:function(a){var b,c=this;for(var d in c.detailInstances)b=c.detailInstances[d],d===a?b.show():b.hide()},save:function(){var a=this,b=a.dialog,c=a.nodeData;return b.showLoading(),k.saveBinning(c.nodeInstanceId,c.experimentId,a.featuresData,a.constraintData).then(function(c){return a.featuresData=c.features,a.constraintData=c.constrains,a.cleanModifyInfo(a.featuresData),a.features.update(a.featuresData),new s({binTable:a.features.table}),a.saveSucceed(),b.hideLoading(),!0}).catch(function(){return a.saveFailed(),b.hideLoading(),!1})},rerun:function(){var a=this,b=a.dialog,c=a.$dialog,d=a.nodeData;return b.showLoading(),c.find(y.loading).append('<div class="modal-loading-tip">实验准备中……请耐心等待。完毕后，窗口自动关闭。</div>'),k.rerunBinning(d.nodeInstanceId,d.experimentId,a.featuresData,a.constraintData).then(function(c){b.hideLoading(),a.saveSucceed().then(function(){b.forceClose=!0,b.hide(),o.tick(c)})}).catch(function(){b.hideLoading(),a.saveFailed()})},exportAll:function(){var a=this,b=a.nodeData,c=b.experimentName+"-"+b.nodeInstanceName+u,d={};d.featuresJson=a.featuresData||{},d.constraintJson=a.constraintData||[],d=m.JSONFormat(JSON.stringify(d)),l(d,c,"text/plain")},exportReport:function(){var a,b=this,c={},d=[],e=b.dialog,f=x,g=b.features.table,h=g.getRows();b.binningData=g.getTsvRows(),c.binningData=b.binningData||{},e.showLoading(),setTimeout(function(){h.forEach(function(c){b.detailInstances[c.name]||(a=new i({parent:b,$wrapper:b.$details,feature:c,featuresData:b.featuresData,constraintData:b.constraintData,activeIndex:b.activeTabKey}),b.detailInstances[c.name]=a),b.detailData="名称:"+c.name+"\n"+b.detailInstances[c.name].binsTable.getTsvRows()+"\n",d.push(b.detailData)}),e.hideLoading(),l(c.binningData+"\n"+d.join(""),f,"text/csv;charset=utf-8;")},50)},exportBinning:function(){var a,b=this,c=b.nodeData,d=c.experimentName+"-"+c.nodeInstanceName+v;a=m.JSONFormat(JSON.stringify(a)),l(a,d,"text/plain")},exportConstraint:function(){var a,b=this,c=b.nodeData,d=c.experimentName+"-"+c.nodeInstanceName+w;a=b.constraintData||[],a=m.JSONFormat(JSON.stringify(a)),l(a,d,"text/plain")},cleanModifyInfo:function(a){a.forEach(function(a){a[A.isModified]=void 0})},cleanFeatures:function(a){var b=this,c=C(a);return c.forEach(function(a){a.bin&&a.bin.norm&&(a.bin.norm=a.bin.norm.map(function(a){return b.cleanBin(a)})),a.bin&&a.bin.else&&(a.bin.else=b.cleanBin(a.bin.else)),a.bin&&a.bin.null&&(a.bin.null=b.cleanBin(a.bin.null))}),c},cleanBin:function(a){var b=["index","value","lowValue","lessThan","left","right","woe","total","totalRate","n","p","prate","iv"],c={};return b.forEach(function(b){void 0!==a[b]&&(c[b]=a[b])}),c},checkModified:function(){return this.check(A.isModified)},checkCustomBinning:function(){return this.check(A.isCustomBinning)},check:function(a){var b=this,c=!1,d=b.featuresData;return!!d&&(d.forEach(function(b){b[a]&&(c=!0)}),c)},saveSucceed:function(){return this.labelAnimate(this.$labelSuccess)},saveFailed:function(){return this.labelAnimate(this.$labelFailed)},labelAnimate:function(a){return new Promise(function(b){a.animate({top:5},300).delay(3e3).animate({top:-100},300,b)})},bindEvents:function(){var a=this,b=a.$dialog;b.on("click",y.back,a.onBack.bind(a)),b.on("click",y.prevDetail,a.prevDetail.bind(a)),b.on("click",y.nextDetail,a.nextDetail.bind(a)),b.on("click",y.recover,a.onRecover.bind(a)),b.on("click",y.copy,a.onCopyDialog.bind(a)),b.on("click",y.tab,a.onTabClick.bind(a)),b.on("click",y.saveWoe,a.onSaveWoe.bind(a))},onTabClick:function(a){var b=this,c=a.target.parentElement.getAttribute("data-target");b.activeTabKey=".bins-chart"===c?1:0},onCopyDialog:function(){var a=this;a.message=new e,a.message.show()},onBack:function(){var a=this;a.currentDetail.binsTable.validate()&&(a.$details.hide(),a.$binningList.show(),a.$title.text(a.binningName),a.currentDetail.update(),a.features.update(a.featuresData,a.featureTableStatus))},onRecover:function(){var a=this,b=a.nodeData;a.dialog.showLoading(),k.getBinning(b.nodeInstanceId,b.experimentId,!0).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},onSaveWoe:function(){var a=this,b=a.dialog,c=a.nodeData;b.showLoading(),k.getBinning(c.nodeInstanceId,c.experimentId).then(a.renderSaveWoeSuccess.bind(a),a.renderSaveWoeFailed.bind(a))},renderSaveWoeSuccess:function(a){var b={};a.features.forEach(function(a){var c=r.parseFeatureForChart(a);b[a.name]={container:c,feature:a}}),new q({data:a,chartDataMap:b}).show()},renderSaveWoeFailed:function(){this.dialog.hideLoading()}});return{show:function(a){t||(t=new D),t.show(a)}}}),define("midway/components/cumulateGroup/legendList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e="<p>选择直方图指标：</p>",c=a.uuid();return e+="<ul>",a.each(b,function(a,b){e+='<li><div class="ui-checkbox">',a.checked?e+='<input type="checkbox" data-name="'+d(a.name)+'" id="'+d(c+"-"+b)+'" checked> ':e+='<input type="checkbox" data-name="'+d(a.name)+'" id="'+d(c+"-"+b)+'"> ',e+='<label for="'+d(c+"-"+b)+'"><span class="ui-checkbox-label">'+d(a.name)+"</span></label></div></li>"}),e+="</ul>"}(b.items,b.uuid)}});define("midway/components/cumulateGroup/detail",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="binning-detail" data-feature="'+e(a)+'"><a href="javascript:void(0);" class="back">&lsaquo; '+e(d("backToList"))+'</a><ul class="nav nav-tabs pai-tab"><li class="active" data-target=".bins-list"><a href="javascript:void(0);">'+e(d("list"))+'</a></li><li data-target=".bins-chart"><a href="javascript:void(0);">'+e(d("charts"))+'</a></li></ul><ul class="sibling-nav"><li><a href="javascript:void(0);" data-role="prev-detail">&lsaquo; '+e(d("prev"))+'</a></li><li><a href="javascript:void(0);" data-role="next-detail">'+e(d("next"))+' &rsaquo; </a></li></ul><div class="bins-list"><ul class="binning-actions"><li data-role="binning" data-binning="merge" class="disabled"><i class="icon icon-merge-cell"></i><span>'+e(d("merge"))+'</span></li><li data-role="binning" data-binning="split" class="disabled"><i class="icon icon-separate-cell"></i><span>'+e(d("split"))+'</span></li><li data-role="binning" data-binning="down"><i class="icon icon-arrow-reduce"></i><span>'+e(d("down"))+'</span></li><li data-role="binning" data-binning="up"><i class="icon icon-arrow-rise"></i><span>'+e(d("up"))+'</span></li><li data-role="binning" data-binning="selectAll"><i class="icon icon-ok-s"></i><span>'+e(d("selectAll"))+'</span></li><li data-role="binning" data-binning="unselectAll" style="display:none;"><i class="icon icon-s"></i><span>'+e(d("unselectAll"))+'</span></li><li data-role="binning" data-binning="collapse" style="display:none;"><i class="icon icon-node-expand"></i><span>'+e(d("collapse"))+'</span></li><li data-role="binning" data-binning="expand"><i class="icon icon-node-collapse"></i><span>'+e(d("expand"))+'</span></li><li data-role="binning" data-binning="undo" class="disabled"><i class="icon icon-undo"></i><span>'+e(d("undo"))+'</span></li><li data-role="binning" data-binning="redo" class="disabled"><i class="icon icon-redo"></i><span>'+e(d("redo"))+'</span></li>\x3c!-- 全选复制  --\x3e<li class="copy" data-role="binning" data-binning="copy"><i class="icon icon-copy-l"></i><span>'+e(d("selectAndCopy"))+'</span></li><li data-role="binning" data-binning="save" class="disabled"><i class="icon icon-save"></i><span>'+e(d("save"))+'</span></li><li data-role="binning" data-binning="rerun" class="disabled"><i class="icon icon-run-o-24"></i><span>'+e(d("reExecute"))+'</span></li></ul><div class="binning-body"><div class="bins-table-container"><div class="bins-table-container-scroll"><div class="bins-table-container-inner"><div class="bins-table"></div><div class="total-table"></div></div></div></div><div class="actions"><div class="custom-binning-actions action-box"><h5 class="action-title">'+e(d("customBinning"))+'</h5><div class="action-body"><div class="custom-binning-block" data-custom-type="number"><div class="custom-binning-group"><div class=""><label title="'+e(d("binBoundariesPlaceholder"))+'" for="custom-binning-boundaries">'+e(d("binBoundaries"))+'</label></div><div class="input-group"><input type="text" class="form-control" id="custom-binning-boundaries" placeholder="'+e(d("binBoundariesPlaceholder"))+'"><span class="input-group-btn"><button data-role="boundaries-button" class="btn btn-default" type="button">'+e(d("add"))+'</button></span></div>\x3c!-- /input-group --\x3e</div><div class="custom-binning-group"><div class=""><label for="custom-binning-start">'+e(d("binStart"))+'</label><label for="custom-binning-stop">'+e(d("binStop"))+'</label><label for="custom-binning-step">'+e(d("step"))+'</label></div><div class="input-group custom-binning-steps"><input type="text" class="form-control" id="custom-binning-start" placeholder=""><input type="text" class="form-control" id="custom-binning-stop" placeholder=""><input type="text" class="form-control" id="custom-binning-step" placeholder=""><span class="input-group-btn"><button data-role="steps-button" class="btn btn-default" type="button">'+e(d("add"))+'</button></span></div>\x3c!-- /input-group --\x3e</div></div><div class="custom-binning-block" data-custom-type="string"><div class="custom-binning-group"><div class=""><label title="'+e(d("newStringBin"))+'" for="custom-binning-boundaries">'+e(d("newBin"))+'</label></div><div class="input-group"><input type="text" class="form-control" id="custom-binning-strings" placeholder="'+e(d("newStringBin"))+'"><span class="input-group-btn"><button data-role="string-bin-button" class="btn btn-default" type="button">'+e(d("add"))+'</button></span></div>\x3c!-- /input-group --\x3e</div></div></div></div></div></div></div><div class="bins-chart"><div class="chart-options"></div><div class="chart-wrap"><div class="chart-content"></div></div></div><div class="json-editor"><div class="editor-header"><h5>'+e(d("editJSON"))+'</h5><i data-role="editor-close" class="icon icon-close-o"></i></div><div class="editor-body"><textarea></textarea></div><div class="editor-footer"><div class="editor-alert" data-role="editor-alert">'+e(d("jsonEditAlert"))+'</div><button data-role="editor-save" type="button" class="btn-primary btn btn-sm ">'+e(d("save"))+'</button><button data-role="editor-close" type="button" class="btn btn-sm">'+e(d("close"))+"</button></div></div></div>"}(b.featureName)}}),define("components/cumulateGroup/common",[],function(){"use strict";return{statusFields:{operator:"const_operator",value:"const_value",isCustomBinning:"isCustomBinning",isModified:"isModified",lastModified:"lastModified",hasConstraint:"hasConstraint"},operatorMap:{ascending:"< bin",descending:"> bin",zero:"= 0",equal:"= bin",ws:"= weight",woe:"woe"}}}),define("components/cumulateGroup/utils",["./common"],function(a){"use strict";function b(a,b){var c,e=d(a),f={};return o.forEach(function(a){f[a]=null}),a.bin.else||(a.bin.else=_.assign({_placeholder:!0,value:[]},f)),a.bin.else.index=-2,a.bin.else._value="ELSE",a.bin.null||(a.bin.null=_.assign({_placeholder:!0},f)),a.bin.null.index=-1,a.bin.null._value="NULL",a.bin.norm||(a.bin.norm=[]),c=a.bin.norm.map(function(a,b){if(a.index=void 0!==a.index?a.index:b,a.id=void 0!==a.id||a.children?a.id:b,a._value=a.value.toString(),!e){var c=a.value.split(",");a.left=c[0].charAt(0),a.lowValue=c[0].slice(1),a.lessThan=c[1].slice(0,-1),a.right=c[1].slice(-1),"-inf"!==a.lowValue&&(a.lowValue=parseFloat(a.lowValue)),"+inf"!==a.lessThan&&(a.lessThan=parseFloat(a.lessThan))}return a}),b?[a.bin.null].concat(c,a.bin.else):c.concat(a.bin.else,a.bin.null)}function c(a,b){b.bin&&(b.bin.norm=a.filter(function(a){return!f(a)}),b.bin.else=a.filter(function(a){return g(a)})[0],b.bin.null=a.filter(function(a){return h(a)})[0],b.binCount=b.bin.norm.length+(b.bin.null&&!b.bin.null._placeholder?1:0)+(b.bin.else&&!b.bin.null._placeholder?1:0))}function d(a){if(a.bin&&a.bin.norm&&a.bin.norm[0]){var b=a.bin.norm[0];if(m(b.value))return!0;if(n(b.value)&&("("===b.value.charAt(0)||"["===b.value.charAt(0)))return!1;new Error("分箱格式不正确...")}else new Error("特征",a.name,"没有分箱信息...")}function e(a){return a.find(function(a){return 0===a.id})}function f(a){return-1===a.index||-2===a.index}function g(a){return-2===a.index}function h(a){return-1===a.index}function i(a,c,d,e){var f=b(a,!0),g=[],h={toolbox:{feature:{restore:{show:!0}}},title:{text:a.name},name:a.name,imageName:a.name,series:[],legend:{data:[],selected:{}},xAxis:[{data:_.pluck(f,"_value")}],yAxis:[{type:"value",splitNumber:5},{type:"value",splitNumber:5}]},i=function(a){if(a.length){return a.reduce(function(a,b){var c=parseFloat(b);return a+(isNaN(c)?0:c)},0)/a.length}return 0},g=c.map(function(a){var b=_.pluck(f,a);return{name:d[a]||a,data:b,avg:i(b)}}),j=g.map(function(a){return a.avg}),k=Math.max.apply(null,j);return g.forEach(function(a){var b=e.some(function(b){if(b.checked&&b.name===a.name)return!0});h.series.push({name:a.name,data:a.data,type:b?"bar":"line",yAxisIndex:k/a.avg<10?0:1}),h.legend.data.push(a.name)}),h}function j(a,c){var d,f,g=[],h=[],i=[],j=a[0];a.forEach(function(a){var c=b(a,!0);g.push(c)});var l={toolbox:{feature:{restore:{show:!0}}},name:j.name,imageName:j.name,legend:{data:[],selected:{}},xAxis:[{data:_.pluck(k(g),"_value")}],yAxis:[{},{type:"value",scale:!0}]};return g.forEach(function(a,b){var d=c[b],e=[{name:"Positive ("+d+")",data:_.pluck(a,"p"),type:"bar",stack:d,yAxisIndex:1},{name:"Negative ("+d+")",data:_.pluck(a,"n"),type:"bar",stack:d,yAxisIndex:1},{name:"IV ("+d+")",data:_.pluck(a,"iv"),type:"line",yAxisIndex:0},{name:"WOE ("+d+")",data:_.pluck(a,"woe"),type:"line",yAxisIndex:0}],f=[{name:"Total ("+d+")",data:_.pluck(a,"total"),type:"bar"}];h=h.concat(e),i=i.concat(f)}),d=e(g[0]),f=d&&void 0===d.p,l.series=f?i:h,l.legend.data=_.pluck(l.series,"name"),f?l.legend.data.forEach(function(a){l.legend.selected[a]=!0}):l.legend.data.reverse().forEach(function(a){var b=!1;0===a.indexOf("WOE")&&(b=!0),l.legend.selected[a]=b}),l}function k(a){for(var b=a[0],c=1,d=a.length;c<d;c++)b.length<a[c].length&&(b=a[c]);return b}function l(a){return["iv","n","nrateOfTotal","p","prate","prateOfTotal","total","totalRate","totalRate","woe"].forEach(function(b){a[b]&&(a[b]=void 0)}),a}var m=(a.statusFields,a.operatorMap,_.isArray),n=_.isString,o=["SUM_WEIGHT","A","B","A_SUM_B","A_SUB_B","A_MUL_B","A_DIV_B","A_COUNT","B_COUNT","AB_COUNT","COUNT"];return{metricsProps:o,parseFeatureForCumulateGroupChart:i,parsefeatureListForChart:j,isEnumerable:d,featureToBins:b,binsToFeature:c,isElseOrNullBin:f,isElse:g,isNull:h,clearBin:l}}),define("components/cumulateGroup/CustomBinning",["zero/declare","zero/ui/DialogSingleInput","../../i18n","../../global/utils","./utils","./common"],function(a,b,c,d,e,f){"use strict";var g={actionsBox:".custom-binning-actions",numberType:'[data-custom-type="number"]',stringType:'[data-custom-type="string"]',stringBinButton:'[data-role="string-bin-button"]',boundariesButton:'[data-role="boundaries-button"]',stepsButton:'[data-role="steps-button"]',stringsInput:"#custom-binning-strings",boundariesInput:"#custom-binning-boundaries",startInput:"#custom-binning-start",stopInput:"#custom-binning-stop",stepInput:"#custom-binning-step"},h=f.statusFields,i=c.translate;return a("binning/CustomBinning",[],{constructor:function(a){var b=this.$container=a.$container;this.parent=a.parent,this.binsTable=a.binsTable,this.stack=a.stack,this.$actionsBox=b.find(g.actionsBox),this.$numberType=b.find(g.numberType),this.$stringType=b.find(g.stringType),this.$stringsInput=b.find(g.stringsInput),this.$boundariesInput=b.find(g.boundariesInput),this.$startInput=b.find(g.startInput),this.$stopInput=b.find(g.stopInput),this.$stepInput=b.find(g.stepInput),this.dispatchCustomBinning(),this.bindEvents()},dispatchCustomBinning:function(){var a=this;"string"===a.parent.currentFeature.type?a.switchToString():a.switchToNumber()},switchToString:function(){this.$numberType.hide(),this.$stringType.show()},switchToNumber:function(){this.$numberType.show(),this.$stringType.hide()},bindEvents:function(){var a=this,b=a.$container;b.on("click.customBinning",g.boundariesButton,a.onBoundaries.bind(a)),b.on("click.customBinning",g.stepsButton,a.onSteps.bind(a)),b.on("click.customBinning",g.stringBinButton,a.onStringBins.bind(a))},onBoundaries:function(){var a,b,c=this,d=c.$boundariesInput.val();if(a=c.string2Array(d),void 0===(a=c.getValidBoundaries(a)))return void alert(i("customBinningAlert",i("binBoundaries")));b=c.getNewNumberBins(a),c.update(b)},onSteps:function(){var a,b,c=this,e=[],f=parseFloat(c.$startInput.val()),g=parseFloat(c.$stopInput.val()),h=parseFloat(c.$stepInput.val());if(!c.isNumber(f))return void alert(i("customBinningAlert",i("binStart")));if(!c.isNumber(g))return void alert(i("customBinningAlert",i("stopStart")));if(!c.isNumber(h))return void alert(i("customBinningAlert",i("step")));for(e=e.concat(f),a=f;a<g;)a=d.accAdd(a,h),e.push(a);e.pop(),e=e.concat(g),b=c.getNewNumberBins(e),c.update(b)},onStringBins:function(){var a,b,c=this;a=[c.$stringsInput.val()],b=c.getNewStringBins(a),c.update(b)},getNewStringBins:function(a){var b=this,c=b.parent.currentFeature.bin.norm||[],d=c.slice(0);return a.forEach(function(a){if(""!==a){var b=!1;c.forEach(function(c){c.value&&-1!==c.value.indexOf(a)&&(b=!0)}),b||d.push(a)}}),d.map(function(a,b){return{id:b,index:b,value:a.value||[a]}})},getNewNumberBins:function(a){var b,c,d,e,f,g=this,h=[],i=g.parent.currentFeature.bin.norm||[];for(c=0,d=i.length;c<d;c++)e=i[c],b="-inf"===e.lowValue?-1/0:parseFloat(e.lowValue),h.push(b),"+inf"===e.lessThan&&h.push(1/0);return h=h.concat(a),h=_.sortBy(h),h=_.uniq(h),f=g.generateNewNumberBins(h),g.mergeConstraintInfo(f,i),f},generateNewNumberBins:function(a){var b,c,d,e=this,f=e.parent,g=[],h=a.length;for(a[0]===-1/0&&(a[0]="-inf"),a[h-1]===1/0&&(a[h-1]="+inf"),b=0;b<h-1;b++)c=a[b],d=a[b+1],g.push({id:b,index:b,value:f.getLeftOperator(c)+c+","+d+f.getRightOperator(d),lowValue:c,lessThan:d});return g},mergeConstraintInfo:function(a,b){var c,d,e,f,g,i;for(c=0,d=b.length;c<d;c++)for(g=b[c],e=c,f=a.length;e<f;e++)i=a[e],i.lowValue===g.lowValue&&i.lessThan===g.lessThan&&(i[h.operator]=g[h.operator],i[h.value]=g[h.value])},string2Array:function(a){return a=a.replace(/[,，、]\s*/g," "),a.split(" ")},getValidBoundaries:function(a){var b,c,d,e=this,f=[];for(b=0,c=a.length;b<c&&""!==(d=a[b]);b++){if(d=parseFloat(d),!e.isNumber(d))return;f.push(d)}return f},isNumber:function(a){return!isNaN(a)&&isFinite(a)},update:function(a){var b=this,c=b.parent,d=[].concat(a,e.clearBin(c.currentFeature.bin.else),e.clearBin(c.currentFeature.bin.null));b.binsTable.update(d,!0),c.currentBins=d,c.currentFeature[h.isCustomBinning]=!0,c.saveStack()},destroy:function(){this.$container.off(".customBinning")}})}),define("components/cumulateGroup/singleBinMetricsFormula",[],function(){"use strict";function a(a){return"-"!==a.COUNT&&a.COUNT?parseFloat(a.SUM_WEIGHT.toFixed(o)):"-"}function b(a){return 0===a.A_COUNT||null===a.A?"-":parseFloat((a.A/a.A_COUNT).toFixed(o))}function c(a){return 0===a.B_COUNT||null===a.B?"-":parseFloat((a.B/a.B_COUNT).toFixed(o))}function d(a){return 0===a.AB_COUNT||null===a.A_SUM_B?"-":parseFloat((a.A_SUM_B/a.AB_COUNT).toFixed(o))}function e(a){return 0===a.AB_COUNT||null===a.A_SUB_B?"-":parseFloat((a.A_SUB_B/a.AB_COUNT).toFixed(o))}function f(a){return 0===a.AB_COUNT||null===a.A_MUL_B?"-":parseFloat((a.A_MUL_B/a.AB_COUNT).toFixed(o))}function g(a){return 0===a.AB_COUNT||null===a.A_DIV_B?"-":parseFloat((a.A_DIV_B/a.AB_COUNT).toFixed(o))}function h(a){return null===a.A?"-":parseFloat(a.A.toFixed(4))}function i(a){return null===a.B?"-":parseFloat(a.B.toFixed(o))}function j(a){return null!==a.A&&null!==a.B&&a.COUNT&&"-"!==a.COUNT?parseFloat(((a.A||0)+(a.B||0)).toFixed(o)):"-"}function k(a){return null!==a.A&&null!==a.B&&a.COUNT&&"-"!==a.COUNT?parseFloat(((a.A||0)-(a.B||0)).toFixed(o)):"-"}function l(a){return null!==a.A&&null!==a.B&&a.COUNT&&"-"!==a.COUNT?parseFloat(((a.A||0)*(a.B||0)).toFixed(o)):"-"}function m(a){return null!==a.A&&null!==a.B&&a.COUNT&&"-"!==a.COUNT?parseFloat(((a.A||0)/(a.B||0)).toFixed(4)):"-"}function n(a){return a.COUNT}var o=4;return{"sum(weight)":a,"avg(A)":b,"avg(B)":c,"avg(A+B)":d,"avg(A-B)":e,"avg(A*B)":f,"avg(A/B)":g,"sum(A)":h,"sum(B)":i,"sum(A)+sum(B)":j,"sum(A)-sum(B)":k,"sum(A)*sum(B)":l,"sum(A)/sum(B)":m,count:n}}),define("components/cumulateGroup/multiBinsMetricsFormula",[],function(){"use strict";function a(a,b){return parseFloat(a.total_SUM_WEIGHT.toFixed(o))}function b(a,b){return 0===a.total_A_COUNT||null===a.total_A?"-":parseFloat((a.total_A/a.total_A_COUNT).toFixed(o))}function c(a,b){return 0===a.total_B_COUNT||null===a.total_B?"-":parseFloat((a.total_B/a.total_B_COUNT).toFixed(o))}function d(a,b){return 0===a.total_AB_COUNT||null===a.total_A_SUM_B?"-":parseFloat((a.total_A_SUM_B/a.total_AB_COUNT).toFixed(o))}function e(a,b){return 0===a.total_AB_COUNT||null===a.total_A_SUB_B?"-":parseFloat((a.total_A_SUB_B/a.total_AB_COUNT).toFixed(o))}function f(a,b){return 0===a.total_AB_COUNT||null===a.total_A_MUL_B?"-":parseFloat((a.total_A_MUL_B/a.total_AB_COUNT).toFixed(o))}function g(a,b){return 0===a.total_AB_COUNT||null===a.total_A_DIV_B?"-":parseFloat((a.total_A_DIV_B/a.total_AB_COUNT).toFixed(o))}function h(a,b){return null===a.total_A?"-":parseFloat(a.total_A.toFixed(o))}function i(a,b){return null===a.total_B?"-":parseFloat(a.total_B.toFixed(o))}function j(a,b){var c=0;return b.forEach(function(a){c+=a.SUM_AB||0}),parseFloat(c.toFixed(o))}function k(a,b){var c=0;return b.forEach(function(a){c+=a.SUB_AB||0}),parseFloat(c.toFixed(o))}function l(a,b){return null===a.total_A||null===a.total_B?"-":parseFloat((a.total_A*a.total_B).toFixed(o))}function m(a,b){return null===a.total_A||null===a.total_B||0===a.total_B?"-":parseFloat((a.total_A/a.total_B).toFixed(o))}function n(a,b){return a.total_COUNT}var o=4;return{"sum(weight)":a,"avg(A)":b,"avg(B)":c,"avg(A+B)":d,"avg(A-B)":e,"avg(A*B)":f,"avg(A/B)":g,"sum(A)":h,"sum(B)":i,"sum(A)+sum(B)":j,"sum(A)-sum(B)":k,"sum(A)*sum(B)":l,"sum(A)/sum(B)":m,count:n}}),define("components/cumulateGroup/metricsFormula",["./singleBinMetricsFormula","./multiBinsMetricsFormula","./utils"],function(a,b,c){"use strict";function d(a){a.forEach(function(a){e(a)})}function e(a){0===a.COUNT&&(a.A_COUNT=a.B_COUNT=a.AB_COUNT=0),0===a.A_COUNT&&(a.A=a.A_SUM_B=a.A_SUB_B=a.A_MUL_B=a.A_DIV_B=null,a.AB_COUNT=0),0===a.B_COUNT&&(a.B=a.A_SUM_B=a.A_SUB_B=a.A_MUL_B=a.A_DIV_B=null,a.AB_COUNT=0),0===a.AB_COUNT&&(a.A_SUM_B=a.A_SUB_B=a.A_MUL_B=a.A_DIV_B=null)}function f(b,c){return a[b](c)}function g(a,c){var d=h(c,"total_"),e=j(c);return b[a](d,e)}function h(a,b){var d={},e=b||"";return c.metricsProps.forEach(function(a){d[e+a]=null}),a.forEach(function(a){c.metricsProps.forEach(function(b){null!=a[b]&&(null===d[e+b]?d[e+b]=a[b]:d[e+b]+=a[b])})}),d}function i(a){return h(a)}function j(a){return a.map(function(a){return null===a.A||null===a.B?{SUM_AB:null,SUB_AB:null,MUL_AB:null,DIV_AB:null}:{SUM_AB:parseFloat((a.A+a.B).toFixed(k)),SUB_AB:parseFloat((a.A-a.B).toFixed(k)),MUL_AB:parseFloat((a.A*a.B).toFixed(k)),DIV_AB:parseFloat((a.A/a.B).toFixed(k))}})}var k=4;return{preprocessingBins:d,singleBinMetricsCalculate:f,multiBinsMetricsCalculate:g,countBinsMetaData:i}}),define("components/cumulateGroup/Detail",["zero/declare","zero/ui/datatable/plugins/Resizer","zero/ui/datatable/editors/Text","zero/ui/datatable/editors/Dropdown","zero/ui/DataTable","zero/ui/Undo","zero/ui/Tab","../../global/utils","../../i18n","../../charts/bar","../../midway/components/cumulateGroup/legendList","../../midway/components/cumulateGroup/detail","./CustomBinning","./common","./utils","./metricsFormula"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q={ATTR_COPY:"data-clipboard-text"},r={binsTable:".bins-table",totalTable:".total-table",binning:'[data-role="binning"]',selectAll:'[data-binning="selectAll"]',unselectAll:'[data-binning="unselectAll"]',collapse:'[data-binning="collapse"]',expand:'[data-binning="expand"]',merge:'[data-binning="merge"]',split:'[data-binning="split"]',down:'[data-binning="down"]',up:'[data-binning="up"]',undo:'[data-binning="undo"]',redo:'[data-binning="redo"]',edit:'[data-binning="edit"]',save:'[data-binning="save"]',rerun:'[data-binning="rerun"]',export:'[data-binning="export"]',tabSelector:".nav-tabs li",container:".bins-chart",selectAndCopy:".copy"},s={active:"active",disabled:"disabled",animated:"animated",flash:"flash"},t=_.cloneDeep,u=i.translate,v=n.statusFields;return a("binning/Detail",[],{constructor:function(a){var b,c,d=this,e=a.feature,h=a.$wrapper;b=l({featureName:e.name}),c=d.$container=$(b).appendTo(h),d.isLeftOpen=e.isLeftOpen,void 0===d.isLeftOpen&&(d.isLeftOpen=!0),d.tab=new g({selector:c.find(r.tabSelector),activeClassName:s.active,afterShow:function(a){1!==a||d.chartRendered||(d.chartRendered=!0,d.renderChart())}}),d.$binsTable=c.find(r.binsTable),d.$totalTable=c.find(r.totalTable),d.$binning=c.find(r.binning),d.$selectAll=c.find(r.selectAll),d.$unselectAll=c.find(r.unselectAll),d.$collapse=c.find(r.collapse),d.$expand=c.find(r.expand),d.$merge=c.find(r.merge),d.$split=c.find(r.split),d.$down=c.find(r.down),d.$up=c.find(r.up),d.$undo=c.find(r.undo),d.$redo=c.find(r.redo),d.$save=c.find(r.save),d.$rerun=c.find(r.rerun),d.$export=c.find(r.export),d.$chart=c.find(r.container),d.parent=a.parent,d.nodeData=a.nodeData,d.currentFeature=e,d.selectedMetrics=a.selectedMetrics,d.selectedMetricsNameMap=a.selectedMetricsNameMap,d.isEnum=o.isEnumerable(e),d.currentBins=o.featureToBins(e),p.preprocessingBins(d.currentBins),d.clearSelect(d.currentBins),d.tableOptions=d.getTableOptions(d.selectedMetrics,d.selectedMetricsNameMap),d.stack=new f,d.initActions(),d.renderBinsTable(),d.renderTotalTable(),d.saveTrack(),d.bindEvents(),d.customBinning=new m({$container:c,binsTable:d.binsTable,stack:d.stack,currentFeature:d.currentFeature,parent:d})},getTableOptions:function(a,b){var c={theme:"small",tree:!0,line:!0,grid:!0,resizable:!0,crossHover:!1,multiSelect:!0,defaultsort:!0,cols:[{title:"Index",field:"index",sort:!0,width:65},{title:"Label",field:"value",sort:!0,width:90,parse:function(a,b){var c=a;return-2===b.index?c="ELSE":-1===b.index&&(c="NULL"),c}}]};return a.forEach(function(a){c.cols.push({title:b[a]||a,field:a,sort:!0,width:120})}),c},show:function(){this.$container.show()},hide:function(){this.$container.hide()},initActions:function(){var a=this;a.$selectAll.show(),a.$unselectAll.hide(),a.$expand.show(),a.$collapse.hide()},clearSelect:function(a){a.forEach(function(a){a[e.status_props.isSelected]=!1})},renderBinsTable:function(){var a=this,b=a.preParseData(a.currentBins,a.selectedMetrics),c=a.getTableWidth(a.tableOptions),d={container:a.$binsTable,data:b,height:"calc(100% - 60px)",selectable:function(a){return!a.level}};d=$.extend({},this.tableOptions,d),a.binsTable=new e(d),a.binsTable.$dataTable.css("width",c)},getTableWidth:function(a){var b=50;return a.cols.forEach(function(a){b+=parseInt(a.width,10)}),b>950?b:950},preParseData:function(a,b){return a.map(function(a){var c={};return b.forEach(function(b){var d=p.singleBinMetricsCalculate(b,a);c[b]=isNaN(d)?"-":d}),_.extend(a,c)})},renderTotalTable:function(){var a=this,b=a.getTableWidth(a.tableOptions),c={container:a.$totalTable,data:[a.getTotal(a.currentBins)],headless:!0,selectable:function(){return!1},cols:[{},{},{title:"Operator",type:""},{title:"Value",type:""}]};c=$.extend(!0,{},a.tableOptions,c),a.totalTable=new e(c),a.totalTable.$dataTable.css("width",b)},renderChart:function(){var a=this,b=o.parseFeatureForCumulateGroupChart(a.currentFeature,a.selectedMetrics,a.selectedMetricsNameMap,a.barItems||[]);a.barItems||(a.barItems=b.series.map(function(a){return{name:a.name,checked:"line"!==a.type}})),a.$chart.find(".chart-options").html(k({items:a.barItems})).off().on("click","input",function(){var b=$(this),c=b.attr("data-name"),d=b.prop("checked");a.barItems.some(function(a){if(a.name===c)return a.checked=d,!0}),a.renderChart()});try{a.chart?a.chart.echart.setOption(b):($.extend(b,{element:a.$chart.find(".chart-content")}),a.chart=new j(b))}catch(a){console.error&&console.error(a)}},bindEvents:function(){var a=this,b=a.$container;a.stack.on("execute",a.onFeatureChange.bind(a)).on("undo",a.onFeatureChange.bind(a)).on("redo",a.onFeatureChange.bind(a)),a.binsTable.on("rowSelect",a.onRowSelect.bind(a)).on("updated",a.onBinsTableUpdate.bind(a)).on("collapse",a.onBinsTableCollapse.bind(a)),b.on("click.detail",r.binning,a.onBinning.bind(a)).on("click",r.selectAndCopy,a.onCopy.bind(a))},onCopy:function(a){var b=this,c=b.binsTable,d=$(a.currentTarget);c.selectAll();var e=c.getSelectedTsvRows();d.attr(q.ATTR_COPY,e),c.selectCopy(r.selectAndCopy,q.ATTR_COPY)},onRowSelect:function(a){var b,c,d,e=this,f=a.selectedData,g=f.length;e.mergeButtonDisabledCheck(),g>0&&(b=f[0]&&f[0].index,c=f[g-1]&&f[g-1].index,d=e.binsTable.getTableData(),e.moveButtonDisableCheck(b,c,d))},onBinsTableUpdate:function(){var a=this,b=a.binsTable;a.currentBins=b.getTableData(),a.totalTable.update([a.getTotal(a.currentBins)])},onBinsTableCollapse:function(){this.saveStack()},saveStack:function(){var a=this;return a.currentBins=a.binsTable.getTableData(),a.saveTrack(),a.currentBins},getTotal:function(a){var b=this;return _.assign(b.getMultiBinsMetrics(a),{index:"Total"})},getFirstNormBin:function(a){return a.find(function(a){return 0===a.id})},saveTrack:function(){
var a=this;a.stack.execute({currentBins:t(a.currentBins),currentFeature:t(a.currentFeature)})},updateBinsTable:function(a){var b=this;b.binsTable.update(a||b.currentBins,!0)},onBinning:function(a){var b=this,c=$(a.currentTarget).data("binning"),d=$(a.currentTarget);b["on"+h.ucFirst(c)](d)},onMerge:function(){var a=this,b=a.binsTable.getSelectedRows(),c=!1,d=[];b.length<2||(b=b.filter(function(a){return!o.isElseOrNullBin(a)}),a.isEnum?a.currentBins=a.mergeData(a.currentBins,b):(b=a.splitArray(b,"index"),b.reverse().forEach(function(b){b.length>1?a.currentBins=a.mergeData(a.currentBins,b):(c=!0,d.push(b[0].id))})),a.indicesMap={},a.reIndex(a.currentBins),c?d.forEach(function(b,c){a.$binsTable.find('[data-id="'+b+'"]').removeClass(s.active).addClass(s.animated).addClass(s.flash).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oAnimationEnd oanimationend animationend",function(){$(this).removeClass(s.animated).removeClass(s.flash),0===c&&(a.updateBinsTable(),a.saveTrack())})}):(a.updateBinsTable(),a.saveTrack()))},onSplit:function(){var a=this,b=a.binsTable.getSelectedRows();b.length<1||!a.hasChildRow(b)||(a.currentBins=a.splitData(a.currentBins,b),a.indicesMap={},a.reIndex(a.currentBins),a.updateBinsTable(),a.saveTrack())},onDown:function(a){var b,c=this,d=c.binsTable.getSelectedRows(),e=d.length,f=d[0].index,g=d[e-1].index,h=c.binsTable.getTableData();if(0!==e&&!a.hasClass(s.disabled)){if(g<0)return void alert(u("notSupportMove"));h[g+1].index=h[g+1].index-e,d.forEach(function(a){a.index++}),b=h.slice(0,-2),b=_.sortBy(b,"index"),h=b.concat(h.slice(-2)),c.updateBinsTable(h),c.saveStack(),c.moveButtonDisableCheck(f+1,g+1,h)}},onUp:function(a){var b,c=this,d=c.binsTable.getSelectedRows(),e=d.length,f=d[0].index,g=d[e-1].index,h=c.binsTable.getTableData();if(0!==e&&!a.hasClass(s.disabled)){if(g<0)return void alert(u("notSupportMove"));h[f-1].index=h[f-1].index+e,d.forEach(function(a){a.index--}),b=h.slice(0,-2),b=_.sortBy(b,"index"),h=b.concat(h.slice(-2)),c.updateBinsTable(h),c.saveStack(),c.moveButtonDisableCheck(f-1,g-1,h)}},onSelectAll:function(){this.binsTable.selectAll(),this.$selectAll.hide(),this.$unselectAll.show()},onUnselectAll:function(){this.binsTable.unselectAll(),this.$selectAll.show(),this.$unselectAll.hide()},onCollapse:function(){this.binsTable.collapseAll(),this.$collapse.hide(),this.$expand.show()},onExpand:function(){this.binsTable.expandAll(),this.$collapse.show(),this.$expand.hide()},onUndo:function(){var a=this,b=a.stack;b.canUndo()&&(b.undo(),a.updateBinsTable())},onRedo:function(){var a=this,b=a.stack;b.canRedo()&&(b.redo(),a.updateBinsTable())},onSave:function(a){var b=this,c=b.parent;!a.hasClass(s.disabled)&&b.binsTable.validate()&&(b.update(),c.save().then(function(c){b.currentFeature[v.isModified]=!1,a.toggleClass(s.disabled,c)}))},onRerun:function(a){var b=this,c=b.parent;a.hasClass(s.disabled)||(b.update(),c.rerun())},update:function(){this.updateFeatures(),this.renderChart()},updateDetailPanel:function(a){var b=this;b.currentFeature=a,b.$save.toggleClass(s.disabled,!a[v.isModified])},updateFeatures:function(){var a=this,b=a.currentBins,c=a.parent.featuresData,d=a.currentFeature;d.bin&&o.binsToFeature(b,d),c.forEach(function(a,b){if(a.name===d.name)return c[b]=d,!0})},hasChildRow:function(a){var b=!1;return a.forEach(function(a){if(a.children)return void(b=!0)}),b},mergeData:function(a,b){var c,d,f,g,h=this;c=b.map(function(a){return a.index}),b=b.map(function(a){return a[e.status_props.isSelected]=void 0,a}),d=h.createNewRow(b);for(var i=0,j=a.length;i<j;i++)if(a[i].index===b[0].index){f=i;break}return g=a.filter(function(a){return-1===c.indexOf(a.index)}),d.children=h.flatten(b),h.collapseRow(d),g=g.slice(0,f).concat(d,g.slice(f))},collapseRow:function(a){a&&(a[e.status_props.isCollapsed]=!0,a.children&&a.children.forEach(function(a){a[e.status_props.isHide]=!0}))},splitData:function(a,b){var c,d;for(c=b.length-1;c>=0;c--)d=b[c],d.children&&(a=a.slice(0,d.index).concat(d.children,a.slice(d.index+1)),d.children.forEach(function(a){a[e.status_props.isHide]=void 0}));return a},getMultiBinsMetrics:function(a){var b=this,c={};return b.selectedMetrics.forEach(function(b){c[b]=p.multiBinsMetricsCalculate(b,a)}),c},createNewRow:function(a){var b=this,c=a.length-1,d="",e=[];return a.forEach(function(a){b.isEnum&&(e=e.concat(a.value))}),d=b.isEnum?e:b.getLeftOperator(a[0].lowValue)+a[0].lowValue+","+a[c].lessThan+b.getRightOperator(a[c].lessThan),_.assign({index:a[0].index,value:d,_value:d,lowValue:a[0].lowValue,lessThan:a[c].lessThan},b.getMultiBinsMetrics(a),p.countBinsMetaData(a))},getLeftOperator:function(a){return"-inf"===a?"(":this.isLeftOpen?"(":"["},getRightOperator:function(a){return"+inf"===a?")":this.isLeftOpen?"]":")"},reIndex:function(a,b){var c,d=this,e=0,f=d.indicesMap;a.forEach(function(a,g){o.isElseOrNullBin(a)?(e++,f[a.index]=a.index):(c=a.index,a.index=void 0!==b?b+"."+(g-e):g-e,f[c]=a.index),a.children&&d.reIndex(a.children,a.index)})},flatten:function(a){var b=[];return a.forEach(function(a){a.children&&(b=b.concat(a.children),a.children=void 0,a.out=!0)}),b=a.concat(b),b=b.filter(function(a){return void 0===a.out}).sort(function(a,b){return a.id>b.id})},splitArray:function(a,b){if(!a||!a.length)return[];var c=[],d=[],e=a[0][b]-1;return a.forEach(function(a){a[b]===e+1?d.push(a):(c.push(d),d=[a]),e=a[b]}),c.push(d),c},onFeatureChange:function(a){var b,c,d=this,e=d.stack,f=e.canRedo(),g=e.canUndo();d.currentBins=a.currentBins,b=d.currentFeature=a.currentFeature,c=b[v.isCustomBinning],b[v.isModified]=g,b[v.lastModified]=g?(new Date).toLocaleString():"",d.$undo.toggleClass(s.disabled,!g),d.$save.toggleClass(s.disabled,!g),d.$redo.toggleClass(s.disabled,!f),d.$rerun.toggleClass(s.disabled,!c),d.update()},mergeButtonDisabledCheck:function(){var a=this,b=a.binsTable,c=b.getSelectedRows();c.length>1?a.$merge.removeClass(s.disabled):a.$merge.addClass(s.disabled),c.length>0&&a.hasChildRow(c)?a.$split.removeClass(s.disabled):a.$split.addClass(s.disabled)},moveButtonDisableCheck:function(a,b,c){var d=this;d.$up.removeClass(s.disabled),d.$down.removeClass(s.disabled),b===c.length-3&&d.$down.addClass(s.disabled),0===a&&d.$up.addClass(s.disabled)},destroy:function(){var a=this,b=a.binsTable,c=a.totalTable,d=a.tab,e=a.chart,f=a.customBinning;a.$container.off(".detail"),d&&(d.destroy&&d.destroy(),d=null),f&&(f.destroy(),f=null),b&&(b.destroy(),b=null),c&&(c.destroy(),c=null),e&&(e.destroy(),e=null)}})}),define("components/cumulateGroup/Features",["zero/declare","zero/ui/datatable/plugins/Resizer","zero/ui/DataTable","zero/ui/DialogEx","../../i18n","../../global/utils","./Detail","./common"],function(a,b,c,d,e,f,g,h){"use strict";var i=e.translate,j=h.statusFields,k={ATTR_COPY:"data-clipboard-text"},l={crossHover:!1,grid:!0,resizable:!0,defaultsort:!0,height:"calc(100% - 40px)",cols:[{field:"name",title:i("name"),width:210,sort:!0},{field:"type",title:i("type"),width:190,sort:!0},{field:"binCount",title:i("bins"),width:150,sort:!0},{field:j.isModified,title:i("editStatus"),width:155,sort:!0,parse:function(a,b){return b[j.isModified]?i("modifying"):""}},{field:j.lastModified,title:i("lastModified"),width:220,sort:!0}],showActions:!0,actions:[{key:"detail",name:i("detail")}]},m={tr:'[data-role="tbody"] tr',detail:'[data-key="detail"]',binning:'[data-role="binning"]',save:'[data-binning="save"]',rerun:'[data-binning="rerun"]',export:'[data-binning="export"]',exportReport:'[data-binning="exportReport"]',selectAndCopy:".copy",details:".binning-details"},n={disabled:"disabled"};return a("binning/Features",[],{constructor:function(a){var b=this,d=b.tableConfig=$.extend({},a.tableOptions,l);b.parent=a.parent,b.$container=a.container,b.table=new c(d),b.$save=b.$container.find(m.save),b.$rerun=b.$container.find(m.rerun),b.$export=b.$container.find(m.export),b.exportReport=b.$container.find(m.exportReport),b.$details=b.$container.find(m.details),b.bindEvents(),b.dialog=a.dialog},bindEvents:function(){var a=this;a.$container.on("dblclick.features",m.tr,a.onRowDblClick.bind(a)).on("click.features",m.binning,a.onBinning.bind(a)).on("click",m.selectAndCopy,a.onCopy.bind(a))},onCopy:function(a){var b=this,c=b.table,d=$(a.currentTarget);c.selectAll();var e=c.getSelectedTsvRows();d.attr(k.ATTR_COPY,e),c.selectCopy(m.selectAndCopy,k.ATTR_COPY)},onRowDblClick:function(a){var b=$(a.currentTarget);b.data("row")[c.status_props.isSelected]=!0,b.find(m.detail).trigger("click")},onBinning:function(a){var b=this,c=$(a.currentTarget),d=c.data("binning");b["on"+f.ucFirst(d)](c)},onSave:function(a){var b=this,c=b.parent;a.hasClass(n.disabled)||c.save()},update:function(a,b){var d=this,e=d.tableConfig;e.data=a,e.status=b,d.table=new c(e),d.$save.toggleClass(n.disabled,!d.parent.checkModified()),d.$rerun.toggleClass(n.disabled,!d.parent.checkCustomBinning())},destroy:function(){this.$container.off(".features"),this.table.destroy()}})}),define("midway/components/cumulateGroup/cumulateGroup",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert"><span>'+e(d("needRecoverTip"))+'</span><button type="button" class="btn btn-primary" data-role="recover">'+e(d("recover"))+'</button></div><span class="label label-success" data-note="saveSucceed">'+e(d("saveSucceed"))+'</span><span class="label label-danger" data-note="danger">'+e(d("saveFailed"))+'</span><div class="binning-list"><ul class="binning-actions">\x3c!-- 全选复制  --\x3e<li class="copy" data-role="binning" data-binning="copy"><i class="icon icon-copy-l"></i><span>'+e(d("selectAndCopy"))+'</span></li><li data-role="binning" data-binning="save" class="disabled"><i class="icon icon-save"></i><span>'+e(d("saveBatch"))+'</span></li></ul><div class="feature-table"></div></div><div class="binning-details"></div>'}()}}),define("components/cumulateGroup/BatchOperator",["zero/zero","zero/declare","zero/ui/Undo","zero/ui/DialogSingleInput","../../i18n","../common/binningUtil","./common","./utils"],function(a,b,c,d,e,f,g,h){var i=e.translate,j={quickWoe:".j-quick-woe",quickWoeLi:'.j-quick-woe [data-role="constraint"]',save:'[data-binning="save"]'},k=g.statusFields,l=g.operatorMap;return b("binning/BatchOperator",{constructor:function(a){this.context=a.context,this.binTable=a.binTable,this.selectedFeatures=[],this.undo=new c,this.events()},events:function(){var a=this;a.binTable.on("rowSelect",function(b){var c=a.binTable.getSelectedRows(),d=c.length;a.selectedFeatures=b.selectedData,$(j.quickWoe)[d>0?"removeClass":"addClass"]("disabled")}),$(j.quickWoeLi).off("click.liBatchOperator").on("click.liBatchOperator",function(b){var c=$(this).data("type"),e=a.binTable.getTableData(),f=a.binTable.getSelectedRows(),g=a.binTable.getSelectedRowsIndex(),h=a.getDetailFeatures(f);if("ws"===c.toLowerCase())return void new d({backdrop:!1,title:i("SlapOnWeight"),placeholder:i("PleaseEnterAWeight"),callback:function(b){a.updateFeature(e,h,c,g,b),a.binTable.update(e,a.binTable.getStatus())}});a.updateFeature(e,h,c,g),a.binTable.update(e,a.binTable.getStatus())})},getDetailFeatures:function(a){for(var b=[],c=0;c<a.length;c++)b.push(h.featureToBins(a[c]));return b},updateFeature:function(a,b,c,d,e){for(var f,g,i,m=this,n=0;n<=b.length-1;n++){f=b[n];for(var o=d[n]-1,p=0;p<=f.length-1;p++){var q=p+1;q===f.length&&(q=0),f[p][k.operator]=l[c],f[p][k.value]=void 0!==e?e:f[q].index,g=""!==f[p][k.operator]&&void 0!==f[p][k.operator],a[o][k.hasConstraint]=g,a[o][k.isModified]=g,a[o][k.lastModified]=g?(new Date).toLocaleString():"",i=h.getConstraintFromFeature(a[o],f),m.updateConstraint(a[o].name,i)}}$(j.save).toggleClass("disabled",!g)},updateConstraint:function(a,b){var c=this.context.constraintData.filter(function(b){return b.name!==a});this.context.constraintData=c.concat(b)}})}),define("dialog/cumulateGroup",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Message","zero/ui/Confirm","../i18n","../components/cumulateGroup/Features","../components/cumulateGroup/Detail","../midway/components/cumulateGroup/cumulateGroup","../ajax/model","../global/download","../global/utils","../components/cumulateGroup/utils","../workspace/statusTicker","../components/cumulateGroup/common","../components/common/WoePreviewDialog","../components/common/binningUtil","../components/cumulateGroup/BatchOperator"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";var s,t="-binning.txt",u="binningExport.txt",v={dialogBody:".modal-body",binningList:".binning-list",binslist:".bins-list",featureTable:".feature-table",details:".binning-details",back:".back",prevDetail:'[data-role="prev-detail"]',nextDetail:'[data-role="next-detail"]',copy:".copy",title:".modal-title",warning:".alert-warning",labelSuccess:'[data-note="saveSucceed"]',labelFailed:".label-danger",loading:".modal-loading",recover:'[data-role="recover"]',saveWoe:".j-save-woe",quickWoe:".j-quick-woe"},w={dialog:"binning-dialog",active:"active",splitScreen:"split-screen",disabled:"disabled"},x=o.statusFields,y=f.translate,z=_.cloneDeep,A=b("dialog/CumulateGroup",[],{constructor:function(){},show:function(a){var b,d=this;d.nodeData=a,d.detailInstances={},b=d.dialog=new c({canFullscreen:!0,destroyOnHide:!0,title:y("binning"),body:i(),className:w.dialog,beforeHide:d.onBeforeHide.bind(d),afterShow:d.onAfterShow.bind(d),buttons:[{text:y("close"),click:function(){b.hide()}}]}).on("fullScreen",d.fullScreen.bind(d))},fullScreen:function(a){},onBeforeHide:function(){var a=this,b=a.dialog,c=a.features,d=a.detailInstances;if(!b.forceClose&&a.checkModified())return e({title:y("close"),body:y("hasNotSaved"),onAccept:function(){b.forceClose=!0,b.hide()}}),!1;if(d){for(var f in d)d[f].destroy();d=null}c&&(c.destroy(),c=null)},onAfterShow:function(){var a=this,b=a.dialog;a.$dialog=$(b.$element),b.showLoading(),a.bindEvents(),a.render()},render:function(){var a=this,b=a.nodeData;j.getCumulateGroup(b.nodeInstanceId,b.experimentId).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog,d=b.$dialog;c.hideLoading(),d.find(v.warning).hide(),d.find(v.binningList).show(),b.featuresData=a.features,b.selectedMetrics=a.selectedMetrics,b.selectedMetricsNameMap=a.selectedMetricAndNameMap,b.addIndex(b.featuresData),b.$binningList=d.find(v.binningList),b.$featureTable=d.find(v.featureTable),b.$details=d.find(v.details),b.$copy=d.find(v.copy),b.$title=d.find(v.title),b.$labelSuccess=d.find(v.labelSuccess),b.$labelFailed=d.find(v.labelFailed),b.$copyLabelSuccess=d.find(v.copyLabelSuccess),b.$title.text(b.binningName=a.binningName),b.features=new g({parent:b,dialog:c,container:b.$binningList,tableOptions:{container:b.$featureTable,data:b.featuresData,on:{detail:b.viewDetail.bind(b)}}}),new r({context:b,binTable:b.features.table})},renderFailed:function(){var a=this,b=a.dialog,c=a.$dialog;b&&b.hideLoading(),c&&c.find(v.warning).show(),c&&c.find(v.binningList).hide()},addIndex:function(a){return a.map(function(a,b){return a.index=b,a})},filterConstraints:function(a,b){var c=_.pluck(a,"name");return b.filter(function(a){return-1!==c.indexOf(a.name)})},viewDetail:function(a){var b=this,c=b.features.table;b.featureTableStatus=c.getStatus(),b.featuresData=c.getTableData(),b.$details.show(),b.$binningList.hide(),b.currentFeatureIndex=a.index,c.destroy(),b.createDetail(a)},nextDetail:function(){var a,b=this;b.currentFeatureIndex<b.featuresData.length-1&&(a=b.featuresData[++b.currentFeatureIndex],b.createDetail(a))},prevDetail:function(){var a,b=this;b.currentFeatureIndex>0&&(a=b.featuresData[--b.currentFeatureIndex],b.createDetail(a))},createDetail:function(a){var b,c=this,d=c.selectedMetrics;c.$title.text(y("binningDetail",a.name)),c.detailInstances[a.name]?(c.currentDetail=c.detailInstances[a.name],c.currentDetail.updateDetailPanel(a)):(b=new h({parent:c,$wrapper:c.$details,feature:a,featuresData:c.featuresData,selectedMetrics:d,selectedMetricsNameMap:c.selectedMetricsNameMap}),c.currentDetail=c.detailInstances[a.name]=b),c.showCurrentDetail(a.name),c.siblingNavStatus()},siblingNavStatus:function(){var a=this;a.$dialog.find(v.prevDetail).toggleClass(w.disabled,a.currentFeatureIndex<=0),a.$dialog.find(v.nextDetail).toggleClass(w.disabled,a.currentFeatureIndex>=a.featuresData.length-1)},showCurrentDetail:function(a){var b,c=this;for(var d in c.detailInstances)b=c.detailInstances[d],d===a?b.show():b.hide()},save:function(){var a=this,b=a.dialog,c=a.nodeData;return b.showLoading(),j.saveCumulateGroup(c.nodeInstanceId,c.experimentId,a.featuresData).then(function(c){return a.featuresData=c.features,a.constraintData=c.constrains,a.cleanModifyInfo(a.featuresData),a.features.update(a.featuresData),new r({binTable:a.features.table}),a.saveSucceed(),b.hideLoading(),!0}).catch(function(){return a.saveFailed(),b.hideLoading(),!1})},rerun:function(){var a=this,b=a.dialog,c=a.$dialog,d=a.nodeData;return b.showLoading(),c.find(v.loading).append('<div class="modal-loading-tip">实验准备中……请耐心等待。完毕后，窗口自动关闭。</div>'),j.rerunCumulateGroup(d.nodeInstanceId,d.experimentId,a.featuresData).then(function(c){b.hideLoading(),a.saveSucceed().then(function(){b.forceClose=!0,b.hide(),n.tick(c)})}).catch(function(){b.hideLoading(),a.saveFailed()})},exportReport:function(){var a,b=this,c={},d=[],e=b.dialog,f=u,g=b.features.table,i=g.getRows();b.binningData=g.getTsvRows(),c.binningData=b.binningData||{},e.showLoading(),setTimeout(function(){i.forEach(function(c){b.detailInstances[c.name]||(a=new h({parent:b,$wrapper:b.$details,feature:c,featuresData:b.featuresData}),b.detailInstances[c.name]=a),b.detailData="名称:"+c.name+"\n"+b.detailInstances[c.name].binsTable.getTsvRows()+"\n",d.push(b.detailData)}),e.hideLoading(),k(c.binningData+"\n"+d.join(""),f,"text/csv;charset=utf-8;")},50)},exportBinning:function(){var a,b=this,c=b.nodeData,d=c.experimentName+"-"+c.nodeInstanceName+t;a=l.JSONFormat(JSON.stringify(a)),k(a,d,"text/plain")},cleanModifyInfo:function(a){a.forEach(function(a){a[x.isModified]=void 0})},cleanFeatures:function(a){var b=this,c=z(a);return c.forEach(function(a){a.bin&&a.bin.norm&&(a.bin.norm=a.bin.norm.map(function(a){return b.cleanBin(a)})),a.bin&&a.bin.else&&(a.bin.else=b.cleanBin(a.bin.else)),a.bin&&a.bin.null&&(a.bin.null=b.cleanBin(a.bin.null))}),c},cleanBin:function(a){var b=["index","value","lowValue","lessThan","left","right","woe","total","totalRate","n","p","prate","iv"],c={};return b.forEach(function(b){void 0!==a[b]&&(c[b]=a[b])}),c},checkModified:function(){return this.check(x.isModified)},checkCustomBinning:function(){return this.check(x.isCustomBinning)},check:function(a){var b=this,c=!1,d=b.featuresData;return!!d&&(d.forEach(function(b){b[a]&&(c=!0)}),c)},saveSucceed:function(){return this.labelAnimate(this.$labelSuccess)},saveFailed:function(){return this.labelAnimate(this.$labelFailed)},labelAnimate:function(a){return new Promise(function(b){a.animate({top:5},300).delay(3e3).animate({top:-100},300,b)})},bindEvents:function(){var a=this,b=a.$dialog;b.on("click",v.back,a.onBack.bind(a)),b.on("click",v.prevDetail,a.prevDetail.bind(a)),b.on("click",v.nextDetail,a.nextDetail.bind(a)),b.on("click",v.recover,a.onRecover.bind(a)),b.on("click",v.copy,a.onCopyDialog.bind(a)),b.on("click",v.saveWoe,a.onSaveWoe.bind(a))},onCopyDialog:function(){var a=this;a.message=new d,a.message.show()},onBack:function(){var a=this;a.currentDetail.binsTable.validate()&&(a.$details.hide(),a.$binningList.show(),a.$title.text(a.binningName),a.currentDetail.update(),a.features.update(a.featuresData,a.featureTableStatus))},onRecover:function(){var a=this,b=a.nodeData;a.dialog.showLoading(),j.getCumulateGroup(b.nodeInstanceId,b.experimentId,!0).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},onSaveWoe:function(){var a=this,b=a.dialog,c=a.nodeData;b.showLoading(),j.getCumulateGroup(c.nodeInstanceId,c.experimentId).then(a.renderSaveWoeSuccess.bind(a),a.renderSaveWoeFailed.bind(a))},renderSaveWoeSuccess:function(a){var b={};a.features.forEach(function(a){var c=q.parseFeatureForChart(a);b[a.name]={container:c,feature:a}}),new p({data:a,chartDataMap:b}).show()},renderSaveWoeFailed:function(){this.dialog.hideLoading()}});return{show:function(a){s||(s=new A),s.show(a)}}}),define("charts/d3Extensions/d3.path.js",[],function(){"use strict";function a(){this._x0=this._y0=this._x1=this._y1=null,this._=[]}function b(){return new a}var c=Math.PI,d=2*c,e=1e-6,f=d-e;a.prototype=b.prototype={constructor:a,moveTo:function(a,b){this._.push("M",this._x0=this._x1=+a,",",this._y0=this._y1=+b)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._.push("Z"))},lineTo:function(a,b){this._.push("L",this._x1=+a,",",this._y1=+b)},quadraticCurveTo:function(a,b,c,d){this._.push("Q",+a,",",+b,",",this._x1=+c,",",this._y1=+d)},bezierCurveTo:function(a,b,c,d,e,f){this._.push("C",+a,",",+b,",",+c,",",+d,",",this._x1=+e,",",this._y1=+f)},arcTo:function(a,b,d,f,g){a=+a,b=+b,d=+d,f=+f,g=+g;var h=this._x1,i=this._y1,j=d-a,k=f-b,l=h-a,m=i-b,n=l*l+m*m;if(g<0)throw new Error("negative radius: "+g);if(null===this._x1)this._.push("M",this._x1=a,",",this._y1=b);else if(n>e)if(Math.abs(m*j-k*l)>e&&g){var o=d-h,p=f-i,q=j*j+k*k,r=o*o+p*p,s=Math.sqrt(q),t=Math.sqrt(n),u=g*Math.tan((c-Math.acos((q+n-r)/(2*s*t)))/2),v=u/t,w=u/s;Math.abs(v-1)>e&&this._.push("L",a+v*l,",",b+v*m),this._.push("A",g,",",g,",0,0,",+(m*o>l*p),",",this._x1=a+w*j,",",this._y1=b+w*k)}else this._.push("L",this._x1=a,",",this._y1=b);else;},arc:function(a,b,g,h,i,j){a=+a,b=+b,g=+g;var k=g*Math.cos(h),l=g*Math.sin(h),m=a+k,n=b+l,o=1^j,p=j?h-i:i-h;if(g<0)throw new Error("negative radius: "+g);null===this._x1?this._.push("M",m,",",n):(Math.abs(this._x1-m)>e||Math.abs(this._y1-n)>e)&&this._.push("L",m,",",n),g&&(p>f?this._.push("A",g,",",g,",0,1,",o,",",a-k,",",b-l,"A",g,",",g,",0,1,",o,",",this._x1=m,",",this._y1=n):(p<0&&(p=p%d+d),this._.push("A",g,",",g,",0,",+(p>=c),",",o,",",this._x1=a+g*Math.cos(i),",",this._y1=b+g*Math.sin(i))))},rect:function(a,b,c,d){this._.push("M",this._x0=this._x1=+a,",",this._y0=this._y1=+b,"h",+c,"v",+d,"h",-c,"Z")},toString:function(){return this._.join("")}},d3.path=b}),define("charts/d3Extensions/d3.layout.treeLine",[],function(){"use strict";d3.layout.treeLine=function(){function a(a){var b=a.source.x,d=a.source.y,e=a.target.x,f=a.target.y,g=d3.path();return d+=c,g.moveTo(b,d),g.lineTo(b,(f-d)/2+d),g.lineTo(e,(f-d)/2+d),g.lineTo(e,f),g.toString()}var b=0,c=0;return a.nodeSize=function(d){return b=d[0],c=d[1],a},a.topAnchor=function(a){var b=a.source.x,d=a.source.y,e=(a.target.x,a.target.y);return d+=c,{x:b,y:(e-d)/4+d}},a.bottomAnchor=function(a){var b=(a.source.x,a.source.y),d=a.target.x,e=a.target.y;return b+=c,{x:d,y:3*(e-b)/4+b}},a}}),define("midway/charts/cartTreeNode",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e,f,g,h){var i='<tspan x="-1.5em" dy="1.5em">节点: '+d(b)+'</tspan><tspan x="-4em" dy="1.5em">n:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+d(c)+'</tspan><tspan x="-4em" dy="1.5em">%:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+d(e)+"</tspan>",g="";return f?(a.each(f,function(a,b){g+=b+": "+a+", "}),g="{"+g.slice(0,-2)+"}"):g=h,i+='<tspan x="-4em" dy="1.5em">预测:&nbsp;&nbsp;'+d(g)+"</tspan>"}(b.id,b.count,b.weight,b.scoreDistribution,b.predict,b.score)}}),define("charts/cartTree",["zero/declare","zero/ui/Undo","zero/ui/ContextMenu","./d3Extensions/d3.path.js","./d3Extensions/d3.layout.treeLine","../global/utils","../midway/charts/cartTreeNode"],function(a,b,c,d,e,f,g){"use strict";var h={cartTree:"cart-tree",hover:"hover"},i=_.cloneDeep,j={margin:{top:12,right:8,bottom:12,left:8},node:{width:100,height:66,rx:15,ry:8,separation:1.2},depth:150,displayDepth:5,maxDisplayDepth:100,duration:500};return a("charts/CartTree",{cutIds:[],uid:0,constructor:function(a){var c=this;c.opt=$.extend(!0,{},j,a),c.stack=new b,c.preParseData(),c.render()},getCutIds:function(){return this.cutIds},saved:function(){this.cutIds=[]},render:function(){var a=this;a.$container=$(a.opt.container),a.container=d3.select(a.opt.container);var b=a.renderSVG();a.renderFilter(b),a.initTreeLayout(),a.update(a.root),a.initContextMenu(),a.bindEvents()},renderSVG:function(){var a=this,b=a.$container.width(),c=a.$container.height(),d=a.opt.margin.left+b/2,e=a.opt.margin.top;return a.svg=a.container.append("svg:svg").attr("width",b).attr("height",c).attr("class",h.cartTree).on("mousedown",function(){a.svg.style("cursor","-webkit-grabbing")}),a.vis=a.svg.append("svg:g").attr("transform","translate("+d+","+e+")"),a.zoom=d3.behavior.zoom().on("zoom",function(){a.vis.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),a.zoom.translate([d,e]),a.svg.call(a.zoom),a.svg},renderFilter:function(a){var b=a.append("svg:defs").append("filter").attr({x:0,y:0,width:1,height:1,id:"solid"});b.append("feFlood").attr("flood-color","white"),b.append("feComposite").attr("in","SourceGraphic")},preParseData:function(){var a=this,b=a.opt.data;a.opt.convertMap&&a.convert(b,a.opt.convertMap),a.root=b,a.root.x0=0,a.root.y0=0,a.totalCount=b.recordCount,a.collapse(a.root,a.opt.displayDepth),a.saveOperations(a.root,a.cutIds)},onOperationsChange:function(a,b){var c=this,d=c.stack,e=d.canRedo(),f=d.canUndo();a&&(c.root=i(b.tree),c.cutIds=i(b.cutIds)),c.update(c.root),_.isFunction(c.opt.onOperationsChange)&&c.opt.onOperationsChange({canUndo:f,canRedo:e})},saveOperations:function(a,b){this.stack.execute({tree:i(a),cutIds:i(b)})},initTreeLayout:function(){var a=this,b=a.opt.node.width,c=a.opt.node.height;a.tree=d3.layout.tree().nodeSize([b,c]).separation(function(b,c){return b.parent,c.parent,a.opt.node.separation}),a.treeLine=d3.layout.treeLine().nodeSize([b,c])},initContextMenu:function(){var a=this;a.contextMenu=new c({target:".cart-tree .node",items:[{key:"cut",label:"删除分支",icon:"cut",disabled:function(){var a=d3.select(this.rootMenu.$trigger).data()[0];return!a.children&&!a._children}},{key:"create",label:"生长分支（敬请期待）",icon:"plus-l",disabled:function(){return!0}}],callback:function(){},on:{cut:function(b){var c=d3.select(b.$trigger).data();a.cutSubTree(c[0].id)}}})},reRender:function(){this.destroy(),this.render()},bindEvents:function(){var a=this;$(document).on("mouseup.cartTree",function(){a.svg&&a.svg.style("cursor","-webkit-grab")}),a.stack.on("execute",a.onOperationsChange.bind(a,!1)).on("undo",a.onOperationsChange.bind(a,!0)).on("redo",a.onOperationsChange.bind(a,!0))},update:function(a){var b=this,c=b.tree.nodes(b.root).reverse(),d=b.tree.links(c);c.forEach(function(a){a.y=a.depth*b.opt.depth}),b.updateNodes(a,c),b.updateLinks(a,d),c.forEach(function(a){a.x0=a.x,a.y0=a.y})},updateNodes:function(a,b){var c=this,d=c.opt.duration,e=c.vis.selectAll("g.node").data(b,function(a){return a.id||(a.id=++c.uid)}),h=e.enter().append("svg:g").attr("class","node").classed("leaf",function(a){return c.isLeaf(a)}).attr("transform",function(b){return"translate("+a.x0+","+a.y0+")"}).attr("data-id",function(a){return a.id}).on("click",function(a){c.toggle(a),c.update(a),d3.event.stopPropagation()}).on("dblclick",function(a){d3.event.stopPropagation()}).on("mouseenter",function(a){c.clearMarkPath(a);var b=c.getRoute(a);c.markPath(b)});h.append("svg:rect").attr("x",function(a){return-c.opt.node.width/2}).attr("width",1e-6).attr("height",1e-6).attr("rx",function(a){return c.isLeaf(a)?0:2}).attr("ry",function(a){return c.isLeaf(a)?0:2}).style("fill",function(a){return c.isLeaf(a)?"#eefbf3":"#fff"}),h.append("svg:circle").attr("class","delIcon").attr("cx","48px").attr("cy",0).attr("r",1e-6),h.append("svg:text").attr("text-anchor","start").html(function(a){return g({id:a.id,count:a.recordCount,weight:f.toFixedNumber(100*a.recordCount/c.totalCount,5),scoreDistribution:a.scoreDistribution,score:f.toFixedNumber(a.score,3)})}).style("fill-opacity",1e-6);var i=e.transition().duration(d).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("class",function(a){return c.isLeaf(a)?"node leaf":"node"});i.select("rect").attr("width",function(a){return c.opt.node.width}).attr("height",c.opt.node.height).attr("rx",c.opt.node.rx).attr("ry",c.opt.node.ry).style("fill",function(a){return c.isLeaf(a)?"#eefbf3":"#fff"}),i.select("circle").attr("r",function(a){return c.isModified(a)?5:1e-6}),i.selectAll("text").style("fill-opacity",1);var j=e.exit().transition().duration(d).attr("transform",function(b){return"translate("+a.x+","+a.y+")"}).remove();j.select("rect").attr("width",1e-6).attr("height",1e-6),j.selectAll("text").style("fill-opacity",1e-6)},updateLinks:function(a,b){var c=this,d=c.treeLine,e=c.opt.duration,f=c.vis.selectAll("g.link").data(b,function(a){return a.target.id}),g=f.enter().insert("svg:g","g").attr("class","link").attr("data-id",function(a){return a.target.id});g.append("svg:path").attr("d",function(b){var c={x:a.x0,y:a.y0};return d({source:c,target:c})}),g.append("svg:text").attr("class","feature").attr("text-anchor","middle").attr("filter","url('#solid')").attr("x",function(a){return d.topAnchor(a).x}).attr("y",function(a){return d.topAnchor(a).y}).html(function(a){var b='<tspan dx="5px" dy="-5px">'+a.target.predict.feature+"</tspan>";return a.source.extensionNodeStats&&void 0!==a.source.extensionNodeStats.improvement&&(b+='<tspan dx="-50px" dy="16px">改进='+a.source.extensionNodeStats.improvement+"</tspan>"),b}).style("fill-opacity",1e-6),g.append("svg:text").attr("class","cut").attr("text-anchor","middle").attr("filter","url('#solid')").attr("x",function(a){return d.bottomAnchor(a).x}).attr("y",function(a){return d.bottomAnchor(a).y}).text(function(a){return c.markByOperator(a.target.predict.operator,a.target.predict.value)}).style("fill-opacity",1e-6);var h=f.transition().duration(e);h.select("path").attr("d",d),h.select("text.feature").attr("x",function(a){return d.topAnchor(a).x}).attr("y",function(a){return d.topAnchor(a).y}).style("fill-opacity",1),h.select("text.cut").attr("x",function(a){return d.bottomAnchor(a).x}).attr("y",function(a){return d.bottomAnchor(a).y}).style("fill-opacity",1);var i=f.exit().transition().duration(e).remove();i.select("path").attr("d",function(b){var c={x:a.x,y:a.y};return d({source:c,target:c})}),i.select("text.feature").style("fill-opacity",1e-6),i.select("text.cut").style("fill-opacity",1e-6)},cutSubTree:function(a){var b,c=this,d=c.findNode(a);d.__modified=!0,b=d.children.map(function(a){return a.id}),d.children=null,c.update(d),c.cutIds=c.cutIds.concat(b),c.saveOperations(c.root,c.cutIds)},findNode:function(a){var b,c=this,d=c.root;return c.preOrderTraversal(d,function(c){c.id===a&&(b=c)}),b},convert:function(a,b){function c(a){a[d]&&(a.children=a[d],a.children.forEach(function(b){b.depth=a.depth+1,c(b)}))}var d=b.children;a.depth=1,c(a)},scale:function(a){var b=this;if(b.vis){var c=b.vis.attr("transform");c=c.replace(/(scale\()\d*\.*\d*(\))/,"$1"+a+"$2"),b.vis.attr("transform",c),b.zoom.scale(a)}},collapseAll:function(){this.collapse(this.root,this.opt.displayDepth),this.reRender()},expandAll:function(){this.expand(this.root,this.opt.maxDisplayDepth),this.reRender()},expand:function(a,b){var c=this,d=a.children?a.children:a._children;a&&d&&(d.forEach(function(a){c.expand(a,b)}),a.depth<=b&&a._children&&(a.children=a._children,a._children=null))},collapse:function(a,b){var c=this,d=a.children?a.children:a._children;a&&d&&(d.forEach(function(a){c.collapse(a,b)}),a.depth>=b&&a.children&&(a._children=a.children,a.children=null))},toggle:function(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)},markPath:function(a){this.vis.selectAll("[data-id]").each(function(b){var c=d3.select(this),d=parseInt(c.attr("data-id"),10);a.forEach(function(a){parseInt(a.id,10)===d&&c.classed(h.hover,!0)})})},clearMarkPath:function(a){this.vis.selectAll("[data-id]").each(function(a){
d3.select(this).classed(h.hover,!1)})},getRoute:function(a){function b(a){a.parent&&b(a.parent),c.push(a)}var c=[];return b(a),c},markByOperator:function(a,b){var c={isIn:"in",greaterOrEqual:">=",lessThan:"<",lessOrEqual:"<=",greaterThan:">",equal:"="},d=c[a];return"in"===d?"in("+b+")":d+" "+b},preOrderTraversal:function(a,b){for(var c=[a];null!=(a=c.pop());)if(b(a),(e=a.children)&&(d=e.length))for(var d,e;--d>=0;)c.push(e[d])},isLeaf:function(a){return!a._children&&!a.children},isModified:function(a){return a.__modified},destroy:function(){$(document).off("mouseup.cartTree"),this.contextMenu&&this.contextMenu.destroy&&this.contextMenu.destroy(),this.svg.remove(),this.$container.empty()}})}),define("midway/dialog/cartTree/cartTree",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f="",b=a.uuid();f+=" ";var c=a.uuid();return f+='<ul class="nav nav-tabs pai-tab"><li data-target="#'+e(b)+'"><a href="javascript:void(0);">模型</a></li><li data-target="#'+e(c)+'"><a href="javascript:void(0);">规则</a></li></ul><div id="'+e(b)+'" class="cart-tree-wrap hide"><div class="cart-tree"></div><ul class="actions"><li data-action="realSize"><i class="icon icon-real-size-24"></i><span>'+e(d("realSize"))+'</span></li><li data-action="expand"><i class="icon icon-node-collapse"></i><span>'+e(d("expand"))+'</span></li><li data-action="collapse"><i class="icon icon-node-expand"></i><span>'+e(d("collapse"))+'</span></li><li data-action="undo" class="disabled"><i class="icon icon-undo"></i><span>'+e(d("undo"))+'</span></li><li data-action="redo" class="disabled"><i class="icon icon-redo"></i><span>'+e(d("redo"))+'</span></li><li data-action="save" class="disabled"><i class="icon icon-save"></i><span>'+e(d("save"))+'</span></li></ul></div><div id="'+e(c)+'" class="rules-wrap hide"></div>'}(b.uuid1,b.uuid2)}}),define("dialog/cartTreeDialog",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","../i18n","../ajax/model","../charts/cartTree","../midway/dialog/cartTree/cartTree","../global/utils","./generateRules"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k,l={container:".cart-tree",action:"[data-action]",save:'[data-action="save"]',undo:'[data-action="undo"]',redo:'[data-action="redo"]'},m={dialog:"cart-tree-dialog",disabled:"disabled"},n=e.translate,o=b("dialog/CartTreeDialog",[],{constructor:function(){},show:function(a){var b,d=this;d.nodeData=a,b=d.dialog=new c({title:n("ctEditModel"),className:m.dialog,canFullscreen:!0,destroyOnHide:!0,body:h(),beforeHide:d.onBeforeHide.bind(d),afterShow:d.onAfterShow.bind(d),buttons:[{text:n("close"),click:function(){b.hide()}}]}).on("fullScreen",d.fullScreen.bind(d))},fullScreen:function(a){var b=this;b.cartTree&&b.cartTree.reRender()},onBeforeHide:function(){this.cartTree&&this.cartTree.destroy()},onAfterShow:function(){var a=this,b=a.dialog;a.tab=new d({selector:b.$(".pai-tab li"),activeIndex:0,activeClassName:"active",afterShow:function(c){1!==c||this.generateRules||(b.showLoading(),this.generateRules=new j({treeId:0,container:b.$(".rules-wrap"),experimentId:a.nodeData.experimentId,nodeInstanceId:a.nodeData.nodeInstanceId,projectName:a.nodeData.projectName,callback:function(){b.hideLoading()}}))}}),a.$dialog=$(b.$element),a.$container=a.$dialog.find(l.container),a.$save=a.$dialog.find(l.save),a.$undo=a.$dialog.find(l.undo),a.$redo=a.$dialog.find(l.redo),b.showLoading(),a.bindEvents(),a.render()},render:function(){var a=this,b=a.nodeData;f.queryCARTTree(b.nodeInstanceId,0,100).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog;c&&c.hideLoading(),b.cartTree=new g({container:b.$container[0],data:a.rootNode||{},convertMap:{children:"childNodes"},onOperationsChange:b.onOperationsChange.bind(b)})},renderFailed:function(){var a=this,b=a.dialog;b&&b.hideLoading(),b&&b.showEmpty()},bindEvents:function(){var a=this;a.$dialog.on("click",l.action,a.onAction.bind(a))},onOperationsChange:function(a){var b=this;b.$undo.toggleClass(m.disabled,!a.canUndo),b.$save.toggleClass(m.disabled,!a.canUndo),b.$redo.toggleClass(m.disabled,!a.canRedo)},onAction:function(a){var b=this,c=$(a.currentTarget).data("action"),d=$(a.currentTarget);b["on"+i.ucFirst(c)](d)},onRealSize:function(){var a=this;a.cartTree&&a.cartTree.scale(1)},onExpand:function(){var a=this;a.cartTree&&a.cartTree.expandAll()},onCollapse:function(){var a=this;a.cartTree&&a.cartTree.collapseAll()},onUndo:function(){var a=this,b=a.cartTree.stack;b.canUndo()&&b.undo()},onRedo:function(){var a=this,b=a.cartTree.stack;b.canRedo()&&b.redo()},onSave:function(){var a=this,b=a.nodeData;a.cartTree&&a.cartTree.getCutIds().length&&(a.dialog.showLoading(),f.cutCARTNodes(b.nodeInstanceId,b.experimentId,a.cartTree.getCutIds()).then(function(){a.dialog.hideLoading(),a.cartTree.saved()}))}});return{show:function(a){k||(k=new o),k.show(a)}}}),define("midway/dialog/evaluation/roc",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="line-chart"></div>'}}),define("midway/dialog/evaluation/rocTooltip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c){return'<div class="roc-tooltip"><table><thead><tr><th colspan="2">'+d(a)+"</th></tr></thead><tbody><tr><td>auc</td><td>"+d(b)+"</td></tr><tr><td>accuracy</td><td>"+d(c.accuracy)+"</td></tr><tr><td>f1</td><td>"+d(c.f1)+"</td></tr><tr><td>fn</td><td>"+d(c.fn)+"</td></tr><tr><td>fp</td><td>"+d(c.fp)+"</td></tr><tr><td>precision</td><td>"+d(c.precision)+"</td></tr><tr><td>recall</td><td>"+d(c.recall)+"</td></tr><tr><td>tn</td><td>"+d(c.tn)+"</td></tr><tr><td>tp</td><td>"+d(c.tp)+"</td></tr></tbody></table></div>"}(b.label,b.auc,b.detail)}}),define("dialog/evaluation/roc",["zero/zero","zero/ui/DialogEx","../../i18n","../../global/utils","../../ajax/model","../../midway/dialog/evaluation/roc","../../midway/dialog/evaluation/rocTooltip"],function(a,b,c,d,e,f,g){"use strict";function h(a){var c;new b({body:f(),title:k("roc"),className:"dialog-output-roc",destroyOnHide:!0,canFullscreen:!1,afterShow:function(){var b=this;b.showLoading(),e.roc(a.nodeInstanceId,a.nodeDefId,a.experimentId,a.loopTimestamp).then(function(a){return i(a,function(a){function b(a,b){var c,e;if(b){for(e=a;e>=0;e--)if((c=d[e])&&!c.isFake)return c}else for(e=a;e<11;e++)if((c=d[e])&&!c.isFake)return c;return null}function c(a){var c=a/10,d={isFake:!0,x:c},e=b(a,!0);if(!e)return d.y=0,d;var f=b(a,!1);if(!f)return d.y=1,d;var g=e.x,h=e.y,i=f.x,j=f.y;return d.y=(j-h)*(c-g)/(i-g)+h,d}var d=[];i(a.coordinates,function(a){if("object"==typeof a){var b=10*j(a.x,1);d[b]||(d[b]=a)}});for(var e=0;e<11;e++)d[e]||(d[e]=c(e));a.coordinates=d}),a}).then(function(a){if(b.hideLoading(),!a||!a.length)return b.showEmpty();var d={toolbox:{show:!0,feature:{saveAsImage:{show:!0}}},tooltip:{show:function(){return!1},trigger:"item",showDelay:0,hideDelay:50,position:function(a){var b=a[0];return b>330&&(b-=275),[b,65]}},xAxis:{type:"category",boundaryGap:!1,data:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]},yAxis:{type:"value",min:0,max:1,splitNumber:10},legend:{data:[]},series:[]};d.tooltip.formatter=function(b){var c=a[b.seriesIndex],d=b.dataIndex,e=c&&c.coordinates[d];if(e)return e.isFake?"":g({label:c.label,auc:c.auc,detail:e})};var e=d.legend.data,f=d.series;i(a,function(a){var b=a.label+", auc:"+a.auc,c=[];i(a.coordinates,function(a){c.push(a.y)}),e.push(b),f.push({smooth:!0,type:"line",name:b,data:c})}),c=echarts.init(b.$(".line-chart")[0],l),c.setOption(d)},function(){b.hideLoading(),b.showEmpty()})},afterHide:function(){c&&(c.clear(),c.dispose())},buttons:[{text:k("close"),click:function(){this.hide()}}]})}var i=a.each,j=d.toFixed,k=c.translate,l={color:["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],tooltip:{backgroundColor:"rgba(24, 42, 60, .9)",padding:0},grid:{borderColor:"#eee"},line:{smooth:!0,symbol:"emptyCircle",symbolSize:3},categoryAxis:{axisLine:{lineStyle:{color:"#289DE9"}},splitLine:{lineStyle:{color:"#eee"}}},valueAxis:{axisLine:{lineStyle:{color:"#289DE9"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:"#eee"}}},textStyle:{fontFamily:"Lantinghei SC, tahoma, Arial, Hiragino Sans GB, Microsoft YaHei, 微软雅黑, STHeiti, STXiHei"}};return{show:h}}),define("midway/dialog/evaluation/cluster",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c){return'<div class="layout"><div class="table-wrap"><table class="table table-bordered"><tbody><tr><td>'+e(d("recordCount"))+"</td><td>"+e(a)+"</td></tr><tr><td>"+e(d("clusterCenterCount"))+"</td><td>"+e(b)+"</td></tr><tr><td>"+e(d("calinskiHarabasz"))+"</td><td>"+e(c)+'</td></tr></tbody></table></div><div class="chart-wrap"><div class="chart-panel"></div></div></div>'}(b.count,b.centerCount,b.calinhara)}}),define("dialog/evaluation/cluster",["zero/zero","zero/json","zero/ui/DialogEx","../../i18n","../../global/utils","../../ajax/analysis","../../charts/theme","../../midway/dialog/evaluation/cluster"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a=this;a.showLoading(),f.explore(p,q.loopTimestamp).then(function(a){var c=a.records?a.records[0]:"";if(c)try{return b.parse(c)}catch(a){}return null}).then(function(b){b?(a.set("body",h(b)),a.on("fullScreen",function(){j(a,b)}),j(a,b)):a.showEmpty(),a.hideLoading()},function(){a.hideLoading(),a.showEmpty()})}function j(b,c){var d=c.clusterCounts||[],e=0,f=0;a.each(d,function(a){f+=a,e=Math.max(e,a)});var h={toolbox:{show:!0,feature:{restore:{show:!0},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"center",max:e}}},saveAsImage:{show:!0}}},tooltip:{trigger:"item",formatter:"{c}"},legend:{show:!1,orient:"vertical",x:"left",y:"center",data:[]},calculable:!0,series:[{type:"pie",radius:"55%",center:["50%","60%"],data:[]}]};a.each(d,function(a,b){var c=b+1+": "+m(100*a/f,2)+"%";h.legend.data.push(c),h.series[0].data.push({name:c,value:a})}),o=echarts.init(b.$(".chart-panel")[0],g),o.setOption(h)}function k(){o&&(o.clear(),o.dispose(),o=null),p=0}function l(a){p=a.nodeInstanceId,q=a,new c({title:n("clusterEvaluation"),className:"dialog-evaluation-cluster",destroyOnHide:!0,canFullscreen:!0,afterShow:i,afterHide:k,buttons:[{text:n("close"),click:function(){this.hide()}}]})}var m=e.toFixed,n=d.translate,o=null,p=0,q=null;return{show:l}}),define("midway/components/evaluate/evaluate",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="evaluate-body '+e(a)+'"><div class="evaluate-list"></div><div class="evaluate-detail"><a href="javascript:void(0);" class="back">&lsaquo; '+e(d("backToList"))+'</a><ul class="nav nav-tabs pai-tab"><li data-target="'+e("."+a)+' .indices-table"><a href="javascript:void(0);">'+e(d("indicesData"))+'</a></li><li data-target="'+e("."+a)+' .evaluate-charts"><a href="javascript:void(0);">'+e(d("charts"))+'</a></li><li data-target="'+e("."+a)+' .eq-evaluate-table"><a href="javascript:void(0);">'+e(d("eqDetailInfo"))+'</a></li><li data-target="'+e("."+a)+' .el-evaluate-table"><a href="javascript:void(0);">'+e(d("elDetailInfo"))+'</a></li><li data-target="'+e("."+a)+' .key-info-table"><a href="javascript:void(0);">'+e(d("highSublevelInfo"))+'</a></li></ul><div class="indices-table"></div><div class="evaluate-charts"><ul class="chart-list"><li class="chart" data-chart="roc" title="'+e(d("RocChart"))+'"></li><li class="chart" data-chart="ks" title="'+e(d("ksChart"))+'"></li><li class="chart" data-chart="lift" title="'+e(d("LiftChart"))+'"></li><li class="chart" data-chart="gain" title="'+e(d("GainChart"))+'"></li><li class="chart" data-chart="pr" title="'+e(d("PRChart"))+'"></li></ul><div class="chart-detail"></div></div><div class="eq-evaluate-table"><div class="eq-evaluate-table-inner"></div></div><div class="el-evaluate-table"><div class="el-evaluate-table-inner"></div></div><div class="key-info-table"></div></div></div>'}(b.uid)}}),define("components/evaluate/ks",["zero/declare","../../i18n","./util","../../midway/components/evaluate/tooltip"],function(a,b,c,d){"use strict";var e=b.translate,f="Cumulative Negative Dist.",g="Cumulative Positive Dist.";return a("evaluate/KS",[],{constructor:function(){},parse:function(a){var b,h,i,j;return b=e("ksChart"),h=c.getMaxDistancePoint(a),i=(100*Math.abs(h.cn-h.cp)).toFixed(2)+"%",j="KS值："+i,{title:{text:b,subtext:j,left:10},name:b,imageName:b,dataZoom:{end:100},grid:{top:100,right:50,left:50},tooltip:{trigger:"axis",formatter:function(b){if(b&&b[0]){var e=a[b[0].dataIndex-1];return e?d({titleWidth:"150px",detailWidth:"90px",infos:{KS:(100*Math.abs(e.cn-e.cp)).toFixed(2)+"%",Threshold:c.getLowerValue(e.dr),"Sample Ratio":(e.id/a.length*100).toFixed(2)+"%","Cumulative Negative Dist.":e.cn,"Cumulative Positive Dist.":e.cp}}):void 0}}},legend:{data:[f,g]},series:[{name:f,data:[0].concat(_.pluck(a,"cn")),type:"line",smooth:!0,markPoint:{data:[{xAxis:h.index+1,yAxis:Math.max(h.cp,h.cn),value:(100*Math.abs(h.cn-h.cp)).toFixed(2)}],symbolSize:70},markLine:{data:[[{xAxis:h.index+1,yAxis:h.cn},{xAxis:h.index+1,yAxis:h.cp}]]}},{name:g,data:[0].concat(_.pluck(a,"cp")),type:"line"}],xAxis:[{type:"category",data:[0].concat(_.pluck(a,"xAxis"))}],yAxis:[{min:0,max:1}]}},markKSPoints:function(a,b){var c=a.series[0].markPoint.data,d=Math.round(b.length/10);b.forEach(function(a){a.index%d==0&&c.push({xAxis:a.xAxis,yAxis:Math.max(a.cp,a.cn),name:"KS值",value:(100*Math.abs(a.cn-a.cp)).toFixed(2)})})}})}),define("components/evaluate/lift",["zero/declare","../../i18n","./util","../../midway/components/evaluate/tooltip"],function(a,b,c,d){"use strict";var e=b.translate;return a("evaluate/Lift",[],{constructor:function(){},parse:function(a){var b=(Math.floor(a.length/20),e("LiftChart"));return{title:{text:b,left:10},name:b,imageName:b,dataZoom:{end:100},grid:{top:60,right:50,left:50},tooltip:{formatter:function(b){if(b){var e=a[b[0].dataIndex];return d({titleWidth:null,detailWidth:"90px",infos:{Lift:e.l,Threshold:c.getLowerValue(e.dr)}})}}},series:[{name:"Lift",data:_.pluck(a,"l"),type:"line",smooth:!0,markPoint:{data:[],symbolSize:20}}],xAxis:[{type:"category",data:_.pluck(a,"xAxis"),axisLabel:{}}],yAxis:[{name:"Lift值"}]}},markLiftPoints:function(a,b){var c=a.series[0].markPoint.data,d=Math.round(b.length/10);b.forEach(function(a){a.index%d==0&&c.push({xAxis:a.index,yAxis:a.l,name:"Lift",value:a.l})})}})}),define("components/evaluate/pr",["zero/declare","../../i18n","./util","../../midway/components/evaluate/tooltip"],function(a,b,c,d){"use strict";var e=b.translate;return a("evaluate/PR",[],{constructor:function(){},parse:function(a){var b=c.getMaxF1ScorePoint(a),f=e("PRChart");return{title:{text:f,subtext:"F1-Score值: "+b.f1,left:10},name:f,imageName:f,dataZoom:{end:100},grid:{top:90,right:50,left:50,right:60},toolbox:{top:30},tooltip:{axisPointer:{type:"line",axis:"x"},formatter:function(b){if(b&&b[0]){var e=a[b[0].dataIndex];return d({titleWidth:null,detailWidth:"90px",infos:{Threshold:c.getLowerValue(e.dr),F1_score:e.f1,Precision:e.p,Recall:e.r}})}}},series:[{name:"Precision",type:"line",smooth:!0,symbol:"none",data:_.zip(_.pluck(a,"r"),_.pluck(a,"p")),markPoint:{data:[{xAxis:b.r,yAxis:b.p,name:"最大F1_Score",value:b.f1}],symbolSize:80}}],xAxis:[{type:"value",name:"Recall",min:0,max:1,axisLabel:{formatter:function(a){if(0===a||1===a)return a;for(var b=a.toFixed(2);b.length<4;)b+="0";return b}}}],yAxis:[{name:"Precision",min:0,max:1}]}},markPRPoints:function(a,b){var c=a.series[0].markPoint.data,d=Math.round(b.length/10);b.forEach(function(a){a.index%d==0&&c.push({xAxis:a.r,yAxis:a.p,name:"F1_score",value:a.f1})})}})}),define("components/evaluate/gain",["zero/declare","../../i18n","./util","../../midway/components/evaluate/tooltip"],function(a,b,c,d){"use strict";var e=b.translate;return a("evaluate/Gain",[],{constructor:function(){},parse:function(a){var b=e("GainChart");return{title:{text:b,left:10},name:b,imageName:b,dataZoom:{end:100},grid:{top:60,right:50,left:50},tooltip:{formatter:function(b){if(b){var c=a[b[0].dataIndex];return d({titleWidth:"150px",detailWidth:null,infos:{recall:c.r,Threshold:c.t,precision:c.p,"Cumulative Negative Dist.":c.cn,"Cumulative Positive Dist.":c.cp}})}}},series:[{name:"Gain",data:_.pluck(a,"r"),type:"line",smooth:!0,markPoint:{data:[],symbolSize:20}}],xAxis:[{type:"category",data:_.pluck(a,"t"),axisLabel:{formatter:function(a){if(0===a||1===a)return a;for(var b=a.toFixed(2);b.length<4;)b+="0";return b}}}],yAxis:[{name:"Gain值",min:0,max:1}]}}})}),define("components/evaluate/IndicesTable",["zero/declare","zero/ui/DataTable","../../i18n","./util"],function(a,b,c,d){"use strict";var e=c.translate,f={line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,sort:{field:"id",type:"desc"},cols:[{title:"Index",field:"index",description:"指标",sort:!0,width:"50%",parse:function(a){return e("evaluate_"+a)}},{title:"Value",field:"value",description:"值"}]};return a("evaluate/IndicesTable",[],{constructor:function(a){var c=this,d={container:a.container,data:a.metric,height:"calc(100% - 70px)"};d=$.extend(!0,{},f,d),c.table=new b(d)},destroy:function(){this.table&&this.table.destroy()}})}),define("components/evaluate/KeyInfoTable",["zero/declare","zero/ui/DataTable","../../i18n","./util"],function(a,b,c,d){"use strict";var e=(c.translate,{theme:"small",line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,sort:{field:"rule",type:"asc"},cols:[{title:"Rule",field:"rule",sort:!0,width:"100px"},{title:"Bin",field:"id",sort:!0,width:"50px"},{title:"Recall",field:"r",sort:!0},{title:"Fpr",field:"fpr",sort:!0},{title:"P",field:"p",sort:!0},{title:"Range",field:"dr"}]});return a("evaluate/KeyInfoTable",[],{constructor:function(a){var c=this,d={container:a.container,data:a.data,height:"calc(100% - 70px)"};d=$.extend(!0,{},e,d),c.table=new b(d)},destroy:function(){this.table&&this.table.destroy()}})}),define("components/evaluate/DetailTable",["zero/declare","zero/ui/DataTable","../../i18n","./util"],function(a,b,c,d){"use strict";var e=(c.translate,{theme:"small",line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,sort:{field:"id",type:"desc"},cols:[{title:"Bin",field:"id",description:"桶的编号",sort:!0,width:"6%"},{title:"Range",field:"dr",description:"该桶的数据值域",sort:!0,width:"10%"},{title:"Total",field:"tc",description:"该桶中总样本个数",sort:!0,width:"6%"},{title:"Pos",field:"pc",description:"该桶中的正样本个数",sort:!0,width:"6%"},{title:"Neg",field:"nc",description:"该桶中的负样本个数",sort:!0,width:"6%"},{title:"Fpr",field:"fpr",description:"",sort:!0,width:"6%"},{title:"Precision",field:"p",description:"该桶中数据值域下界做分类阈值时的precision",sort:!0,width:"8%"},{title:"Recall",field:"r",description:"该桶中数据值域下界做分类阈值时的recall",sort:!0,width:"6%"},{title:"F1",field:"f1",description:"该桶中数据值域下界做分类阈值时的f1 score",sort:!0,width:"5%"},{title:"KS",field:"ks",description:"KS值",sort:!0,width:"5%"},{title:"Lift",field:"l",description:"该桶中数据值域下界做分类阈值时的lift",sort:!0,width:"5%"},{title:"Avg",field:"avg",description:"该桶中样本得分的均值",sort:!0,width:"5%"},{title:"Neg",field:"n",group:"Distribution",description:"该桶中的负样本数/总的负样本数",sort:!0,width:"6%"},{title:"Pos",field:"pos",group:"Distribution",description:"该桶中的正样本数/总的正样本数",sort:!0,width:"6%"},{title:"Neg",field:"cn",group:"Cumulative Percentages",description:"Negative分布的累加",sort:!0,width:"7%"},{title:"Pos",field:"cp",group:"Cumulative Percentages",description:"Positive分布的累加",sort:!0}]});return a("evaluate/DetailTable",[],{constructor:function(a){"equal-length"==a.type?(e.cols[1].title="Threshold",e.cols[1].field="t"):(e.cols[1].title="Range",e.cols[1].field="dr"),16===e.cols.length&&["equal-length","equal-freq"].some(function(b){return a.type===b})&&e.cols.push({title:"total",field:"totalCum",group:"Cumulative Percentages",description:"累计统计值",sort:!0});var c=this,d=100,f=a.data,g={container:a.container,data:f.slice(0,d),lazyLoad:function(a){return f.slice(a*d,(a+1)*d)},height:"calc(100% - 70px)"};g=$.extend(!0,{},e,g),c.table=new b(g)},destroy:function(){this.table&&this.table.destroy()}})}),define("components/evaluate/index",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","zero/ui/LoadingPanel","zero/ui/Tab","../../i18n","../../charts/bar","../../midway/components/evaluate/evaluate","../../ajax/model","../../global/utils","./roc","./ks","./lift","./pr","./gain","./IndicesTable","./KeyInfoTable","./DetailTable"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";var t=(g.translate,_.each),u=_.isNumber,v=0,w={body:".evaluate-body",list:".evaluate-list",detail:".evaluate-detail",indicesTable:".indices-table",keyInfoTable:".key-info-table",eqevaluateTable:".eq-evaluate-table",elEvaluateTable:".el-evaluate-table",eqEvaluateTableInner:".eq-evaluate-table-inner",elEvaluateTableInner:".el-evaluate-table-inner",evaluateCharts:".evaluate-charts",tabSelector:".nav-tabs li",miniChart:"[data-chart]",chartDetail:".chart-detail",ksChart:'[data-chart="ks"]',liftChart:'[data-chart="lift"]',prChart:'[data-chart="pr"]',rocChart:'[data-chart="roc"]',warning:".alert-warning",backButton:".back"},x={dialog:"evaluate-dialog",active:"active"},y={line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,sort:{field:"id",type:"desc"},cols:[{title:"Group Name",field:"groupName",sort:!0,width:"13%"},{title:"AUC",field:"auc",sort:!0,width:"13%"},{title:"KS",field:"ks",sort:!0,width:"13%"},{title:"F1 Score",field:"f1",sort:!0,width:"13%"},{title:"Total",field:"total",sort:!0,width:"13%"},{title:"Positive",field:"positive",sort:!0,width:"13%"},{title:"Negative",field:"negative",sort:!0,width:"13%"}],showActions:!0,actions:[{key:"detail",name:"详情"}]};return b("model/Evaluate",[],{constructor:function(a){this.node=a.node,this.$container=$(a.container),this.uid="evaluate-component-"+ ++v,this.$container.html(i({uid:this.uid})),this.$list=this.$container.find(w.list),this.$detail=this.$container.find(w.detail),this.$back=this.$container.find(w.backButton),this.render(),this.bindEvents()},render:function(){var a=this,b=a.node;a.loadingPanel=new e({target:this.$container}),a.loadingPanel.show(),j.getEvaluate(b.nodeInstanceId,b.experimentId,0,b.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this;b.data=a,a.groupMetricsFlag?b.renderList(a.groupMetrics):(b.$detail.show(),b.$back.hide(),b.renderDetail(a)),b.loadingPanel.hide()},renderFailed:function(){var a=this,b=a.$container;b.find(w.warning).show(),b.find(w.body).hide(),a.loadingPanel.hide()},renderList:function(a){var b=this,c=b.parseGroupMetrics(a),e={container:b.$list,data:c,height:"calc(100% - 70px)",on:{detail:b.onDetail.bind(b)}};e=$.extend({},y,e),b.groupMatricsTable=new d(e)},onDetail:function(a){var b,c=this;c.loadingPanel.show(),setTimeout(function(){c.$list.hide(),c.$detail.show(),b=c.data.groupMap[a.groupName],c.renderDetail(b),c.loadingPanel.hide()},50)},onBack:function(){var a=this;a.$list.show(),a.$detail.hide(),a.destroyDetail()},renderDetail:function(a){var b,c,d,e,g=this,h=g.$detail;g.tab=new f({selector:h.find(w.tabSelector),activeClassName:x.active,activeIndex:1}),g.$chartDetail=h.find(w.chartDetail),g.$rocChart=h.find(w.rocChart),g.metric=a.metric,b=g.points=g.parseData(a.points),c=g.points=a.elPoints?g.parseData(a.elPoints):[],d=g.gains=g.parseData(a.gainChart),e=g.parseMatric(a.metric),g.indicesTable=new q({metric:e,container:h.find(w.indicesTable)}),g.keyInfoTable=new r({data:a.highlightedPoints,container:h.find(w.keyInfoTable)}),g.detailTable=new s({data:b,container:h.find(w.eqEvaluateTableInner),type:"equal-freq"}),g.elDetailTable=new s({data:c,container:h.find(w.elEvaluateTableInner),type:"equal-length"}),g.renderChart(b,d)},parseData:function(a){var b,c=a.length;return a=_.sortBy(a,"id"),a=a.map(function(a,d){for(b in a)u(a[b])&&(a[b]=k.toWeakFixed(a[b],4));return a.index=d,a.xAxis=k.toWeakFixed((d+1)/c*100,2)+"%",a})},parseMatric:function(a){var b=[];for(var c in a)b.push({index:c,value:k.toWeakFixed(a[c],4)});return b},parseGroupMetrics:function(a){for(var b in a)for(var c in a[b])u(a[b][c])&&(a[b][c]=k.toWeakFixed(a[b][c],6));return a},renderChart:function(a,b){var c=this,d=c.chartDataMap={};d.ks=(new m).parse(a),d.lift=(new n).parse(a),d.roc=(new l).parse(a,c.metric),d.pr=(new o).parse(a),d.gain=(new p).parse(b),c.renderMiniCharts(d),c.$rocChart.trigger("click")},renderMiniCharts:function(a){var b,c,d=this,e=d.miniCharts=[];t(a,function(a,f){b={element:d.$container.find('[data-chart="'+f+'"]'),mini:!0,cancelSmart:{dataZoom:!0}},b=$.extend(!0,{},b,a),b.series[0].markPoint=void 0,c=new h(b),e.push(c)})},renderMainChart:function(){var a=this,b=a.chartDataMap,c=a.currentType,d={element:a.$chartDetail};b&&($.extend(d,b[c]),a.mainChart=new h(d))},bindEvents:function(){var a=this,b=a.$container;b.on("click",w.miniChart,a.onChartSwitch.bind(a)),b.on("click",w.backButton,a.onBack.bind(a))},onChartSwitch:function(a){var b=this;b.currentType=$(a.currentTarget).data("chart"),b.renderMainChart()},destroy:function(){var a=this,b=a.tab,c=a.mainChart,d=a.miniCharts;c&&(c.destroy(),c=null),d&&(d.forEach(function(a){a.destroy()}),d=null),b&&(b.destroy(),b=null),a.groupMatricsTable&&a.groupMatricsTable.destroy(),a.keyInfoTable&&a.keyInfoTable.destroy(),a.loadingPanel&&a.loadingPanel.destroy(),a.destroyDetail()},destroyDetail:function(){var a=this;a.indicesTable&&a.indicesTable.destroy(),a.detailTable&&a.detailTable.destroy(),a.elDetailTable&&a.elDetailTable.destroy()}})}),define("dialog/evaluate",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","zero/ui/Tab","../i18n","../charts/bar","../midway/components/evaluate/evaluate","../ajax/model","../global/utils","zero/querystring","../components/evaluate/index"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m,n=f.translate,o={dialogBody:".modal-content .modal-body"},p={dialog:"evaluate-model"},q=b("dialog/Evaluate",[],{constructor:function(){},show:function(a){var b,d=this;d.nodeData=a,b=d.dialog=new c({title:n("evaluateReport"),canFullscreen:!0,className:p.dialog,beforeHide:d.onBeforeHide.bind(d),destroyOnHide:!0,afterShow:d.onAfterShow.bind(d),buttons:[{text:n("close"),click:function(){b.hide()}}]}).on("fullScreen",d.fullScreen.bind(d))},fullScreen:function(a){this.evaluateModel&&this.evaluateModel.renderMainChart()},onBeforeHide:function(){this.evaluateModel&&this.evaluateModel.destroy()},onAfterShow:function(){var a=this,b=a.dialog;a.evaluateModel=new l({node:a.nodeData,container:b.$element.find(o.dialogBody),referer:"Dialog"})}});return{show:function(a){k.parse(window.location.search);window.react_bridge&&window.react_bridge.actions?window.react_bridge.actions.analysis.modelReport.get({experimentId:a.experimentId,projectName:a.projectName,nodeInstanceId:a.nodeInstanceId,loopTimestamp:a.loopTimestamp}):(m||(m=new q),m.show(a))}}}),define("global/domLoading",["zero/zero"],function(a){"use strict";return function(a,b){var c,d,e,f,g=a,h="J-base-loading";return b?(d=g.find(">."+h),d.length||(c='<div class="'+h+'"><div class="load-status"><span class="icon-loading-spinner fa fa-spin"></span></div></div>',g.css("position","relative"),e=g.scrollTop(),f=g.scrollLeft(),d=$(c).css({top:0+e,left:0+f}).appendTo(g))):(g.find(">."+h).remove(),g[0]&&g[0].style.removeProperty("position")),g}}),define("global/math",["zero/zero"],function(a){"use strict";var b=function(a){return a.reduce(function(a,b){return a+b},0)},c={gini:function(a,c){var d,e,f,g=1;if(0===(c=void 0!==c?c:b(a)))return 0;for(d=0,e=a.length;d<e;d++)f=a[d]/c,g-=f*f;return g},entropy:function(a,c){var d,e,f,g=0;if(0===(c=void 0!==c?c:b(a)))return 0;for(d=0,e=a.length;d<e;d++)0!==a[d]&&(f=a[d]/c,g-=f*Math.log2(f));return g}};return c.array={merge:function(a,b){var c,d=a.length,e=[],f=0;for(c=1;c<=d;c++)f+=a[c-1],c%b==0&&(e.push(f),f=0);return(c-1)%b!=0&&e.push(f),e}},c.matrix={transpose:function(a){return a[0].map(function(b,c){return a.map(function(a){return a[c]})})},sum:function(a){var c,d,e=0;for(c=0,d=a.length;c<d;c++)e+=b(a[c]);return e},normalize:function(a){for(var b=[],c=[],d=0,e=a.length;d<e;d++)for(var f=a[d],g=0,h=f.length;g<h;g++)void 0===b[g]&&(b[g]=0),b[g]+=f[g];for(var d=0,e=a.length;d<e;d++){for(var f=a[d],i=[],g=0,h=f.length;g<h;g++)i.push((f[g]/b[g]).toFixed(2));c.push(i)}return c}},c}),define("midway/dialog/confusionMatrix/confusionMatrix",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="confusion-matrix-container"><ul class="nav nav-tabs pai-tab"><li class="active" data-target=".confusion-matrix"><a href="javascript:void(0);">'+e(d("confusionMatrix"))+'</a></li><li data-target=".proportion-matrix"><a href="javascript:void(0);">'+e(d("proportionMatrix"))+'</a></li><li data-target=".confusion-stats"><a href="javascript:void(0);">'+e(d("Stats"))+'</a></li></ul><div class="confusion-matrix"></div><div class="proportion-matrix"></div><div class="confusion-stats"></div></div>'}()}}),define("dialog/confusionMatrix",["zero/zero","zero/declare","zero/dom/event","zero/dom/query","zero/ui/DialogEx","zero/ui/Accordion","zero/ui/DataTable","zero/ui/Popover","zero/ui/Tab","../ajax/model","../global/domLoading","../global/math","../global/utils","../i18n","../charts/ConfusionMatrixChart","../midway/dialog/confusionMatrix/confusionMatrix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q,r=n.translate,s={tabSelector:".nav-tabs li",warning:".alert-warning",container:".confusion-matrix-container",confusionMatrix:".confusion-matrix",proportionMatrix:".proportion-matrix",confusionStats:".confusion-stats"},t={dialog:"confusion-matrix-dialog",active:"active"},u={line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,cols:[{title:r("model"),field:"label",sort:!0,width:"10%"},{title:r("trueCount"),field:"truePositive",sort:!0,width:"12%"},{title:r("falseCount"),field:"falsePositive",sort:!0,width:"12%"},{title:r("summary"),field:"truePositive",sort:!0,width:"12%",parse:function(a,b){return b.falsePositive+b.truePositive}},{title:r("accuracy"),field:"accuracy",sort:!0,width:"12%",parse:function(a){return""!==a?m.toFixedNumber(100*a,3)+"%":void 0}},{title:r("precision"),field:"precision",sort:!0,width:"12%",parse:function(a){return""!==a?m.toFixedNumber(100*a,3)+"%":void 0}},{title:r("recallRate"),field:"recall",sort:!0,width:"12%",parse:function(a){return""!==a?m.toFixedNumber(100*a,3)+"%":void 0}},{title:r("f1"),field:"f1",sort:!0,parse:function(a){return""!==a?m.toFixedNumber(100*a,3)+"%":void 0}}]},v=b("component/ConfusionMatrix",[],{constructor:function(){},show:function(a){var b,c=this;b=c.dialog=new e({title:r("confusionMatrix"),className:t.dialog,canFullscreen:!0,destroyOnHide:!0,body:p(),beforeHide:c.beforeHide.bind(c),afterShow:c.afterShow.bind(c),buttons:[{text:r("close"),click:function(){b.hide()}}]}),this.options=a,c.bindEvent(b)},afterShow:function(){var a,b=this,c=this.options,d=b.dialog;a=b.$dialog=$(d.$element),b.$warning=a.find(s.warning),b.$container=a.find(s.container),d.showLoading(),j.confusionMatrix(c.nodeInstanceId,c.nodeDefId,c.experimentId,c.loopTimestamp).then(b.renderSucceed.bind(b),b.renderFailed.bind(b))},renderSucceed:function(a){var b,c=this,d=c.dialog
;d.hideLoading(),c.$warning.toggle(!a),c.$container.toggle(!!a);for(var e in a)a.hasOwnProperty(e)&&(b=a[e]);c.labels=c.getLabels(b.stats),c.initTab(),c.initConfusionMatrix(b.matrix),c.initProportionMatrix(b.matrix),c.initStatsDataTable(b.stats)},getLabels:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c].label);return b},initTab:function(){var a=this,b=a.$dialog;a.tab=new i({selector:b.find(s.tabSelector),activeClassName:t.active})},initConfusionMatrix:function(a){var b=this,c=b.$dialog;b.confusionMatrixChart=new o({container:c.find(s.confusionMatrix)[0],data:a,labels:b.labels,width:200,height:200,columnTitle:r("actual"),rowTitle:r("predicted")})},initProportionMatrix:function(a){var b=this,c=b.$dialog;b.proportionMatrixChart=new o({container:c.find(s.proportionMatrix)[0],data:l.matrix.normalize(a),labels:b.labels,width:200,height:200,cellBackground:!0,columnTitle:r("predicted"),rowTitle:r("actual")})},initStatsDataTable:function(a){var b=this,c={container:b.$dialog.find(s.confusionStats),data:b.parseStatsData(a)};c=$.extend(!0,{},u,c),b.statsTable=new g(c)},parseStatsData:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},renderFailed:function(){var a=this,b=a.dialog,c=a.$container;b.hideLoading(),c.hide().siblings().show()},beforeHide:function(){var a=this;a.tab&&a.tab.destroy(),a.proportionMatrixChart&&a.proportionMatrixChart.destroy(),a.confusionMatrixChart&&a.confusionMatrixChart.destroy(),a.statsTable&&a.statsTable.destroy()},bindEvent:function(){}});return{show:function(a){q||(q=new v),q.show(a)}}}),define("midway/dialog/confusionMatrixPlus/confusionMatrixPlus",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="confusion-matrix-container"><ul class="nav nav-tabs pai-tab"><li class="active" data-target=".confusion-overall"><a href="javascript:void(0);">'+e(d("overall"))+'</a></li><li data-target=".confusion-matrix"><a href="javascript:void(0);">'+e(d("confusionMatrix"))+'</a></li><li data-target=".proportion-matrix"><a href="javascript:void(0);">'+e(d("proportionMatrix"))+'</a></li><li data-target=".confusion-stats"><a href="javascript:void(0);">'+e(d("Stats"))+'</a></li></ul><div class="confusion-overall"><div class="overall-table-1"></div><div class="overall-table-2"></div></div><div class="confusion-matrix"></div><div class="proportion-matrix"></div><div class="confusion-stats"></div></div>'}()}}),define("dialog/confusionMatrixPlus",["zero","zero/zero","zero/declare","zero/dom/event","zero/dom/query","zero/ui/DialogEx","zero/ui/Accordion","zero/ui/DataTable","zero/ui/Popover","zero/ui/Tab","../ajax/model","../global/domLoading","../global/math","../global/utils","../i18n","../charts/ConfusionMatrixChart","../midway/dialog/confusionMatrixPlus/confusionMatrixPlus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";var r,s=a.Popup,t=o.translate,u={tabSelector:".nav-tabs li",warning:".alert-warning",container:".confusion-matrix-container",overallTable01:".overall-table-1",overallTable02:".overall-table-2",confusionMatrix:".confusion-matrix",proportionMatrix:".proportion-matrix",confusionStats:".confusion-stats"},v={dialog:"confusion-matrix-dialog",active:"active"},w={line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,cols:[{title:"指标",field:"key",sort:!0,width:"200px"},{title:"值",field:"value",sort:!0}]},x={line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,cols:[{title:"模型",field:"label",sort:!0,width:"6%"},{title:"TruePositive",field:"TruePositive",sort:!0,width:"10%"},{title:"TrueNegative",field:"TrueNegative",sort:!0,width:"10%"},{title:"FalsePositive",field:"FalsePositive",sort:!0,width:"10%"},{title:"FalseNegative",field:"FalseNegative",sort:!0,width:"10%"},{title:"Sensitivity",field:"Sensitivity",sort:!0,width:"10%"},{title:"Specificity",field:"Specificity",sort:!0,width:"10%"},{title:t("precision"),field:"Precision",width:"10%",sort:!0},{title:t("accuracy"),field:"Accuracy",width:"10%",sort:!0},{title:"F1",field:"F1",width:"7%",sort:!0},{title:"Kappa",field:"Kappa",sort:!0}]},y=c("component/ConfusionMatrixPlus",[],{constructor:function(){},show:function(a){var b,c=this;b=c.dialog=new f({title:t("confusionMatrixPlus"),className:v.dialog,canFullscreen:!0,destroyOnHide:!0,body:q(),beforeHide:c.beforeHide.bind(c),afterShow:c.afterShow.bind(c),buttons:[{text:t("close"),click:function(){b.hide()}}]}),this.options=a},afterShow:function(){var a,b=this,c=this.options,d=b.dialog;a=b.$dialog=$(d.$element),b.$warning=a.find(u.warning),b.$container=a.find(u.container),d.showLoading(),k.queryJsonData(c.experimentId,c.nodeInstanceId,c.loopTimestamp).then(b.renderSucceed.bind(b),b.renderFailed.bind(b))},renderSucceed:function(a){var b=this,c=b.dialog,d=a.jsonData;c.hideLoading(),b.$warning.toggle(!a),b.$container.toggle(!!a),b.labels=d.LabelList,b.initTab(),b.initOverallDataTables(d.OverallMeasures),b.initConfusionMatrix(d.ConfusionMatrix),b.initProportionMatrix(d.ProportionMatrix),b.initStatsDataTable(d.LabelMeasureList)},initTab:function(){var a=this,b=a.$dialog;a.tab=new j({selector:b.find(u.tabSelector),activeClassName:v.active})},initOverallDataTables:function(a){var b=this,c={container:b.$dialog.find(u.overallTable01),data:b.parseOverallData(a)};c=$.extend(!0,{},w,c),b.overallTable01=new h(c),b.$dialog.find(u.overallTable01).on("mouseenter","tbody td",function(){var a=new s(this,{position:"bottom center",fallback:"bottom center",hoverable:!0,classNames:{popup:"ui-popup log-popup"},escape:function(a){return a.length>100?"<pre>"+n.JSONFormat(a)+"</pre>":a}});a.delayedShow(),a.on("hide",function(){setTimeout(function(){a.destroy()},10)})})},parseOverallData:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&"LabelFrequencyBasedMicro"!==c&&"MicroAveraged"!==c&&b.push({key:c,value:_.isObject(a[c])?JSON.stringify(a[c]):a[c]});return b},initConfusionMatrix:function(a){var b=this,c=40,d=b.labels.length,e=b.$dialog;b.confusionMatrixChart=new p({container:e.find(u.confusionMatrix)[0],data:a,labels:b.labels,columnTitle:t("actual"),rowTitle:t("predicted"),width:c*d>300?c*d:300,height:c*d>300?c*d:300})},initProportionMatrix:function(a){var b=this,c=40,d=b.labels.length,e=b.$dialog;b.proportionMatrixChart=new p({container:e.find(u.proportionMatrix)[0],data:a,labels:b.labels,width:c*d>300?c*d:300,height:c*d>300?c*d:300,columnTitle:t("actual"),rowTitle:t("predicted"),cellBackground:!0})},initStatsDataTable:function(a){var b=this,c={container:b.$dialog.find(u.confusionStats),data:b.parseStatsData(a),height:"calc(100% - 60px)"};c=$.extend(!0,{},x,c),b.statsTable=new h(c)},parseStatsData:function(a){var b=this;return a.forEach(function(a,c){a.label=b.labels[c]}),a},renderFailed:function(){var a=this,b=a.dialog,c=a.$container;b.hideLoading(),c.hide().siblings().show()},beforeHide:function(){var a=this;a.tab&&a.tab.destroy(),a.proportionMatrixChart&&a.proportionMatrixChart.destroy(),a.confusionMatrixChart&&a.confusionMatrixChart.destroy(),a.statsTable&&a.statsTable.destroy(),a.overallTable01&&a.overallTable01.destroy()},bindEvent:function(){}});return{show:function(a){r||(r=new y),r.show(a)}}}),define("midway/dialog/simpleSummary/simpleSummary",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a){return'<div class="dialog-simpleSummary"><center style="display:none;">'+d(a)+"</center></div>"}(b.noDataTip)}}),define("dialog/simpleSummary",["zero/zero","zero/ui/DialogEx","../i18n","zero/ui/datatable/plugins/Resizer","zero/ui/DataTable","../midway/dialog/simpleSummary/simpleSummary","../ajax/model","../global/domLoading","../global/tooltip","../global/config","../global/utils"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(){r.dataTable&&r.dataTable.destroy()}function m(){r.showLoading(),g.simpleSummary(q.nodeInstanceId,q.nodeDefId,q.experimentId,q.loopTimestamp).then(n,o)}function n(a){r.hideLoading();var b,c,d,f,g,h,j=u("column"),k=r.$element.find(s.body),l=[],m=[],n=0;a.columnHeaders.unshift("field"),a.columnHeadersChinese.unshift(j),f=a.columnHeaders.length;for(d in a.summary){b={},b.field=d;for(var o=0;o<f-1;o++)c=a.columnHeaders[o+1],b[c]=a.summary[d][o];l.push(b)}for(d=0;d<f;d++)h=a.columnHeaders[d],g=h.length*v+w+y+x,n+=g,m.push({field:h,title:h,sort:!0,width:d===f-1?"":g});r.dataTable=new e({container:k,data:l,cols:m,defaultsort:!0,resizable:!0,grid:!0,height:"calc(100% - 40px)",theme:"small"}),n>k.outerWidth()&&r.dataTable.$(".ui-datatable-head, .ui-datatable-body").width(n),r.$element.data("tooltip",a.columnHeadersChinese),r.$element.find("th").attr("title",""),r.$element.on("mouseover","th",function(){var a=r.$element.data("tooltip"),b=$(this).index();a&&a[b]&&i.show(a[b],this,{gravity:"n"})}),r.$element.on("mouseout","th",function(){i.hide()})}function o(){r.hideLoading(),r.$element.find("center").show()}function p(a){q=a,r=new b({title:u("simpleSummary"),canFullscreen:!0,destroyOnHide:!0,className:t.dialog,body:f({noDataTip:u("noDataTip")},!0),beforeHide:l,afterShow:m,buttons:[{text:u("close"),click:function(){r.hide()}}]})}var q,r,s={body:".modal-body"},t={dialog:"simple-summary-dialog"},u=c.translate,v=8,w=16,x=1,y=16;return{show:p}}),define("midway/components/batchHistograms/batchHistogram",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="batch-histogram-body"></div>'}()}}),define("midway/components/batchHistograms/body",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var c='<div class="field-panel"><div class="header-table"><table class="table table-bordered table-hover table-striped "><thead><tr><th width="36px"><div class="triangle"></div><span class="sorter" ><span class=\'asc\' data-role=\'asc\'></span><span class=\'desc\' data-role=\'desc\'></span></span> </th><th class="field"><div class="field-container J-search-container"><span class="field-name J-field-name">'+e(d("column"))+'</span><input class="field-input J-field-input" placeholder="'+e(d("column"))+'"><span class="icon-search-24 J-field-search"></span><span class="icon-close-o J-field-close"></span></div></th><th>'+e(d("charts"))+'</th></tr></thead></table></div><div class="body-table"><table class="table table-bordered table-hover table-striped"><tbody class="field-tbody J-field-tbody">';return a.each(b.features,function(b,d){c+='<tr data-field="'+e(b.name)+'"><th width="36px">'+e(a.numberToLetter(d+1))+'</th><td class="field"><div class="field-container"><div class="field-name">'+e(b.name)+"</div>",b._entropy&&(c+='\x3c!-- boyu.zlj 增加entropy字段 --\x3e<div class="field-type field-type-entrofy">'+e(b._entropy)+"</div>"),c+='<div class="field-type field-type-'+e(b._type)+'">'+e(b.type)+'</div></div></td><td class="field"><div class="mini-chart J-chart-'+e(b.name)+'"></div></td></tr>'}),c+='</tbody></table></div></div><div class="chart-panel"><div class="panel-container"><div class="step-panel"></div><div class="log-panel"></div></div><div class="main-chart J-main-chart"></div><div class="summaries"></div></div>'}(b.table)}}),define("midway/components/batchHistograms/stepPanel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="step-controller"><span class="">'+e(d("step"))+'</span><div class="input-group"><div class="input-group-btn"><button data-role="step-minus" type="button" class="btn btn-default disabled step-minus">&nbsp;</button></div><input type="text" class="form-control" data-role="step-input" readonly><div class="input-group-btn"><button data-role="step-plus" type="button" class="btn btn-default"><i class="icon icon-plus-l-thin"></i></button></div></div><span data-role="step-times"></span></div><div class="step-result"><span>'+e(d("bins"))+'</span><strong data-role="step-bins"></strong></div>'}()}}),define("midway/components/batchHistograms/logPanel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<label for="log-scale-checkbox"><input type="checkbox" id="log-scale-checkbox">'+e(d("logScaleY"))+'</label><label for="log-scale-basement">'+e(d("basement"))+'<input type="number" id="log-scale-basement" value="10"></label>'}()}}),define("components/batchHistograms/BasicHistogram",["zero/zero","zero/declare","../../i18n","zero/ui/AutoComplete","../../midway/components/batchHistograms/batchHistogram","../../midway/components/batchHistograms/body","../../midway/components/batchHistograms/stepPanel","../../midway/components/batchHistograms/logPanel","../../ajax/model","../../global/tooltip","../../global/config","../../global/utils","../../global/math","../../charts/bar"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o={body:".batch-histogram-body",mainChart:".J-main-chart",fieldRow:".J-field-tbody tr",miniChartPrefix:".J-chart-",searchContainer:".J-search-container",field:".field-panel [data-field]",fieldInput:".J-field-input",fieldSearch:".J-field-search",fieldName:".J-field-name",fieldClose:".J-field-close",logPanel:".log-panel",stepPanel:".step-panel",stepInput:'[data-role="step-input"]',stepTimes:'[data-role="step-times"]',stepBins:'[data-role="step-bins"]',stepMinus:'[data-role="step-minus"]',stepPlus:'[data-role="step-plus"]',warning:".alert-warning",summaries:".summaries",logCheckbox:"#log-scale-checkbox",logBasement:"#log-scale-basement",sorter:".sorter span"},p={onSearch:"on-search",disabled:"disabled"},q=c.translate,r={num:q("num"),enum:q("enum")};return b("component/BasicHistogram",[],{hasStepPanel:!0,hasLogPanel:!0,constructor:function(a){var b=this;b.times=[1,2,4,5,10,20,50],b.miniCharts=[],b.dataMap={},b.currentStep={},b.$container=$(a.container),b.bindEvents(),b.bindEventsWithNoOverwrite(),b.render(a.data)},bindEventsWithNoOverwrite:function(){var a=this;a.$container.on("click",o.sorter,a.onSorterClick.bind(a))},bindEvents:function(){var a=this,b=a.$container;b.on("click",o.fieldName+", "+o.fieldSearch,a.onFieldSearch.bind(a)),b.on("keyup",o.fieldInput,a.onFieldKeyup.bind(a)),b.on("click",o.fieldClose,a.onFieldClose.bind(a)),b.on("click",o.field,a.onFieldClick.bind(a)),b.on("mouseleave",o.field,a.onMouseleave.bind(a)),b.on("mouseenter",o.field,a.onMouseenter.bind(a)),b.on("click",o.stepMinus,a.onStepMinus.bind(a)),b.on("click",o.stepPlus,a.onStepPlus.bind(a)),b.on("click",o.logCheckbox,a.onlogCheck.bind(a)),b.on("change",o.logBasement,a.onLogBasement.bind(a))},render:function(b){var c,d=this;c=d.$container.append(e()),b=d.data=d.parseData(b),d.labelValue=b.label&&b.label.value,a.numberToLetter=l.numberToLetter,a.padLeft=l.padLeft,b&&(c.find(o.body).append(f({table:b})),d.$stepPanel=c.find(o.stepPanel),d.$logPanel=c.find(o.logPanel),d.$searchContainer=c.find(o.searchContainer),d.$fieldInput=c.find(o.fieldInput),d.$fieldName=c.find(o.fieldName),d.$fieldClose=c.find(o.fieldClose),d.$summaries=c.find(o.summaries),d.hasStepPanel?(d.$stepPanel.append(g()),d.$stepInput=c.find(o.stepInput),d.$stepBins=c.find(o.stepBins),d.$stepTimes=c.find(o.stepTimes),d.$stepMinus=c.find(o.stepMinus),d.$stepPlus=c.find(o.stepPlus)):d.$stepPanel.hide(),d.hasLogPanel?(d.$logPanel.append(h()),d.$logCheckbox=c.find(o.logCheckbox),d.$logBasement=c.find(o.logBasement)):d.$logPanel.hide(),b.features.forEach(function(a){var b=d.parseFeature(a);d.dataMap[a.name]={container:b,feature:a},d.renderMiniChart(b)}),c.find(o.fieldRow).first().click(),d.initAutoComplete(b))},onSorterClick:function(a){var b=this,c=$(a.target),d=c.parent().find("span.active"),e=b.$container.find(o.fieldRow),f=e.parent(),g=a.target.dataset.role;a&&a.target&&(c.hasClass("active")||(d.removeClass("active"),c.addClass("active"),"asc"===g?e.sort(function(a,b){return a.dataset.field>b.dataset.field?1:-1}):"desc"===g&&e.sort(function(a,b){return a.dataset.field>b.dataset.field?-1:1}),e.detach().appendTo(f)))},onFieldSearch:function(){var a=this,b=a.$fieldInput;if(b.is(":hidden"))a.$searchContainer.addClass("on-search"),b.show().focus(),a.$fieldName.hide();else{var c={name:_.trim(b.val()),type:"field"};a.onAutoCompleteSelect(c)}},onFieldKeyup:function(){var a=this,b=a.$fieldInput;if(0===_.trim(b.val()).length){var c={name:_.trim(b.val()),type:"field"};a.onAutoCompleteSelect(c)}else a.$fieldClose.show()},onFieldClose:function(){var a=this;a.$fieldInput.val(""),a.$container.find(o.field).show(),a.$fieldClose.hide()},onFieldClick:function(a){var b=this,c=$(a.currentTarget);b.currentField=c.data("field"),b.currentChartData=b.dataMap[b.currentField].container,b.renderMainChart(),b.hasStepPanel&&b.refreshSteps(),b.hasLogPanel&&b.refreshLogs(),b.renderSummaries(),c.siblings().removeClass("current"),c.addClass("current")},onMouseleave:function(a){var b,c,d=this,e=$(a.currentTarget);b=e.data("field"),c=d.$container.find("[data-field="+b+"]"),c.removeClass("hover")},onMouseenter:function(a){var b,c,d=this,e=$(a.currentTarget);b=e.data("field"),c=d.$container.find("[data-field="+b+"]"),c.addClass("hover")},onStepMinus:function(){var a,b=this,c=b.currentStep;c.index>0&&(c.index--,b.setStepsValue(),0===c.index&&b.$stepMinus.addClass(p.disabled),b.$stepPlus.removeClass(p.disabled),a=b.getChartData(),b.renderMainChart(a))},onStepPlus:function(){var a,b=this,c=b.times,d=b.currentStep;d.index<c.length-1&&(d.index++,b.setStepsValue(),d.index===c.length-1&&b.$stepPlus.addClass(p.disabled),b.$stepMinus.removeClass(p.disabled),a=b.getChartData(),b.renderMainChart(a))},onlogCheck:function(a){this.changeChartByLog()},onLogBasement:function(a){this.changeChartByLog()},changeChartByLog:function(){var a,b=this;a=b.getChartData(),b.renderMainChart(a)},parseLog:function(a,b){var c=this,d=a.yAxis,e=parseInt(c.$logBasement.val());return d.forEach(function(a){b?(a.type="log",a.logLabelBase=10!==e?e:void 0):a.type="value"}),a},parseData:function(a){return a.features.forEach(function(a){a._type=a.type,a.type=r[a.type]}),a},getChartData:function(){var a,b,c=this,d=c.times[c.currentStep.index];return a=_.cloneDeep(c.dataMap[c.currentField].feature),c.hasStepPanel&&(a.step=d*c.currentStep.minStep,a.distribution.forEach(function(b,c){a.distribution[c]=m.array.merge(a.distribution[c],d)})),b=c.parseFeature(a),c.hasLogPanel&&(b=c.parseLog(b,c.$logCheckbox.is(":checked"))),b},parseFeature:function(a){var b,c,d,e,f={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},g=a.distribution[0].length,h=[];if("num"===a._type){for(c=a.min,b=0;b<g;b++)d=l.accAdd(c,a.step),e=c+" ~ "+d,h.push(e),f.xAxis[0].data.push(e),c=d;f.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(f.xAxis[0].data=a.value,f.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}});return f.series.push({name:a.name,data:a.distribution[0],type:"bar"}),f},initAutoComplete:function(a){var b,c,e=this;b=_.map(a.features,function(a){return{name:a.name,type:"field"}}),c=_.map(a.features,function(a){return{name:a.type,type:"type"}}),c=_.uniq(c,"name"),e.ac=new d({input:e.$container.find(".J-field-input"),ignorecase:!0,data:b.concat(c),minLength:0,max:10}).on("select",e.onAutoCompleteSelect.bind(e))},onAutoCompleteSelect:function(a){var b=this,c=b.$container,d=b.filter(b.data,a);d.length?(c.find(o.field).hide(),_.forEach(d,function(a){c.find("[data-field="+a+"]").show()}),b.$fieldClose.show()):c.find(o.field).show()},renderMiniChart:function(a){var b,c=this,d={element:c.$container.find(o.miniChartPrefix+a.name),mini:!0};$.extend(d,a),b=new n(d),c.miniCharts.push(b)},filter:function(a,b){var c=[];return"field"===b.type?_.forEach(a.features,function(a){-1!==a.name.indexOf(b.name)&&c.push(a.name)}):"type"===b.type&&_.forEach(a.features,function(a){a.type===b.name&&c.push(a.name)}),c},destroyMiniCharts:function(){var a=this;a.miniCharts.forEach(function(a){a.destroy()}),a.miniCharts=[]},renderMainChart:function(a){var b=this,c={element:b.$container.find(o.mainChart)};$.extend(c,a||b.currentChartData),b.destroyMainChart(),b.mainChart=new n(c)},refreshSteps:function(){var a=this,b=a.dataMap[a.currentField].feature;if("enum"===b._type)return void a.$stepPanel.hide();a.$stepPanel.show(),a.currentStep={minStep:b.step,index:0,initBins:b.distribution[0].length},a.setStepsValue(),a.$stepMinus.addClass(p.disabled),a.$stepPlus.removeClass(p.disabled)},refreshLogs:function(){var a=this;a.$logCheckbox.prop("checked",!1),a.$logBasement.val(10)},renderSummaries:function(){},setStepsValue:function(){var a=this;a.$stepTimes.text(q("times",a.times[a.currentStep.index])),a.$stepInput.val(a.times[a.currentStep.index]*a.currentStep.minStep),a.$stepBins.text(a.currentStep.initBins/a.times[a.currentStep.index])},destroy:function(){var a=this;a.destroyMainChart(),a.destroyMiniCharts(),a.ac&&a.ac.destroy()},destroyMainChart:function(){var a=this;a.mainChart&&(a.mainChart.destroy(),a.mainChart=null)}})}),define("components/batchHistograms/Percentile",["zero/declare","zero/ui/DataTable","./BasicHistogram","../../global/utils"],function(a,b,c,d){"use strict";return a("component/Percentile",[c],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){c.prototype.constructor.call(this,a)},parseFeature:function(a){var b,c,e,f,g={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},h=a.distribution[0].length;if("num"===a._type){for(c=a.min,g.xAxis[0].data.push(c),b=0;b<h;b++)e=d.accAdd(c,a.step),f=e,g.xAxis[0].data.push(f),c=e;g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(g.xAxis[0].data=a.value,g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}});return g.series.push({name:a.name,data:a.distribution[0],type:"bar"}),g},renderSummaries:function(){var a=this,c=a.dataMap[a.currentField].feature;a.summaryTable&&a.summaryTable.destroy(),a.summaryTable=new b({theme:"small",line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,container:a.$summaries,data:[c.metrics],cols:[{title:"Max",field:"max",width:"20%"},{title:"Median",field:"median",width:"20%"},{title:"Min",field:"min",width:"20%"},{title:"Q1",field:"q1",width:"20%"},{title:"Q3",field:"q3"}]})},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),c.prototype.destroy.call(this)}})}),define("dialog/analytic/percentile",["zero/zero","zero/declare","zero/ui/DialogEx","../../components/batchHistograms/Percentile","../../i18n","../../ajax/model"],function(a,b,c,d,e,f){"use strict";var g={dialogBody:".modal-content .modal-body"},h={dialog:"dialog-percentile batch-histogram"},i=e.translate,j=b("dialog/PercentileDialog",[],{show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:i("percentile"),canFullscreen:!0,className:h.dialog,beforeHide:b.onBeforeHide.bind(b),destroyOnHide:!0,afterShow:b.onAfterShow.bind(b),buttons:[{text:i("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){this.component&&this.component.renderMainChart()},onBeforeHide:function(){this.component&&this.component.destroy()},onAfterShow:function(){var a=this;a.dialog.showLoading(),f.percentile(a.nodeData.nodeInstanceId,a.nodeData.nodeDefId,a.nodeData.experimentId,a.nodeData.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this.dialog;b.hideLoading(),this.component=new d({container:b.$element.find(g.dialogBody),data:a})},renderFailed:function(){this.dialog.hideLoading(),this.dialog.showEmpty()}});return{show:function(a){(new j).show(a)}}}),define("midway/components/binningWoe/binningWoe",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c){var f='<div class="binning-woe">';return b||(f+='<div class="save-all"><a class="do-save J-save-all"><span class="icon-save"></span>'+e(d("saveAllResult"))+"</a></div>"),f+='<div class="field-panel"><div class="header-table"><table class="table table-bordered table-hover table-striped "><thead><tr><th class="field-index"><div class="triangle"></div></th><th class="field field-info"><div class="field-container J-search-container"><span class="field-name J-field-name">'+e(d("column"))+'</span><input class="field-input J-field-input" placeholder="'+e(d("column"))+'"><span class="icon-search-24 J-field-search"></span><span class="icon-close-o J-field-close"></span></div></th ><th class="field-chart">'+e(d("charts"))+'</th></tr></thead></table></div><div class="body-table"><table class="table table-bordered table-hover table-striped"><tbody class="field-tbody J-field-tbody">',a.each(c.features,function(b,c){f+='<tr data-field="'+e(b.name)+'"><th class="field-index">'+e(a.numberToLetter(c+1))+'</th><td class="field field-info"><div class="field-container"><div class="field-name">'+e(b.name)+'</div><div class="field-type field-type-'+e(b.type)+'">'+e(b.type)+'</div></div></td><td class="field field-chart"><div class="mini-chart J-chart-'+e(b.name)+'"></div></td></tr>'}),f+='</tbody></table></div></div><div class="chart-panel"><div class="main-chart J-main-chart"></div></div></div>'}(b.hideSaveBtn,b.table)}}),define("components/binningWoe/BinningWoe",["zero/zero","zero/declare","../../i18n","zero/ui/AutoComplete","zero/ui/LoadingPanel","../../midway/components/binningWoe/binningWoe","../../ajax/model","../../global/tooltip","../../global/config","../../global/utils","../../global/math","../../charts/bar","../common/WoePreviewDialog","../common/binningUtil"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o=(c.translate,{body:".binning-woe",mainChart:".J-main-chart",fieldRow:".J-field-tbody tr",miniChartPrefix:".J-chart-",searchContainer:".J-search-container",field:"[data-field]",fieldInput:".J-field-input",fieldSearch:".J-field-search",fieldName:".J-field-name",fieldClose:".J-field-close",saveAll:".J-save-all"}),p={onSearch:"on-search",disabled:"disabled"};return echarts.config=echarts.config||{EVENT:{LEGEND_SELECTED:"legendselected"}},b("components/BinningWoe",[],{constructor:function(a){var b=this;b.$container=$(a.container),b.nodeData=a.node,b.hideSaveBtn=a.hideSaveBtn,b.chartDataMap={},b.miniCharts=[],b.bindEvents(),b.render()},bindEvents:function(){var a=this,b=a.$container;b.on("click",o.fieldName+", "+o.fieldSearch,a.onFieldSearch.bind(a)),b.on("keyup",o.fieldInput,a.onFieldKeyup.bind(a)),b.on("click",o.fieldClose,a.onFieldClose.bind(a)),b.on("click",o.field,a.onFieldClick.bind(a)),b.on("mouseleave",o.field,a.onMouseleave.bind(a)),b.on("mouseenter",o.field,a.onMouseenter.bind(a)),b.on("click",o.saveAll,a.onSaveAllResult.bind(a))},onFieldSearch:function(){var a=this,b=a.$fieldInput;if(b.is(":hidden"))a.$searchContainer.addClass(p.onSearch),b.show().focus(),a.$fieldName.hide();else{var c={name:_.trim(b.val()),type:"field"};a.onAutoCompleteSelect(c)}},onFieldKeyup:function(){var a=this,b=a.$fieldInput;if(0===_.trim(b.val()).length){var c={name:_.trim(b.val()),type:"field"};a.onAutoCompleteSelect(c)}else a.$fieldClose.show()},onFieldClose:function(){var a=this;a.$fieldInput.val(""),a.$container.find(o.field).show(),a.$fieldClose.hide()},onFieldClick:function(a){var b=this,c=$(a.currentTarget);b.currentField=c.data("field"),b.renderMainChart(),c.siblings().removeClass("current"),c.addClass("current")},onMouseleave:function(a){var b,c,d=this,e=$(a.currentTarget);b=e.data("field"),c=d.$container.find("[data-field="+b+"]"),c.removeClass("hover")},onMouseenter:function(a){var b,c,d=this,e=$(a.currentTarget);b=e.data("field"),c=d.$container.find("[data-field="+b+"]"),c.addClass("hover")},render:function(){var a=this,b=a.nodeData;a.loadingPanel=new e({target:a.$container}),a.loadingPanel.show(),g.getBinning(b.nodeInstanceId,b.experimentId).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(b){var c=this,d=c.$container;c.data=b,c.loadingPanel.hide(),a.numberToLetter=j.numberToLetter,a.padLeft=j.padLeft,d.append(f({table:b,hideSaveBtn:!!c.hideSaveBtn})),c.$searchContainer=d.find(o.searchContainer),c.$mainChart=d.find(o.mainChart),c.$fieldInput=d.find(o.fieldInput),c.$fieldName=d.find(o.fieldName),c.$fieldClose=d.find(o.fieldClose),b.features.forEach(function(a){var b=n.parseFeatureForChart(a);c.chartDataMap[a.name]={container:b,feature:a},c.renderMiniChart(b)}),d.find(o.fieldRow).first().click(),c.initAutoComplete(b)},renderFailed:function(){this.loadingPanel.hide()},renderMiniChart:function(a){var b,c=this,d=c.$container,e={element:d.find(o.miniChartPrefix+a.name),mini:!0};$.extend(e,a),b=new l(e),c.miniCharts.push(b)},renderMainChart:function(a){var b=this,c={element:b.$mainChart,legend:{selected:b.selectedLegend||{}}};(a=a||b.chartDataMap[b.currentField].container)&&(c=$.extend(!0,{},a,c),b.destroyMainChart(),b.mainChart=new l(c),b.mainChart.echart.on(echarts.config.EVENT.LEGEND_SELECTED,b.onLegendSelected.bind(b)))},onLegendSelected:function(a){this.selectedLegend=a.selected},initAutoComplete:function(a){var b,c,e=this;b=_.map(a.features,function(a){return{name:a.name,type:"field"}}),c=_.map(a.features,function(a){return{name:a.type,type:"type"}}),c=_.uniq(c,"name"),e.autocomplete=new d({input:e.$container.find(".J-field-input"),ignorecase:!0,data:b.concat(c),minLength:0,max:10}).on("select",e.onAutoCompleteSelect.bind(e))},onAutoCompleteSelect:function(a){var b,c=this,d=c.$container;b=c.filter(c.data,a),b.length?(d.find(o.field).hide(),_.forEach(b,function(a){d.find("[data-field="+a+"]").show()}),c.$fieldClose.show()):d.find(o.field).show()},filter:function(a,b){var c=[];return"field"===b.type?_.forEach(a.features,function(a){-1!==a.name.indexOf(b.name)&&c.push(a.name)}):"type"===b.type&&_.forEach(a.features,function(a){a.type===b.name&&c.push(a.name)}),c},destroy:function(){var a=this;a.autocomplete&&a.autocomplete.destroy(),a.loadingPanel&&a.loadingPanel.destroy(),a.destroyMainChart(),a.destroyMiniCharts()},destroyMiniCharts:function(){var a=this;a.miniCharts&&(a.miniCharts.forEach(function(a){a.destroy()}),a.miniCharts=[])},destroyMainChart:function(){var a=this;a.mainChart&&(a.mainChart.echart.off(echarts.config.EVENT.LEGEND_SELECTED),a.mainChart.destroy(),a.mainChart=null)},onSaveAllResult:function(){new m({data:this.data,chartDataMap:this.chartDataMap,$mainChart:this.$mainChart}).show()}})}),define("dialog/analytic/advanceHistograms",["zero/zero","zero/declare","zero/ui/DialogEx","../../components/binningWoe/BinningWoe","../../i18n","../../ajax/model","../../global/utils"],function(a,b,c,d,e,f,g){"use strict";var h={dialogBody:".modal-content .modal-body"},i={dialog:"batch-histogram"},j=e.translate,k=b("dialog/AdvanceBatchHistograms",[],{constructor:function(){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({
title:j("advanceHistogram"),canFullscreen:!0,className:i.dialog,beforeHide:b.onBeforeHide.bind(b),destroyOnHide:!0,afterShow:b.onAfterShow.bind(b),buttons:[{text:j("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){var a=this;a.component&&a.component.renderMainChart()},onBeforeHide:function(){var a=this;a.component&&a.component.destroy()},onAfterShow:function(){var a=this;a.dialog.showLoading(),a.renderSucceed.call(a,a.nodeData)},renderSucceed:function(a){var b=this,c=b.dialog;c.hideLoading(),b.component=new d({container:c.$element.find(h.dialogBody),node:a,hideSaveBtn:!0})},renderFailed:function(){var a=this,b=a.dialog;b.hideLoading(),b.showEmpty()}});return{show:function(a){(new k).show(a)}}}),define("midway/dialog/analytic/pearson",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f,g,h,i){var j='<table class="table table-bordered table-hover table-striped"><thead><tr><th>'+e(d("property"))+"</th><th>"+e(d("value"))+"</th></tr></thead><tbody><tr><td>"+e(d("sourceTableName"))+"</td><td>"+e(a)+"</td></tr>";return b&&(j+="<tr><td>"+e(d("sourcePartitionName"))+"</td><td>"+e(b)+"</td></tr>"),j+="<tr><td>"+e(d("firstColumnName"))+"</td><td>"+e(c)+"</td></tr><tr><td>"+e(d("secondColumnName"))+"</td><td>"+e(f)+"</td></tr><tr><td>"+e(d("rowCount"))+"</td><td>"+e(g)+"</td></tr><tr><td>"+e(d("validRowCount"))+"</td><td>"+e(h)+"</td></tr><tr><td>"+e(d("pearsonCoefficient"))+"</td><td>"+e(i)+"</td></tr></tbody></table>"}(b.srcTable,b.srcParts,b.col1Name,b.col2Name,b.countTotal,b.countValid,b.pearsonCoeff)}}),define("dialog/analytic/pearson",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../midway/dialog/analytic/pearson"],function(a,b,c,d,e){"use strict";function f(a){new b({title:g("pearson"),destroyOnHide:!0,canFullscreen:!1,afterShow:function(){var b=this;b.showLoading(),d.queryPearson(a.nodeInstanceId,a.nodeDefId,a.experimentId,a.loopTimestamp).then(function(a){b.hideLoading(),b.set("body",e(a))},function(){b.hideLoading(),b.showEmpty()})},buttons:[{text:g("close"),click:function(){this.hide()}}]})}var g=c.translate;return{show:f}}),define("midway/dialog/analytic/modularity",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f,g,h,i){var j='<table class="table table-bordered table-hover table-striped"><thead><tr><th>'+e(d("property"))+"</th><th>"+e(d("value"))+"</th></tr></thead><tbody><tr><td>"+e(d("sourceTableName"))+"</td><td>"+e(a)+"</td></tr>";return b&&(j+="<tr><td>"+e(d("sourcePartitionName"))+"</td><td>"+e(b)+"</td></tr>"),j+="<tr><td>"+e(d("fromVertexCol"))+"</td><td>"+e(c)+"</td></tr><tr><td>"+e(d("fromGroupCol"))+"</td><td>"+e(f)+"</td></tr><tr><td>"+e(d("toVertexCol"))+"</td><td>"+e(g)+"</td></tr><tr><td>"+e(d("toGroupCol"))+"</td><td>"+e(h)+"</td></tr><tr><td>"+e(d("modularity"))+"</td><td>"+e(i)+"</td></tr></tbody></table>"}(b.srcTable,b.srcParts,b.fromVertexCol,b.fromGroupCol,b.toVertexCol,b.toGroupCol,b.modularity)}}),define("dialog/analytic/modularity",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../midway/dialog/analytic/modularity","../../global/utils"],function(a,b,c,d,e,f){"use strict";function g(a){new b({title:h("Modularity"),destroyOnHide:!0,canFullscreen:!1,afterShow:function(){var b=this;b.showLoading(),d.queryModularity(a.nodeInstanceId,a.nodeDefId,a.experimentId,a.loopTimestamp).then(function(a){b.hideLoading(),b.set("body",e(a))},function(){b.hideLoading(),b.showEmpty()})},buttons:[{text:h("close"),click:function(){this.hide()}}]})}var h=c.translate;return{show:g}}),define("midway/dialog/analytic/tTest",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<table class="table table-bordered table-hover table-striped"><tbody>';return a.each(b,function(a,b){c+="<tr><td>"+d(b)+"</td><td>"+d(a)+"</td></tr>"}),c+="</tbody></table>"}(b.jsonData)}}),define("dialog/analytic/tTest",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../midway/dialog/analytic/tTest"],function(a,b,c,d,e){"use strict";function f(a){new b({title:g("tTest"),className:"dialog-tTest",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var b=this;b.showLoading(),d.queryJsonData(a.experimentId,a.nodeInstanceId,a.loopTimestamp).then(function(a){b.hideLoading(),b.set("body",e(a))},function(){b.hideLoading(),b.showEmpty()})},buttons:[{text:g("close"),click:function(){this.hide()}}]})}var g=c.translate;return{show:f}}),define("midway/dialog/analytic/chisqTest",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<table class="table table-bordered table-hover table-striped"><tbody>';return a.each(b,function(b,e){c+='<tr><td colspan="2">'+d(e)+"</td></tr>",a.each(b,function(a,b){c+="<tr><td>"+d(b)+"</td><td>"+d(a)+"</td></tr>"}),c+=""}),c+="</tbody></table>"}(b.jsonData)}}),define("dialog/analytic/chisqTest",["zero/zero","zero/ui/DialogEx","../../i18n","../../global/codeName","../../ajax/model","../../midway/dialog/analytic/chisqTest"],function(a,b,c,d,e,f){"use strict";function g(a){var c=a.codeName,g="";g=h(d.isSameCodeName(c,"chisq_test_fit")?"chisqTestFit":d.isSameCodeName(c,"chisq_test_independence")?"chisqTestIndependence":"chisqTest"),new b({title:g,className:"dialog-chisqTest",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var b=this;b.showLoading(),e.queryJsonData(a.experimentId,a.nodeInstanceId,a.loopTimestamp).then(function(a){b.hideLoading(),b.set("body",f(a))},function(){b.hideLoading(),b.showEmpty()})},buttons:[{text:h("close"),click:function(){this.hide()}}]})}var h=c.translate;return{show:g}}),define("midway/dialog/analytic/evaluation",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<ul class="nav nav-tabs pai-tab"><li class="active" data-target=".indices-table"><a href="javascript:void(0);">'+e(d("indicesData"))+'</a></li><li data-target=".evaluation-charts"><a href="javascript:void(0);">'+e(d("charts"))+'</a></li></ul><div class="indices-table"></div><div class="evaluation-charts"></div>'}()}}),define("dialog/analytic/evaluation",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","zero/ui/DataTable","../../i18n","../../ajax/model","../../midway/dialog/analytic/evaluation","../../components/batchHistograms/BasicHistogram"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=f.translate,k={indicesTable:".indices-table",evaluationCharts:".evaluation-charts",tabSelector:".nav-tabs li"},l={dialog:"batch-histogram evaluation-dialog",active:"active"},m={line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,sort:{field:"id",type:"desc"},cols:[{title:j("index"),field:"index",description:"指标",sort:!0,width:"50%"},{title:j("value"),field:"value",description:"值"}]},n=b("dialog/Evaluation",[],{constructor:function(){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:j("regressionEvaluation"),className:l.dialog,destroyOnHide:!0,canFullscreen:!0,body:h(),beforeHide:b.onBeforeHide.bind(b),afterShow:b.onAfterShow.bind(b),buttons:[{text:j("close"),click:function(){this.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){var a=this;a.component&&a.component.renderMainChart()},onBeforeHide:function(){var a=this;a.indicsTable&&a.indicsTable.destroy(),a.tab&&a.tab.destroy(),a.component&&a.component.destroy()},onAfterShow:function(){this.render()},render:function(){var a=this;a.dialog.showLoading(),g.queryRegressionEvaData(a.nodeData.experimentId,a.nodeData.nodeInstanceId,a.nodeData.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog;c.hideLoading(),b.$indicsTable=c.$element.find(k.indicesTable),b.$evaluationCharts=c.$element.find(k.evaluationCharts),b.tab=new d({selector:c.$element.find(k.tabSelector),activeClassName:l.active,activeIndex:1}),b.renderIndicesTable(a.jsonData),b.renderEvaluationChart(a.histograms)},renderFailed:function(){var a=this,b=a.dialog;b.hideLoading(),b.showEmpty()},parseIndicesData:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({index:c,value:a[c]});return b},renderIndicesTable:function(a){var b=this,c={container:b.$indicsTable,data:b.parseIndicesData(a),height:"calc(100% - 70px)"};c=$.extend(!0,{},m,c),b.indicsTable=new e(c)},renderEvaluationChart:function(a){var b=this;b.component=new i({container:b.$evaluationCharts,data:a})}});return{show:function(a){(new n).show(a)}}}),define("components/batchHistograms/FeatureImportance",["zero/zero","zero/declare","./BasicHistogram","../../charts/bar"],function(a,b,c,d){"use strict";return b("component/FeatureImportance",[c],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){c.prototype.constructor.call(this,a)},parseFeature:function(b){var c=b.name,d=b.cols,e=b.data,f=a.map(d,function(a,b){return{key:a,val:e[b]}});return f.sort(function(a,b){return a.val-b.val}),d=[],e=[],a.each(f,function(a){d.push(a.key),e.push(a.val)}),{title:{text:c,subtext:b.type},name:c,imageName:c,toolbox:{feature:{restore:{show:!0},saveAsImage:{show:!0}}},xAxis:[{type:"category",data:d,axisLabel:{show:!0,rotate:0}}],yAxis:[{type:"value",min:0,splitNumber:5,axisLabel:{show:!0,rotate:0}}],dataZoom:{show:!1},series:[{name:c,type:"bar",data:e}]}},renderMainChart:function(a){var b={element:this.$container.find(".J-main-chart"),cancelSmart:{dataZoom:!0}};$.extend(b,a||this.currentChartData),this.destroyMainChart(),this.mainChart=new d(b)}})}),define("midway/dialog/analytic/featureImportance",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("dialog/analytic/featureImportance",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../components/batchHistograms/FeatureImportance","../../midway/dialog/analytic/featureImportance"],function(a,b,c,d,e,f){"use strict";function g(c){function g(){var b=this;b.showLoading(),d.queryColsAsHistogramSchema(c.nodeInstanceId,c.experimentId,c.loopTimestamp).then(function(c){var d=c.cols,f=c.vals,g=[];a.each(f,function(a,b){g.push({name:b,data:a,cols:d,type:"enum"})}),j=new e({container:b.$(".chart-wrap"),data:{features:g}}),b.hideLoading(),b.on("fullScreen",function(){j&&j.renderMainChart()})},function(){b.hideLoading(),b.showEmpty()})}function i(){j&&j.destroy()}var j=null;new b({title:h("histogram"),className:"batch-histogram dialog-output-feature-importance",body:f(),destroyOnHide:!0,canFullscreen:!0,afterShow:g,afterHide:i,buttons:[{text:h("close"),click:function(){this.hide()}}]})}var h=c.translate;return{show:g}}),define("components/batchHistograms/EnumFeatureSelection",["zero/declare","zero/ui/DataTable","./BasicHistogram","../../i18n"],function(a,b,c,d){"use strict";var e=d.translate,f={num:e("num"),enum:e("enum")};return a("component/EnumFeatureSelection",[c],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){c.prototype.constructor.call(this,a)},parseData:function(a){return a.features.forEach(function(a){a._type=a.type,a.type=f[a.type],a._entropy=e("entropy")+":  "+(a.featureEntropy&&a.featureEntropy.toFixed(4)||a.totalEntropy&&a.totalEntropy.toFixed(4)||"none")}),a},parseFeature:function(a){var b,c,d,f,g=this,h=g.labelValue,i={overideBarOptions:!0,title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},j=a.distribution[0].length,k=[],l=[{name:e("gini"),data:a.gini,type:"line",yAxisIndex:1},{name:e("entropy"),data:a.entropy,type:"line",yAxisIndex:1}],m=_.pluck(l,"name");if("num"===a._type){for(c=a.min,b=0;b<j;b++)d=utils.accAdd(c,a.step),f=c+" ~ "+d,k.push(f),i.xAxis[0].data.push(f),c=d;i.tooltip.formatter=function(a){if(a){var b=k[a[0].dataIndex];return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(i.xAxis[0].data=a.value,i.tooltip.formatter=function(a){if(a){var b=a[0].name,c=this.currentChartData;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a,d){c.series[a.seriesName]&&void 0!==c.series[a.seriesName].ratio?b+="<br>"+a.seriesName+": "+(100*c.series[a.seriesName].ratio[a.dataIndex]).toFixed(2)+"%   ("+a.value+")":b+="<br>"+a.seriesName+" : "+a.value}),b}}.bind(this));if(h){for(var b=0,n=h.length;b<n;b++)i.series.push({name:h[b],data:a.distribution[b],type:"bar",stack:a.name,ratio:a.ratios[b]});i.series=i.series.concat(l),i.legend={data:h.slice(0,3).concat(m),selected:{}}}else i.series.push({name:a.name,data:a.distribution[0],type:"bar"});return i},renderSummaries:function(){var a=this,c=a.dataMap[a.currentField].feature,d=["totalEntropy","totalGini","totalGinigain","totalInfogain","totalInfogainratio"],e={};a.summaryTable&&a.summaryTable.destroy(),c.total?e=c.total:d.forEach(function(a){e[a]=c[a]}),a.summaryTable=new b({theme:"small",line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,container:a.$summaries,data:[e],cols:[{title:"Entropy",field:"totalEntropy",width:"20%"},{title:"Gini",field:"totalGini",width:"20%"},{title:"Gini Gain",field:"totalGinigain",width:"20%"},{title:"Info Gain",field:"totalInfogain",width:"20%"},{title:"Info Gain Ratio",field:"totalInfogainratio"}]})},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),c.prototype.destroy.call(this)}})}),define("dialog/analytic/EnumFeatureSelection",["zero/zero","zero/declare","zero/ui/DialogEx","../../components/batchHistograms/EnumFeatureSelection","../../i18n","../../ajax/model","../../global/utils"],function(a,b,c,d,e,f,g){"use strict";var h={dialogBody:".modal-content .modal-body"},i={dialog:"batch-histogram"},j=e.translate,k=b("dialog/EnumFeatureSelection",[],{constructor:function(){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:j("enumAnalysisReport"),canFullscreen:!0,className:i.dialog,beforeHide:b.onBeforeHide.bind(b),destroyOnHide:!0,afterShow:b.onAfterShow.bind(b),buttons:[{text:j("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){var a=this;a.component&&a.component.renderMainChart()},onBeforeHide:function(){var a=this;a.component&&a.component.destroy()},onAfterShow:function(){var a=this;a.dialog.showLoading(),f.queryEnumFeatureSelectionData(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog;c.hideLoading(),this.component=new d({container:c.$element.find(h.dialogBody),data:a})},renderFailed:function(){var a=this,b=a.dialog;b.hideLoading(),b.showEmpty()}});return{show:function(a){(new k).show(a)}}}),define("components/batchHistograms/FeatureEngineering",["zero/declare","zero/ui/DataTable","./BasicHistogram","../../global/math","../../i18n","../../global/utils"],function(a,b,c,d,e,f){"use strict";var g=e.translate,h={num:g("num"),enum:g("enum")};return a("component/featureEngineering",[c],{hasStepPanel:!0,hasLogPanel:!1,constructor:function(a){c.prototype.constructor.call(this,a)},parseData:function(a){return a.features.forEach(function(a){a._type=a.type,a.type=h[a.type],a._entropy=g("entropy")+":  "+(a.featureEntropy&&a.featureEntropy.toFixed(4)||a.totalEntropy&&a.totalEntropy.toFixed(4)||"none")}),a},parseFeature:function(a){var b,c,e,h,i=this,j=i.labelValue,k={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},l=a.distribution[0].length,m=[],n=d.matrix.transpose(a.distribution),o=[{name:g("gini"),data:a.gini||i.calculateGini(n),type:"line",yAxisIndex:1},{name:g("entropy"),data:a.entropy||i.calculateEntropy(n),type:"line",yAxisIndex:1}],p=_.pluck(o,"name");if("num"===a._type){for(c=a.min,b=0;b<l;b++)e=Math.round(100*f.accAdd(c,a.step))/100,h=c+" ~ "+e,m.push(h),k.xAxis[0].data.push(h),c=e;k.tooltip.formatter=function(a){if(a){var b=m[a[0].dataIndex];return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(k.xAxis[0].data=a.value,k.tooltip.formatter=function(a){if(a){var b=a[0].name,c=this.currentChartData;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){c.series[a.seriesName]&&void 0!==c.series[a.seriesName].ratio?b+="<br>"+a.seriesName+": "+(100*c.series[a.seriesName].ratio[a.dataIndex]).toFixed(2)+"%   ("+a.value+")":b+="<br>"+a.seriesName+" : "+a.value}),b}}.bind(this));if(j){for(var b=0,q=j.length;b<q;b++)k.series.push({name:j[b],data:a.distribution[b],type:"bar",stack:a.name,ratio:a.ratios[b]});k.series=k.series.concat(o),k.legend={data:j.slice(0,3).concat(p),selected:{}}}else k.series.push({name:a.name,data:a.distribution[0],type:"bar"});return k},calculateGini:function(a){var b=[];return a.forEach(function(a){b.push(d.gini(a).toFixed(4))}),b},calculateEntropy:function(a,b){var c=[];return a.forEach(function(a){c.push(d.entropy(a).toFixed(4))}),c},calculateGiniWeight:function(a,b){var c,e,f=this,g=[];return a.forEach(function(a){c=f.sumArray(a),e=(1-d.gini(a,c))*(c/b),g.push(e.toFixed(4))}),g},calculateEntropyWeight:function(a,b){var c,e,f=this,g=[];return a.forEach(function(a){c=f.sumArray(a),e=(1-d.entropy(a,c))*(c/b),g.push(e.toFixed(4))}),g},sumArray:function(a){return a.reduce(function(a,b){return a+b},0)},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),c.prototype.destroy.call(this)}})}),define("dialog/analytic/featureEngineering",["zero/zero","zero/declare","zero/ui/DialogEx","../../components/batchHistograms/FeatureEngineering","../../i18n","../../ajax/model","../../global/utils"],function(a,b,c,d,e,f,g){"use strict";var h={dialogBody:".modal-content .modal-body"},i={dialog:"batch-histogram"},j=e.translate,k=b("dialog/FeatureEngineering",[],{constructor:function(){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:j("featureEngineering"),canFullscreen:!0,className:i.dialog,beforeHide:b.onBeforeHide.bind(b),destroyOnHide:!0,afterShow:b.onAfterShow.bind(b),buttons:[{text:j("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){var a=this;a.component&&a.component.renderMainChart()},onBeforeHide:function(){var a=this;a.component&&a.component.destroy()},onAfterShow:function(){var a=this;a.dialog.showLoading(),f.featureEngineering(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog;c.hideLoading(),this.component=new d({container:c.$element.find(h.dialogBody),data:a})},renderFailed:function(){var a=this,b=a.dialog;b.hideLoading(),b.showEmpty()}});return{show:function(a){(new k).show(a)}}}),define("dialog/analytic/batchHistograms",["zero/zero","zero/declare","zero/ui/DialogEx","../../components/batchHistograms/BasicHistogram","../../i18n","../../ajax/model","../../global/utils"],function(a,b,c,d,e,f,g){"use strict";var h={dialogBody:".modal-content .modal-body"},i={dialog:"batch-histogram"},j=e.translate,k=b("dialog/BatchHistograms",[],{constructor:function(){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:j("histogram"),canFullscreen:!0,className:i.dialog,beforeHide:b.onBeforeHide.bind(b),destroyOnHide:!0,afterShow:b.onAfterShow.bind(b),buttons:[{text:j("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){var a=this;a.component&&a.component.renderMainChart()},onBeforeHide:function(){var a=this;a.component&&a.component.destroy()},onAfterShow:function(){var a=this;a.dialog.showLoading(),f.queryBatchHistogramData(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog;c.hideLoading(),b.component=new d({container:c.$element.find(h.dialogBody),data:a})},renderFailed:function(){var a=this,b=a.dialog;b.hideLoading(),b.showEmpty()}});return{show:function(a){(new k).show(a)}}}),define("midway/components/batchHistograms/dataCompContainer",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="batch-histogram-body" id = "dataComp"></div>'}()}}),define("components/batchHistograms/DataCompFreqency",["zero/zero","zero/declare","zero/ui/DataTable","../../global/utils","../../global/math","../../i18n","../../ajax/model","../../charts/bar","../../components/batchHistograms/BasicHistogram","../../midway/components/batchHistograms/body","../../midway/components/batchHistograms/dataCompContainer","../../midway/components/batchHistograms/stepPanel"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=f.translate,n=(m("enum"),{body:"#dataComp",mainChart:".J-main-chart",fieldRow:".J-field-tbody tr",miniChartPrefix:".J-chart-",searchContainer:".J-search-container",field:".field-panel [data-field]",fieldInput:".J-field-input",fieldSearch:".J-field-search",fieldName:".J-field-name",fieldClose:".J-field-close",logPanel:".log-panel",stepPanel:".step-panel",stepInput:'[data-role="step-input"]',stepTimes:'[data-role="step-times"]',stepBins:'[data-role="step-bins"]',stepMinus:'[data-role="step-minus"]',stepPlus:'[data-role="step-plus"]',warning:".alert-warning",summaries:".summaries",logCheckbox:"#log-scale-checkbox",logBasement:"#log-scale-basement"}),o={onSearch:"on-search",disabled:"disabled"};return b("dialog/DataCompFreqency",[i],{hasStepPanel:!0,hasLogPanel:!1,constructor:function(a){i.prototype.constructor.call(this,a)},render:function(b){var c,e=this;e.stepRender=!1,c=e.$container.append(k()),b=e.data=e.parseData(b),e.labelValue=b.label&&b.label.value,a.numberToLetter=d.numberToLetter,a.padLeft=d.padLeft,b&&(c.find(n.body).html(j({table:b})),e.$container=c.find(n.body),e.$stepPanel=c.find(n.body+" "+n.stepPanel),e.$logPanel=c.find(n.logPanel),e.$searchContainer=c.find(n.searchContainer),e.$fieldInput=c.find(n.fieldInput),e.$fieldName=c.find(n.fieldName),e.$fieldClose=c.find(n.fieldClose),e.$summaries=c.find(n.summaries),e.$logPanel.hide(),e.hasStepPanel?(e.stepRender||(e.stepRender=!0,e.$stepPanel.append(l())),e.$stepInput=c.find(n.stepInput),e.$stepBins=c.find(n.body+" "+n.stepPanel+" "+n.stepBins),e.$stepTimes=c.find(n.body+" "+n.stepPanel+" "+n.stepTimes),e.$stepMinus=c.find(n.body+" "+n.stepPanel+" "+ +n.stepMinus),e.$stepPlus=c.find(n.body+" "+n.stepPanel+" "+n.stepPlus)):e.$stepPanel.hide(),b.features.forEach(function(a){var b=e.parseFeature(a);e.dataMap[a.name]={container:b,feature:a},e.renderMiniChart(b)}),e.$container.find(n.fieldRow).first().click(),e.initAutoComplete(b))},bindEvents:function(){var a=this,b=a.$container;b.on("click",n.fieldName+", "+n.fieldSearch,a.onFieldSearch.bind(a)),b.on("keyup",n.fieldInput,a.onFieldKeyup.bind(a)),b.on("click",n.fieldClose,a.onFieldClose.bind(a)),b.on("click",n.body+" "+n.field,a.onFieldClick.bind(a)),b.on("mouseleave",n.field,a.onMouseleave.bind(a)),b.on("mouseenter",n.field,a.onMouseenter.bind(a)),b.on("click",n.body+" "+n.stepMinus,a.onStepMinus.bind(a)),b.on("click",n.body+" "+n.stepPlus,a.onStepPlus.bind(a)),b.on("click",n.logCheckbox,a.onlogCheck.bind(a)),b.on("change",n.logBasement,a.onLogBasement.bind(a))},renderMainChart:function(a){var b=this,c={element:this.$container.find(".J-main-chart")};$.extend(c,a||this.currentChartData),this.destroyMainChart(),b.mainChart=new h(c),setTimeout(function(){b.mainChart.echart.resize()},200)},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),i.prototype.destroy.call(this)},refreshSteps:function(){var a=this,b=a.dataMap[a.currentField].feature;if("enum"===b._type)return void a.$stepPanel.hide();a.$stepPanel.show(),a.currentStep={minStep:b.step,index:0,initBins:b.name2Distrubution.count.length},a.setStepsValue(),a.$stepMinus.addClass(o.disabled),a.$stepPlus.removeClass(o.disabled)},getChartData:function(){var a,b,c=this,d=c.times[c.currentStep.index];return a=_.cloneDeep(c.dataMap[c.currentField].feature),c.hasStepPanel&&(a.step=d*c.currentStep.minStep,a.name2Distrubution.count=e.array.merge(a.name2Distrubution.count,d)),b=c.parseFeature(a),c.hasLogPanel&&(b=c.parseLog(b,c.$logCheckbox.is(":checked"))),b},parseFeature:function(a){var b,c,e,f,g={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},h=a.name2Distrubution.count.length,i=[];if("num"===a._type){for(c=a.min,b=0;b<h;b++)e=d.accAdd(c,a.step),f=c+" ~ "+e,i.push(f),g.xAxis[0].data.push(f),c=e;g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(g.xAxis[0].data=a.value,g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}});return g.series.push({name:a.name,data:a.name2Distrubution.count,type:"bar"}),g}})}),define("midway/components/batchHistograms/dataCompPercentContainer",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="batch-histogram-body" id = "dataPercent"></div>'}()}}),define("midway/components/batchHistograms/stepPaneldataComp",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="step-controller"><span class="">'+e(d("step"))+'</span><div class="input-group"><div class="input-group-btn"><button data-role="step-minus-dataComp" type="button" class="btn btn-default disabled step-minus">&nbsp;</button></div><input type="text" class="form-control" data-role="step-input-dataComp" readonly><div class="input-group-btn"><button data-role="step-plus-dataComp" type="button" class="btn btn-default"><i class="icon icon-plus-l-thin"></i></button></div></div><span data-role="step-times-dataComp"></span></div><div class="step-result"><span>'+e(d("bins"))+'</span><strong data-role="step-bins-dataComp"></strong></div>'}()}}),define("components/batchHistograms/DataCompPercent",["zero/zero","zero/declare","zero/ui/DataTable","../../global/utils","../../global/math","../../i18n","../../ajax/model","../../charts/bar","../../components/batchHistograms/BasicHistogram","../../midway/components/batchHistograms/body","../../midway/components/batchHistograms/dataCompPercentContainer","../../midway/components/batchHistograms/stepPaneldataComp"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=f.translate,n=(m("enum"),{body:"#dataPercent",mainChart:".J-main-chart",fieldRow:".J-field-tbody tr",miniChartPrefix:".J-chart-",searchContainer:".J-search-container",field:".field-panel [data-field]",fieldInput:".J-field-input",fieldSearch:".J-field-search",fieldName:".J-field-name",fieldClose:".J-field-close",logPanel:".log-panel",stepPanel:".step-panel",stepInput:'[data-role="step-input-dataComp"]',stepTimes:'[data-role="step-times-dataComp"]',stepBins:'[data-role="step-bins-dataComp"]',stepMinus:'[data-role="step-minus-dataComp"]',stepPlus:'[data-role="step-plus-dataComp"]',warning:".alert-warning",summaries:".summaries",logCheckbox:"#log-scale-checkbox",logBasement:"#log-scale-basement"}),o={onSearch:"on-search",disabled:"disabled"};return b("dialog/DataCompPercent",[i],{hasStepPanel:!0,hasLogPanel:!1,constructor:function(a){i.prototype.constructor.call(this,a)},render:function(b){var c,e=this;e.stepRender=!1,c=e.$container.append(k()),b=e.data=e.parseData(b),e.labelValue=b.label&&b.label.value,a.numberToLetter=d.numberToLetter,a.padLeft=d.padLeft,b&&(c.find(n.body).html(j({table:b})),e.$container=c.find(n.body),e.$stepPanel=c.find(n.body+" "+n.stepPanel),e.$logPanel=c.find(n.logPanel),e.$searchContainer=c.find(n.searchContainer),e.$fieldInput=c.find(n.fieldInput),e.$fieldName=c.find(n.fieldName),e.$fieldClose=c.find(n.fieldClose),e.$summaries=c.find(n.summaries),e.$logPanel.hide(),e.hasStepPanel?(e.stepRender||(e.stepRender=!0,e.$stepPanel.append(l())),e.$stepInput=c.find(n.stepInput),e.$stepBins=c.find(n.body+" "+n.stepPanel+" "+n.stepBins),e.$stepTimes=c.find(n.body+" "+n.stepPanel+" "+n.stepTimes),e.$stepMinus=c.find(n.body+" "+n.stepPanel+" "+ +n.stepMinus),e.$stepPlus=c.find(n.body+" "+n.stepPanel+" "+n.stepPlus)):e.$stepPanel.hide(),b.features.forEach(function(a){var b=e.parseFeature(a);e.dataMap[a.name]={container:b,feature:a},e.renderMiniChart(b)}),e.$container.find(n.fieldRow).first().click(),e.initAutoComplete(b))},bindEvents:function(){var a=this,b=a.$container;b.on("click",n.fieldName+", "+n.fieldSearch,a.onFieldSearch.bind(a)),b.on("keyup",n.fieldInput,a.onFieldKeyup.bind(a)),b.on("click",n.fieldClose,a.onFieldClose.bind(a)),b.on("click",n.body+" "+n.field,a.onFieldClick.bind(a)),b.on("mouseleave",n.field,a.onMouseleave.bind(a)),b.on("mouseenter",n.field,a.onMouseenter.bind(a)),b.on("click",n.body+" "+n.stepMinus,a.onStepMinus.bind(a)),b.on("click",n.body+" "+n.stepPlus,a.onStepPlus.bind(a)),b.on("click",n.body+" "+n.logCheckbox,a.onlogCheck.bind(a)),b.on("change",n.logBasement,a.onLogBasement.bind(a))},renderMainChart:function(a){var b=this,c={element:this.$container.find(".J-main-chart")};$.extend(c,a||this.currentChartData),this.destroyMainChart(),b.mainChart=new h(c),setTimeout(function(){b.mainChart.echart.resize()},200)},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),i.prototype.destroy.call(this)},parseFeature:function(a){var b,c,e,f,g={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},h=a.name2Distrubution.percent.length,i=[];if("num"===a._type){for(c=a.min,b=0;b<h;b++)e=d.accAdd(c,a.step),f=c+" ~ "+e,i.push(f),g.xAxis[0].data.push(f),c=e;g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(g.xAxis[0].data=a.value,g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}});return g.series.push({name:a.name,data:a.name2Distrubution.percent,type:"bar"}),g},getChartData:function(){var a,b,c=this,d=c.times[c.currentStep.index];return a=_.cloneDeep(c.dataMap[c.currentField].feature),c.hasStepPanel&&(a.step=d*c.currentStep.minStep,a.name2Distrubution.percent=e.array.merge(a.name2Distrubution.percent,d)),b=c.parseFeature(a),c.hasLogPanel&&(b=c.parseLog(b,c.$logCheckbox.is(":checked"))),b},refreshSteps:function(){var a=this,b=a.dataMap[a.currentField].feature;if("enum"===b._type)return void a.$stepPanel.hide();a.$stepPanel.show(),a.currentStep={minStep:b.step,index:0,
initBins:b.name2Distrubution.percent.length},a.setStepsValue(),a.$stepMinus.addClass(o.disabled),a.$stepPlus.removeClass(o.disabled)}})}),define("midway/dialog/analytic/dataCompTab",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class=tab-panel><ul class="nav nav-tabs pai-tab"><li class="active" data-target="#dataComp"><a href="javascript:void(0);">'+e(d("frequency"))+'</a></li><li data-target="#dataPercent"><a href="javascript:void(0);">'+e(d("percentage"))+"</a></li></ul></div>"}()}}),define("dialog/analytic/dataCompareTab",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","../../components/batchHistograms/DataCompFreqency","../../components/batchHistograms/DataCompPercent","../../midway/dialog/analytic/dataCompTab","../../i18n","../../ajax/model"],function(a,b,c,d,e,f,g,h,i){"use strict";var j,k={dialogBody:".modal-content .modal-body",tab:".tab-panel .nav li"},l={dialog:"batch-histogram"},m=h.translate,n=b("dialog/DataCompareDialog",[],{show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:m("dataCompare"),canFullscreen:!0,className:l.dialog,beforeHide:b.onBeforeHide.bind(b),destroyOnHide:!0,afterShow:b.onAfterShow.bind(b),buttons:[{text:m("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b))},onFullScreen:function(){this.component&&this.component.renderMainChart()},onBeforeHide:function(){var a=this;a.component&&a.component.destroy()},onAfterShow:function(){var a=this,b=a.dialog;a.dataCompFreq=!1,a.dataCompPercent=!1,b.showLoading(),b.$element.find(k.dialogBody).append(g()),a.tab=new d({selector:b.$element.find(k.tab),activeClassName:"active",afterShow:function(b){0===b?a.dataCompFreq||(a.dataCompFreq=!0,i.dataComp(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.projectName).then(a.renderFrenquency.bind(a),a.renderFailed.bind(a))):a.dataCompPercent||(i.dataComp(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.projectName).then(a.renderPercent.bind(a),a.renderFailed.bind(a)),a.dataCompPercent=!0)}})},renderFrenquency:function(a){var b=this,c=b.dialog;c.hideLoading(),b.component=new e({container:c.$element.find(k.dialogBody),data:{features:a.histogram}})},renderPercent:function(a){var b=this,c=b.dialog;c.hideLoading(),b.component=new f({container:c.$element.find(k.dialogBody),data:{features:a.histogram}})},renderFailed:function(){this.dialog.hideLoading(),this.dialog.showEmpty()}});return{show:function(a){j||(j=new n),j.show(a)}}}),define("midway/components/batchHistograms/echartPlotBox",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="batch-histogram-body" id="boxPlotContainer"></div>'}()}}),define("components/batchHistograms/newBoxPlot",["zero/zero","zero/declare","zero/ui/DataTable","../../global/utils","../../i18n","../../ajax/model","../../charts/bar","../../components/batchHistograms/BasicHistogram","../../midway/components/batchHistograms/body","../../midway/components/batchHistograms/echartPlotBox"],function(a,b,c,d,e,f,g,h,i,j){var k={body:"#boxPlotContainer",mainChart:".J-main-chart",fieldRow:".J-field-tbody tr",miniChartPrefix:".J-chart-",searchContainer:".J-search-container",field:".field-panel [data-field]",fieldInput:".J-field-input",fieldSearch:".J-field-search",fieldName:".J-field-name",fieldClose:".J-field-close",logPanel:".log-panel",stepPanel:".step-panel",stepInput:'[data-role="step-input"]',stepTimes:'[data-role="step-times"]',stepBins:'[data-role="step-bins"]',stepMinus:'[data-role="step-minus"]',stepPlus:'[data-role="step-plus"]',warning:".alert-warning",summaries:".summaries",logCheckbox:"#log-scale-checkbox",logBasement:"#log-scale-basement"};return b("dialog/BoxPlot",[h],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){h.prototype.constructor.call(this,a)},render:function(b){var c,e=this;c=e.$container.append(j()),b=e.data=e.parseData(b),e.labelValue=b.label&&b.label.value,a.numberToLetter=d.numberToLetter,a.padLeft=d.padLeft,b&&(c.find(k.body).html(i({table:b})),e.$container=c.find(k.body),e.$stepPanel=c.find(k.stepPanel),e.$logPanel=c.find(k.logPanel),e.$searchContainer=c.find(k.searchContainer),e.$fieldInput=c.find(k.fieldInput),e.$fieldName=c.find(k.fieldName),e.$fieldClose=c.find(k.fieldClose),e.$summaries=c.find(k.summaries),e.$stepPanel.hide(),e.$logPanel.hide(),b.features.forEach(function(a){var b=e.parseFeature(a);e.dataMap[a.name]={container:b,feature:a},e.renderMiniChart(b)}),e.$container.find(k.fieldRow).first().click(),e.initAutoComplete(b))},bindEvents:function(){var a=this,b=a.$container;b.on("click",k.fieldName+", "+k.fieldSearch,a.onFieldSearch.bind(a)),b.on("keyup",k.fieldInput,a.onFieldKeyup.bind(a)),b.on("click",k.fieldClose,a.onFieldClose.bind(a)),b.on("click",k.body+" "+k.field,a.onFieldClick.bind(a)),b.on("mouseleave",k.field,a.onMouseleave.bind(a)),b.on("mouseenter",k.field,a.onMouseenter.bind(a)),b.on("click",k.stepMinus,a.onStepMinus.bind(a)),b.on("click",k.stepPlus,a.onStepPlus.bind(a)),b.on("click",k.logCheckbox,a.onlogCheck.bind(a)),b.on("change",k.logBasement,a.onLogBasement.bind(a))},renderMainChart:function(a){var b=this,c={element:this.$container.find(".J-main-chart"),cancelSmart:{dataZoom:!0}};$.extend(c,a||this.currentChartData),this.destroyMainChart(),b.mainChart=new g(c),setTimeout(function(){b.mainChart.echart.resize()},200)},parseBoxFeature:function(a){var b,c={boxData:[],outliers:[],axisData:[]};return b=a.values,b.forEach(function(a,b){var d=a.boxPlot;d.range=[d.max,d.q3,d.mid,d.q1,d.min],c.boxData.push(d.range),c.axisData.push(a.categoryValue)}),c},parseData:function(a){return a.features.forEach(function(a){a.name=a.continueCol,a.type="",a._type="enum"}),a},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),h.prototype.destroy.call(this)},parseFeature:function(a){var b=this,c=b.parseBoxFeature(a);return{overideBarOptions:!0,name:a.name,title:{text:a.name,left:"center"},tooltip:{trigger:"item",axisPointer:{type:"shadow"},formatter:"{a}: ( {c} ) <br />"},toolbox:{feature:{magicType:{type:[],show:!1}}},grid:{left:"10%",right:"10%",bottom:"15%"},xAxis:[{type:"category",data:c.axisData,boundaryGap:!0,nameGap:30,splitArea:{show:!1},axisLabel:{formatter:"category-{value}",rotate:0},splitLine:{show:!1}}],yAxis:[{type:"value",splitArea:{show:!0}}],series:[{name:a.name+" - boxplot",type:"boxplot",data:c.boxData,tooltip:{formatter:function(a){return["category"+(a.name?a.name:"0")+":","upper: "+a.data[0],"Q3: "+a.data[1],"median: "+a.data[2],"Q1: "+a.data[3],"lower: "+a.data[4]].join("<br/>")}}}]}}})}),define("midway/components/batchHistograms/echartJitterPoint",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="alert alert-warning" role="alert">'+e(d("noDataTip"))+'</div><div class="batch-histogram-body" id="pointJitterContainer"></div>'}()}}),define("components/batchHistograms/newPointJitter",["zero/zero","zero/declare","zero/ui/DataTable","../../global/utils","../../i18n","../../ajax/model","../../charts/bar","../../components/batchHistograms/BasicHistogram","../../midway/components/batchHistograms/body","../../midway/components/batchHistograms/echartJitterPoint"],function(a,b,c,d,e,f,g,h,i,j){var k={body:"#pointJitterContainer",mainChart:".J-main-chart",fieldRow:".J-field-tbody tr",miniChartPrefix:".J-chart-",searchContainer:".J-search-container",field:".field-panel [data-field]",fieldInput:".J-field-input",fieldSearch:".J-field-search",fieldName:".J-field-name",fieldClose:".J-field-close",logPanel:".log-panel",stepPanel:".step-panel",stepInput:'[data-role="step-input"]',stepTimes:'[data-role="step-times"]',stepBins:'[data-role="step-bins"]',stepMinus:'[data-role="step-minus"]',stepPlus:'[data-role="step-plus"]',warning:".alert-warning",summaries:".summaries",logCheckbox:"#log-scale-checkbox",logBasement:"#log-scale-basement"};return b("dialog/JitterPoint",[h],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){h.prototype.constructor.call(this,a)},bindEvents:function(){var a=this,b=a.$container;b.on("click",k.fieldName+", "+k.fieldSearch,a.onFieldSearch.bind(a)),b.on("keyup",k.fieldInput,a.onFieldKeyup.bind(a)),b.on("click",k.fieldClose,a.onFieldClose.bind(a)),b.on("click",k.body+" "+k.field,a.onFieldClick.bind(a)),b.on("mouseleave",k.field,a.onMouseleave.bind(a)),b.on("mouseenter",k.field,a.onMouseenter.bind(a)),b.on("click",k.stepMinus,a.onStepMinus.bind(a)),b.on("click",k.stepPlus,a.onStepPlus.bind(a)),b.on("click",k.logCheckbox,a.onlogCheck.bind(a)),b.on("change",k.logBasement,a.onLogBasement.bind(a))},render:function(b){var c,e=this;c=e.$container.append(j()),b=e.data=e.parseData(b),e.labelValue=b.label&&b.label.value,a.numberToLetter=d.numberToLetter,a.padLeft=d.padLeft,b&&(c.find(k.body).html(i({table:b})),e.$container=c.find(k.body),e.$stepPanel=c.find(k.stepPanel),e.$logPanel=c.find(k.logPanel),e.$searchContainer=c.find(k.searchContainer),e.$fieldInput=c.find(k.fieldInput),e.$fieldName=c.find(k.fieldName),e.$fieldClose=c.find(k.fieldClose),e.$summaries=c.find(k.summaries),e.$stepPanel.hide(),e.$logPanel.hide(),b.features.forEach(function(a){var b=e.parseFeature(a);e.dataMap[a.name]={container:b,feature:a},e.renderMiniChart(b)}),e.$container.find(k.fieldRow).first().click(),e.initAutoComplete(b))},renderMainChart:function(a){var b=this,c={element:this.$container.find(".J-main-chart"),cancelSmart:{dataZoom:!0}};$.extend(c,a||this.currentChartData),this.destroyMainChart(),b.mainChart=new g(c),setTimeout(function(){b.mainChart.echart.resize()},200)},parseBoxFeature:function(a){var b=a.values;return b=b.map(function(a,b){return a.percentPoints.reduce(function(a,c){var d=[];return d.push(b),d.push(c),a.concat([d])},[])})},parseData:function(a){return a.features.forEach(function(a){a.name=a.continueCol,a.type="",a._type="enum"}),a},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),h.prototype.destroy.call(this)},parseFeature:function(a){var b=this,c=b.parseBoxFeature(a),d={overideBarOptions:!0,title:{text:a.name,x:"center",y:0},name:a.name,tooltip:{formatter:"{a}: ( {c} ) <br />",trigger:"item"},toolbox:{feature:{magicType:{type:[],show:!1}}},xAxis:[{type:"category",axisLabel:{show:!0,rotate:0},data:[]}],yAxis:[{type:"value",axisLabel:{show:!0,rotate:0}}],series:[]};return d.series=c.map(function(b,c){return d.xAxis[0].data=d.xAxis[0].data.concat(c),{name:a.name+" "+c,type:"scatter",data:b}}),d}})}),define("midway/dialog/analytic/boxplotTab",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class=tab-panel><ul class="nav nav-tabs pai-tab"><li class="active" data-target="#boxPlotContainer"><a href="javascript:void(0);">'+e(d("boxPlot"))+'</a></li><li data-target="#pointJitterContainer"><a href="javascript:void(0);">'+e(d("pointJitter"))+"</a></li></ul></div>"}()}}),define("dialog/analytic/boxPlot",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","zero/ui/Tab","../../global/utils","../../i18n","../../ajax/model","../../components/batchHistograms/newBoxPlot","../../components/batchHistograms/newPointJitter","../../midway/dialog/analytic/boxplotTab"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=g.translate,m={dialogBody:".modal-content .modal-body",tab:".tab-panel .nav li"},n={dialog:"batch-histogram"},o=b("dialog/BoxPlot",[],{constructor:function(a){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:l("boxPlot"),canFullscreen:!0,destroyOnHide:!0,className:n.dialog,afterShow:b.onAfterShow.bind(b),buttons:[{text:l("close"),click:function(){b.dialog.hide()}}]})},onAfterShow:function(){var a=this,b=a.dialog;a.boxPlotRendered=!1,a.pointJitterRendered=!1,b.showLoading(),b.$element.find(m.dialogBody).append(k()),a.defferred=h.getBoxPlotData(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.loopTimestamp),a.tab=new e({selector:b.$element.find(m.tab),activeClassName:"active",afterShow:function(b){0===b?a.boxPlotRendered||(a.boxPlotRendered=!0,a.defferred.then(a.renderBoxPlot.bind(a),a.renderFailed.bind(a))):a.pointJitterRendered||(a.defferred.then(a.renderPointJitter.bind(a),a.renderFailed.bind(a)),a.pointJitterRendered=!0)}})},renderBoxPlot:function(a){var b,c=this,d=c.dialog;d.hideLoading(),b=new i({container:d.$element.find(m.dialogBody),data:{features:a}}),c.component=b},renderPointJitter:function(a){var b,c=this,d=c.dialog;d.hideLoading(),b=new j({container:d.$element.find(m.dialogBody),data:{features:a}}),c.component=b},renderFailed:function(){this.dialog.hideLoading(),this.dialog.showEmpty()}});return{show:function(a){(new o).show(a)}}}),define("components/batchHistograms/EmpiricalPDF",["zero/zero","zero/declare","./BasicHistogram","../../charts/bar"],function(a,b,c,d){"use strict";return b("component/EmpiricalPDF",[c],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){c.prototype.constructor.call(this,a)},parseFeature:function(b){var c=b.name,d={title:{text:c,subtext:b.type},name:c,imageName:c,toolbox:{feature:{restore:{show:!0},saveAsImage:{show:!0}}},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"cross"}},xAxis:[{type:"value",scale:!0,splitNumber:10,axisLabel:{show:!0,rotate:0}}],yAxis:[{type:"value",min:0,splitNumber:5,axisLabel:{show:!0,rotate:0}}],dataZoom:{show:!1,start:0,end:100},legend:{data:[]},series:[]},e=Number.MAX_SAFE_INTEGER,f=Number.MIN_SAFE_INTEGER,g=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;return a.each(b.data,function(b,c){d.legend.data.push(c),d.series.push({name:c,data:b,type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}}}),a.each(b,function(a){e=Math.min(e,a[0]),f=Math.max(f,a[0]),g=Math.min(g,a[1]),h=Math.max(h,a[1])}),Math.abs(f)>100||Math.abs(e)<.01||f-e<1?d.xAxis[0].axisLabel.formatter=function(a){return Number(a).toExponential(2)}:d.xAxis[0].axisLabel.formatter=function(a){return Number(a).toFixed(2)};var i=Math.abs(h);(i>100||i<.01)&&(d.yAxis[0].axisLabel.formatter=function(a){return a=Number(a),a?a.toExponential(2):a}),d.xAxis[0].min=e,d.xAxis[0].max=f}),d},renderMainChart:function(a){var b={element:this.$container.find(".J-main-chart"),cancelSmart:{dataZoom:!0}};$.extend(b,a||this.currentChartData),this.destroyMainChart(),this.mainChart=new d(b)}})}),define("midway/dialog/analytic/empiricalPDF",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("dialog/analytic/empiricalPDF",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../charts/theme","../../components/batchHistograms/EmpiricalPDF","../../midway/dialog/analytic/empiricalPDF"],function(a,b,c,d,e,f,g){"use strict";function h(c){function e(){var b=this;b.showLoading(),d.queryEmpiricalPDF(c.nodeInstanceId,c.experimentId,c.loopTimestamp).then(function(c){var d=[];a.each(c,function(a,b){d.push({name:b,type:"num",data:a})}),j=new f({container:b.$(".chart-wrap"),data:{features:d}}),b.hideLoading(),b.on("fullScreen",function(){j&&j.renderMainChart()})})}function h(){j&&j.destroy()}var j=null;new b({title:i("empiricalPDF"),className:"batch-histogram dialog-empirical-pdf",body:g(),destroyOnHide:!0,canFullscreen:!0,afterShow:e,afterHide:h,buttons:[{text:i("close"),click:function(){this.hide()}}]})}var i=c.translate;return{show:h}}),define("midway/dialog/analytic/dnnConvergenceCurve",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("dialog/analytic/dnnConvergenceCurve",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../charts/theme","../../midway/dialog/analytic/dnnConvergenceCurve"],function(a,b,c,d,e,f){"use strict";function g(b,c){for(var d=parseInt(b.interval,10),e=b.result,f=a.keys(e)||[],g=a.map(f,function(a){return{smooth:!0,type:"line",name:a,yAxisIndex:-1!==a.indexOf("_accuracy")?1:0,data:e[a]}})||[],h=c?20:10,j={title:{text:i("dnnConvergenceCurve"),x:"center",align:"right"},toolbox:{show:!0,feature:{saveAsImage:{show:!0},restore:{show:!0}}},grid:{x:220},tooltip:{show:function(){return!1},trigger:"axis",axisPointer:{type:"line"},showDelay:0,hideDelay:50},xAxis:{type:"category",data:[]},yAxis:[{type:"value",min:0,splitNumber:h},{type:"value",min:0,max:1,splitNumber:h}],legend:{data:f,orient:"vertical",x:"left",y:"center"},series:g,dataZoom:{show:!0,realtime:!0,height:30,start:0,end:100}},k=Math.min.apply(null,a.map(f,function(a){return e[a].length}))||0,l=0;l<k;l++)j.xAxis.data.push(l*d);var m=Math.max.apply(null,a.map(g,function(a){return Math.max.apply(null,a.data)}))||0;return j.yAxis[0].max=Math.ceil(m/h)*h,j}function h(c){function h(b,c){b&&(m=b),a.keys(m.result).length?(l=echarts.init(n.$(".chart-wrap")[0],e),l.setOption(g(m,c))):n.showEmpty()}function j(){var a=this;a.showLoading(),d.getDNNDataPoints(c.nodeInstanceId,c.experimentId,c.loopTimestamp).then(function(b){b&&h(b,!1),a.hideLoading()})}function k(){l&&(l.clear(),l.dispose())}var l=null,m=null,n=new b({title:i("dnnConvergenceCurve"),className:"dialog-dnn-convergence-curve",body:f(),destroyOnHide:!0,canFullscreen:!0,afterShow:j,afterHide:k,buttons:[{text:i("close"),click:function(){this.hide()}}]});n.on("fullScreen",function(a){m&&(k(),h(m,a))})}var i=c.translate;return{show:h}}),define("midway/dialog/analytic/lstmConvergenceCurve",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("dialog/analytic/lstmConvergenceCurve",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../charts/theme","../../midway/dialog/analytic/lstmConvergenceCurve"],function(a,b,c,d,e,f){"use strict";function g(b,c){for(var d=parseInt(b.interval,10),e=b.result,f=a.keys(e)||[],g=a.map(f,function(a){return{smooth:!0,type:"line",name:a,data:e[a]}})||[],h=c?20:10,j={title:{text:i("convLSTMConvergenceCurve"),x:"center",align:"right"},toolbox:{show:!0,feature:{saveAsImage:{show:!0},restore:{show:!0}}},grid:{x:220},tooltip:{show:function(){return!1},trigger:"axis",axisPointer:{type:"line"}},xAxis:{type:"category",data:[]},yAxis:[{type:"value",min:0,splitNumber:h}],legend:{data:f,orient:"vertical",x:"left",y:"center"},series:g,dataZoom:{show:!1,realtime:!0,height:30,start:0,end:100}},k=Math.max.apply(null,a.map(f,function(a){return e[a].length}))||0,l=Math.max.apply(null,a.map(g,function(a){return Math.max.apply(null,a.data)}))||0,m=0;m<k;m++)j.xAxis.data.push((m+1)*d);return j.yAxis[0].max=Math.ceil(l),j}function h(c){function h(b,c){b&&(m=b),a.keys(m.result).length?(l=echarts.init(n.$(".chart-wrap")[0],e),l.setOption(g(m,c))):n.showEmpty()}function j(){var a=this;a.showLoading(),d.getConvLSTMDataPoints(c.nodeInstanceId,c.experimentId,c.loopTimestamp).then(function(b){b&&h(b,!1),a.hideLoading()})}function k(){l&&(l.clear(),l.dispose())}var l=null,m=null,n=new b({title:i("convLSTMConvergenceCurve"),className:"dialog-convLSTM-convergence-curve",body:f(),destroyOnHide:!0,canFullscreen:!0,afterShow:j,afterHide:k,buttons:[{text:i("close"),click:function(){this.hide()}}]});n.on("fullScreen",function(a){m&&(k(),h(m,a))})}var i=c.translate;return{show:h}}),define("midway/dialog/analytic/c5",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="wraps"><label for="c5-type-filter" class="filter-wrap hide"><span class="text">'+e(d("recognizedObjectFilter"))+': </span><label for="c5-type-filter" class="select-hacker"><select id="c5-type-filter" class="form-control"></select></label></label><div class="table-wrap"></div><div class="tips-wrap hide"><p>[1]: '+e(d("accuracy"))+" = "+e(d("rightNumber"))+" / "+e(d("coverNumber"))+"</p><p>[2]: "+e(d("coverage"))+" = "+e(d("rightNumber"))+" / "+e(d("recallCover"))+"</p></div></div>"}()}}),define("dialog/analytic/c5",["zero/zero","zero/ui/DialogEx","zero/ui/DataTable","../../i18n","../../global/utils","../../ajax/model","../../midway/dialog/analytic/c5"],function(a,b,c,d,e,f,g){"use strict";function h(){o&&o.destroy(),o=null}function i(b){h();var d=p;q&&q!==n&&(d=a.filter(p,function(a){return a.classLabel===q})),o=new c({container:b.$(l.wrap),data:d,theme:"small",line:!0,grid:!0,resizable:!0,defaultsort:!0,crossHover:!1,height:"calc(100% - 40px)",sort:{field:"precision",type:"desc"},cols:[{title:k("rules"),field:"rules",parse:function(b,c){return a.map(c.rules,function(a){return"<div>"+a+"</div>"}).join("")},width:360},{title:k("recognizedObject"),field:"classLabel"},{title:k("accuracy")+"[1]",field:"precision",sort:!0},{title:k("coverage")+"[2]",field:"recall",sort:!0},{title:k("rightNumber"),field:"rightNuber",sort:!0},{title:k("coverNumber"),field:"coverNumber",sort:!0},{title:k("recallCover"),field:"recallCover",sort:!0}]})}function j(c){new b({title:k("c5Rules"),className:"dialog-c5",body:g(),destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var b=this;b.showLoading(),f.queryC5Output(c.nodeInstanceId,c.experimentId,c.loopTimestamp).then(function(c){if(b.hideLoading(),!c.rule)return b.showEmpty();var d=[n];p=[],a.each(c.rulesSet,function(b){var c={classLabel:"type="+b.classLabel,rightNuber:b.rightNuber,coverNumber:b.coverNumber,recallCover:b.recallCover,recall:e.toFixed(100*b.recall,2)+"%",precision:e.toFixed(100*b.precision,2)+"%"};c.rules=a.map(b.expressions,function(a){return a.leftleftParameter+" "+a.operator+" "+a.rightleftParameter}),p.push(c),-1===a.indexOf(d,c.classLabel)&&d.push(c.classLabel)});var f=b.$(l.filter).empty();a.each(d,function(a){f.append('<option value="'+a+'">'+a+"</option>")}),f.off().on("change",function(){q=$(this).val(),i(b)}),b.$(l.filterWrap).removeClass(m.hide),b.$(l.tipsWrap).removeClass(m.hide),i(b)},function(){b.showEmpty(),b.hideLoading()})},afterHide:function(){h(),p=null,q=null},buttons:[{text:k("close"),click:function(){this.hide()}}]})}var k=d.translate,l={wrap:".table-wrap",filterWrap:".filter-wrap",filter:"#c5-type-filter",tipsWrap:".tips-wrap"},m={hide:"hide"},n=k("all"),o=null,p=null,q=null;return{show:j}}),define("midway/charts/scorecardGroupingTreeNode",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c){var e="";return e+=a?'<tspan dy="1.8em" x="0">'+d(a)+'</tspan><tspan dy="2em" x="0">'+d(b)+'</tspan><tspan dy="2em" x="0">'+d(c)+"</tspan>":'<tspan dy="3.5em">查看详情</tspan>',e+=""}(b.name,b.recordCount,b.metricChange)}}),define("charts/ScorecardGroupingTree",["zero/declare","./d3Extensions/d3.path.js","./d3Extensions/d3.layout.treeLine","../global/utils","../midway/charts/scorecardGroupingTreeNode"],function(a,b,c,d,e){"use strict";var f={scorecardTree:"scorecard-tree cart-tree",hover:"hover"},g=(_.cloneDeep,{margin:{top:12,right:8,bottom:12,left:8},node:{width:100,height:66,rx:15,ry:8,separation:1.2},depth:150,displayDepth:5,maxDisplayDepth:100,duration:500}),h={string:{left:"&in;",right:"&notin;"},number:{left:"&le;",right:"&gt;"}};return a("charts/scorecardGroupingTree",{cutIds:[],uid:0,constructor:function(a){var b=this;b.opt=$.extend(!0,{},g,a),b.preParseData(),b.render()},getCutIds:function(){return this.cutIds},saved:function(){this.cutIds=[]},preParseData:function(){var a=this,b=a.opt.data;a.opt.convertMap&&a.convert(b,a.opt.convertMap),a.root=b,a.root.x0=0,a.root.y0=0,a.totalCount=b.recordCount,a.collapse(a.root,a.opt.displayDepth)},render:function(){var a=this;a.$container=$(a.opt.container),a.container=d3.select(a.opt.container);var b=a.renderSVG();a.renderFilter(b),a.initTreeLayout(),a.update(a.root),a.bindEvents()},renderSVG:function(){var a=this,b=a.$container.width(),c=a.$container.height(),d=a.opt.margin.left+b/2,e=a.opt.margin.top;return a.svg=a.container.append("svg:svg").attr("width",b).attr("height",c).attr("class",f.scorecardTree).on("mousedown",function(){a.svg.style("cursor","-webkit-grabbing")}),a.vis=a.svg.append("svg:g").attr("transform","translate("+d+","+e+")"),a.zoom=d3.behavior.zoom().on("zoom",function(){a.vis.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}),a.zoom.translate([d,e]),a.svg.call(a.zoom),a.svg},renderFilter:function(a){var b=a.append("svg:defs").append("filter").attr({x:0,y:0,width:1,height:1,id:"solid"});b.append("feFlood").attr("flood-color","white"),b.append("feComposite").attr("in","SourceGraphic")},initTreeLayout:function(){var a=this,b=a.opt.node.width,c=a.opt.node.height;a.tree=d3.layout.tree().nodeSize([b,c]).separation(function(b,c){return b.parent,c.parent,a.opt.node.separation}),a.treeLine=d3.layout.treeLine().nodeSize([b,c])},reRender:function(){this.destroy(),this.render()},bindEvents:function(){var a=this;$(document).on("mouseup.cartTree",function(){a.svg&&a.svg.style("cursor","-webkit-grab")})},update:function(a){var b=this,c=b.tree.nodes(b.root).reverse(),d=b.tree.links(c);c.forEach(function(a){a.y=a.depth*b.opt.depth}),b.updateNodes(a,c),b.updateLinks(a,d),c.forEach(function(a){a.x0=a.x,a.y0=a.y})},updateNodes:function(a,b){var c=this,d=c.opt.duration,f=c.vis.selectAll("g.node").data(b,function(a){return a.id||(a.id=++c.uid)}),g=f.enter().append("svg:g").attr("class","node").classed("leaf",function(a){return c.isLeaf(a)}).attr("transform",function(b){return"translate("+a.x0+","+a.y0+")"}).attr("data-id",function(a){return a.id}).on("click",function(a){a.isLeafNode?_.isFunction(c.opt.onViewDetail)&&c.opt.onViewDetail(a):(c.toggle(a),c.update(a)),d3.event.stopPropagation()}).on("dblclick",function(a){d3.event.stopPropagation()}).on("mouseenter",function(a){c.clearMarkPath(a);var b=c.getRoute(a);c.markPath(b)});g.append("svg:rect").attr("x",function(a){return-c.opt.node.width/2}).attr("width",1e-6).attr("height",1e-6).attr("rx",function(a){return c.isLeaf(a)?0:2}).attr("ry",function(a){return c.isLeaf(a)?0:2}).style("fill",function(a){return c.isLeaf(a)?"#E9F3FB":"#fff"}),g.append("svg:circle").attr("class","delIcon").attr("cx","48px").attr("cy",0).attr("r",1e-6),g.append("svg:text").attr("text-anchor","middle").attr("x",0).attr("y",0).html(function(a){return e(a)}).style("fill-opacity",1e-6);var h=f.transition().duration(d).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("class",function(a){return c.isLeaf(a)?"node leaf":"node"});h.select("rect").attr("width",function(a){return c.opt.node.width}).attr("height",c.opt.node.height).attr("rx",c.opt.node.rx).attr("ry",c.opt.node.ry).style("fill",function(a){return c.isLeaf(a)?"#E9F3FB":"#fff"}),h.select("circle").attr("r",function(a){return c.isModified(a)?5:1e-6}),h.selectAll("text").style("fill-opacity",1);var i=f.exit().transition().duration(d).attr("transform",function(b){return"translate("+a.x+","+a.y+")"}).remove();i.select("rect").attr("width",1e-6).attr("height",1e-6),i.selectAll("text").style("fill-opacity",1e-6)},updateLinks:function(a,b){var c=this,d=c.treeLine,e=c.opt.duration,f=c.vis.selectAll("g.link").data(b,function(a){return a.target.id}),g=f.enter().insert("svg:g","g").attr("class","link").attr("data-id",function(a){return a.target.id});g.append("svg:path").attr("d",function(b){var c={x:a.x0,y:a.y0};return d({source:c,target:c})}),g.append("svg:text").attr("class","feature").attr("text-anchor","middle").attr("filter","url('#solid')").attr("x",function(a){return d.topAnchor(a).x}).attr("y",function(a){return d.topAnchor(a).y}).html(function(a){return""}).style("fill-opacity",1e-6),g.append("svg:text").attr("class","cut").attr("text-anchor","middle").attr("filter","url('#solid')").attr("x",function(a){return d.bottomAnchor(a).x}).attr("y",function(a){return d.bottomAnchor(a).y}).html(function(a){if(a.source.isNull)return a.target.isLeft?"=NULL":"!=NULL";var b=a.source.isStringValue?"string":"number",c=a.target.isLeft?"left":"right";return h[b][c]+" "+a.source.value}).style("fill-opacity",1e-6);var i=f.transition().duration(e);i.select("path").attr("d",d),i.select("text.feature").attr("x",function(a){return d.topAnchor(a).x}).attr("y",function(a){return d.topAnchor(a).y}).style("fill-opacity",1),i.select("text.cut").attr("x",function(a){return d.bottomAnchor(a).x}).attr("y",function(a){return d.bottomAnchor(a).y}).style("fill-opacity",1);var j=f.exit().transition().duration(e).remove();j.select("path").attr("d",function(b){var c={x:a.x,y:a.y};return d({source:c,target:c})}),j.select("text.feature").style("fill-opacity",1e-6),j.select("text.cut").style("fill-opacity",1e-6)},cutSubTree:function(a){var b,c=this,d=c.findNode(a);d.__modified=!0,b=d.children.map(function(a){return a.id}),d.children=null,c.update(d),c.cutIds=c.cutIds.concat(b),c.saveOperations(c.root,c.cutIds)},findNode:function(a){var b,c=this,d=c.root;return c.preOrderTraversal(d,function(c){c.id===a&&(b=c)}),b},convert:function(a,b){function c(a){a[d]&&(a.children=a[d],a.children.forEach(function(b){b.depth=a.depth+1,c(b)}))}var d=b.children;a.depth=1,c(a)},scale:function(a){var b=this;if(b.vis){var c=b.vis.attr("transform");c=c.replace(/(scale\()\d*\.*\d*(\))/,"$1"+a+"$2"),b.vis.attr("transform",c),b.zoom.scale(a)}},collapseAll:function(){this.collapse(this.root,this.opt.displayDepth),this.reRender()},expandAll:function(){this.expand(this.root,this.opt.maxDisplayDepth),this.reRender()},expand:function(a,b){var c=this,d=a.children?a.children:a._children;a&&d&&(d.forEach(function(a){c.expand(a,b)}),a.depth<=b&&a._children&&(a.children=a._children,a._children=null))},collapse:function(a,b){var c=this,d=a.children?a.children:a._children;a&&d&&(d.forEach(function(a){c.collapse(a,b)}),a.depth>=b&&a.children&&(a._children=a.children,a.children=null))},toggle:function(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)},markPath:function(a){this.vis.selectAll("[data-id]").each(function(b){var c=d3.select(this),d=parseInt(c.attr("data-id"),10);a.forEach(function(a){parseInt(a.id,10)===d&&c.classed(f.hover,!0)})})},clearMarkPath:function(a){this.vis.selectAll("[data-id]").each(function(a){d3.select(this).classed(f.hover,!1)})},getRoute:function(a){function b(a){a.parent&&b(a.parent),c.push(a)}var c=[];return b(a),c},markByOperator:function(a,b){var c={isIn:"in",greaterOrEqual:">=",lessThan:"<",lessOrEqual:"<=",greaterThan:">",equal:"="},d=c[a];return"in"===d?"in("+b+")":d+" "+b},preOrderTraversal:function(a,b){for(var c=[a];null!=(a=c.pop());)if(b(a),(e=a.children)&&(d=e.length))for(var d,e;--d>=0;)c.push(e[d])},isLeaf:function(a){return!a._children&&!a.children},isModified:function(a){return a.__modified},destroy:function(){$(document).off("mouseup.cartTree"),this.svg.remove(),this.$container.empty()}})}),define("midway/components/treeDataTable/treeDataTable",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<ul class="actions nonselect"><li data-role="collapse"><i class="icon icon-node-expand"></i><span>'+e(d("collapse"))+'</span></li><li data-role="expand"><i class="icon icon-node-collapse"></i><span>'+e(d("expand"))+'</span></li></ul><div class="linear-model-table"></div>'}()}}),
define("components/treeDataTable/TreeDataTable",["zero/zero","zero/declare","zero/ui/datatable/plugins/Resizer","zero/ui/DataTable","../../i18n","../../midway/components/treeDataTable/treeDataTable"],function(a,b,c,d,e,f){"use strict";var g={table:".linear-model-table",title:".modal-title",collapse:'[data-role="collapse"]',expand:'[data-role="expand"]'},h=_.zipObject;return b("component/TreeDataTable",[],{$container:null,dataTable:null,constructor:function(a){var b=this;b.getTableOptions();b.$container=a.$container,b.render(a.data),b.bindEvents()},bindEvents:function(){var a=this,b=a.$container;b.on("click",g.collapse,function(){a.dataTable.collapseAll()}),b.on("click",g.expand,function(){a.dataTable.expandAll()})},render:function(a){var b,c=this;c.$container.append(f()),b={container:c.$container.find(g.table),data:[],cols:[]};var e=c.getTableOptions();e.tree||(c.$container.find(g.collapse).hide(),c.$container.find(g.expand).hide(),$(g.table).css("height","100%")),b.data=c.parseData(a,e),$.extend(b,e),c.dataTable=new d(b)},getTableOptions:function(){},parseData:function(a,b){var c,d=this,e=a.records,f=a.tableHeader;return e.forEach(function(a,b){e[b]=h(f,a)}),b.tree?(e&&e[0]&&"intercept"===e[0].feaname&&void 0!==e[0].weight?(c=e.shift(),e=d.toTree(e),e.unshift(c)):e=d.toTree(e),e):e},toTree:function(a){var b,c,d,e=[];return a.forEach(function(a){a.feaname!==b?(b=a.feaname,d=c,c=a,d&&e.length>0&&(d.children=e,e=[])):(e.push(a),a.feaname=" ",a.__del=!0)}),c&&e.length>0&&(c.children=e),a=a.filter(function(a){return!a.__del})},destroy:function(){this.dataTable&&this.dataTable.destroy()}})}),define("components/treeDataTable/LinearModel",["zero/zero","zero/declare","./TreeDataTable","../../global/utils"],function(a,b,c,d){"use strict";var e={table:".ui-datatable"},f={theme:"small",tree:!1,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 30px)",cols:[{field:"feaname",title:"Variable",sort:!0},{field:"weight",sort:!0,title:"weight"}]},g={theme:"small",tree:!0,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 60px)",cols:[{field:"feaname",title:"Variable",sort:!0,width:90},{field:"in_model",title:"Selected",sort:!0,width:80,parse:function(a){return"Y"===a?"&check;":""}},{field:"binid",title:"Bin Id",sort:!0,width:65},{field:"bin",title:"Variable/Bin",sort:!0,width:100},{field:"constraint",sort:!0,title:"Const.",width:68},{field:"weight",sort:!0,title:"Unscaled",group:"Weight",width:85,parse:function(a){return a?d.toFixedNumber(a,3):a}},{field:"scaled_weight",sort:!0,title:"Scaled",group:"Weight",width:70,parse:function(a){return a?d.toFixedNumber(a,3):a}},{field:"woe",sort:!0,title:"WOE",group:"Train",width:70,parse:function(a){return a?d.toFixedNumber(a,3):a}},{field:"contribution",sort:!0,title:"Importance",group:"Train",width:100,parse:function(a){return a?parseFloat(a).toExponential(3):a}},{field:"total",sort:!0,title:"Total",group:"Train",width:70},{field:"positive",sort:!0,title:"Positive",group:"Train",width:80},{field:"negative",sort:!0,title:"Negative",group:"Train",width:80},{field:"percentage_pos",sort:!0,title:"% Pos",group:"Train",width:80,parse:function(a){return""!==a?d.toFixedNumber(100*a,2):void 0}},{field:"percentage_neg",sort:!0,title:"% Neg",group:"Train",width:80,parse:function(a){return""!==a?d.toFixedNumber(100*a,2):void 0}},{field:"test_woe",sort:!0,title:"WOE",group:"Test",width:70,parse:function(a){return a?d.toFixedNumber(a,3):a}},{field:"test_contribution",sort:!0,title:"Importance",group:"Test",width:100,parse:function(a){return a?parseFloat(a).toExponential(3):a}},{field:"test_total",sort:!0,title:"Total",group:"Test",width:70},{field:"test_positive",sort:!0,title:"Positive",group:"Test",width:80},{field:"test_negative",sort:!0,title:"Negative",group:"Test",width:80},{field:"test_percentage_pos",sort:!0,title:"% Pos",group:"Test",width:80,parse:function(a){return""!==a?d.toFixedNumber(100*a,2):void 0}},{field:"test_percentage_neg",sort:!0,title:"% Neg",group:"Test",parse:function(a){return""!==a?d.toFixedNumber(100*a,2):void 0}}]};return b("component/LinearModel",[c],{$container:null,tableOptions:_.clone(g),dataTable:null,constructor:function(a){var b=(a.dialog,a.data.tableHeader);14==b.length?this.tableOptions.cols=g.cols.slice(0,14):21==b.length?this.tableOptions.cols=g.cols:this.tableOptions=f,c.prototype.constructor.call(this,a),21==b.length&&(this.$container=a.$container,this.$container.find(e.table).width("1720px"))},getTableOptions:function(){return this.tableOptions}})}),define("midway/dialog/scorecardGrouping/body",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(){return'<div class="score-list"></div><div class="score-detail"><a href="javascript:void(0);" class="back">&lsaquo; '+e(d("backToList"))+'</a><ul class="nav nav-tabs pai-tab"><li class="active" data-target=".linear-model-dialog"><a href="javascript:void(0);">'+e(d("modelReport"))+'</a></li><li data-target=".rules"><a href="javascript:void(0);">'+e(d("rules"))+'</a></li></ul><div class="linear-model-dialog"></div><pre class="rules"></pre></div>'}()}}),define("dialog/analytic/scorecardGrouping",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../ajax/model","../../charts/ScorecardGroupingTree","../../components/treeDataTable/LinearModel","../../midway/dialog/scorecardGrouping/body"],function(a,b,c,d,e,f,g,h,i){"use strict";var j={list:".score-list",detail:".score-detail",linearModel:".linear-model-dialog",rules:".rules",tabSelector:".nav-tabs li",back:".back"},k={active:"active",dialog:"scorecard-grouping"},l=e.translate,m=b("dialog/ScorecardGrouping",[],{constructor:function(){},show:function(a){var b=this;b.nodeData=a,b.dialog=new c({title:l("scorecardGrouping"),canFullscreen:!0,destroyOnHide:!0,className:k.dialog,body:i(),beforeHide:b.onBeforeHide.bind(b),afterShow:b.onAfterShow.bind(b),buttons:[{text:l("close"),click:function(){b.dialog.hide()}}]}).on("fullScreen",b.onFullScreen.bind(b)),b.$list=b.dialog.$(j.list),b.$detail=b.dialog.$(j.detail),b.$linearModel=b.dialog.$(j.linearModel),b.$rules=b.dialog.$(j.rules)},onFullScreen:function(){},onBeforeHide:function(){var a=this;a.tab&&a.tab.destroy(),a.tree&&a.tree.destroy()},onAfterShow:function(){var a=this;a.dialog.showLoading(),f.getScorecardGroupingTree(a.nodeData.nodeInstanceId,a.nodeData.experimentId,a.nodeData.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this;b.dialog.hideLoading(),b.tree=new g({container:b.$list[0],data:a||{},convertMap:{children:"childNodes"},onViewDetail:b.onViewDetail.bind(b)}),b.tab=new d({selector:b.$detail.find(j.tabSelector),activeClassName:k.active}),b.bindEvent()},renderFailed:function(){this.dialog.hideLoading(),this.dialog.showEmpty()},bindEvent:function(){this.dialog.$element.on("click",j.back,this.onBack.bind(this))},onViewDetail:function(a){var b=this;b.dialog.showLoading(),Promise.all([f.getScorecardGroupingModelById(b.nodeData.nodeInstanceId,a.id),f.getScorecardGroupingRules(b.nodeData.nodeInstanceId,a.id)]).then(b.viewDetail.bind(b))},onBack:function(){var a=this;a.$detail.hide(),a.$list.show()},viewDetail:function(a){var b=this;b.dialog.hideLoading(),b.$detail.show(),b.$list.hide(),b.renderLinearModel(a[0]),b.$rules.html(a[1])},renderLinearModel:function(a){var b=this;b.dataTable=new h({$container:b.$linearModel,data:a})}});return{show:function(a){(new m).show(a)}}}),define("midway/dialog/analytic/glm",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g){var h="",b=a.uuid();return h+='<ul class="param-tab"><li data-target="#'+e(b)+'-1">'+e(d("modelInfo"))+'</li><li data-target="#'+e(b)+'-2">'+e(d("configInfo"))+'</li><li data-target="#'+e(b)+'-3">'+e(d("evaluationReport"))+'</li><li data-target="#'+e(b)+'-4">'+e(d("Offset"))+'</li></ul><div id="'+e(b)+'-1" class="model-table"></div><div id="'+e(b)+'-2"><table class="table table-bordered table-striped table-condensed"><tbody>',a.each(c,function(a,b){h+="<tr><td>"+e(b)+"</td><td>"+e(a)+"</td></tr>"}),h+='</tbody></table></div><div id="'+e(b)+'-3"><table class="table table-bordered table-striped table-condensed"><tbody>',a.each(f,function(a,b){h+="<tr><td>"+e(b)+"</td><td>"+e(a)+"</td></tr>"}),h+='</tbody></table></div><div id="'+e(b)+'-4" class="offset-table"><table class="table table-bordered table-striped table-condensed"><tbody>',a.each(g,function(a,b){h+="<tr><td>"+e(b)+"</td><td>"+e(a)+"</td></tr>"}),h+="</tbody></table></div>"}(b.uuid,b.conf,b.fitGoodness,b.offset)}}),define("dialog/analytic/glm",["zero/zero","zero/ui/DialogEx","zero/ui/Tab","zero/ui/DataTable","../../i18n","../../ajax/model","../../midway/dialog/analytic/glm"],function(a,b,c,d,e,f,g){"use strict";function h(e){new b({title:j("analysisReport"),className:"dialog-analytic-glm",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){i=this,i.showLoading(),f.getGLMData(e.nodeInstanceId,e.loopTimestamp).then(function(b){if(i.hideLoading(),b){i.set("body",g(b.otherInformation)),m=new c({selector:i.$(".param-tab li")});var e=b.model.result,f={container:i.$(".model-table"),data:[],cols:[]};a.each(e[0],function(a,b){f.cols.push({title:a,field:b,sort:!0})}),e.unshift(),f.data=e,$.extend(f,k),l=new d(f)}else i.showEmpty()},function(){i.$(".param-tab").addClass("hide"),i.hideLoading(),i.showEmpty()})},afterHide:function(){m&&(m.destroy(),m=null),l&&(l.destroy(),l=null)},buttons:[{text:j("close"),click:function(){this.hide()}}]})}var i,j=e.translate,k={theme:"small",line:!0,grid:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 40px)"},l=null,m=null;return{show:h}}),define("midway/charts/tooltip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e){var f='<div class="echart-tooltip"><table><thead><tr><th></th><th>'+d(b)+"</th><th>"+d(c)+"</th></tr></thead><tbody>";return a.each(e,function(a){f+='<tr><td><span class="dot" style="background:'+d(a.color)+'"></span></td><td>'+d(a.label)+"</td><td>"+d(a.value)+"</td></tr>"}),f+="</tbody></table></div>"}(b.axisLabel,b.axisValue,b.items)}}),define("midway/dialog/analytic/glmInsurance",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b,c,f,g){var h="",b=a.uuid();return h+='<ul class="param-tab"><li data-target="#'+e(b)+'-1">'+e(d("modelInfo"))+'</li><li data-target="#'+e(b)+'-2">'+e(d("configInfo"))+'</li><li data-target="#'+e(b)+'-3">'+e(d("evaluationReport"))+'</li><li data-target="#'+e(b)+'-4">'+e(d("Offset"))+'</li><li data-target="#'+e(b)+'-5">'+e(d("confidenceInterval"))+'</li></ul><div id="'+e(b)+'-1" class="model-table"></div><div id="'+e(b)+'-2"><table class="table table-bordered table-striped table-condensed"><tbody>',a.each(c,function(a,b){h+="<tr><td>"+e(b)+"</td><td>"+e(a)+"</td></tr>"}),h+='</tbody></table></div><div id="'+e(b)+'-3"><table class="table table-bordered table-striped table-condensed"><tbody>',a.each(f,function(a,b){h+="<tr><td>"+e(b)+"</td><td>"+e(a)+"</td></tr>"}),h+='</tbody></table></div><div id="'+e(b)+'-4" class="offset-table"><table class="table table-bordered table-striped table-condensed"><tbody>',a.each(g,function(a,b){h+="<tr><td>"+e(b)+"</td><td>"+e(a)+"</td></tr>"}),h+='</tbody></table></div><div id="'+e(b)+'-5" class="batch-histogram"></div>'}(b.uuid,b.conf,b.fitGoodness,b.offset)}}),define("dialog/analytic/glmInsurance",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","zero/ui/datatable/plugins/Resizer","zero/ui/DataTable","../../i18n","../../global/utils","../../ajax/model","../../components/batchHistograms/BasicHistogram","../../charts/bar","../../midway/charts/tooltip","../../midway/dialog/analytic/glmInsurance"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b){v=new r({container:a.$(".batch-histogram"),data:b})}function o(b){new c({title:q("analysisReport"),className:"dialog-analytic-glm-insurance",destroyOnHide:!0,afterShow:function(){p=this,p.showLoading(),i.getGLMData(b.nodeInstanceId,b.loopTimestamp).then(function(b){if(p.hideLoading(),b){p.set("body",m(b.otherInformation)),u=new d({selector:p.$(".param-tab li"),afterShow:function(a){4!==a||v||n(p,b.confidenceInterval)}});var c=b.model.result,e=c[0],g=0,i={container:p.$(".model-table"),data:c.slice(1),cols:[]};a.each(e,function(b,c){var d=[b];a.each(i.data,function(a){d.push(a[c])});var e=h.getMaxTextWidth(d)+40;g+=e,i.cols.push({title:b,field:c,width:e,sort:!0})}),i.container.css({width:g+20}),$.extend(i,s),t=new f(i)}else p.showEmpty()},function(){p.$(".param-tab").addClass("hide"),p.hideLoading(),p.showEmpty()})},afterHide:function(){u&&(u.destroy(),u=null),t&&(t.destroy(),t=null),v&&(v.destroy(),v=null)},buttons:[{text:q("close"),click:function(){this.hide()}}]})}var p,q=g.translate,r=b("component/glmInsurance",[j],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(b){var c=b.data,d=a.map(a.keys(c),function(a){return{name:a,type:"enum",data:c[a]}});b.data={features:d},j.prototype.constructor.call(this,b)},parseFeature:function(b){var c=b.data,d=a.some(c.value_minus_stdandard_error,function(a){return null===a})||a.some(c.value_plus_stdandard_error,function(a){return null===a}),e="Weight",f={title:{text:b.name,subtext:b.type,top:8},grid:{top:112},name:b.name,imageName:b.name,toolbox:{feature:{restore:{show:!1},magicType:{show:!1,type:[]}}},tooltip:{formatter:function(a){return l({axisLabel:"x",axisValue:a[0].axisValue,items:a.map(function(a){return{label:a.seriesName,value:a.value.toFixed(4),color:a.color}})})}},xAxis:[{type:"category",data:c.colname}],yAxis:[{type:"value"},{type:"value",min:0}],series:[{name:e,data:c.weight,type:"bar",yAxisIndex:1},{name:"Value",data:c.value,type:"line"}],legend:{data:[e,"Value"],top:64}};return d||(f.series.push({name:"+ Std Err",data:c.value_plus_stdandard_error,type:"line"},{name:"- Std Err",data:c.value_minus_stdandard_error,type:"line"}),f.legend.data.push("+ Std Err","- Std Err")),f},renderMainChart:function(a){var b={element:this.$container.find(".main-chart"),cancelSmart:{dataZoom:!0}};$.extend(b,a||this.currentChartData),this.destroyMainChart(),this.mainChart=new k(b)}}),s={theme:"small",line:!0,grid:!0,crossHover:!1,defaultsort:!0,height:"calc(100% - 40px)"},t=null,u=null,v=null;return{show:o}}),define("midway/dialog/analytic/glmInsurancePredict",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e='<div class="tab-wrap">',c=a.uuid();return e+='<ul class="nav nav-tabs pai-tab">',a.each(b,function(a,b){e+='<li data-target="#'+d(c+"-"+b)+'"><a href="javascript:void(0);">'+d(a)+"</a></li>"}),e+="</ul>",a.each(b,function(a,b){e+='<div id="'+d(c+"-"+b)+'" class="chart-wrap chart-wrap-'+d(b)+' hide"></div>'}),e+="</div>"}(b.tabs,b.uuid)}}),define("dialog/analytic/glmInsurancePredict",["zero/zero","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../global/utils","../../ajax/model","../../charts/theme","../../midway/charts/tooltip","../../midway/dialog/analytic/glmInsurancePredict"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=this;b.showLoading(),f.getGLMResidual(a.nodeInstanceId,a.loopTimestamp).then(function(a){b.hideLoading();var c=a.residual;k(b,{tabs:s,map:c})},function(){b.hideLoading(),b.showEmpty()})}function k(a,b){a.set("body",i(b)),q=new c({selector:a.$(".pai-tab li"),activeClassName:"active",selectedIndex:0,afterShow:function(c){r[c]||(3===c?l(a,b,c):4===c?m(a,b,c):n(a,b,c))}})}function l(a,b,c){var d=b.tabs[c],f=b.map[d].result,h=[],i=[],j=e.getMaxTextWidth(f.map(function(a){return h.push(a[0]),i.push(a[1]),Math.round(a[1])})),k=Math.max.apply(null,h),l=Math.max.apply(null,i),m=(Math.max(k,l),{title:{text:d,left:j+64,textAlign:"left"},grid:{top:48,left:j+64,right:40,bottom:64},tooltip:{axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}},formatter:function(a){return""}},toolbox:{show:!0,right:32,feature:{saveAsImage:{}}},xAxis:{type:"value",min:0,scale:!0},yAxis:{type:"value",min:0,scale:!0},series:[{type:"scatter",data:f},{type:"scatter",data:[],markLine:{animation:!1,lineStyle:{normal:{type:"solid"}},data:[[{coord:[0,0],symbol:"none"},{coord:[1,1],symbol:"none"}]]}}]}),n=echarts.init(a.$(".chart-wrap-"+c)[0],g);n.setOption(m),r[c]=n}function m(a,b,c){var d=b.tabs[c],f=b.map[d].result,h=b.map["SSDR 高斯曲线"].result,i=[],j=[];h&&h.forEach(function(a){i.push(a[0]),j.push(a[1])});var k=[],l=[],m=e.getMaxTextWidth(f.map(function(a){return k.push(a[0]),l.push(a[1]),Math.round(a[1])})),n={title:{text:d,left:m+64,textAlign:"left"},grid:{top:48,left:m+64,right:40,bottom:64},tooltip:{axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}},formatter:function(a){return""}},toolbox:{show:!0,right:32,feature:{saveAsImage:{}}},xAxis:[{type:"category",data:k},{type:"category",data:i,show:!1}],yAxis:{type:"value",scale:!0},series:[{type:"bar",data:l,xAxisIndex:0},{type:"line",data:j,xAxisIndex:1,showSymbol:!1,hoverAnimation:!1,animation:!1,smooth:!0}]},o=echarts.init(a.$(".chart-wrap-"+c)[0],g);o.setOption(n),r[c]=o}function n(a,b,c){var d=b.tabs[c],f=b.map[d].result,h=e.getMaxTextWidth(f.map(function(a){return Math.round(a[1])})),i={title:{text:d,left:h+64,textAlign:"left"},grid:{top:48,left:h+64,right:40,bottom:64},tooltip:{axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}},formatter:function(a){return""}},toolbox:{show:!0,right:32,feature:{saveAsImage:{}}},xAxis:{type:"value",scale:!0,name:0===c?"Transformed Fitted Value":1===c?"fitted value":"",nameGap:48,nameLocation:"middle"},yAxis:{type:"value",name:0===c?"Studentised Standardised Deviance residual":1===c?"crunched residual":"",nameLocation:"middle",nameRotate:90,nameGap:h+48,scale:!0},series:[{type:"scatter",data:f}]},j=echarts.init(a.$(".chart-wrap-"+c)[0],g);j.setOption(i),r[c]=j}function o(c){new b({title:p("analysisReport"),className:"dialog-analytic-glm-insurance-predict",destroyOnHide:!0,canFullscreen:!1,body:i({tabs:[]}),afterShow:function(){j.call(this,c)},afterHide:function(){q&&(q.destroy(),q=null),a.each(r,function(a){a.dispose()}),r=[]},buttons:[{text:p("close"),click:function(){this.hide()}}]})}var p=d.translate,q=null,r=[],s=["Studentized Standardized Deviance Residuals","Crunched Residuals","Cooks largest残差图","SSDR PP图","SSDR 直方图"];return{show:o}}),define("midway/dialog/analytic/normalityTest",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("midway/dialog/analytic/normalityTestParams",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e){return'<table class="table table-bordered table-hover table-striped"><tbody><tr><td>Anderson Darling Test [value]</td><td>'+d(a)+"</td></tr><tr><td>Anderson Darling Test [p-value]</td><td>"+d(b)+"</td></tr><tr><td>Kolmogorov Smirnov Test [value]</td><td>"+d(c)+"</td></tr><tr><td>Kolmogorov Smirnov Test [p-value]</td><td>"+d(e)+"</td></tr></tbody></table>"}(b.adTestValue,b.adPValue,b.ksTestValue,b.ksPValue)}}),define("dialog/analytic/normalityTest",["zero/zero","zero/declare","zero/ui/DialogEx","../../i18n","../../ajax/model","../../components/batchHistograms/BasicHistogram","../../charts/bar","../../midway/dialog/analytic/normalityTest","../../midway/dialog/analytic/normalityTestParams"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){var d=null;new c({title:k("normalityTest"),className:"dialog-normality-test batch-histogram",body:h(),destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var c=this;c.showLoading(),e.getNormalityTestData(b.nodeInstanceId,b.loopTimestamp).then(function(b){var e=[];a.each(b,function(a,b){e.push({name:b,data:a,type:"enum"})}),d=new l({container:c.$(".chart-wrap"),data:{features:e}}),c.hideLoading(),c.on("fullScreen",function(){d&&d.renderMainChart()})},function(){c.hideLoading(),c.showEmpty()})},afterHide:function(){d&&d.destroy()},buttons:[{text:k("close"),click:function(){this.hide()}}]})}var k=d.translate,l=b("component/NormalityTest",[f],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){f.prototype.constructor.call(this,a)},parseFeature:function(b){var c=b.name,d=b.data,e=d.x,f=d.y,g=a.map(e,function(a,b){return[a,f[b]]});return{raw:d,title:{text:c,subtext:b.type},name:c,imageName:c,toolbox:{feature:{restore:{show:!0},saveAsImage:{show:!0},magicType:{show:!1}}},tooltip:{formatter:function(a){return a.seriesName+"<br/>  x: "+a.value[0]+"<br/>  y: "+a.value[1]}},axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}},xAxis:[{type:"value",axisLabel:{show:!0,rotate:0}}],yAxis:[{type:"value",axisLabel:{show:!0,rotate:0}}],dataZoom:{show:!1},series:[{name:c,type:"scatter",data:g}]}},renderMainChart:function(a){var b={element:this.$container.find(".main-chart"),cancelSmart:{dataZoom:!0}};$.extend(b,a||this.currentChartData),this.destroyMainChart(),this.mainChart=new g(b)},renderSummaries:function(){var a=this.dataMap[this.currentField].feature;this.$summaries.empty().append(i(a.data))}});return{show:j}}),define("dialog/analytic/quantile",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../global/utils","../../i18n","../../ajax/model","../../components/batchHistograms/BasicHistogram","../../charts/bar"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=null;new c({title:k("quantile"),className:"dialog-quantile batch-histogram",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var c=this;c.showLoading(),g.percentile(a.nodeInstanceId,a.nodeDefId,a.experimentId,a.loopTimestamp).then(function(a){b=new l({container:c.$element.find(".modal-content .modal-body"),data:a}),c.hideLoading(),c.on("fullScreen",function(){b&&b.renderMainChart()})},function(){c.hideLoading(),c.showEmpty()})},afterHide:function(){b&&b.destroy()},buttons:[{text:k("close"),click:function(){this.hide()}}]})}var k=f.translate,l=b("component/Quantile",[h],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){h.prototype.constructor.call(this,a)},parseFeature:function(a){var b,c,d,f,g={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0},magicType:{show:!1}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{},{type:"value",scale:!0}]},h=a.distribution[0].length;if("num"===a._type){for(c=a.min,g.xAxis[0].data.push(c),b=0;b<h;b++)d=e.accAdd(c,a.step),f=d,g.xAxis[0].data.push(f),c=d;g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(g.xAxis[0].data=a.value,g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}});return g.series.push({name:a.name,data:a.distribution[0],type:"bar"}),g},renderMainChart:function(a){var b={element:this.$container.find(".main-chart"),cancelSmart:{dataZoom:!0}};$.extend(b,a||this.currentChartData),this.destroyMainChart(),this.mainChart=new i(b)},renderSummaries:function(){var a=this,b=a.dataMap[a.currentField].feature;a.summaryTable&&a.summaryTable.destroy(),a.summaryTable=new d({theme:"small",line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,container:a.$summaries,data:[b.metrics],cols:[{title:"Max",field:"max",width:"20%"},{title:"Median",field:"median",width:"20%"},{title:"Min",field:"min",width:"20%"},{title:"Q1",field:"q1",width:"20%"},{title:"Q3",field:"q3"}]})},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),h.prototype.destroy.call(this)}});return{show:j}}),define("dialog/analytic/lorenzCurve",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../global/utils","../../i18n","../../ajax/model","../../components/batchHistograms/BasicHistogram","../../charts/bar"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=null;new c({title:k("lorenzCurve"),className:"dialog-lorenzCurve batch-histogram",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var c=this;c.showLoading(),g.percentile(a.nodeInstanceId,a.nodeDefId,a.experimentId,a.loopTimestamp).then(function(a){b=new l({container:c.$element.find(".modal-content .modal-body"),data:a}),c.hideLoading(),c.on("fullScreen",function(){b&&b.renderMainChart()})},function(){c.hideLoading(),c.showEmpty()})},afterHide:function(){b&&b.destroy()},buttons:[{text:k("close"),click:function(){this.hide()}}]})}var k=f.translate,l=b("component/LorenzCurve",[h],{hasStepPanel:!1,hasLogPanel:!1,constructor:function(a){h.prototype.constructor.call(this,a)},parseFeature:function(a){var b,c,d,f,g={title:{text:a.name,subtext:a.type},name:a.name,imageName:a.name,toolbox:{feature:{restore:{show:!0},magicType:{show:!1}}},tooltip:{},series:[],xAxis:[{data:[]}],yAxis:[{type:"value",scale:!0,min:0,max:1,splitNumber:10}]},h=a.distribution[0].length;if("num"===a._type){for(c=a.min,g.xAxis[0].data.push(c),b=0;b<h;b++)d=e.accAdd(c,a.step),f=d,g.xAxis[0].data.push(f),c=d;g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}}}else"enum"===a._type&&(g.xAxis[0].data=a.value,g.tooltip.formatter=function(a){if(a){var b=a[0].name;return a.sort(function(a,b){return a.seriesIndex>b.seriesIndex}).forEach(function(a){b+="<br>"+a.seriesName+" : "+a.value}),b}});return g.series.push({name:a.name,data:a.distribution[0],type:"line"}),g},renderMainChart:function(a){var b={element:this.$container.find(".main-chart"),cancelSmart:{dataZoom:!0}};$.extend(b,a||this.currentChartData),this.destroyMainChart(),this.mainChart=new i(b)},renderSummaries:function(){var a=this,b=a.dataMap[a.currentField].feature;a.summaryTable&&a.summaryTable.destroy(),a.summaryTable=new d({theme:"small",line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,container:a.$summaries,data:[b.metrics],cols:[{title:"Max",field:"max",width:"20%"},{title:"Median",field:"median",width:"20%"},{title:"Min",field:"min",width:"20%"},{title:"Q1",field:"q1",width:"20%"},{title:"Q3",field:"q3"}]})},destroy:function(){this.summaryTable&&this.summaryTable.destroy(),h.prototype.destroy.call(this)}});return{show:j}}),define("midway/dialog/analytic/correlationMatrixList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c="";return a.each(b,function(a){c+="<li "+d(a.selected?"class=selected":"")+' data-name="'+d(a.name)+'">'+d(a.name)+"</li>"}),c+=""}(b.columns)}}),define("midway/dialog/analytic/correlationMatrix",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(b){var f='<div class="tab-panel"><ul class="nav nav-tabs pai-tab"><li class="active" data-target="#matrix-chart"><a href="javascript:void(0);">'+e(d("matrixChart"))+'</a></li><li data-target="#matrix-table"><a href="javascript:void(0);">'+e(d("matrixTable"))+'</a></li></ul></div><div id="matrix-chart"><div class="correlation-matrix-options hide">',b=a.uuid();return f+='<div class="ui-checkbox"><input type="checkbox" id="'+e(b)+'"><label for="'+e(b)+'"><span class="ui-checkbox-label">'+e(d("showCorrelation"))+'</span></label></div><dl class="column-list"><dt>'+e(d("selectColumn"))+"<span>("+c(d("selectedColumnCount",""))+')</span></dt><dd><ul></ul></dd></dl></div><div class="correlation-matrix-chart" id="correlation-matrix-chart"></div></div><div id="matrix-table"><div class="filter-input"><span> '+e(d("matrixRange"))+' : </span> <input type="range" value="0.5" min="0" max="0.9999" step="0.0001" class="matrix_filter_range"><input type="number" value="0.5" min="0" max="1"  step="0.0001"  class="matrix_filter_input"></div><div class="table-section"><div class="table-header"></div><div class="table-content"><div class="table-record"></div></div></div></div>'}(b.uuid)}}),define("dialog/analytic/correlationMatrix",["zero/zero","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../global/utils","../../ajax/analysis","../../midway/dialog/analytic/correlationMatrixList","../../midway/dialog/analytic/correlationMatrix","../../global/natsort"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){A=a.map(b.tableHeader.slice(1),function(a,b){return{name:a,selected:b<D}}),B=a.map(b.records,function(b){var c=[];return a.each(b,function(a,b){if(b){var d=parseFloat(parseFloat(a).toFixed(2));isNaN(d)&&(d=0),c.push(d)}}),c})}function k(a){a.on("fullScreen",function(){if(v){var b=a.$(x.container);v.changeSize(b.width(),b.height())}}),a.$(x.count).text(D),a.$(x.options).removeClass(y.hide),a.$(x.chk).on("click",function(){C=$(this).prop("checked"),n(a)}).prop("checked",C)}function l(b){b.$(x.list).html(g({columns:A})).on("click","li",function(){var c=$(this),d=c.hasClass(y.selected),e=c.attr("data-name");c.toggleClass(y.selected),a.each(A,function(a){a.name===e&&(a.selected=!d)}),D+=d?-1:1,b.$(x.count).text(D),n(b)})}function m(){var b={columns:[],records:[]};return a.each(A,function(c,d){if(c.selected){b.columns.push(c.name);var e=B[d],f=[];a.each(A,function(a,b){a.selected&&f.push(e[b])}),b.records.push(f)}}),b}function n(b){var c=m(),d=c.columns,e=[];a.each(c.records,function(b,c){a.each(b,function(a,b){e.push({x:c,y:b,correlation:a})})});var f=b.$(x.container);v&&v.destroy(),v=new G2.Chart({id:"correlation-matrix-chart",width:f.width(),height:f.height()}),v.source(e,{x:{type:"cat",values:d.slice(0)},y:{type:"cat",values:d.slice(0)},correlation:{nice:!1,min:-1,max:1}}),v.axis("x",{title:null}),v.axis("y",{title:null});var g=v.polygon().position("x*y").color("correlation","#EECB5F-#ffffff-#61a5e8");C&&g.label("correlation",{offset:-2,label:{fill:"#666",fontWeight:"bold"}}),v.tooltip(!0,{title:null,map:{title:"x",name:"y",value:"correlation"}}),v.on("tooltipchange",function(a){var b=a.items[0],c=b.point._origin;b.name=d[c.x]+" - "+d[c.y]}),v.render()}function o(a){F=a,E=["filed","field","correlation-value"];var b=u(F,.5),c=i({desc:"desc"===I});b.sort(function(a,b){return c(a[G],b[G])}),K=t({headers:E,tableData:b}),q(E,K),r(b,K),s()}function p(){var a=i({desc:"desc"===I}),b=u(F,H);b.sort(function(b,c){return a(b[G],c[G])}),q(E,K),r(0===b.length?[["none","data","match"]]:b.slice(0),K)}function q(a,b){var c=b.reduce(function(a,b){return a+b},0),d='<table class="table table-bordered"><thead><tr>';a.forEach(function(a,c){d+='<th style="width: '+b[c]+'px;">'+a,d+='<span class="sorter'+(c===G?" sorted-"+I:"")+'" data-index="'+c+'"><span class="asc '+(c===G&&"asc"===I?" active ":"")+' "></span><span class="desc'+(c===G&&"desc"===I?" active ":"")+'"></span></span>',d+="</th>"}),d+="</tr></thead></table>",z.$(x.table).find(".table-header").css({width:c}).html(d)}function r(a,b){var c=b.reduce(function(a,b,c){return a+b},0),d='<table class="table table-bordered table-hover" style="width:'+c+'px"><tbody>';a.forEach(function(a){a.forEach(function(a,c){var e=b[c];d+="<td"+(e===J?' class="tips"':"")+' style="width: '+e+'px;">'+a+"</td>"}),d+="</tr>"}),d+="</tr></tbody></table>",z.$(x.table).find(".table-record").html(d)}function s(){z.$(".table-header").on("click",".sorter",function(){var a=$(this),b=parseInt(a.attr("data-index"),10),c=a.hasClass("sorted-asc")
;a.hasClass("sorted-desc");b!==G?(G=b,I="asc"):I=c?"desc":"asc",p()}),z.$(".matrix_filter_range").on("mouseup",function(a){var b=$(this),c=z.$(".matrix_filter_input");H=parseFloat(b.val(),10),c.val(H),p()}),z.$(".matrix_filter_input").on("change",function(a){var b=$(this),c=z.$(".matrix_filter_range");H=parseFloat(b.val(),10),c.val(H),p()}),z.$(".table-record").on("mouseenter",".tips",function(){var a=new Popup(this,{position:"bottom center",fallback:"bottom center",hoverable:!0,content:$(this).html(),classNames:{popup:"ui-popup log-popup"},escape:function(a){return a=_.escape(a),a.length>100?"<pre>"+a+"</pre>":a}});a.delayedShow(),a.on("hide",function(){setTimeout(function(){a.destroy()},10)})})}function t(a){var b=[],c=a.headers,d=a.tableData;return c.forEach(function(a,c){var e=[a+"AA"];d.forEach(function(a){a.forEach(function(a,b){c===b&&e.push(a)})}),b.push(e)}),b.map(function(a){var b=e.getMaxTextWidth(a)+22;return b>J?J:b})}function u(a,b){var c=a.tableHeader.slice(1),d=[];return a.records.forEach(function(a,e){var f=a[0];a.slice(1).forEach(function(a,e){var g=parseFloat(a,10);Math.abs(g)>b&&f!==c[e]&&d.push([c[e],f,g.toFixed(5)])})}),d}var v,w=d.translate,x={options:".correlation-matrix-options",container:".correlation-matrix-chart",list:".column-list ul",count:".column-list dt span em",chk:".ui-checkbox input",selected:".selected",tab:".tab-panel .nav li",table:".table-section",tableContent:".matrix-table .table-content",tableHeader:".matrix-table .table-header thead",tableRecord:".matrix-table .table-record tbody tr"},y={hide:"hide",selected:"selected"},z=null,A=null,B=null,C=!1,D=20,E=[],F=null,G=2,H=.5,I="",J=400,K=[];return{show:function(a){var d=this;z=new b({title:w("correlationMatrix"),className:"dialog-correlation-matrix",body:h(),destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var b=this;b.showLoading(),f.explore(a.nodeInstanceId,1,1e5,a.loopTimestamp).then(function(a){j(a),l(b),n(b),k(b),o(a),b.hideLoading()},function(){b.hideLoading(),b.showEmpty()})},afterHide:function(){v&&v.destroy(),v=null,B=null,A=null,D=20},buttons:[{text:w("close"),click:function(){this.hide()}}]}),d.tab=new c({selector:z.$element.find(x.tab),activeClassName:"active",afterShow:function(a){}})}}}),define("midway/dialog/analytic/corresp",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("dialog/analytic/corresp",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../charts/theme","../../midway/dialog/analytic/corresp"],function(a,b,c,d,e,f){"use strict";function g(c){function g(b,c){var d=c?20:10,f=a.keys(b)||[],g={},i=Number.MAX_SAFE_INTEGER,j=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;if(a.each(f,function(c){var d=b[c],e=a.keys(d);g[c]=a.map(e,function(a){var b=d[a][0],c=d[a][1];return i=Math.min(b,i),j=Math.max(b,j),n=Math.min(c,n),o=Math.max(c,o),{label:a,pos:[b,c]}})}),i>=0?(i=0,j=Math.ceil(j/d)*d):j<=0?(j=0,i=Math.floor(i/d)*d):(j=Math.max(-i,j),j=Math.ceil(Math.ceil(2*j/d)*d/2),i=-j),n>=0?(n=0,o=Math.ceil(o/d)*d):o<=0?(o=0,n=Math.floor(n/d)*d):(o=Math.max(-n,o),o=Math.ceil(Math.ceil(2*o/d)*d),n=-o),f.length){var p=a.map(f,function(b){return{type:"scatter",name:b,data:a.map(g[b],function(a){return a.pos}),markPoint:{symbol:"pin",itemStyle:{normal:{color:"transparent",label:{textStyle:{color:"#333"},formatter:function(a){return a.seriesName+"="+a.value}}}},data:a.map(g[b],function(a){return{name:"["+a.pos.join(", ")+"]",value:a.label,xAxis:a.pos[0],yAxis:a.pos[1]}})}}})||[],q={title:{text:h("corresp"),x:"center",align:"right"},toolbox:{show:!0,feature:{saveAsImage:{show:!0},restore:{show:!0}}},grid:{x:220,y2:80},tooltip:{trigger:"axis",showDelay:0,hideDelay:50,axisPointer:{show:!1,type:"cross",lineStyle:{type:"dashed",width:1}},formatter:function(a){var b=a.dataIndex,c=a.seriesName,d=g[c],e=d[b];return c+" <br/> ["+e.pos.join(", ")+"]: "+e.label}},xAxis:{type:"value",splitNumber:d},yAxis:{type:"value",splitNumber:d},legend:{data:f,orient:"vertical",x:"left",y:"center"},series:p,dataZoom:{show:!0,realtime:!0,height:30,start:0,end:100}};k=echarts.init(m.$(".chart-wrap")[0],e),k.setOption(q)}else m.showEmpty();l=b}function i(){var a=this;a.showLoading(),d.getCorrespData(c.nodeInstanceId,c.loopTimestamp).then(function(b){b&&g(b,!1),a.hideLoading()})}function j(){k&&(k.clear(),k.dispose())}var k=null,l=null,m=new b({body:f(),title:h("corresp"),className:"dialog-corresp",destroyOnHide:!0,canFullscreen:!0,afterShow:i,afterHide:j,buttons:[{text:h("close"),click:function(){this.hide()}}]});m.on("fullScreen",function(a){l&&(j(),g(l,a))})}var h=c.translate;return{show:g}}),define("midway/dialog/analytic/decompose",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e="";if(b){e+='<div class="wrap">';var c=a.uuid();e+='<ul class="nav nav-tabs pai-tab">',a.each(b,function(a,b){e+='<li data-target="#'+d(c+"-"+b)+'"><a href="javascript:void(0);">group'+d(b)+"</a></li>"}),e+="</ul>",a.each(b,function(a,b){e+='<div id="'+d(c+"-"+b)+'" class="tab-content"><div class="tab-meta">'+d(a.meta)+'</div><div class="chart-wrap"></div></div>'}),e+="</div>"}else e+='<div class="wrap"><div class="chart-wrap"></div></div>';return e+=""}(b.groups,b.uuid)}}),define("midway/dialog/analytic/decomposeTooltip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e='<table class="decompose-tooltip"><thead><tr><th colspan="3">'+d(b)+"</th></tr></thead><tbody>";return a.each(c,function(a){e+="<tr><td>",a.color&&(e+='<i class="color" style="border-color: '+d(a.color)+';"></i> '),e+="</td><td>"+d(a.name)+"：</td><td>"+d(a.value)+"</td></tr>"}),e+="</tbody></table>"}(b.title,b.items)}}),define("dialog/analytic/decompose",["zero/zero","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../ajax/model","../../charts/theme","../../midway/dialog/analytic/decompose","../../midway/dialog/analytic/decomposeTooltip"],function(a,b,c,d,e,f,g,h){"use strict";function i(d){function i(a,b){function c(a,b){var c={top:a,right:32,left:64,height:u};return b&&$.extend(!0,c,b),c}function d(a,b){var c={type:"category",axisLine:{show:!0,onZero:!1,lineStyle:{color:"#d6d6d6",width:2}},axisTick:{show:!1,lineStyle:{color:"#d6d6d6"}},axisLabel:{show:!1,margin:8,textStyle:{color:"#999"}},splitLine:{show:!1},axisPointer:{lineStyle:{color:"transparent"}},gridIndex:a,data:l};return b&&$.extend(!0,c,b),c}function e(a,b){var c={type:"value",gridIndex:a,nameGap:40,nameTextStyle:{color:"#666",fontSize:14},nameLocation:"middle",axisTick:{show:!0,length:5,lineStyle:{color:"#d6d6d6"}},axisLine:{show:!0,lineStyle:{color:"#d6d6d6",width:2}},axisLabel:{show:!0,margin:8,textStyle:{color:"#999"}},splitLine:{show:!1}};return b&&$.extend(!0,c,b),c}function g(a,b){var c={type:"line",symbol:"circle",symbolSize:2,xAxisIndex:a,yAxisIndex:a};return $.extend(!0,c,b),c}var i=a.decompose,j={observed:i.observed.result,random:i.random.result,seasonal:i.seasonal.result,trend:i.trend.result},l=j.trend.slice(1).map(function(a){return a[0]}),m=j.trend.slice(1).map(function(a){return a[1]||"-"}),n=j.random.slice(1).map(function(a){return a[1]||"-"}),o=j.seasonal.slice(1).map(function(a){return a[1]||"-"}),p=j.observed.slice(1).map(function(a){return a[1]||"-"}),q=k.outerHeight(),r=24,t=40,u=Math.floor((q-4*r-t-40)/4),v={title:{text:"Decompose of time series",left:"center"},toolbox:{show:!0,right:32,feature:{dataZoom:{show:!0},saveAsImage:{show:!0,type:"png",name:"Decompose of time series"}}},tooltip:{trigger:"axis",formatter:function(a){var b={},c={},d=["observed","trend","seasonal","random"];return d.forEach(function(d){a.some(function(a){return d===a.seriesName&&(c[d]=a,b.title||(b.title=a.axisValue),!0)})}),b.items=d.map(function(a){return{name:a,value:c[a].value,color:c[a].color}}),h(b)}},axisPointer:{link:{xAxisIndex:"all"},snap:!0},grid:[c(t),c(t+u+r),c(t+2*u+2*r),c(t+3*u+3*r),c(t,{show:!0,height:4*u+3*r,z:10})],xAxis:[d(0),d(1),d(2),d(3),d(4,{axisTick:{show:!0},axisLabel:{show:!0},axisPointer:{show:!0,lineStyle:{color:"#478cf1",width:1.5}}})],yAxis:[e(0,{name:"observed"}),e(1,{name:"trend"}),e(2,{name:"seasonal"}),e(3,{name:"random"}),e(4,{axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!1}})],series:[g(0,{name:"observed",data:p}),g(1,{name:"trend",data:m}),g(2,{name:"seasonal",data:o}),g(3,{name:"random",data:n}),g(4,{name:"main",symbol:"none",data:n.map(function(){return Math.random()}),itemStyle:{normal:{color:"transparent"}}})],dataZoom:[{type:"slider",top:t+4*u+4*r+10,xAxisIndex:[0,1,2,3,4]},{type:"inside",xAxisIndex:[0,1,2,3,4]}]};s=echarts.init(k[0],f),s.setOption(v)}function n(a){u.set("body",g({groups:a})),l=new c({selector:u.$(".nav-tabs"),activeClassName:"active",afterShow:function(a){q(),m=a,o()}})}function o(){k=u.$(".tab-content:eq("+m+") .chart-wrap"),i(t[m].tabs,!1)}function p(){var b=this;b.showLoading(),e.getLinearModelStatic(d.nodeInstanceId,d.loopTimestamp).then(function(c){t=c,a.isArray(c)?n(c):(k=b.$(".chart-wrap"),i(c,!1)),b.hideLoading()})}function q(){s&&(s.clear(),s.dispose(),s=null)}function r(){q(),l&&(l.destroy(),l=null),k=null}var s=null,t=null,u=new b({body:g({}),title:"Decompose of time series",className:"dialog-analytic-decompose",destroyOnHide:!0,canFullscreen:!0,afterShow:p,afterHide:r,buttons:[{text:j("close"),click:function(){this.hide()}}]});u.on("fullScreen",function(a){t&&(q(),l?o():i(t,a))})}var j=d.translate,k=null,l=null,m=-1;return{show:i}}),define("midway/dialog/analytic/gainCurve",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div>'}}),define("dialog/analytic/gainCurve",["zero/zero","zero/ui/DialogEx","../../i18n","../../ajax/model","../../charts/theme","../../midway/charts/tooltip","../../midway/dialog/analytic/gainCurve"],function(a,b,c,d,e,f,g){"use strict";function h(a){var b=this;b.showLoading(),d.getGainCurve(a.nodeInstanceId,a.loopTimestamp).then(function(a){b.hideLoading(),i(b,a)},function(){b.hideLoading(),b.showEmpty()})}function i(a,b){var c=b.lorenz,d=c.lines,g=(c.quantile.quantile,{title:{text:"洛伦茨曲线",subtext:"Gini: "+b.metrics.gini.toFixed(4),left:"10%",textAlign:"left"},color:["#61A5E8","#da3e3d"],tooltip:{trigger:"axis",axisPointer:{type:"line",axis:"x"},formatter:function(a){return f({axisLabel:"x",axisValue:(100*a[0].axisValue).toFixed(2)+"%",items:a.map(function(a){return{label:a.seriesName,color:a.color,value:(100*a.value[1]).toFixed(2)+"%"}})})}},toolbox:{show:!0,right:"10%",feature:{saveAsImage:{}}},xAxis:[{type:"value",min:0,max:1,position:"bottom",axisLabel:{formatter:function(a){return 100*a+"%"}}}],yAxis:{axisLabel:{formatter:function(a){return 100*a+"%"}}},legend:{data:["Lorenz Curve","Line of Equality"]},series:[{name:"Lorenz Curve",type:"line",symbol:"none",smooth:!0,data:d.lorenz_curve.map(function(a,b){return[d.line_of_equality[b],a]})},{name:"Line of Equality",type:"line",symbol:"none",smooth:!0,data:d.line_of_equality.map(function(a,b){return[a,a]})}]});echarts.init(a.$(".chart-wrap")[0],e).setOption(g)}function j(a){new b({title:"增益曲线基尼",className:"dialog-gain-curve",destroyOnHide:!0,canFullscreen:!1,body:g(),afterShow:function(){h.call(this,a)},buttons:[{text:k("close"),click:function(){this.hide()}}]})}var k=c.translate;return{show:j}}),define("ajax/modelOperationAjax",["zero/zero","./base"],function(a,b){"use strict";var c="/modelOperationAjax.json",d=b.create(c);return{saveOperation:function(a,b){return d.post({operationContent:JSON.stringify(b),nodeInstanceId:a,method:"saveVisualizationOperation"})},getOperation:function(a){return d.get({nodeInstanceId:a,method:"getVisualizationOperation"}).then(function(a){var b=a.operation;try{return JSON.parse(b)}catch(a){return{}}})}}}),define("midway/dialog/analytic/pivotTable",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e=" ";if(b&&b.length){e+='<ul class="column-list"><li>选择直方图列</li>';var c=a.uuid();e+=" ",a.each(b,function(a,b){e+='<li><div class="ui-checkbox"><input type="checkbox" '+d(a.checked?" checked":"")+' data-column="'+d(a.name)+'" id="'+d(c+"-"+b)+'"><label for="'+d(c+"-"+b)+'">'+d(a.name)+"</label></div></li>"}),e+="</ul>"}return e+='<div class="chart-wrap"></div>'}(b.columns,b.uuid)}}),define("dialog/analytic/pivotTable",["zero/zero","zero/ui/DialogEx","../../i18n","../../global/utils","../../ajax/model","../../ajax/modelOperationAjax","../../charts/theme","../../midway/charts/tooltip","../../midway/dialog/analytic/pivotTable"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){f.saveOperation(a.nodeInstanceId,q),p&&(p.dispose(),p=null)}function k(a){var b=this;b.showLoading(),Promise.all([f.getOperation(a.nodeInstanceId),e.getPivotTableData(a.nodeInstanceId,a.loopTimestamp)]).then(function(a){b.hideLoading(),q.barColumns=a[0].barColumns||[],q.selectedLegend=a[0].selectedLegend||{},l(b,a[1].data)},function(){b.hideLoading(),b.showEmpty()})}function l(b,c){var d=a.keys(c.yColValues),e=a.keys(c.yColValues[d[0]]),f=q.barColumns;q.selectedLegend;f.length||f.push(e[0]),b.set("body",i({columns:e.map(function(a){return{name:a,checked:f.indexOf(a)>=0}})})),b.$(".ui-checkbox input").on("change",function(){var a=[];b.$(".ui-checkbox input").each(function(){var b=$(this);b.prop("checked")&&a.push(b.attr("data-column"))}),q.barColumns=a,m(b,c)}),m(b,c)}function m(b,c){var e=q.barColumns,f=q.selectedLegend,h=["#c1232b","#27727b","#fcce10","#e87c25","#b5c334","#fe8463","#3fb1e3","#6be6c1","#626c91","#a0a7e6","#c4ebad","#96dee8","#9bca63","#fad860","#f3a43b","#60c0dd","#d7504b","#c6e579","#f4e001","#f0805a","#26c0c0"],i={},j=a.keys(c.yColValues),k=a.keys(c.yColValues[j[0]]);a.each(j,function(a,b){var c=b;c>h.length-1&&(c%=h.length),i[a]=h[c]});var l=[],m=[],n=[],o=!1,r=[0],s=[0];a.each(j,function(b){var f=c.yColValues[b];a.each(k,function(a,c){var g=b+": "+a,h=e.indexOf(a)>=0;h&&(o=!0),l.push({name:g,type:h?"bar":"line",yAxisIndex:h?1:0,data:f[a]}),h?s.push(d.getMaxTextWidth(f[a].map(function(a){return Math.round(a)}))):r.push(d.getMaxTextWidth(f[a].map(function(a){return Math.round(a)}))),m.push(g),n.push(i[b])})});var t=Math.max.apply(null,r)+32,u=Math.max.apply(null,s)+32,v=d.getMaxTextWidth(m)+40,w=15,x=Math.ceil(m.length/w)*v;a.keys(f).some(function(a){return f[a]})||(f=m.reduce(function(a,b,c){return a[b]=c<=1,a},{}),q.selectedLegend=f);var y={grid:{top:10,left:t+10,right:x+u},tooltip:{trigger:"axis"},toolbox:{show:!0,right:16,feature:{saveAsImage:{}}},xAxis:[{type:"category",data:c.xColValues}],yAxis:[{splitNumber:5}],legend:{orient:"vertical",top:40,right:8,selected:q.selectedLegend,data:m},series:l,color:n};o&&y.yAxis.push({splitNumber:5}),p||(p=echarts.init(b.$(".chart-wrap")[0],g),p.on("legendselectchanged",function(a){q.selectedLegend=a.selected})),p.setOption(y)}function n(a){new b({title:"数据透视图",className:"dialog-pivot-table",destroyOnHide:!0,canFullscreen:!1,body:i(),afterShow:function(){k.call(this,a)},afterHide:function(){j.call(this,a)},buttons:[{text:o("close"),click:function(){this.hide()}}]})}var o=c.translate,p=null,q={};return{show:n}}),define("ajax/modelReport",["zero/zero","./base"],function(a,b){"use strict";var c="api/v1/excel",d="https://reportcapture.alipay.com/",e=b.create(c,d);return{getDownloadUrl:function(a){return e.post({data:JSON.stringify(a),user:window.userNumber||"000000"})},exportExcelTables:function(a){return b.create("api/v1/excel/table",d).post({data:JSON.stringify(a),user:window.userNumber||"000000"})}}}),define("midway/dialog/analytic/lrreportSummary",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b){var c='<div class="tab-wrap"><ul class="tabs">',b=a.uuid();return c+='<li data-target="#'+d(b)+'-summary">Summary</li><li data-target="#'+d(b)+'-gains">Gains</li><li data-target="#'+d(b)+'-means">Means</li><li data-target="#'+d(b)+'-bi-variate-mdl">Bi Variate MDL</li><li data-target="#'+d(b)+'-bi-variate-hd">Bi Variate HD</li><li data-target="#'+d(b)+'-bi-variate-oot">Bi Variate OOT</li><li data-target="#'+d(b)+'-chart-gains">Gains Chart</li><li data-target="#'+d(b)+'-chart-pva">PVA Chart</li><li data-target="#'+d(b)+'-chart-cohort">Cohort Chart</li><li data-target="#'+d(b)+'-bivar-chart-samples">Bivar Chart</li></ul></div><div class="content-wrap"><div id="'+d(b)+'-summary" class="tab-content hide"></div><div id="'+d(b)+'-gains" class="tab-content hide"></div><div id="'+d(b)+'-means" class="tab-content hide"></div><div id="'+d(b)+'-bi-variate-mdl" class="tab-content hide"></div><div id="'+d(b)+'-bi-variate-hd" class="tab-content hide"></div><div id="'+d(b)+'-bi-variate-oot" class="tab-content hide"></div><div id="'+d(b)+'-chart-gains" class="tab-content hide"></div><div id="'+d(b)+'-chart-pva" class="tab-content hide"></div><div id="'+d(b)+'-chart-cohort" class="tab-content hide"></div><div id="'+d(b)+'-bivar-chart-samples" class="tab-content hide"></div></div>'}(b.uuid)}}),define("dialog/analytic/lrreportSummary/SummaryTable",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable"],function(a,b,c,d){"use strict";return b("lrreportSummary/SummaryTable",{constructor:function(a){var b=a.data,c=b.colNames,e=b.records.map(function(a){return a.reduce(function(a,b,d){return a[c[d]]=b,a},{})});this.table=new d({grid:!0,defaultsort:!0,container:a.container,data:e,cols:c.map(function(a){return{field:a,title:a}})})},destroy:function(){this.table.destroy()}})}),define("dialog/analytic/lrreportSummary/GainsTable",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../../global/utils"],function(a,b,c,d,e){"use strict";return b("lrreportSummary/GainsTable",{constructor:function(a){var b=this.tables=[],c=this.containers=[];[{key:"gains_modeling",title:"Gains Table for Modeling"},{key:"mean_modeling",title:"Mean Table for Modeling"},{key:"gains_in_time_validation",title:"Gains Table for In-Time Validation"},{key:"mean_in_time_validation",title:"Mean Table for In-Time Validation"},{key:"gains_out_of_time_validation",title:"Gains Table for Out-Of-Time Validation"},{key:"mean_out_of_time_validation",title:"Means Table for Out-Of-Time Validation"}].forEach(function(f){var g=$('<div class="table-wrap"></div>').appendTo(a.container),h=a.data[f.key],i=h.colNames,j=h.records.map(function(a){return a.reduce(function(a,b,c){return a[i[c]]=b,a},{})}),k=i.map(function(a,b){return h.records.reduce(function(a,c){return a.push(c[b]),a},[a])}),l=k.map(function(a){return e.getMaxTextWidth(a)+28}),m=l.reduce(function(a,b){return a+b},0);g.width(m+20);var n=new d({grid:!0,defaultsort:!0,theme:"small",title:f.title,container:g,data:j,cols:i.map(function(a,b){return{field:a,title:a,width:l[b]}})});b.push(n),c.push(g)})},destroy:function(){this.tables.forEach(function(a){a.destroy()}),this.containers.forEach(function(a){a.remove()})}})}),define("dialog/analytic/lrreportSummary/MeansTable",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../../global/utils"],function(a,b,c,d,e){"use strict";return b("lrreportSummary/MeansTable",{constructor:function(a){var b=a.data,c=b.colNames,f=b.records.map(function(a){return a.reduce(function(a,b,d){return a[c[d]]=b,a},{})}),g=c.map(function(a,c){return b.records.reduce(function(a,b){return a.push(b[c]),a},[a])}),h=g.map(function(a){return e.getMaxTextWidth(a)+42}),i=h.reduce(function(a,b){return a+b},0),j=$('<div class="table-wrap"></div>').appendTo(a.container);j.width(i+8),this.table=new d({grid:!0,defaultsort:!0,container:j,data:f,cols:[{field:"Variable",title:" ",width:h[0]},{field:"Mean_MDL",title:"1.MDL",group:"Mean",width:h[1]},{field:"Mean_HD",title:"2.HD",group:"Mean",width:h[2]},{field:"Mean_OOT",title:"3.OOT",group:"Mean",width:h[3]},{field:"Std_MDL",title:"1.MDL",group:"Std",width:h[4]},{field:"Std_HD",title:"2.HD",group:"Std",width:h[5]},{field:"Std_OOT",title:"3.OOT",group:"Std",width:h[6]}]})},destroy:function(){this.table.destroy()}})}),define("dialog/analytic/lrreportSummary/BiTable",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../../global/utils"],function(a,b,c,d,e){"use strict";return b("lrreportSummary/BiTable",{constructor:function(b){var c=this.tables=[],e=this.containers=[];a.keys(b.data).sort().forEach(function(a){var f=$('<div class="table-wrap"></div>').appendTo(b.container),g=b.data[a],h=g.colNames,i=g.records.map(function(a){return a.reduce(function(a,b,c){return a[h[c]]=b,a},{})}),j=new d({grid:!0,defaultsort:!0,theme:"small",container:f,data:i,cols:h.map(function(a,b){return{field:a,title:a}})});c.push(j),e.push(f)})},destroy:function(){this.tables.forEach(function(a){a.destroy()}),this.containers.forEach(function(a){a.remove()})}})}),define("dialog/analytic/lrreportSummary/GainChart",["zero/zero","zero/declare","zero/ui/DialogEx","../../../charts/theme"],function(a,b,c,d){"use strict";return b("lrreportSummary/GainChart",{constructor:function(a){this.charts=[],this.container=a.container,this.renderLorenz(a.data.lorenz),this.renderRoc(a.data.roc)},getContainer:function(){var a=$('<div class="chart-wrap"></div>').appendTo(this.container);return a.css({width:760,height:420}),a[0]},getChartOption:function(a){return $.extend(!0,{title:{left:80},grid:{left:80,top:40,right:230,bottom:80},tooltip:{show:!0,trigger:"axis"},toolbox:{show:!0,right:230,feature:{saveAsImage:{show:!0}}},xAxis:{type:"value",min:0,max:100,axisLabel:{formatter:function(a){return a?a+"%":a}},nameLocation:"middle",nameGap:40},yAxis:{type:"value",min:0,max:100,axisLabel:{formatter:function(a){return a?a+"%":a}},nameRotate:90,nameLocation:"middle",nameGap:56},legend:{orient:"vertical",right:8,bottom:80,data:[]},series:[]},a)},renderRoc:function(a){var b=a.charts[0].groups[0],c=this.getContainer(),e=this.getChartOption({title:{text:"Roc Curve"},xAxis:{name:"% of Cum non-Bads"},yAxis:{name:"% of Cum Bads"}});b.forEach(function(a){var b=a.legend,c=a.points;e.legend.data.push(b),e.series.push({name:b,type:"line",data:c})}),e.series.push({type:"line",data:[],markLine:{data:[[{coord:["0","0"],symbol:"none"},{coord:["100","100"],symbol:"none"}]]}});var f=echarts.init(c,d);f.setOption(e),this.charts.push(f)},renderLorenz:function(a){var b=a.charts[0].groups[0],c=this.getContainer(),e=this.getChartOption({title:{text:"Lorenz Curve"},xAxis:{name:"% of Cum Accounts"},yAxis:{name:"% of Cum Bads"}});b.forEach(function(a){var b=a.legend,c=a.points;e.legend.data.push(b),e.series.push({name:b,type:"line",data:c})}),e.series.push({type:"line",data:[],markLine:{data:[[{coord:["0","0"],symbol:"none"},{coord:["100","100"],symbol:"none"}]]}});var f=echarts.init(c,d);f.setOption(e),this.charts.push(f)},destroy:function(){this.charts.forEach(function(a){a.dispose()}),this.container.empty()}})}),define("dialog/analytic/lrreportSummary/PvaChart",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../../charts/theme"],function(a,b,c,d,e){"use strict";return b("lrreportSummary/PvaChart",{constructor:function(a){this.charts=[],this.container=a.container;var b=this;[{key:"modeling",title:"Predicted Vs Actual in Modeling Sample"},{key:"in_time_validation",title:"Predicted Vs Actual in In-Time Validation Sample"},{key:"out_of_time_validation",title:"Predicted Vs Actual in Out-Of-Time Validation Sample"}].forEach(function(c){b.renderChart(a.data[c.key],c.title)})},getContainer:function(){var a=$('<div class="chart-wrap"></div>').appendTo(this.container);return a.css({width:760,height:420}),a[0]},renderChart:function(a,b){var c=a.charts[0].groups[0],d=this.getContainer(),f={title:{text:b,left:80},grid:{left:80,top:40,right:120,bottom:80},tooltip:{show:!0,trigger:"axis"},toolbox:{show:!0,right:120,feature:{saveAsImage:{show:!0}}},xAxis:{type:"category",data:c[0].points.map(function(a){return a[0]}),name:"10 Quantiles",nameLocation:"middle",nameGap:40},yAxis:{type:"value",min:0,axisLabel:{formatter:function(a){return a?100*a+"%":a}},name:"% of Bads",nameRotate:90,nameLocation:"middle",nameGap:56},legend:{orient:"vertical",right:8,bottom:80,data:[]},series:[]};c.forEach(function(a){var b=a.legend,c=a.points;f.legend.data.push(b),f.series.push({name:b,type:"line",data:c.map(function(a){return a[1]})})});var g=echarts.init(d,e);g.setOption(f),this.charts.push(g)},destroy:function(){this.charts.forEach(function(a){a.dispose()}),this.container.empty()}})}),define("dialog/analytic/lrreportSummary/CohortChart",["zero/zero","zero/declare","zero/ui/DialogEx","../../../charts/theme"],function(a,b,c,d){"use strict";return b("lrreportSummary/CohortChart",{constructor:function(b){this.charts=[],this.container=b.container;var c=this;a.keys(b.data).sort().forEach(function(a){c.renderChart(b.data[a],a)})},getContainer:function(){var a=$('<div class="chart-wrap"></div>').appendTo(this.container);return a.css({width:360,height:240}),a[0]},renderChart:function(a,b){var c=a.charts[0].groups[0],e=this.getContainer(),f={title:{text:b,left:40},grid:{left:40,top:40,right:8,bottom:32},tooltip:{show:!0,trigger:"axis"},toolbox:{show:!1},xAxis:{type:"category",data:c[0].points.map(function(a){return a[0]})},yAxis:{type:"value"},legend:{show:!1},series:[]};c.forEach(function(a){var b=a.legend,c=a.points;f.series.push({name:b,type:"line",data:c.map(function(a){return a[1]})})});var g=echarts.init(e,d);g.setOption(f),this.charts.push(g)},destroy:function(){this.charts.forEach(function(a){a.dispose()}),this.container.empty()}})}),define("dialog/analytic/lrreportSummary/BivarChart",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/DataTable","../../../charts/theme"],function(a,b,c,d,e){"use strict";return b("lrreportSummary/BivarChart",{constructor:function(b){this.charts=[],this.container=b.container;var c=this;a.keys(b.data).sort().forEach(function(a){c.renderChart(b.data[a],a)})},getContainer:function(){var a=$('<div class="chart-wrap"></div>').appendTo(this.container);return a.css({width:360,height:240}),a[0]},renderChart:function(a,b){var c=a.charts[0].groups[0],d=a.charts[0].groups[1],f=this.getContainer(),g={title:{text:b,left:80,textStyle:{fontSize:14}},grid:{left:80,top:32,right:80,bottom:64},tooltip:{show:!0,trigger:"axis"},toolbox:{show:!1},xAxis:{type:"category",data:c[0].points.map(function(a){return a[0]})},yAxis:[{type:"value",name:"Freq",nameRotate:90,nameLocation:"middle",nameGap:56},{type:"value",name:"tx_flag",nameRotate:90,nameLocation:"middle",nameGap:56}],legend:{bottom:16,data:[]},series:[]};c.forEach(function(a){var b=a.legend,c=a.points;g.legend.data.push(b),g.series.push({name:b,type:"bar",yAxisIndex:0,data:c.map(function(a){return a[1]})})}),d.forEach(function(a){var b=a.legend,c=a.points;g.legend.data.push(b),g.series.push({name:b,type:"line",yAxisIndex:1,data:c.map(function(a){return a[1]})})});var h=echarts.init(f,e);h.setOption(g),this.charts.push(h)},destroy:function(){this.charts.forEach(function(a){a.dispose()}),this.container.empty()}})}),define("dialog/analytic/lrreportSummary",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","zero/ui/DataTable","../../global/utils","../../i18n","../../ajax/model","../../ajax/modelReport","../../midway/dialog/analytic/lrreportSummary","./lrreportSummary/SummaryTable","./lrreportSummary/GainsTable","./lrreportSummary/MeansTable","./lrreportSummary/BiTable","./lrreportSummary/GainChart","./lrreportSummary/PvaChart","./lrreportSummary/CohortChart","./lrreportSummary/BivarChart"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(a){function b(a,b){var c=u[b],d=new c({data:e(b),container:a.$(".content-wrap .tab-content:eq("+b+")")});v.push(d)}function e(a){return w[a].reduce(function(a,b){return a=a[b]},y)}function f(a){a.set("body",j()),x=new d({selector:a.$(".tab-wrap .tabs li"),afterShow:function(c){v[c]||b(a,c)}}),a.on("fullScreen",function(){})}function s(){v.forEach(function(a){a.destroy()})}var t=g.translate,u=[k,l,m,n,n,n,o,p,q,r],v=[],w=[["summaryTab","summary"],["gainsTab"],["meansTab","var_mean_std"],["biVariateTablesMLD"],["biVariateTablesIT"],["biVariateTablesOOT"],["gainCharts"],["pvaChart"],["cohortChart"],["bivatChartSample"]],x=null,y=null;new c({title:"汇总报告",className:"dialog-lrreport-summary",destroyOnHide:!0,canFullscreen:!0,afterShow:function(){var b=this;b.showLoading(),h.getLRReportSummary(a.nodeInstanceId,a.loopTimestamp).then(function(a){y=a.lrReportVO,b.hideLoading(),f(b)},function(){b.hideLoading(),b.showEmpty()})},afterHide:s,buttons:[{text:t("downloadReport"),click:function(){this.download()}},{text:t("close"),click:function(){this.hide()}}]}).download=function(){null!==y&&i.getDownloadUrl(y).then(function(a){"string"==typeof a&&window.location.assign(a)})}}return{show:s}}),define("midway/dialog/analytic/ssdCurve",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<div class="chart-wrap"></div><div class="metrics-wrap"></div>'}}),define("dialog/analytic/ssdCurve",["zero/zero","zero/ui/DialogEx","zero/ui/DataTable","../../i18n","../../global/utils","../../ajax/model","../../charts/theme","../../midway/charts/tooltip","../../midway/dialog/analytic/ssdCurve"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b=this;b.showLoading(),f.getSSDCurve(a.nodeInstanceId,a.loopTimestamp).then(function(a){b.hideLoading(),k(b,a.data.xyColValues.value),l(b,a.data.metrics)},function(){b.hideLoading(),b.showEmpty()})}function k(b,c){var d=a.keys(c),f=e.getMaxTextWidth(d)+40,h=Math.ceil(d.length/15)*f,i={grid:{top:10,left:"10%",right:h+40},tooltip:{trigger:"axis",axisPointer:{type:"line",axis:"x"}},toolbox:{show:!0,right:16,feature:{saveAsImage:{}}},legend:{orient:"vertical",top:40,right:8,data:d},xAxis:[{}],yAxis:[{}],series:d.map(function(a){return{name:a,type:"line",symbol:"none",smooth:!0,data:c[a]}})};echarts.init(b.$(".chart-wrap")[0],g).setOption(i)}function l(b,d){var e=a.keys(d);e.length&&new c({grid:!0,theme:"small",container:b.$(".metrics-wrap")[0],data:e.map(function(a){return{name:a,value:d[a]}}),cols:[{field:"name",title:"name"},{field:"value",title:"value"}]})}function m(a){new b({title:"SSD Curve",className:"dialog-ssd-curve",destroyOnHide:!0,canFullscreen:!1,body:i(),afterShow:function(){j.call(this,a)},buttons:[{text:n("close"),click:function(){this.hide()}}]})}var n=d.translate;return{show:m}}),define("midway/dialog/evaluation/linearModel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return'<ul class="nav nav-tabs pai-tab j-linear-model-tab"></ul><div class="j-linear-model-tab-content"></div>'}}),define("midway/dialog/evaluation/GroupLinearModel",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a};a.escape;return"<ul class=\"nav nav-tabs pai-tab j-linear-model-group-tab\"></ul><div class = 'j-linear-model-group-tab-content-meta'></div><div class = 'j-linear-model-group-tab-content'></div>"}}),define("components/treeDataTable/Estimates",["zero/zero","zero/declare","./TreeDataTable","../../global/utils"],function(a,b,c,d){"use strict";var e={theme:"small",tree:!1,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 60px)",cols:[{field:"f",title:"Variable",sort:!0},{field:"df",title:"DF",sort:!0,width:60},{field:"es",title:"Estimate",sort:!0,width:100,parse:function(a){return a?d.toFixedNumber(a,4):a}
},{field:"stderr",title:"StdErr",sort:!0,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"stdest",sort:!0,title:"StdEst",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"t",sort:!0,title:"T Value",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"p",sort:!0,title:"Pr > |t|",width:100},{field:"cll",sort:!0,title:"Lower",group:"95% Confidence Limits",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"clu",sort:!0,title:"Upper",group:"95% Confidence Limits",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"con",sort:!0,title:"Consistent",width:100},{field:"corr",sort:!0,title:"Correlation",width:100,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"tol",sort:!0,title:"Tolerance",group:"Collinear",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"vif",sort:!0,title:"VIF",group:"Collinear",parse:function(a){return a?d.toFixedNumber(a,4):a}}]};return b("component/LinearModelEstimates",[c],{tableOptions:_.clone(e),constructor:function(a){var b=a.data.records,d=a.data.tableHeader;this.parseHeader(d,b),c.prototype.constructor.call(this,a)},parseHeader:function(a,b){var c,d,f=!1,g=!1;for(var h in a)"vif"==a[h]?c=h:"stdest"==a[h]&&(d=h);for(var h in b)""!=b[h][c]&&(f=!0),0!=parseFloat(b[h][d])&&(g=!0);var i=e.cols;this.tableOptions.cols=[];for(var h in i){var j=i[h].field;(g||"stdest"!=j)&&((f||"vif"!=j&&"tol"!=j)&&this.tableOptions.cols.push(i[h]))}},getTableOptions:function(){return this.tableOptions}})}),define("components/treeDataTable/Mle",["zero/zero","zero/declare","./TreeDataTable","../../global/utils"],function(a,b,c,d){"use strict";var e={theme:"small",tree:!1,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 60px)",cols:[{field:"f",title:"Variable",sort:!0},{field:"df",title:"DF",sort:!0,width:60},{field:"es",title:"Estimate",sort:!0,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"stderr",title:"StdErr",sort:!0,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"stdest",sort:!0,title:"StdEst",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"chisqr",sort:!0,title:"Wald ChiSqr",width:120,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"p",sort:!0,title:"Pr>ChiSqr"},{field:"cll",sort:!0,title:"Lower",group:"95% Confidence Limits",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"clu",sort:!0,title:"Upper",group:"95% Confidence Limits",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"con",sort:!0,title:"Consistent",width:100},{field:"corr",sort:!0,title:"Correlation",width:100,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"tol",sort:!0,title:"Tolerance",group:"Collinear",parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"vif",sort:!0,title:"VIF",group:"Collinear",parse:function(a){return a?d.toFixedNumber(a,4):a}}]};return b("component/LinearModelMle",[c],{tableOptions:_.clone(e),constructor:function(a){var b=a.data.records,d=a.data.tableHeader;this.parseHeader(d,b),c.prototype.constructor.call(this,a)},parseHeader:function(a,b){var c,d,f=!1,g=!1;for(var h in a)"vif"==a[h]?c=h:"stdest"==a[h]&&(d=h);for(var h in b)""!=b[h][c]&&(f=!0),0!=parseFloat(b[h][d])&&(g=!0);var i=e.cols;this.tableOptions.cols=[];for(var h in i){var j=i[h].field;(g||"stdest"!=j)&&((f||"vif"!=j&&"tol"!=j)&&this.tableOptions.cols.push(i[h]))}},getTableOptions:function(){return this.tableOptions}})}),define("components/treeDataTable/StepwiseLR",["zero/zero","zero/declare","./TreeDataTable","../../global/utils"],function(a,b,c,d){"use strict";var e={theme:"small",tree:!1,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!1,height:"calc(100% - 60px)",cols:[{field:"Step",title:"Step",sort:!1,width:60},{field:"Entered",title:"Entered",group:"Variable",sort:!1},{field:"Removed",title:"Removed",group:"Variable",sort:!1},{field:"DF",title:"DF",sort:!1,width:60},{field:"Number In",sort:!1,title:"Number In",width:80},{field:"Score Chi-Square",sort:!1,title:"Score Chi-Square"},{field:"Wald Chi-Square",sort:!1,title:"Wald Chi-Square"},{field:"Pr > ChiSq",sort:!1,title:"Pr > ChiSq"}]};return b("component/LinearModelStepwiseLR",[c],{constructor:function(a){c.prototype.constructor.call(this,a)},getTableOptions:function(){return e}})}),define("components/treeDataTable/StepwiseLS",["zero/zero","zero/declare","./TreeDataTable","../../global/utils"],function(a,b,c,d){"use strict";var e={theme:"small",tree:!1,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!1,height:"calc(100% - 60px)",cols:[{field:"step",title:"Step",sort:!1,width:60},{field:"e",title:"Entered",group:"Variable",sort:!1},{field:"r",title:"Removed",group:"Variable",sort:!1},{field:"in",sort:!1,title:"Number In",width:80},{field:"prs",sort:!1,title:"Partial R-Square"},{field:"rs",sort:!1,title:"Model R-Square"},{field:"cp",sort:!1,title:"Mallows's Cp"},{field:"f",sort:!1,title:"F Value"},{field:"p",sort:!1,title:"Pr > F"}]};return b("component/LinearModelStepwiseLS",[c],{constructor:function(a){c.prototype.constructor.call(this,a)},getTableOptions:function(){return e}})}),define("midway/components/matrix/matrix",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b,c,e,f,g){var h='<div class="ui-matrix"><table><thead><tr>';a[0]&&a[0].forEach(function(a){h+="<th>"+d(a)+"</th>"}),h+="</tr></thead><tbody>";for(var b=1,c=a.length;b<c;b++){var e=a[b];h+="<tr><th>"+d(e[0])+"</th>";for(var f=1,g=e.length;f<g;f++)h+="<td>"+d(e[f])+"</td>";h+="</tr>"}return h+="</tbody></table></div>"}(b.data,b.i,b.il,b.row,b.j,b.jl)}}),define("components/matrix/Matrix",["zero/zero","zero/declare","../../midway/components/matrix/matrix"],function(a,b,c){"use strict";return b("component/Matrix",[],{constructor:function(a){this.$container=$(a.container),this.data=a.data,this.data&&(this.$element=$(c({data:this.data})),this.$element.appendTo(this.$container))},destroy:function(){this.$element.remove()}})}),define("components/treeDataTable/GroupDataTable",["zero/zero","zero/declare","zero/ui/DataTable"],function(a,b,c){return b("component/GroupDataTable",{constructor:function(a){this.$container=a.$container,this.data=a.data||[],this.columns=a.columns||{},this.groupName=a.groupName||"",this.table=null,this.tableWidth=0,this.parseData()},parseData:function(){for(var a=this.columns.cols,b=this.columns.groupCols,c=[],d=0,e=0;e<a.length;e++)d=Math.max(7*a[e].length+17,150),this.tableWidth+=d,c.push({title:a[e],field:a[e],width:d});for(var f=0;f<b.length;f++)d=Math.max(7*b[f].length+17,150),this.tableWidth+=d,c.push({title:b[f],field:b[f],group:this.groupName,width:d});this.render({container:this.$container,data:this.data,theme:"small",line:!0,grid:!0,cols:c})},render:function(a){this.table=new c(a);try{$(".j-linear-model-tab-content").css("overflow","auto").find(".ui-datatable").css("width",this.tableWidth+410),$(".linear-model-table").css("overflow","auto").find(".ui-datatable").css("width",1160)}catch(a){}}})}),define("midway/dialog/evaluation/predictTooltip",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c){var e='<table class="predict-tooltip"><thead><tr><th colspan="3">'+d(b)+"</th></tr></thead><tbody>";return a.each(c,function(a){e+="<tr><td>",a.color&&(e+='<i class="color" style="border-color: '+d(a.color)+';"></i> '),e+="</td><td>"+d(a.name)+"：</td><td>"+d(a.value)+"</td></tr>"}),e+="</tbody></table>"}(b.title,b.items)}}),define("dialog/evaluation/predictionCurve",["zero/zero","../../charts/theme.js","../../midway/dialog/evaluation/predictTooltip"],function(a,b,c){"use strict";return function(d){var e=$('<div style="height:350px"></div>').appendTo(d.$container),f=[],g=d.data.trainData.slice(1),h=d.data.predictData.slice(1),i={},j={};h.reduce(function(a,b){return Math.min(a,b[2])},Number.MAX_SAFE_INTEGER);a.forEach(g,function(a){var b=a[0];-1===f.indexOf(b)&&f.push(b),i[b]=a[1]}),a.forEach(h,function(a){var b=a[0];-1===f.indexOf(b)&&f.push(b),j[b]=a}),f.sort(function(a,b){return a-b}),echarts.init(e[0],b).setOption({title:{show:!1},tooltip:{trigger:"axis",formatter:function(a){var b={title:a[0].name,items:[]};return"-"!==a[0].value&&b.items.push({name:a[0].seriesName,value:a[0].value,color:a[0].color}),"-"!==a[1].value&&b.items.push({name:a[1].seriesName,value:a[1].value,color:a[1].color}),"-"!==a[2].value&&b.items.push({name:a[2].seriesName,value:a[2].value,color:null}),"-"!==a[2].value&&"-"!==a[3].value&&b.items.push({name:a[3].seriesName,value:"-"===a[3].value?"-":a[3].value+a[2].value,color:null}),c(b)}},grid:{top:10,left:60,right:60,bottom:70},dataZoom:[{id:"dataZoomX",type:"slider",xAxisIndex:[0],filterMode:"filter"}],xAxis:{type:"category",axisTick:{show:!0,lineStyle:{color:"#d6d6d6"}},data:f},yAxis:{type:"value",axisTick:{show:!0,length:5,lineStyle:{color:"#d6d6d6"}}},series:[{name:"Train",type:"line",data:f.map(function(a){return a in i?i[a]:"-"}),symbol:"none"},{name:"Prediction",type:"line",data:f.map(function(a){var b=j[a];return b?b[1]:"-"}),symbol:"none"},{name:"Lower",type:"line",data:f.map(function(a){var b=j[a];return b?b[2]:"-"}),lineStyle:{normal:{opacity:0}},stack:"lower-upper",symbol:"none"},{name:"Upper",type:"line",data:f.map(function(a){var b=j[a];return b?b[3]-b[2]:"-"}),lineStyle:{normal:{opacity:0}},areaStyle:{normal:{color:"#ccc"}},stack:"lower-upper",symbol:"none"}]})}}),define("dialog/evaluation/renderConfig",["../../i18n","../../components/treeDataTable/LinearModel","../../components/treeDataTable/Estimates","../../components/treeDataTable/Mle","../../components/treeDataTable/StepwiseLR","../../components/treeDataTable/StepwiseLS","../../components/matrix/Matrix","../../components/treeDataTable/GroupDataTable","./predictionCurve"],function(a,b,c,d,e,f,g,h,i){function j(a){return{tableHeader:a[0],records:a.slice(1,a.length)}}var k=a.translate;return[{key:"maximum_likelihood_estimate_analysis",type:function(a){return a.data=j(a.data),new d(a)},title:k("parameterEstimates")},{key:"parameter_estimates",type:function(a){return a.data=j(a.data),new c(a)},title:k("parameterEstimates")},{key:"model_fit_statistics",type:function(a){return new g(a)},title:k("modelFit")},{key:"pearson_correlation",type:function(a){return new g(a)},title:k("pearsonCorrelation")},{key:"stepwise_summary",type:function(a){return a.data=j(a.data),new e(a)},title:k("stepwiseSummary")},{key:"ls_stepwise_summary",type:function(a){return a.data=j(a.data),new f(a)},title:k("stepwiseSummary")},{key:"arima_estimate",type:function(a){return new g(a)},title:"Arima Estimate"},{key:"evaluation",type:function(a){return new g(a)},title:"Evaluation"},{key:"regression_estimate",type:function(a){return new g(a)},title:"Regression Estimate"},{key:"anvoa",type:function(a){return new g(a)},title:k("analysisVariance")},{key:"collinear_diagnosis",type:function(a){var b=a.data.slice(1);return cols=a.data[0].slice(0,3),groupCols=a.data[0].slice(3),new g(a),new h({$container:a.$container,groupName:"Variance Proportion",columns:{cols:cols,groupCols:groupCols},data:b})},title:k("collinearDiagnosis")},{key:"level_smooth_estimate",type:function(a){return new g(a)},title:"Level Smooth Estimate"},{key:"trend_smooth_estimate",type:function(a){return new g(a)},title:"Trend Smooth Estimate"},{key:"seasonal_smooth_estimate",type:function(a){return new g(a)},title:"Seasonal Smooth Estimate"},{key:"log",type:function(a){a.container.html("<pre>"+a.data+"</pre>")},title:"Logs"},{key:"linear_model",type:function(a){return new b(a)},title:k("linearModel")},{key:"prediction_curve",type:function(a){return i(a)},title:"Prediction Curve"}]}),define("dialog/evaluation/RenderLinearModelReport",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../ajax/analysis","../../ajax/model","../../global/nodeMenuChecker","../../midway/dialog/evaluation/linearModel","../evaluation/renderConfig"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={dialogBody:".modal-content .modal-body",tab:".nav-tabs li"};return b("dialog/RenderLinearModelReport",[],{constructor:function(a){this.$container=$(a.container),this.$element=$(i()),this.$element.appendTo(this.$container),this.matchData(a.data)},destroy:function(){this.$element.remove()},matchData:function(a){this.needRenderTabs=[];var b,c,d=[];for(b in a)d.push(b);d=d.sort();for(var e=0;e<d.length;e++)if("log"===(b=d[e])&&0!==a[b].length||"prediction_curve"===b&&a[b].predictData&&a[b].predictData.result&&a[b].predictData.result.length||a.hasOwnProperty(b)&&a[b].result&&a[b].result.length)for(c=0;c<j.length;c++){var f=j[c];f.key===b&&("log"===b?f.data=a[b]:"prediction_curve"===f.key?f.data={predictData:a[b].predictData.result,trainData:a[b].trainData.result}:f.data=a[b].result,this.needRenderTabs.push(f))}this.judgeRender()},judgeRender:function(){this.render(this.needRenderTabs)},getTabTitleHtml:function(a,b,c){$(".j-linear-model-tab").append('<li data-target="#'+a+'" class="'+(c?"active":"")+'"><a href="javascript:void(0);">'+b+"</a></li>")},getTabContentWrapperHtml:function(a){return $(".j-linear-model-tab-content").append('<div id="'+a+'"></div>'),$("#"+a)},parseData:function(a){return{tableHeader:a[0],records:a.slice(1,a.length)}},render:function(b){for(var c=this,e=0,f=b.length;e<f;){var g=b[e],h=a.uuid(),i=c.getTabContentWrapperHtml(h);c.getTabTitleHtml(h,g.title,0===e),g.type({container:i,$container:i,data:g.data}),e++}c.tab=new d({selector:c.$container.find(k.tab),activeClassName:"active"})}})}),define("dialog/evaluation/linearModelReport",["zero/zero","zero/declare","zero/ui/DialogEx","zero/ui/Tab","../../i18n","../../ajax/analysis","../../ajax/model","../../ajax/modelReport","../../global/nodeMenuChecker","../../midway/dialog/evaluation/linearModel","../../midway/dialog/evaluation/GroupLinearModel","../evaluation/renderConfig","../evaluation/RenderLinearModelReport"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=["variable","DF","Estimate","StdErr","StsEst","Wald ChiSqr","Pr>ChiSqr","Lower","Upper","Consistent","Correlation","VIF","Tolerance"],o=e.translate,p={dialogBody:".modal-content .modal-body",tab:".nav-tabs li",footer:".modal-footer button:first-child",GroupTab:".j-linear-model-group-tab li",groupContent:".j-linear-model-group-tab-content"},q=o("viewModelReport"),r=b("dialog/LinearModelReport",[],{dialog:null,$dialogContainer:null,constructor:function(a){this.options=a,this.initDialog(),this.checkLinearModalTab=!1,this.checkOtherTabs=!1,this.needRenderTabs=[]},initDialog:function(){var a=this;a.dialog=new c({destroyOnHide:!0,canFullscreen:!0,className:"linear-model-dialog",title:q,beforeHide:null,afterShow:a.afterShow.bind(a),buttons:[{text:o("downloadReport"),click:function(){a.exportReport()}},{text:o("close"),click:function(){a.dialog.hide()}}]}),a.$dialogContainer=a.dialog.$element},show:function(){this.dialog.show()},beforeHide:function(){},onBeforeHide:function(){var a=this;a.component&&a.component.destroy()},afterShow:function(){function b(){c.dialog.hideLoading(),c.dialog.showEmpty()}var c=this,e=c.options,h=c.$dialogContainer.find(p.dialogBody);c.$dialogContainer.find(p.footer).addClass("hide"),c.dialog.showLoading(),f.exploreTableName(e.nodeInstanceId,e.portSequence||1,e.loopTimestamp).then(function(a){var b=a.tableName;c.$dialogContainer.find(".modal-title").text(b?q+"-"+b:q)});var n=c.options.codeName,o=i.isSameCodeName(n,"holt_winters"),r=i.isSameCodeName(n,"x13_arima"),s=i.isSameCodeName(n,"x13_auto_arima"),t=i.isSameCodeName(n,"ftgarch");n&&(o||r||s||t)?g.getLinearModelStatic(c.options.nodeInstanceId,c.options.loopTimestamp).then(function(b){if(c.dialog.hideLoading(),Array.isArray(b)){h.append(k({dataGroupTitle:b}));for(var e in b){var f=a.uuid();c.getGroupTabTitleHtml(f,"group"+e,0==e);var g=b[e].meta;g=g.substring(0,g.length-1),c.getTabGroupMetaContentWrapperHtml(f,g)}c.tab=new d({selector:c.$dialogContainer.find(p.GroupTab),activeClassName:"active",afterShow:function(a){c.component&&c.component.destroy(),c.component=new m({container:c.$dialogContainer.find(p.groupContent),data:b[a].tabs})}})}else c.renderLinearModelReport(b)},b):Promise.all([f.explore(c.options.nodeInstanceId,c.options.portSequence,1e4,c.options.loopTimestamp),g.getLinearModelStatic(c.options.nodeInstanceId,c.options.loopTimestamp)]).then(function(a){c.dialog.hideLoading(),c.dialog.$element.find(p.footer).removeClass("hide"),h.append(j());var b=a[0];if(b&&b.tableHeader&&b.tableHeader.length){var d=l[15];d.data=b,d.data.originData=b.records.slice(),c.needRenderTabs.unshift(d)}c.matchData1(a[1])},b)},matchData1:function(a){var b,c;for(b in a)if(a.hasOwnProperty(b)&&a[b].result&&a[b].result.length>1)for(c=0;c<l.length;c++){var d=l[c];d.key===b&&(d.data="log"===b?a[b]:a[b].result,this.needRenderTabs.push(d))}this.judgeRender()},judgeRender:function(){this.render1(this.needRenderTabs)},getTabTitleHtml:function(a,b,c){$(".j-linear-model-tab").append('<li data-target="#'+a+'" class="'+(c?"active":"")+'"><a href="javascript:void(0);">'+b+"</a></li>")},getTabContentWrapperHtml:function(a){return $(".j-linear-model-tab-content").append('<div id="'+a+'"></div>'),$("#"+a)},parseData:function(a){return{tableHeader:a[0],records:a.slice(1,a.length)}},render1:function(b){var c=this,e=0,f=b.length;for(c.dialog.hideLoading();e<f;){var g=b[e],h=a.uuid(),i=c.getTabContentWrapperHtml(h);c.getTabTitleHtml(h,g.title,0===e),g.type({container:i,$container:i,data:g.data}),e++}new d({selector:c.$dialogContainer.find(".nav-tabs li"),activeClassName:"active"})},renderLinearModelReport:function(a){var b=this,c=b.dialog;c.hideLoading(),b.component=new m({container:c.$element.find(p.dialogBody),data:a})},getGroupTabTitleHtml:function(a,b,c){$(".j-linear-model-group-tab").append('<li data-target="#'+a+'" class="'+(c?"active":"")+'"><a href="javascript:void(0);">'+b+"</a></li>")},getTabGroupMetaContentWrapperHtml:function(a,b){return $(".j-linear-model-group-tab-content-meta").append('<div class="linearModelGroupMeta" id="'+a+'">'+b+"</div>"),$("#"+a)},exportReport:function(){var a=this,b=a.needRenderTabs,c=a.parseExcelData(b);h.exportExcelTables({worksheets:c}).then(function(a){"string"==typeof a&&window.location.assign(a)})},parseExcelData:function(a){return a.map(function(a){var b=[],c=[],d=a.data;return d.colNames?(b=d.colNames,c=d.originData||d.records.slice()):d.tableHeader?(b=d.tableHeader,c=d.originData||d.records.slice()):Array.isArray(d)&&Array.isArray(d[0])&&(b=d.slice(0,1).pop(),c=d.slice(1)),"maximum_likelihood_estimate_analysis"===a.key&&(b=n),{sheetName:a.key,sheetData:[{title:a.title,type:"table",colNames:b,records:c}]}})}});return{show:function(a,b,c){new r({nodeInstanceId:a,portSequence:b,codeName:c}).show()}}}),define("components/treeDataTable/Psi",["zero/zero","zero/declare","./TreeDataTable","../../global/utils"],function(a,b,c,d){"use strict";var e={theme:"small",tree:!0,line:!0,grid:!0,resizable:!0,crossHover:!0,defaultsort:!0,height:"calc(100% - 30px)",cols:[{field:"feaname",title:"Feature",sort:!0,width:120},{field:"bin_desc",title:"Bin",sort:!0,width:120},{field:"test_percentage",title:"Test %",sort:!0,width:120,parse:function(a){return a?d.toFixedNumber(a,2):a}},{field:"base_percentage",title:"Base %",sort:!0,width:120,parse:function(a){return a?d.toFixedNumber(a,2):a}},{field:"test_sub_base",sort:!0,title:"Test - Base",width:120,parse:function(a){return a?d.toFixedNumber(a,2):a}},{field:"ln_test_div_base",sort:!0,title:"ln(Test/Base)",width:120,parse:function(a){return a?d.toFixedNumber(a,4):a}},{field:"psi",sort:!0,title:"PSI",parse:function(a){return a?d.toFixedNumber(a,4):a}}]};return b("component/LinearModel",[c],{$container:null,dataTable:null,constructor:function(a){c.prototype.constructor.call(this,a)},getTableOptions:function(){return e}})}),define("dialog/evaluation/psi",["zero/zero","zero/declare","zero/ui/DialogEx","../../global/utils","../../i18n","../../ajax/analysis","../../components/treeDataTable/Psi"],function(a,b,c,d,e,f,g){"use strict";var h={title:".modal-title",dialogBody:".modal-content .modal-body"},i={dialog:"linear-model-dialog"},j=e.translate,k=null,l=b("dialog/Psi",[],{dialog:null,$container:null,dataTable:null,constructor:function(a){var b=this;b.options=a,b.initDialog()},initDialog:function(){var a=this;a.dialog=new c({destroyOnHide:!0,canFullscreen:!0,className:i.dialog,title:j("viewModelReport"),beforeHide:a.beforeHide.bind(a),afterShow:a.afterShow.bind(a),buttons:[{text:j("close"),click:function(){a.dialog.hide()}}]}),a.$container=a.dialog.$element},show:function(){this.dialog.show()},beforeHide:function(){var a=this;a.dataTable&&a.dataTable.destroy()},afterShow:function(){var a=this;a.dialog.showLoading(),f.exploreTableName(a.options.nodeInstanceId,a.options.portSequence||1,k.loopTimestamp).then(function(b){a.setTitle(b.tableName)}),f.explore(a.options.nodeInstanceId,a.options.portSequence,1e4,k.loopTimestamp).then(a.renderSucceed.bind(a),a.renderFailed.bind(a))},renderSucceed:function(a){var b=this,c=b.dialog;c.hideLoading(),a&&a.tableHeader&&a.tableHeader.length?b.dataTable=new g({$container:c.$element.find(h.dialogBody),data:a}):c.showEmpty()},renderFailed:function(){this.dialog.hideLoading(),this.dialog.showEmpty()},setTitle:function(a){var b=this,c=a?j("viewModelReport")+" - "+a:j("viewModelReport");b.$container.find(h.title).text(c)}});return{show:function(a,b){var c,d;"object"==typeof a?(k=a,c=a.nodeInstanceId,a.loopTimestamp):c=a,d=new l({nodeInstanceId:c,portSequence:b}),k=a,d.show()}}}),define("midway/dialog/evaluation/convLSTM",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){var c='<div class="table-wrap">';if(a){c+='<table class="table table-bordered"><tbody>';for(var b in a)c+="<tr><td>"+d(b)+"</td><td>"+d(a[b])+"</td></tr>";c+="</tbody></table>"}return c+="</div>"}(b.jsonData,b.key)}}),define("dialog/evaluation/convLSTM",["zero/zero","zero/ui/DialogEx","../../ajax/model","../../i18n","../../midway/dialog/evaluation/convLSTM"],function(a,b,c,d,e){"use strict";function f(a){i.showLoading(),c.queryJsonData(a.experimentId,a.nodeInstanceId,a.loopTimestamp).then(function(a){i.hideLoading(),i.set("body",e(a))})}function g(a){i=new b({title:h("convLSTMEvaluation"),className:"dialog-convLSTM-evaluation",canFullscreen:!1,destroyOnHide:!0,afterShow:f.bind(null,a),buttons:[{text:h("close"),click:function(){i.hide()}}]})}var h=d.translate,i=null;return{show:g}}),define("workspace/canvas/nodeContextMenu",["zero/zero","zero/declare","zero/ui/ContextMenu","zero/ui/DialogSingleInput","zero/ui/Confirm","../../i18n","../../storage/globalCache","../../global/event","../../global/notify","../../global/environment","../../global/nodeMenuChecker","../../global/utils","../../ajax/experiment","../../ajax/odpsControl","../../ajax/benchmark","../../ajax/model","../../dialog/experiment/renameNode","../../dialog/experiment/scatterDiagram","../../dialog/output/dataExploration","../../dialog/binning","../../dialog/cumulateGroup","../../dialog/cartTreeDialog","../../dialog/evaluation/roc","../../dialog/evaluation/cluster","../../dialog/evaluate","../../dialog/confusionMatrix","../../dialog/confusionMatrixPlus","../../dialog/simpleSummary","../../dialog/analytic/percentile","../../dialog/analytic/advanceHistograms","../../dialog/analytic/pearson","../../dialog/analytic/modularity","../../dialog/analytic/tTest","../../dialog/analytic/chisqTest","../../dialog/analytic/evaluation","../../dialog/analytic/featureImportance","../../dialog/analytic/EnumFeatureSelection","../../dialog/analytic/featureEngineering","../../dialog/analytic/batchHistograms","../../dialog/analytic/dataCompareTab","../../dialog/analytic/boxPlot","../../dialog/analytic/empiricalPDF","../../dialog/analytic/dnnConvergenceCurve","../../dialog/analytic/lstmConvergenceCurve","../../dialog/analytic/c5","../../dialog/analytic/scorecardGrouping","../../dialog/analytic/glm","../../dialog/analytic/glmInsurance","../../dialog/analytic/glmInsurancePredict","../../dialog/analytic/normalityTest","../../dialog/analytic/quantile","../../dialog/analytic/lorenzCurve","../../dialog/analytic/correlationMatrix","../../dialog/analytic/corresp","../../dialog/analytic/decompose","../../dialog/analytic/gainCurve","../../dialog/analytic/pivotTable","../../dialog/analytic/lrreportSummary","../../dialog/analytic/ssdCurve","../../dialog/evaluation/linearModelReport","../../dialog/evaluation/psi","../../dialog/evaluation/convLSTM","../../dialog/model/showDescription","../../dialog/experiment/cyclicParams","../statusTicker","./contextMenu"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){"use strict";function ma(){return window.GLOBALS.isOnline}var na=f.translate,oa=l.log;return b("workspace/Canvas/NodeContentMenu",[la],{constructor:function(a){la.prototype.constructor.call(this,a)},init:function(){var a=this;return this.menu=new c({key:"node",items:[{key:"rename",icon:"rename",label:na("rename")},{key:"copyNodes",icon:"copy-node",label:na("copy"),accessKey:"Ctrl + C"},{key:"delete",icon:"delete",label:na("delete"),accessKey:"Delete"},{type:"separator",hidden:function(){return ma()}},{key:"group",icon:"group-24",label:na("group"),disabled:function(){var b=a.getTargetNodes();return!a.canvas.canGroup(b)},hidden:function(){return ma()||!k.showGroup(a.getCodeName())&&j.isAliyun}},{key:"groupLoop",icon:"lib",label:na("groupLoop"),hidden:function(){return ma()||j.isAliyun||!k.showGroupLoop(a.getCodeName())}},{key:"benchmark",icon:"optimization",label:na("benchmark"),hidden:function(){if(ma())return!0;if(j.isAntLab||j.isAntCloud||j.isAliyun)return!0;var b=a.getExperimentId(),c=a.getNodeInstanceId(),d=a.getNodeById(a.canvas,c),e=a.canvas.benchmarkCodeNames.some(function(b){return b===a.getCodeName()});return e&&a.checkBenchmarkAsync(d,b,c),!e},items:[{key:"enterBenchmark",icon:"run-node",className:"link",label:function(){var b=a.getExperimentId(),c=a.getNodeInstanceId(),d=a.canvas.metadata.projectName;return'<a href="/benchmark.htm#/config?expId='+b+"&nodeInstId="+c+"&benchmarkId="+((a.canvas.benchmarkNodes[c]||{}).benchmarkId||"")+"&projectName="+d+'" target="_blank">'+na("enterBenchmark")+"</a>"}},{key:"checkBenchmark",icon:"chart",className:"link",label:function(){var b=a.getExperimentId(),c=a.getNodeInstanceId(),d=a.canvas.metadata.projectName;return'<a href="/benchmark.htm#/evaluation?expId='+b+"&nodeInstId="+c+"&benchmarkId="+((a.canvas.benchmarkNodes[c]||{}).benchmarkId||"")+"&projectName="+d+'" target="_blank">'+na("resultBenchmark")+"</a>"},hidden:function(){var b=a.getNodeInstanceId();return"testing"!==(a.canvas.benchmarkNodes[b]||{}).benchmarkStatus}}]},{type:"separator",hidden:function(){return ma()||!k.showGroup(a.getCodeName())}},{key:"executeFromHere",icon:"run-from",label:na("executeFromHere"),disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteFromNode(a.getCodeName())}},{key:"executeToHere",icon:"run-stop",label:na("executeToHere"),disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteToNode(a.getCodeName())}},{key:"executeHere",icon:"run-node",label:na("executeHere"),accessKey:"Ctrl + Shift + R",disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteNode(a.getCodeName())}},{key:"tryExecute",icon:"arrow-right-o",label:na("tryExecute"),hidden:function(){return ma()||j.isAliyun||!k.canExecuteNode(a.getCodeName())||k.shouldHideTryExecute(a.getCodeName())},items:[{key:"tryExecuteAll",icon:"arrow-right-o",label:na("executeAll"),disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteFromNode(a.getCodeName())}},{key:"tryExecuteFromHere",icon:"run-from",label:na("executeFromHere"),disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteFromNode(a.getCodeName())}},{key:"tryExecuteToHere",icon:"run-stop",label:na("executeToHere"),disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteToNode(a.getCodeName())}},{key:"tryExecuteHere",icon:"run-node",label:na("executeHere"),disabled:function(){return!a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteNode(a.getCodeName())}}]},{key:"stopExecute",icon:"stop-o",label:na("stopExecuteNode"),disabled:function(){return a.isNodeExecutable()},hidden:function(){return ma()||!k.canExecuteNode(a.getCodeName())||a.isNodeExecutable()}},{type:"separator",hidden:function(){return ma()||!k.showGroup(a.getCodeName())}},{key:"refreshFields",icon:"refresh",label:na("refreshFields"),hidden:function(){return ma()||!k.canRefreshFields(a.getCodeName())}},{key:"showData",icon:"visible-l",label:na("viewData"),hidden:function(){return!!ma()||(a.targetNode.data.outPorts.filter(function(a){return"hide"!==a.displayType}).length>1||!a.hasOutTablePort())}},{key:"showDataSub",icon:"visible-l",label:na("viewData"),hidden:function(){return!!ma()||(a.targetNode.data.outPorts.filter(function(a){return"hide"!==a.displayType}).length<2||!a.hasOutTablePort())},items:[{key:"showData-1",icon:"visible-l",label:function(){return a.getPortViewDataLabel(1)},hidden:function(){return!a.canPortViewData(1)}},{key:"showData-2",icon:"visible-l",label:function(){return a.getPortViewDataLabel(2)},hidden:function(){return!a.canPortViewData(2)}},{key:"showData-3",icon:"visible-l",label:function(){return a.getPortViewDataLabel(3)},hidden:function(){return!a.canPortViewData(3)}},{key:"showData-4",icon:"visible-l",label:function(){return a.getPortViewDataLabel(4)},hidden:function(){return!a.canPortViewData(4)}},{key:"showData-5",icon:"visible-l",label:function(){return a.getPortViewDataLabel(5)},hidden:function(){return!a.canPortViewData(5)}},{key:"showData-6",icon:"visible-l",label:function(){return a.getPortViewDataLabel(6)},hidden:function(){return!a.canPortViewData(6)}},{key:"showData-7",icon:"visible-l",label:function(){return a.getPortViewDataLabel(7)},hidden:function(){return!a.canPortViewData(7)}},{key:"showData-8",icon:"visible-l",label:function(){return a.getPortViewDataLabel(8)},hidden:function(){return!a.canPortViewData(8)}}]},{key:"showFeatureAnalysis",icon:"analysis",label:function(b){var c=a.getNodeInstanceId(),d=a.getExperimentId();return'<a class="link full-link" href="'+window.location.origin+"/insight?experimentId="+d+"&nodeInstId="+c+'&port=1"  target="_blank"> 数据分析 &nbsp; &nbsp; &nbsp; </a>'},hidden:function(){return!!ma()||(a.targetNode.data.outPorts.filter(function(a){return"hide"!==a.displayType}).length>1||!a.hasOutTablePort()||!k.canShowFeatureAnalysis())}},{key:"showFeatureAnalysisSub",icon:"analysis",label:"数据分析",hidden:function(){return!!ma()||(a.targetNode.data.outPorts.filter(function(a){return"hide"!==a.displayType}).length<2||!a.hasOutTablePort()||!k.canShowFeatureAnalysis())},items:[{key:"showFeatureAnalysis-1",icon:"analysis",label:function(){return a.getPortAnalysisLabel(1,a)},hidden:function(){return!a.canPortViewData(1)}},{key:"showFeatureAnalysis-2",icon:"analysis",label:function(){return a.getPortAnalysisLabel(2,a)},hidden:function(){return!a.canPortViewData(2)}},{key:"showFeatureAnalysis-3",icon:"analysis",label:function(){return a.getPortAnalysisLabel(3,a)},hidden:function(){return!a.canPortViewData(3)}},{key:"showFeatureAnalysis-4",icon:"analysis",label:function(){return a.getPortAnalysisLabel(4,a)},hidden:function(){return!a.canPortViewData(4)}},{key:"showFeatureAnalysis-5",icon:"analysis",label:function(){return a.getPortAnalysisLabel(5,a)},hidden:function(){return!a.canPortViewData(5)}},{key:"showFeatureAnalysis-6",icon:"analysis",label:function(){return a.getPortAnalysisLabel(6,a)},hidden:function(){return!a.canPortViewData(6)}},{key:"showFeatureAnalysis-7",
icon:"analysis",label:function(){return a.getPortAnalysisLabel(7,a)},hidden:function(){return!a.canPortViewData(7)}},{key:"showFeatureAnalysis-8",icon:"analysis",label:function(){return a.getPortAnalysisLabel(8,a)},hidden:function(){return!a.canPortViewData(8)}}]},{key:"editDecisionTree",icon:"cut",className:"link",label:function(){return'<a href="/model/dtree/'+a.getExperimentId()+"/"+a.getNodeInstanceId()+'" target="_blank">'+na("editDecisionTree")+"</a>"},hidden:function(){return!k.canEditDecisionTree(a.getCodeName())}},{key:"showAnalyticsReport",icon:"visible-l",label:na("viewAnalyticsReport"),hidden:function(){return!!ma()||!k.canShowAnalyticsReport(a.getCodeName())}},{key:"showEvaluationReport",icon:"visible-l",label:na("viewEvaluationReport"),hidden:function(){return!!ma()||!k.canShowEvaluationReport(a.getCodeName())}},{key:"generateReport",icon:"report-24",label:na("viewModuleReport"),hidden:function(){return!!ma()||(j.isAliyun||!k.canShowGenerateReport(a.getCodeName()))}},{key:"showModelReport",icon:"visible-l",label:na("viewModelReport"),hidden:function(){return!!ma()||!k.canShowModelReport(a.getCodeName())}},{key:"binning",icon:"separate-cell",label:na("doBinning"),hidden:function(){return!!ma()||!k.canBinning(a.getCodeName())}},{key:"interactiveVariable",icon:"separate-cell",label:na("interactiveVariable"),hidden:function(){return!!ma()||!k.isInteractiveVariable(a.getCodeName())}},{key:"cumulateGroup",icon:"separate-cell",label:na("doCumulateGroup"),hidden:function(){return!!ma()||!k.doCumulateGroup(a.getCodeName())}},{key:"editModel",icon:"cut",label:na("ctEditModel"),hidden:function(){return!!ma()||!k.canEditModel(a.getCodeName())}},{key:"modelOptions",icon:"diamond",label:na("modelOptions"),items:[{key:"generatePMML",icon:"run-node",label:na("generatePMML"),hidden:function(){return j.isAntCloud||!a.isNodeExecutable()||!k.showPmmlOption(a.getCodeName())},disabled:function(){return k.isSpark(a.getOriginCodeName())}},{key:"exportPMML",label:na("exportPMML"),hidden:function(){return j.isAntCloud||j.isAntLab||!k.showPmmlOption(a.getCodeName())}},{type:"separator",hidden:function(){return j.isAntCloud||!k.showPmmlOption(a.getCodeName())}},{key:"showModel",icon:"visible",label:na("showModel"),disabled:function(){return!k.canShowModel(a.getOriginCodeName())},hidden:function(){return j.isAntCloud}},{key:"modelDesc",icon:"list",label:na("modelDesc")},{key:"saveModel",icon:"save",label:na("saveModel")},{key:"locateModel",icon:"locate-o",label:na("locateModel")}],hidden:function(){return!!ma()||(!(j.isInternal||j.isAntLab||j.isAntCloud)||j.isAliyun||!k.showModelMenu(a.getCodeName()))}},{key:"registerModel",icon:"data",label:na("registerModel"),hidden:function(){return!!ma()||!k.canRegisterModel(a.getCodeName())}},{key:"deployAsService",icon:"upload-l",label:"部署为预测服务",hidden:function(){return ma(),!0}},{key:"structure2Vec",icon:"visible",className:"ajax-disabled",label:function(){if(k.isStructure2Vec(a.getCodeName())){var b=a.getNodeInstanceId();a.checkStruct2Vec(b,a)}return'<a href="#" id="structure2Vec-link" class="disabled-link"  target="_blank">查看运行状态</a>'},hidden:function(){return!!ma()||(!j.isInternal||!k.isStructure2Vec(a.getCodeName()))}},{key:"showLog",icon:"analysis",label:na("viewLog"),accessKey:"Ctrl + L",hidden:function(){return!!ma()||!k.canViewLog(a.getCodeName())}}],on:{rename:function(){a.renameNode(),oa("c190.d1")},delete:function(){a.deleteNodes(),oa("c190.d2")},copyNodes:function(){a.copyNodes(),oa("c190.d3")},addRemark:function(){h.addRemark(a.localPosition.x,a.localPosition.y+20),oa("c190.d4")},refreshFields:function(){a.refreshFields(),oa("c190.d5")},enterBenchmark:function(b,c){a.openBenchmark(c,a.canvas),oa("c191.d4")},checkBenchmark:function(b,c){a.checkBenchmark(c,a.canvas),oa("c191.d4")},interactiveVariable:function(b){a.interactiveVariable(a.canvas)},delBenchmark:function(){a.delBenchmark()},group:function(){a.groupNodes(),oa("c191.d1")},groupLoop:function(){a.groupLoop(a),oa("c191.d3")},executeFromHere:function(){h.executeFromNode(a.getNodeInstanceId()),oa("c192.d1")},executeToHere:function(){h.executeToNode(a.getNodeInstanceId()),oa("c192.d2")},executeHere:function(){h.executeNode(a.getNodeInstanceId()),oa("c192.d3")},stopExecute:function(){h.stopExecuteNode(a.getNodeInstanceId()),oa("c192.d4")},tryExecuteAll:function(){h.tryExecuteExperiment(a.getNodeInstanceId()),oa("c192.d8")},tryExecuteFromHere:function(){h.tryExecuteFromNode(a.getNodeInstanceId()),oa("c192.d8")},tryExecuteToHere:function(){h.tryExecuteToNode(a.getNodeInstanceId()),oa("c192.d8")},tryExecuteHere:function(){h.tryExecuteNode(a.getNodeInstanceId()),oa("c192.d8")},generatePMML:function(){h.executePmml(a.getNodeInstanceId()),oa("c193.d1")},exportPMML:function(){h.exportPmml(a.getExperimentId(),a.getNodeInstanceId()),oa("c193.d2")},showModel:function(){h.showModel({fromNodeDef:!1,codeName:a.getOriginCodeName(),experimentId:a.getExperimentId(),nodeInstanceId:a.getNodeInstanceId()}),oa("c193.d3")},modelDesc:function(){ia.show(null,a.getNodeInstanceId()),oa("c193.d4")},saveModel:function(){h.saveModel(a.getExperimentId(),a.getNodeInstanceId()),oa("c193.d5")},locateModel:function(){h.locateModel(a.getExperimentId(),a.getNodeInstanceId()),oa("c193.d6")},registerModel:function(){var b=a.getTargetNodes().map(function(a){return a.data.id});m.registerModel(a.getExperimentId(),b).then(function(a){i.success(na("registerModelSucceed")+", "+a.uuid)}),oa("c193.d7")},showLog:function(){h.showNodeLog(a.getNodeInstanceId()),oa("c194.d1")},showAnalyticsReport:function(){a.showAnalyticsReport(),oa("c194.d3")},showModelReport:function(){a.showModelReport(),oa("c194.d5")},showEvaluationReport:function(){a.showEvaluationReport(),oa("c194.d6")},editModel:function(){a.showEditModel(),oa("c194.d7")},binning:function(){a.showBinning(),oa("c194.d8")},generateReport:function(b){oa("c194.d9"),h.generateReport({experimentId:a.getExperimentId(),reportType:"module",otherExperiment:!1})},deployAsService:function(){oa("c194.d10"),h.deployOnlineService(a.getNodeInstanceId())},cumulateGroup:function(){a.showCumulateGroup(),oa("c194.d11")}},callback:function(){var b=this.key;if("showData"===b)a.showData();else if(0===b.indexOf("showData-")){var c=parseInt(b.substr(9),10);a.showData(c)}}}),a},setup:function(){var a=this;return a.paper.on("cell:contextmenu",function(b,c,d,e,f){!a.isNode(b)||a.isGroup(b)||a.isRemark(b)||(d.preventDefault(),a.localPosition={x:e,y:f},a.targetNode=b,a.menu.show(d.pageX,d.pageY))}),a},isNodeExecutable:function(a){return a=a||this.targetNode,"running"!==a.data.nodeInstanceStatus},hasOutTablePort:function(){return a.some(this.targetNode.data.outPorts,function(a){return 0===a.type&&"hide"!==a.displayType})},checkStruct2Vec:function(a,b){p.getArmorTensorBoard(a).then(function(a){if(a.visUrl){var c=b.menu.$menu.find("#structure2Vec-link");c&&c[0]&&(c.parent().parent().attr("class","ui-context-menu-item link"),c.removeClass("disabled-link"),c.attr("href",a.visUrl))}})},getPortViewDataLabel:function(a){var b=this.targetNode.data.outPorts,c=a-1;return b[c]?b[c].description:na("viewData")},getPortAnalysisLabel:function(a,b){var c=this.targetNode.data.outPorts,d=a-1,e=c[d]?c[d].description:"输出节点",f=b.getNodeInstanceId(),g=b.getExperimentId();return'<a class="link full-link" href="'+window.location.origin+"/insight?experimentId="+g+"&nodeInstId="+f+"&port="+a+'"  target="_blank">'+e+" &nbsp; &nbsp; &nbsp;</a>"},canPortViewData:function(b){var c=null;return a.some(this.targetNode.data.outPorts,function(a){if(a.sequence===b&&"hide"!==a.displayType)return c=a,!0}),c&&0===c.type},isSameCodeName:function(b){var c=this.getCodeName();return a.isArray(b)?a.some(b,function(a){return k.isSameCodeName(c,a)}):k.isSameCodeName(c,b)},getCodeName:function(a){return(a||this.targetNode).data.codeName},getOriginCodeName:function(a){return(a||this.targetNode).data.orignAlgoCodeName},getNodeInstanceId:function(a){return(a||this.targetNode).data.id},getNodeDefineId:function(a){return(a||this.targetNode).data.nodeDefId},getNodeById:function(a,b){return a&&a.nodeById&&a.nodeById[b]||{}},getDialogParams:function(){var a=this.targetNode.data;return{projectName:g.get(g.keys.projectName),nodeInstanceId:a.id,nodeInstanceName:a.name,codeName:a.codeName,nodeDefId:a.nodeDefId,experimentId:this.getExperimentId(),experimentName:this.canvas.metadata.name}},getTargetNodes:function(b){if(!b){var c=this.targetNode,d=this.getSelectedNodes();b=a.some(d,function(a){return a.id===c.id})?d:c}return a.isArray(b)?b:[b]},deleteNodes:function(a){var b=this.canvas.blankContextMenu;b&&b.deleteNodes(this.getTargetNodes(a))},interactiveVariable:function(a){var b=this.getExperimentId(),c=this.getNodeInstanceId();window.react_bridge.actions&&window.react_bridge.actions.analysis.mergeVariable.get({nodeInstId:c,experimentId:b,afterClose:function(){ka.tick()}})},groupLoop:function(){var a=this,b=a.getExperimentId();a.targetNode.data.groupId||a.canvas.createGroup(a.getTargetNodes(),{name:na("groupLoop")+"  ( "+moment().format("YYYY-MM-DD hh:mm:ss")+" )",collapsed:!1}),setTimeout(function(){ja.show({groupId:a.targetNode.data.groupId,experimentId:b})},300)},groupNodes:function(a){h.createGroup(this.getTargetNodes(a))},renameNode:function(a){var b=(a||this.targetNode).data,c=this.canvas;b&&q.show(this.getExperimentId(),b).then(function(a){c.updateNode(b.id,{name:a})})},checkBenchmarkAsync:function(a,b,c){var d=a.benchmarkValid;a.benchmarkError;!0!==d&&!1!==d&&o.preCheckBenchmark(b,c).then(function(){a.benchmarkValid=!0,a.benchmarkError=null},function(b){a.benchmarkValid=!1,a.benchmarkError=b.errorMessage})},openBenchmark:function(a,b){var c=(this.getExperimentId(),this.getNodeInstanceId()),d=this.getNodeById(b,c);if(!0!==d.benchmarkValid)return a.preventDefault(),i.error(d.benchmarkError||"")},checkBenchmark:function(a,b){var c=(this.getExperimentId(),this.getNodeInstanceId()),d=this.getNodeById(b,c);if(!0!==d.benchmarkValid)return a.preventDefault(),i.error(d.benchmarkError||"请检查组件连线")},copyNodes:function(a){var b=this.canvas.blankContextMenu;b&&b.copyNodes(this.getTargetNodes(a))},showModelReport:function(){this.isSameCodeName("linear_model")||this.isSameCodeName("holt_winters")||this.isSameCodeName("x13_arima")||this.isSameCodeName("x13_auto_arima")||this.isSameCodeName("fitscale")||this.isSameCodeName("statistics_logistic_regression")||this.isSameCodeName("statistics_linear_regression")||this.isSameCodeName("ftgarch")||this.isSameCodeName("decompose")?fa.show(this.getNodeInstanceId(),null,this.getCodeName()):this.isSameCodeName("psi")&&ga.show(this.getNodeInstanceId())},showAnalyticsReport:function(){var a=this.getDialogParams();this.isSameCodeName("SimpleSummary")?B.show(a):this.isSameCodeName("Percentile")?C.show(a):this.isSameCodeName("pearson")?E.show(a):this.isSameCodeName("Modularity")?F.show(a):this.isSameCodeName(["chisq_test","chisq_test_fit","chisq_test_independence"])?H.show(a):this.isSameCodeName("t_test")?G.show(a):this.isSameCodeName("evaluation")?I.show(a):this.isSameCodeName(["gbdt_importance","GBDT","GBDT_LR","gbdt_lr_infocode","regression_feature_importance","feature_importance"])?J.show(a):this.isSameCodeName("enum_feature_selection")?K.show(a):this.isSameCodeName(["fe_select_runner","fe_normlize_runner","fe_scale_runner","fe_discrete_runner","fe_soften_runner","fe_meta_runner"])?L.show(a):this.isSameCodeName(["histograms","residual_histogram","antspark_histogram"])?M.show(a):this.isSameCodeName(["HistoWithBin"])?D.show(a):this.isSameCodeName(["data_compare"])?N.show(a):this.isSameCodeName(["scatter_diagram","antspark_scatterdiagram"])?new r(a).show():this.isSameCodeName(["empirical_pdf"])?P.show(a):this.isSameCodeName(["dnn","DNN_CPU"])?Q.show(a):this.isSameCodeName(["ConvLSTM_Train"])?R.show(a):this.isSameCodeName(["C5"])?S.show(a):this.isSameCodeName(["box_plot"])?O.show(a):this.isSameCodeName(["scorecard_grouping"])?T.show(a):this.isSameCodeName(["linearregression"])?s.show(this.getNodeInstanceId(),2):this.isSameCodeName(["glm"])?U.show(a):this.isSameCodeName(["glm_insurance"])?V.show(a):this.isSameCodeName(["glm_insurance_predict"])?W.show(a):this.isSameCodeName(["normality_test"])?X.show(a):this.isSameCodeName(["Quantile"])?Y.show(a):this.isSameCodeName(["LorenzCurve"])?Z.show(a):this.isSameCodeName(["corrcoef"])?$.show(a):this.isSameCodeName(["corresp"])?_.show(a):this.isSameCodeName(["decompose"])?aa.show(a):this.isSameCodeName(["GainCurveGini"])?ba.show(a):this.isSameCodeName(["pivot_table"])?ca.show(a):this.isSameCodeName(["lrreportsummary"])?da.show(a):this.isSameCodeName(["ssd_train","detection_eval"])?ea.show(a):this.isSameCodeName("boxcox")?window.react_bridge.actions.analysis.coxbox.get({nodeInstId:this.getNodeInstanceId()}):this.isSameCodeName("tfidf")?window.react_bridge.actions.showTfDif({nodeInstId:this.getNodeInstanceId(),experimentId:this.getExperimentId()}):this.isSameCodeName("factor_analyze")&&window.react_bridge.actions.analysis.factorAnalyze.show({nodeInstId:this.getNodeInstanceId(),expId:this.getExperimentId()})},showEvaluationReport:function(){var a=this.getDialogParams();this.isSameCodeName("roc")||this.isSameCodeName("compositeRoc")?w.show(a):this.isSameCodeName("confusionmatrix")||this.isSameCodeName("antspark_confusionmatrix")?z.show(a):this.isSameCodeName("mc_eval_wf")||this.isSameCodeName("antspark_multi_evaluate")?A.show(a):this.isSameCodeName("evaluate")||this.isSameCodeName("antspark_evaluate")?y.show(a):this.isSameCodeName("cluster_evaluation")?x.show(a):this.isSameCodeName("ConvLSTM_Predict")&&ha.show(a)},showData:function(a){oa("c194.d2");var b=this.canvas.metadata.projectName;s.show(this.getNodeInstanceId(),a,null,b)},showBinning:function(){t.show(this.getDialogParams())},showCumulateGroup:function(){u.show(this.getDialogParams())},showEditModel:function(){v.show(this.getDialogParams())},refreshFields:function(){var a=this.getExperimentId(),b=this.getNodeInstanceId();n.updateSchema(b).then(function(){i.success(na("refreshFieldsSucceed")),h.reloadProps(a,b)})}})}),define("workspace/canvas/linkContextMenu",["zero/zero","zero/declare","zero/ui/ContextMenu","../../i18n","../../global/event","./contextMenu"],function(a,b,c,d,e,f){"use strict";var g=d.translate;return b("workspace/Canvas/LinkContentMenu",[f],{constructor:function(a){f.prototype.constructor.call(this,a)},init:function(){var a=this;return this.menu=new c({key:"link",items:[{key:"delete",icon:"delete",label:g("delete")}],on:{addComment:function(){e.focusLink(a.getExperimentId(),a.targetLink)},addRemark:function(){e.addRemark(a.localPosition.x,a.localPosition.y+20)},delete:function(){a.deleteLink()}}}),a},deleteLink:function(a){return a||(a=this.targetLink.data),this.canvas.deleteLink(a),this},setup:function(){var a=this;return a.paper.on("cell:contextmenu",function(b,c,d,e,f){d.preventDefault(),a.isLink(b)&&(a.localPosition={x:e,y:f},a.targetLink=b,a.menu.show(d.pageX,d.pageY))}),a}})}),define("workspace/canvas/groupContextMenu",["zero/zero","zero/declare","zero/ui/ContextMenu","zero/ui/DialogSingleInput","../../i18n","../../global/config","../../global/event","../../global/environment","../../global/utils","../../storage/globalCache","../../ajax/groupLoop","../../ajax/nodeGroup","../../dialog/experiment/cyclicParams","./contextMenu"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o=e.translate,p=f.reg,q=i.log;return b("workspace/Canvas/GroupContentMenu",[n],{constructor:function(a){n.prototype.constructor.call(this,a)},init:function(){var a=this;return this.menu=new c({key:"group",items:[{key:"rename",icon:"rename",label:o("rename")},{key:"copy",icon:"copy-node",label:o("copy"),accessKey:"Ctrl + C"},{key:"delete",icon:"delete",label:o("delete")},{type:"separator"},{key:"save",icon:"save",label:o("saveGroup")},{key:"unGroup",icon:"ungroup-24",label:o("unGroup")},{type:"separator"},{key:"configParams",icon:"sheet-1",label:o("groupLoopConfig")},{key:"execute",icon:"arrow-right-o",label:o("groupLoopRun"),hidden:function(){return"running"===a.targetGroup.data.status}},{key:"stop",icon:"stop-o",label:o("groupLoopStop"),hidden:function(){return"running"!==a.targetGroup.data.status}},{key:"viewResult",icon:"report",className:"link",label:function(){var b=a.targetGroup.data.id,c=a.canvas.experimentId;return'<a href="/groupLoop.htm?projectName='+j.get(j.keys.projectName)+"&experimentId="+c+"&groupId="+b+'" target="_blank">'+o("groupLoopResult")+"</a>"}},{type:"separator",hidden:function(){return!h.isAntLab}},{key:"generateGroupModel",icon:"diamond",label:"生成配置模型",hidden:function(){return!h.isAntLab}}],on:{rename:function(){a.rename(),q("195.d1")},delete:function(){a.delete(),q("195.d2")},copy:function(){a.copy(),q("195.d3")},save:function(){a.save(),q("195.d4")},unGroup:function(){a.unGroup(),q("195.d5")},configParams:function(){a.configParams(),q("195.d6")},execute:function(){a.execute(),q("195.d7")},viewResult:function(){q("195.d8")},stop:function(){a.stop(),q("195.d9")},generateGroupModel:function(){a.generateGroupModel(),q("195.d10")}}}),a},setup:function(){var a=this;return a.paper.on("cell:contextmenu",function(b,c,d){a.isGroup(b)&&(d.preventDefault(),a.targetGroup=b,a.menu.show(d.pageX,d.pageY))}),a},getTargetNodes:function(){var b=this.targetGroup,c=this.getSelectedNodes(),d=a.some(c,function(a){return a.id===b.id})?c:b;return a.isArray(d)?d:[d]},rename:function(a){var b=(a||this.targetGroup).data,c=this.canvas;b&&new d({title:o("groupName"),inputValue:b.name,afterHide:function(){this.destroy()},callback:function(a){return!!a&&(p.xss.test(a)?(this.showErrorTip(o("inputXss")),!1):void c.renameGroup(b.id,a))}})},unGroup:function(a){this.canvas.removeGroup(a||this.targetGroup)},delete:function(){var a=this.canvas.blankContextMenu;a&&a.deleteNodes(this.getTargetNodes())},save:function(){this.canvas.saveGroupAsComponent(this.targetGroup)},copy:function(){var a=this.canvas.blankContextMenu;a&&a.copyNodes(this.getTargetNodes())},configParams:function(){m.show({groupId:this.targetGroup.data.id,experimentId:this.canvas.experimentId})},execute:function(){g.executeGroup(this.targetGroup.data.id)},stop:function(){k.stopLoopExecute(this.canvas.experimentId,this.targetGroup.data.id)},generateGroupModel:function(){var a=this.targetGroup.data.id,b=j.get(j.keys.projectName);l.generateGroupModel(a,b)}})}),define("workspace/canvas/remarkContextMenu",["zero/zero","zero/declare","zero/ui/ContextMenu","../../i18n","../../global/event","./contextMenu"],function(a,b,c,d,e,f){"use strict";var g=d.translate;return b("workspace/Canvas/RemarkContentMenu",[f],{constructor:function(a){f.prototype.constructor.call(this,a)},init:function(){var a=this;return this.menu=new c({key:"remark",items:[{key:"edit",icon:"edit",label:g("edit")},{key:"copy",icon:"copy-node",label:g("copy"),accessKey:"Ctrl + C"},{key:"delete",icon:"delete",label:g("delete")}],on:{edit:function(){a.edit()},delete:function(){a.delete()},copy:function(){a.copy()}}}),a},setup:function(){var a=this;return a.paper.on("cell:contextmenu",function(b,c,d){a.isRemark(b)&&(d.preventDefault(),a.targetRemark=b,a.menu.show(d.pageX,d.pageY))}),a},getTargetNodes:function(){var b=this.targetRemark,c=this.getSelectedNodes(),d=a.some(c,function(a){return a.id===b.id})?c:b;return a.isArray(d)?d:[d]},edit:function(a){this.canvas.editRemark(a||this.targetRemark)},delete:function(){var a=this.canvas.blankContextMenu;a&&a.deleteNodes(this.getTargetNodes())},copy:function(){var a=this.canvas.blankContextMenu;a&&a.copyNodes(this.getTargetNodes())}})}),define("workspace/canvas",["zero/zero","zero/declare","zero/json","zero/ui/Confirm","../i18n","../global/classNames","../global/event","../global/config","../global/Track","../global/nodeMenuChecker","../storage/globalCache","../storage/componentCache","../storage/persistence","../ajax/experiment","../ajax/dataSource","../ajax/nodeGroup","../ajax/groupLoop","../ajax/benchmark","../midway/canvas/node","../midway/canvas/group","../midway/canvas/remark","../midway/canvas/port","../midway/canvas/link","../midway/workspace/maskLoading","../dialog/experiment/cyclicParams","./canvas/hotkeys","./canvas/tooltips","./canvas/recommend","./canvas/onGlobalEvent","./canvas/blankContextMenu","./canvas/nodeContextMenu","./canvas/linkContextMenu","./canvas/groupContextMenu","./canvas/remarkContextMenu"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){"use strict";return b("workspace/Canvas",[],{constructor:function(a){var b=a.clientWidth,c=a.clientHeight;this.model=new panejs.Model,this.paper=new panejs.Paper({model:this.model,container:a,gridSize:5,width:b-60,height:c-60,isValidEvent:function(a,b){return!(b&&b.data&&b.data.isRecommendation)}}),this.nodeById={},this.portById={},this.linkById={},this.groupById={},this.remarkById={},this.loaded=!1,this.setup()},isGroup:function(a){return a&&a.isGroup&&a.isGroup()},isRemark:function(a){return a&&a.isRemark&&a.isRemark()},isNode:function(a){return a&&a.isNode()},isLink:function(a){return a&&a.isLink()},setup:function(){return this.snapLines=new panejs.pai.SnapLines({paper:this.paper}),this.paperScroll=new panejs.pai.PaperScroll({paper:this.paper}),this.miniMap=new panejs.pai.MiniMap({paperScroll:this.paperScroll}),this.paper.on("cell:connecting",this.onConnecting.bind(this)).on("cell:connected",this.onConnected.bind(this)).on("cell:focus",this.onFocusChanged.bind(this)).on("cell:click",this.onClick.bind(this)).on("cell:dblclick",this.onDblClick.bind(this)).on("paper:focus",this.onFocusChanged.bind(this)).on("cells:selectionChanged",this.onSelectionChanged.bind(this)).on("cells:updatePosition",this.updateNodesPosition.bind(this)).on("group:collapseChanged",this.onCollapseChanged.bind(this)).on("remark:updateName",this.updateRemarkName.bind(this)),this.paper.on("paper:scale",function(a,b){g.canvasScaled(a,b)}),this.hotKeys=z.init(this),this.tooltips=A.init(this),this.recommend=B.init(this),this.globalEvent=C.init(this),this.blankContextMenu=new D(this),this.nodeContextMenu=new E(this),this.linkContextMenu=new F(this),this.groupContextMenu=new G(this),this.remarkContextMenu=new H(this),this.selectionHandler=new panejs.pai.SelectionHandler(this.paper),this.connectionHandler=new panejs.pai.ConnectionHandler(this.paper),this},onSelectionChanged:function(b){var c=this,d=c.selectionHandler;if(d.clearSelection(),d.selectCells(b),c.selectedNodes=b,window.GLOBALS.sync){var e=b.map(function(a){return{outPorts:a.outPorts,inPorts:a.inPorts,id:a.data.id,name:a.data.name,catId:a.data.catId,category:a.data.category,codeName:a.data.codeName,execStatus:a.data.execStatus}});window.localStorage.setItem("sancho",JSON.stringify({selectNodes:e,expInfo:c.metadata}))}k.set(k.keys.selectedNodes,c.selectedNodes),g.selectNodes(b.map(function(a){return c.getNodeId(a)}));var f=1!==b.length||!b[0].isGroup||!b[0].isGroup();g.toggleGroup(!(b.length&&f&&c.canGroup(b)&&j.showGroup(c.getNodeName(b[0])))),g.toggleUnGroup(f),g.toggleGroupLoop(!a.some(b,function(a){return a.isGroup&&a.isGroup()||j.showGroupLoop(c.getNodeName(a))}))},onFocusChanged:function(a){this.focusedCell=a,a?this.isGroup(a)||this.isRemark(a)||this.isNode(a)&&g.focusNode(this.experimentId,a.data.id):g.focusCanvas(),$("#j-bpmn").focus()},onDblClick:function(a,b,c){a.isGroup&&a.isGroup()&&(a.toggleCollapse(),c.stopPropagation())},onClick:function(a,b,c){if(a.isGroup&&a.isGroup()){var d=c.target.parentNode.className;d&&"string"==typeof d&&(d.indexOf("btnLoopConfig")>=0?y.show({groupId:a.data.id,experimentId:this.experimentId}):d.indexOf("btnLoopExecute")>=0?g.executeGroup(a.data.id):d.indexOf("btnLoopStop")>=0&&q.stopLoopExecute(this.experimentId,a.data.id),c.stopPropagation())}},onConnecting:function(b){var c=b.sourceNode,d=b.sourceView,e=b.sourcePort;d&&e&&d.setPortConnecting&&d.setPortConnecting(e,!1,!0),this.highlightedPorts||(this.highlightedPorts=[],a.each(this.nodeById,function(a){c.id!==a.id&&a.eachInPort(function(b){if(this.canConnect(e,b)){var c=this.paper.getView(a);c&&c.setPortHighlight(b,!0,!0),this.highlightedPorts.push({nodeId:this.getNodeId(a),portId:b.id})}},this)},this)),b.targetNode?this.adsorbPort(b,!0):this.connectingData&&this.connectingData.targetView&&this.adsorbPort(this.connectingData,!1),this.connectingData=b},onConnected:function(b){var c=b.sourceNode,d=b.sourceView,e=b.sourcePort,f=b.targetNode,g=b.targetPort;d&&d.setPortConnecting&&d.setPortConnecting(e,!1,!1),this.adsorbPort(b,!1),a.each(this.highlightedPorts,function(a){var b=this.getNodeById(a.nodeId),c=this.paper.getView(b),d=this.getPortById(a.portId);c&&d&&c.setPortHighlight(d,!0,!1)},this);var h=!1;if(g)var h=!a.some(this.highlightedPorts,function(a){return a.portId===g.id});this.highlightedPorts=null,this.connectingData=null,h||c&&e&&f&&(g||(g=this.getNearestConnPort(b)),g&&this.canConnect(e,g)&&this.createLink({source:this.getNodeId(c),target:this.getNodeId(f),outputPortId:e.id,inputPortId:g.id}))},adsorbPort:function(a,b){var c=a.targetView,d=a.targetPort;return d||(d=this.getNearestConnPort(a)),c&&d&&c.setPortAdsorbed(d,!0,b),this},isPortConnected:function(a,b){for(var c in this.linkById){var d=this.linkById[c],e=d&&d.data;if(e&&b?e.outputPortId===a:e.inputPortId===a)return!0}return!1},setPortConnected:function(a,b,c,d){var e=a.getPortById(b),f=this.paper.getView(a);return e&&f&&(e.connected=d,f.setPortConnected(b,!c,d)),this},canGroup:function(a){return!panejs.utils.some(a,function(a){return this.isInGroup(a)},this)},isInGroup:function(a){for(var b in this.groupById){if(this.groupById[b].isInGroup(a))return!0}return!1},addGroups:function(b){var c=this;return a.each(b,function(a){var b=c.getNodesInGroup(a.id);b&&b.length&&c.createGroup(b,{id:a.id,projectName:c.projectName,experimentId:c.experimentId,name:a.name,collapsed:a.isCollapsed})}),c},createGroup:function(b,c){var d=this;b=b||[],a.isArray(b)||(b=[b]),c.projectName=d.projectName,c.experimentId=d.experimentId,c.i18n={config:e.translate("groupLoopConfig"),execute:e.translate("groupLoopRun"),stop:e.translate("groupLoopStop"),viewResult:e.translate("groupLoopResult")};var f=d.model,h=new panejs.pai.Group({markup:t,collapsed:c.collapsed,data:c});b.length&&d.addToGroup(b,h);var i=function(){f.beginUpdate(),f.addNode(h,null,0);var a=h.getLinks();d.removeLinks(a.inLinks),d.removeLinks(a.outLinks),f.endUpdate(),f.beginUpdate(),panejs.utils.forEach(a.inLinks,function(a){this.addLink(a.data)},d),panejs.utils.forEach(a.outLinks,function(a){this.addLink(a.data)},d),f.endUpdate(),g.toggleGroup(!0)},j=c.id;if(j)d.groupById[j]=h,i();else{var k=a.map(b,function(a){return d.getNodeId(a)});p.createGroup(d.experimentId,k,c.name).then(function(c){j=c.id,a.each(b,function(a){a.data.groupId=j}),h.data.id=j,d.groupById[j]=h,i()},function(){})}return h},addToGroup:function(a,b){return b&&(this.model.beginUpdate(),b.addNodes(a),this.model.endUpdate()),this},getNodesInGroup:function(b){var c=[];return a.each(this.nodeById,function(a){a.data.groupId===b&&c.push(a)}),a.each(this.remarkById,function(a){a.data.groupId===b&&c.push(a)}),c},removeGroups:function(a){return panejs.utils.forEach(a,function(a){this.removeGroup(a)},this),this},removeGroup:function(a){if(a){var b=this;a.data.status?d({title:"拆分群组/取消遍历",body:"取消分组后，您的参数遍历执行的结果将被清空",onAccept:function(){b.deleteGroup(a)}}):this.deleteGroup(a)}return this},deleteGroup:function(a){var b=a.getNodes(),c=a.getLinks(),d=a.getGroupId(),e=panejs.utils.map(b,function(a){return a.data.groupId=0,this.getNodeId(a)},this);this.model.beginUpdate(),this.exchangeGrouLinks(c.inLinks,d),this.exchangeGrouLinks(c.outLinks,d),a.removeNodes(b,this.model.getDefaultParent()),a.removeFromParent(),this.model.endUpdate(),p.removeNodeFromGroup(this.experimentId,d,e),g.toggleGroupLoop(!0)},removeNodeFromGroup:function(){},renameGroup:function(a,b){var c=this;p.updateGroupName(c.experimentId,a,b).then(function(){var d=c.getGroupById(a),e=c.paper.getView(d);e&&e.setNodeName(b)})},updateGroup:function(a,b){var c=this.getGroupById(a),d=c&&this.paper.getView(c);if(c&&d){var e=c.data.status,f=b.status;f&&f!==e&&(e&&panejs.utils.removeClass(d.elem,e),panejs.utils.addClass(d.elem,f),c.data.status=b.status)}},getGroupLinks:function(a){return a.getLinks()},onCollapseChanged:function(a){var b=a.isCollapsed();return void p.updateFoldStatus(this.experimentId,a.data.id,b)},deleteGroups:function(a,b){var c={nodes:[],remarks:[]};return panejs.utils.forEach(a,function(a){a.eachChild(function(a){this.isRemark(a)?c.remarks.push(a):c.nodes.push(a)},this)},this),this.removeGroups(a),b?(c.nodes.length&&this.deleteNodes(c.nodes),c.remarks.length&&this.deleteRemarks(c.remarks),{}):c},saveGroupAsComponent:function(a){var b=a.position.x+Math.round(a.size.width/2),c=a.position.y+Math.round(a.size.height/2),d=[];a.eachChild(function(a){d.push({id:a.data.id,positionX:a.position.x,positionY:a.position.y})});var e=this.paper;p.saveGroupDefine(this.experimentId,a.data.id,d,b,c).then(function(a){var d=e.toClientPoint({x:b,y:c});a.x=d.x,a.y=d.y,g.saveGroupAsDefine(a)})},dropGroupToCanvas:function(a,b,c){p.addGroupToExperiment(this.experimentId,a,b,c).then(this.pasteNodes.bind(this))},checkLeftBottom:function(a,b,c){var d=a.getBBox();return{left:d.x+d.width<=b,bottom:d.y>=c}},pasteNodes:function(a,b){var c=this,d=a.links,e=a.groups||[],f=[],g=[];if(panejs.utils.forEach(a.nodes,function(a){c.isRemarkNode(a.nodeDefId)?g.push(a):f.push(a)}),f.length&&c.addNodes(f),e.length&&c.addGroups(e),d.length&&c.addLinks(d),g.length&&c.addRemarks(g),b){var h=[];panejs.utils.forEach(f,function(a){var b=c.getNodeById(a.id);b&&b.isVisible()&&h.push(b)}),panejs.utils.forEach(g,function(a){var b=c.getRemarkById(a.id);b&&b.isVisible()&&h.push(b)}),panejs.utils.forEach(e,function(a){h.push(c.getGroupById(a.id))});var i=c.selectionHandler;i.clearSelection(),i.selectCells(h),i.notifySelectionChange()}},isRemarkNode:function(a){return this.remarkDefId===a},createRemark:function(a,b){var c=this;return n.addNode(c.experimentId,c.remarkDefId,!1,a,b).then(function(d){var e=$.extend(d,{id:d.nodeInstanceId,init:!0,name:d.name,nodeDefId:c.remarkDefId,isModel:!1,position:{x:a,y:b}}),f=c.addRemark(e);return c.editRemark(f),f})},addRemarks:function(b){return b=b||[],a.isArray(b)||(b=[b]),b.length&&a.each(b,function(a){this.addRemark(a)},this),this},addRemark:function(a){a.size||(a.size={width:1,height:1});var b=new panejs.pai.Remark({markup:u,data:a,size:a.size,position:{x:a.positionX||0,y:a.positionY||0}});return this.model.addNode(b),this.remarkById[a.id]=b,b},updateRemarkName:function(a,b){n.renameNodeInstance(this.experimentId,a.data.id,b)},editRemark:function(a){var b=this.paper.getView(a);return b&&b.editRemark(),this},deleteRemarks:function(b){var c=this;if(b=b||[],a.isArray(b)||(b=[b]),!b.length)return c;var d=a.map(b,function(a){return a.data.id});n.deleteNodes(c.experimentId,d).then(function(){c.removeRemarks(b)})},removeRemarks:function(b){return b=b||[],a.isArray(b)||(b=[b]),b.length&&(this.model.beginUpdate(),a.each(b,function(a){a.removeFromParent(),delete this.remarkById[a.data.id]},this),this.model.endUpdate()),this},addRecommendNode:function(a){a.nodeClass=f.getComponentClass(a),a.iconName=f.getComponentIcon(a),a.statusIcon=f.getComponentAdditionalIcon(a);var b=new panejs.pai.Node({classNames:"pane-cell pane-node pane-node-recommendation",markup:s,portMarkup:v,data:a,inPorts:a.inPorts,outPorts:a.outPorts,position:{x:a.positionX||0,y:a.positionY||0}});return this.model.addNode(b),b},addNodes:function(b){return b=b||[],a.isArray(b)||(b=[b]),b.length&&(this.model.beginUpdate(),a.each(b,function(a){this.addNode(a)},this),this.model.endUpdate()),this},addNode:function(a){a.nodeClass=f.getComponentClass(a),a.iconName=f.getComponentIcon(a),a.statusIcon=f.getComponentAdditionalIcon(a);var b=new panejs.pai.Node({markup:s,portMarkup:v,data:a,inPorts:a.inPorts,outPorts:a.outPorts,position:{x:a.positionX||0,y:a.positionY||0}});return this.nodeById[a.id]=b,this.model.addNode(b),b.eachInPort(function(a){a.parents=[],this.portById[a.id]=a},this),b.eachOutPort(function(a){a.parents=[],this.portById[a.id]=a,
b.eachInPort(function(b){a.parents.push(b.id)},this)},this),this.loaded&&this.updateBenchmarkNode(this.experimentId,a.id),this.adjustPaper(),b},updateBenchmarkNode:function(a,b){var c=this;r.queryCandidateNodes({expId:this.experimentId}).then(function(a){c.queryCandidateNodesTime=(new Date).valueOf(),c.benchmarkNodes=a.candidateNodes,!!c.benchmarkNodes[b]&&(c.nodeById[b].benchmarkValid=!1,c.nodeById[b].benchmarkError="请检查连线")})},removeNodes:function(b){return b=b||[],a.isArray(b)||(b=[b]),b.length&&(this.model.beginUpdate(),a.each(b,function(a){this.removeNode(a)},this),this.model.endUpdate()),this},removeNode:function(b){var c=this.model,d=this.getNodeId(b),e=this.getNodeById(d);if(e){c.beginUpdate();var f=e.links;f&&f.length&&a.forEach(f.slice(),function(a){this.removeLink(a)},this),e.eachInPort(function(a){delete this.portById[a.id]},this),e.eachOutPort(function(a){delete this.portById[a.id]},this),e.removeFromParent(),delete this.nodeById[d],c.endUpdate(),this.adjustPaper()}return e},getExcuteJobStatus:function(a){return a&&a.nodeInstanceStatus},updateRunningIcon:function(a,b){var c=a.find(".loading-svg");"running"!==b&&c.length?c.html(""):a.find(".loading-svg").html(this.getLoadingIcon())},getLoadingIcon:function(){return'<circle stroke-opacity="0.5" cx="9" cy="9" r="9" stroke="#ccc" ></circle> <path d="M18,9 C18,4.03 13.97,0 9,0"> <animateTransform  attributeName="transform"  type="rotate" from="0 9 9"  to="360 9 9"  begin="0s" dur="1s" repeatCount="indefinite" /> </path>'},updateNode:function(b,c){var d=this.getNodeById(b),e=d&&this.paper.getView(d);if(d&&e){var g=d.data;delete c.id,delete c.inPorts,delete c.outPorts,c.execStatus&&delete g.execStatus;var h=g.statusIcon;a.extend(g,c);var i=f.getComponentAdditionalIcon(g);if(h!==i){var j=$(e.elem),k=j.find(".pane-node-content"),l=(k.find(".node-img"),j.find(".status"));this.updateRunningIcon(j,this.getExcuteJobStatus(g)),h&&!i?k.removeClass("has-status"):!h&&i&&k.addClass("has-status"),h&&l.removeClass(h),i&&l.addClass(i),g.statusIcon=i}c.name&&e.setNodeName(c.name)}return this},updateNodeStatus:function(b){return a.each(b,function(a){a.isGroup?this.updateGroup(a.id,a):this.updateNode(a.id,a)},this),this.updateLinkStream(),this},updateLinkStream:function(){return this.nodeById&&a.each(this.nodeById,function(a){this.updateLinkStreamByNode(a)},this),this},updateLinkStreamByNode:function(b){if(b){var c=this.paper,d="running"===this.getNodeStatus(b),e=this.getLinksByNode(b,!0);a.each(e,function(a){var b=c.getView(a);b&&b.vel.toggleClass("pane-link-flow",d)});var f=c.getView(b);f&&f.vel.toggleClass("pane-node-running",d)}return this},hasBenchMarkNode:function(a){return Object.keys(this.benchmarkNodes).some(function(b){return parseInt(b)===parseInt(a||0)})},addLinks:function(b){return b=b||[],a.isArray(b)||(b=[b]),b.length&&(this.model.beginUpdate(),a.each(b,function(a){this.addLink(a)},this),this.model.endUpdate()),this},addLink:function(a){var b=this.getNodeById(a.source),c=this.getNodeById(a.target),d=this.getPortById(a.outputPortId),e=this.getPortById(a.inputPortId);if(b&&c&&d&&e){this.setPortConnected(b,d.id,!0,!0),this.setPortConnected(c,e.id,!1,!0);var f=b.data.groupId,g=c.data.groupId,h=f===g,i=h?new panejs.Link({markup:w,attrs:null,data:a,view:panejs.pai.LinkView,connector:panejs.pai.quadratic}):new panejs.pai.GroupLink({markup:w,attrs:null,data:a,extra:{sourceGroupId:f||0,targetGroupId:g||0},view:panejs.pai.GroupLinkView,connector:panejs.pai.quadratic});this.model.beginUpdate(),h||(f&&this.paper.invalidate(this.getGroupById(f)),g&&this.paper.invalidate(this.getGroupById(g))),this.model.addLink(i,{node:b,port:d},{node:c,port:e}),this.model.endUpdate(),i.canvas=this,e.parents.push(d.id),this.linkById[this.getLinkId(i)]=i}return this},exchangeGrouLinks:function(a,b){panejs.utils.forEach(a,function(a){this.exchangeGrouLink(a,b)},this)},exchangeGrouLink:function(a,b){var c=a.data,d=this.getNodeById(c.source),e=this.getNodeById(c.target),f=this.getPortById(c.outputPortId),g=this.getPortById(c.inputPortId);if(d&&e&&f&&g){var h=d.data.groupId,i=e.data.groupId;h===b&&(h=0),i===b&&(i=0);var j,k=h===i;if(k)j=new panejs.Link({markup:w,attrs:null,data:c,view:panejs.pai.LinkView,connector:panejs.pai.quadratic});else{var l=this.paper.findViewByCell(a);j=new panejs.pai.GroupLink({markup:w,attrs:null,data:c,extra:{sourceGroupId:h||0,targetGroupId:i||0,sourcePortIndex:h?l.sourcePortIndex:-1,targetPortIndex:i?l.targetPortIndex:-1},view:panejs.pai.GroupLinkView,connector:panejs.pai.quadratic})}a.removeFromParent(),this.model.addLink(j,{node:d,port:f},{node:e,port:g}),j.canvas=this,this.linkById[this.getLinkId(j)]=j}},addRecommendLink:function(a){var b=a.sourceNode,c=a.targetNode,d=a.sourcePort,e=a.targetPort,f=new panejs.Link({classNames:"pane-cell pane-link pane-link-recommendation",markup:w,attrs:null,data:a,view:panejs.pai.LinkView,connector:panejs.pai.quadratic});return this.model.addLink(f,{node:b,port:d},{node:c,port:e}),f},removeLinks:function(b){return b=b||[],a.isArray(b)||(b=[b]),b.length&&(this.model.beginUpdate(),a.each(b,function(a){this.removeLink(a)},this),this.model.endUpdate()),this},removeLink:function(a){var b=this.getLinkId(a),c=this.getLinkById(b);if(c&&(c.removeFromParent(),a=c.data),a){var d=this.getNodeById(a.source),e=this.getNodeById(a.target);if(d&&e){var f=d.data.groupId,g=e.data.groupId;f!==g&&(f&&this.paper.invalidate(this.getGroupById(f)),g&&this.paper.invalidate(this.getGroupById(g)))}if(this.isPortConnected(a.inputPortId,!1)){var h=this.getNodeById(a.target);h&&this.setPortConnected(h,a.inputPortId,!1,!1)}d&&(d.emptyRecommendation=!1);var i=this.getPortById(a.inputPortId),j=i&&i.parents;if(j&&j.length)for(var k=j.length-1;k>=0;k--)j[k]===a.outputPortId&&j.splice(k,1);delete this.linkById[b]}return c},updateLinkComment:function(a,b){var d=this.paper.getView(a);a.data.comment=b,n.updateDependency(this.experimentId,c.stringify(a.data)).then(function(){d&&d.updateComment(b)})},createNode:function(b,c,d,e){var f,g=this;if(a.isObject(b))f=b,b=f.id;else{var i=c?h.NS.model+b:b;f=l.get(i)||{}}return n.addNode(this.experimentId,b,c,d,e).then(function(a){return a=$.extend(a,{id:a.nodeInstanceId,nodeDefId:b,name:a.name||f.name,codeName:a.codeName||f.codeName,ioType:a.ioType||f.ioType,category:a.category||f.category,orignAlgoCodeName:a.orignAlgoCodeName||a.codeName||f.codeName,isModel:c,nodeInstanceStatus:a.nodeInstanceStatus||a.status||"default"}),g.addNode(a)})},createLink:function(a){this.modifyDependency([a])},dropDataTable:function(a,b,c,d){var e=this;o.addTableToGraph(e.experimentId,a,b,c,d).then(function(b){b&&(b.id=b.nodeInstanceId,b.isModel=!1,b.nodeInstanceStatus=b.nodeInstanceStatus||"default",e.addNode(b),o.updateTableNameOnGraph(e.experimentId,b.id,a).then(function(){e.updateNode(b.id,{name:a,nodeInstanceStatus:"ready"})}))})},load:function(b){var c=this;k.set(k.keys.projectName,b.projectName),k.set(k.keys.currentExperimentId,b.id),c.metadata=b,c.experimentId=b.id;var d=n.getNodeDefByCodeName("comments_node"),e=n.queryGraph(b.id),f=r.queryCandidateNodes({expId:b.id});return Promise.all([d,e,f]).then(function(b){c.remarkDefId=b[0].id,c.benchmarkNodes=b[2]&&b[2].candidateNodes||{},c.benchmarkCodeNames=b[2]&&b[2].candidateCodeNames||[];var d=b[1],e=[],f=[];a.each(d.nodes,function(a){c.isRemarkNode&&c.isRemarkNode(a.nodeDefId)?f.push(a):e.push(a)}),c.addNodes&&(c.addNodes(e),c.addGroups(d.groups||[]),c.addLinks(d.links),c.addRemarks(f),c.afterLoad()),c.loaded=!0}),e},afterLoad:function(){var b=m.getObject(m.keys.canvasStatus),c=b[this.experimentId];if(c){var d=c.sx,e=c.sy;d&&e&&this.paper.scale(d,e);var f=c.scrollLeft,h=c.scrollTop;a.isUndefined(f)||a.isUndefined(h)||!this.paperScroll||this.paperScroll.applyScroll(f,h)}else a.keys(this.nodeById).length&&g.fitToWindow(null,1);return this.updateLinkStream(),g.openExperiment(this.metadata),this},modifyDependency:function(b,d){b=b||[],d=d||[];var e=b.length?c.stringify(b):"",f=d.length?c.stringify(d):"",h=this,i=h.experimentId;return h.addLinks(b),n.validateModifyDependency(i,e,f).then(function(){return n.modifyDependency(i,e,f).then(function(c){c.addLinks&&(a.each(c.addLinks,function(c){a.some(b,function(a){return h.isSameLink(c,a)})||h.addLink(c)}),a.each(b,function(b){a.some(c.addLinks,function(a){return h.isSameLink(a,b)})||h.removeLink(b)})),c.relatedNodeInstances&&a.each(c.relatedNodeInstances,function(a){var b=a.id;h.updateNode(b,a),g.reloadProps(i,b)}),h.removeLinks(d);var e=b[0]&&b[0].target||d[0]&&d[0].target,f=b[0]&&b[0].source||d[0]&&d[0].source;if(e||f){var j=h.hasBenchMarkNode(e)?e:h.hasBenchMarkNode(f)?f:null;j&&r.preCheckBenchmark(i,j).then(function(){h.nodeById[j].benchmarkValid=!0,h.nodeById[j].benchmarkError=null},function(a){h.nodeById[j].benchmarkValid=!1,h.nodeById[j].benchmarkError=a.errorMessage})}})},function(){h.removeLinks(b)}).catch(function(a){console.error(a)})},updateNodesPosition:function(b){if(b=b||[],a.isArray(b)||(b=[b]),b.length){var c=a.map(b,function(a){var b=a.getPosition();return{nodeInstanceId:this.getNodeId(a),posX:b.x,posY:b.y}},this);this.adjustPaper(),n.updateNodesPosition(this.experimentId,c)}return this},deleteNodes:function(b){var c=this;if(b=b||[],a.isArray(b)||(b=[b]),!b.length)return c;c.tooltips.hide();var d=a.map(b,function(a){return a.data.id});return n.deleteNodes(c.experimentId,d).then(function(d){c.removeNodes(b);var e=c.selectedNodes;if(e&&e.length){var f=a.filter(e,function(c){return!a.some(b,function(a){return c.id===a.id})});f.length!==e.length&&c.onSelectionChanged(f)}var h=c.focusedCell;h&&a.some(b,function(a){return a.id===h.id})?c.onFocusChanged(null):d&&a.each(d,function(a){g.reloadProps(c.experimentId,a.id)})}),c},deleteLink:function(a){this.modifyDependency(null,[a])},getRemarkById:function(a){return this.remarkById[a]},getGroupById:function(a){return this.groupById[a]},getNodeId:function(b){return(a.isFunction(b.isNode)&&b.isNode()?b.data:b).id},getNodeName:function(b){var c=a.isFunction(b.isNode)&&b.isNode()?b.data:b;return c.codeName||c.name||""},getNodeById:function(a){return this.nodeById[a]},getNodeStatus:function(a){var b;return a&&a.data&&(b=a.data.nodeInstanceStatus||a.data.status),b||"ready"},getSelectedNodes:function(){return this.selectedNodes||[]},hasSelectedNodes:function(){return this.selectedNodes&&this.selectedNodes.length>0},isSameLink:function(a,b){return a.source===b.source&&a.target===b.target&&a.outputPortId===b.outputPortId&&a.inputPortId===b.inputPortId},getLinkId:function(b){var c=a.isFunction(b.isLink)&&b.isLink()?b.data:b;return c.source+"-"+c.outputPortId+"-"+c.target+"-"+c.inputPortId},getLinkById:function(a){return this.linkById[a]},getLinksByNode:function(b,c){var d=[];if(b){var e=c?b.inPorts:b.outPorts;a.each(e,function(b){var e=b.id;a.each(this.linkById,function(a){var b=a.data;(c&&b.inputPortId===e||!c&&b.outputPortId===e)&&d.push(a)})},this)}return d},getPortById:function(a){return this.portById[a]},isAncestor:function(b,c){var d=b&&b.parents||[];return 0!==d.length&&(a.indexOf(d,c.id)>=0||a.some(d,function(a){return this.isAncestor(this.getPortById(a),c)},this))},canConnect:function(a,b){return!(a.type!==b.type||!b.isMultiIn&&b.parents.length||this.isAncestor(a,b))},getNearestConnPort:function(a){var b=null,c=a.sourcePort,d=a.targetNode,e=a.targetView;if(c&&d&&e){var f=Number.MAX_SAFE_INTEGER,g=new panejs.geometry.Point(a.localX,a.localY);panejs.utils.forEach(d.getInPorts(),function(a){if(this.canConnect(c,a)){var d=e.getPortBodyBBox(a,!0),h=d&&d.getCenter(),i=Math.abs(g.x-h.x);i<f&&(b=a,f=i)}},this)}return b},adjustPaper:function(){this.model.isUpdated()&&this.paperScroll.adjustPaper()},toLocalPoint:function(a){if(this.paper)return this.paper.toLocalPoint(a)},showMaskLoading:function(){return this.$maskLoading||(this.maskQueue=0,this.$maskLoading=$(x()).appendTo(document.body)),this.maskQueue+=1,this},hideMaskLoading:function(){return this.$maskLoading&&(this.maskQueue-=1,this.maskQueue<=0&&(this.$maskLoading.remove(),this.$maskLoading=null)),this},saveCanvasStatus:function(){var a=m.keys.canvasStatus,b=m.getObject(a),c=b[this.experimentId];return c||(c=b[this.experimentId]={}),c.sx=this.paper.sx,c.sy=this.paper.sy,c.scrollLeft=this.paperScroll.scrollLeft,c.scrollTop=this.paperScroll.scrollTop,m.setObject(a,b),this},highlightDeploy:function(b){var c=this,d=c.paper,e=b.nodes,f=b.links,g=b.inPorts,h=b.outPorts,i=b.cannotDeployNodes;c.highlightDeployData=b,a.keys(c.nodeById).forEach(function(a){var b=parseInt(a,10),f="";e.indexOf(b)>=0&&(f+="pane-node-deploy"),i.indexOf(b)>=0&&(f+=" pane-node-deploy-error");var j=c.getNodeById(b);if(j){var k=d.getView(j);if(k)if(f){panejs.utils.addClass(k.elem,f);var l=k.elem.querySelectorAll(".pane-port");l&&l.length&&l.forEach(function(a){var b=parseInt(a.getAttribute("data-id"),10),c=g.indexOf(b)>=0||h.indexOf(b)>=0?"is-deploy":"is-dim";panejs.utils.addClass(a,c)})}else panejs.utils.addClass(k.elem,"pane-node-dim")}}),a.keys(c.linkById).forEach(function(a){var b=c.getLinkById(a);if(b){var e=d.getView(b);if(e){var g=f.indexOf(a)>=0?"pane-link-deploy":"pane-link-dim";panejs.utils.addClass(e.elem,g)}}}),a.keys(c.groupById).forEach(function(a){var b=c.groupById[a],e=d.getView(b);e&&panejs.utils.addClass(e.elem,"pane-group-dim")}),a.keys(this.remarkById).forEach(function(a){var b=c.remarkById[a],e=d.getView(b);e&&panejs.utils.addClass(e.elem,"pane-remark-dim")})},unHighlightDeploy:function(){var b=this,c=b.paper,d=b.highlightDeployData,e=d.nodes,f=d.links,g=d.inPorts,h=d.outPorts,i=d.cannotDeployNodes;a.keys(this.nodeById).forEach(function(a){var d=parseInt(a,10),f=b.getNodeById(d);if(f){var j=c.getView(f);if(j)if(e.indexOf(d)>=0){var k=j.elem.querySelectorAll(".pane-port");k&&k.length&&k.forEach(function(a){var b=parseInt(a.getAttribute("data-id"),10),c=g.indexOf(b)>=0||h.indexOf(b)>=0?"is-deploy":"is-dim";panejs.utils.removeClass(a,c)}),panejs.utils.removeClass(j.elem,"pane-node-deploy"),i.indexOf(d)>=0&&panejs.utils.removeClass(j.elem,"pane-node-deploy-error")}else panejs.utils.removeClass(j.elem,"pane-node-dim")}}),a.keys(this.linkById).forEach(function(a){var d=b.getLinkById(a);if(d){var e=c.getView(d);if(e){var g=f.indexOf(a)>=0?"pane-link-deploy":"pane-link-dim";panejs.utils.removeClass(e.elem,g)}}}),a.keys(b.groupById).forEach(function(a){var d=b.groupById[a],e=c.getView(d);e&&panejs.utils.removeClass(e.elem,"pane-group-dim")}),a.keys(this.remarkById).forEach(function(a){var d=b.remarkById[a],e=c.getView(d);e&&panejs.utils.removeClass(e.elem,"pane-remark-dim")}),delete b.highlightDeployData},destroy:function(){this.saveCanvasStatus(),this.selectionHandler.destroy(),this.connectionHandler.destroy(),this.hotKeys.destroy(),this.tooltips.destroy(),this.recommend.destroy(),this.globalEvent.destroy(),this.nodeContextMenu.destroy(),this.linkContextMenu.destroy(),this.blankContextMenu.destroy(),this.groupContextMenu.destroy(),this.remarkContextMenu.destroy(),this.model.destroy(),this.paper.destroy(),this.paperScroll.destroy(),this.snapLines.destroy(),this.miniMap.destroy(),a.destroy(this),this.destroyed=!0}})}),define("midway/workspace/main",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){var d=c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},e=a.escape||c;return function(a,b,c,f,g,h,i,j,k,l){var m='<div class="pai-bpmn-paper" id="j-bpmn-dag"></div><div class="pai-bpmn-top"><div class="pai-opened-experiments" id="j-opened-experiments"><span class="box"><span class="text"></span><i class="arrow-down"></i></span></div><div class="pai-bpmn-toolbars"><ul class="pai-bpmn-toolbar pai-toolbar-canvas search-btn"><li class="btnSearchNodes"><div class="tips">'+e(d("searchTips"))+'</div><span class="icon icon-search"></span></li></ul><span class="pai-bpmn-toolbar-splitter"></span><ul class="pai-bpmn-toolbar pai-toolbar-canvas"><li class="btnLocateExperiment"><div class="tips">'+e(d("locateExperimentInTree"))+'</div><span class="icon icon-lib"></span></li><li class="btnLocateModel"><div class="tips">'+e(d("locateModelDir"))+'</div><span class="icon icon-diamond"></span></li></ul><span class="pai-bpmn-toolbar-splitter"></span><ul class="pai-bpmn-toolbar pai-toolbar-canvas"><li class="btnExecuteSelectedNodes disabled"><div class="tips">'+e(d("executeSelectedNodes"))+'</div><span class="icon icon-run-v"></span></li><li class="btnGroupLoop disabled"><div class="tips">'+e(d("groupLoop"))+'</div><span class="icon icon-process"></span></li><li class="btnGroup disabled"><div class="tips">'+e(d("group"))+'</div><span class="icon icon-combine"></span></li><li class="btnUnGroup disabled"><div class="tips">'+e(d("unGroup"))+'</div><span class="icon icon-uncombine"></span></li></ul><span class="pai-bpmn-toolbar-splitter"></span><ul class="pai-bpmn-toolbar pai-toolbar-canvas"><li class="btnSecondScreen ';return a&&(m+=" hide "),m+=' "><a href="'+e(b)+'" class="link" target="_blank"><div class="tips">打开双屏窗口</div><span class="icon icon-report-24"></span></a></li><li class="btnRollbackDeleteNode"><div class="tips">'+e(d("rollbackDeleteNode"))+'</div><span class="icon icon-undo-v"></span></li><li class="btnAreaSelect"><div class="tips">'+e(d("selectModel"))+'</div><span class="icon icon-group"></span></li></ul></div></div><div class="pai-bpmn-actions"><ul><li class="btnZoomIn"><div class="tips">'+e(d("zoomIn"))+'</div><span class="icon icon-zoom-in-24"></span></li><li class="btnZoomOut"><div class="tips">'+e(d("zoomOut"))+'</div><span class="icon icon-zoom-out-24"></span></li><li class="btnFitScreen"><div class="tips">'+e(d("scaleToFitCanvas"))+'</div><span class="icon icon-fitscreen-24"></span></li><li class="btnRealSize"><div class="tips">'+e(d("realSize"))+'</div><span class="icon icon-real-size-24"></span></li><li class="btnFullscreen hide"><div class="tips">'+e(d("fullscreen"))+'</div><span class="icon icon-fullscreen"></span></li></ul></div><div class="pai-bpmn-progress pai-dag-progress hide" id="j-dag-progress"></div><div class="pai-bpmn-status hide"></div><div class="pai-bpmn-bottom"><ul class="pai-bpmn-toolbar pai-toolbar-experiment hide">',c&&!f&&(m+='<li class="btnDeploy deploy-item disabled hide '+e(g?"":"has-guide水哥说暂时屏蔽")+'" data-id="btnDeploy"><span class="icon icon-upload-l-24"></span><span class="text">'+e(d("deploy"))+'</span><ul class="pai-dropdown main-dropdown ui-popup out ui-transition top left"><li class="drop-item">离线任务<ul class="pai-dropdown sub-dropdown"><li id="forD2Tooltip"><a href="http://d2.alibaba-inc.com" target="_blank"><span class="text-item">D2</span></a><a href="https://lark.alipay.com/ai/pai/d2-experiment-deploy" class="help-icon" target="_blank"><span class="icon icon-help-o"></span></a></li><li class="deploy-mydata"><span class="text-item">金数宝</span><a href="https://lark.alipay.com/ai/pai/deploy-to-jinshubao" class="help-icon" target="_blank"><span class="icon icon-help-o"></span></a></li>',c&&h&&(m+='<li class="deploy-tmall"><a href="http://radon.tmall.com/deploy/mountPaiExperiment.htm?experimentId='+e(i)+"&userNumber="+e(j)+'&target=_blank"  target="_blank"><span class="text-item">供应链引擎</span></a></li>'),m+='</ul></li><li class="drop-item">在线任务<ul class="pai-dropdown sub-dropdown">',m+='<li class="btnDeployODPS">ODPS</li><li class="btnDeployOnService">数据市场</li></ul></li></ul><div class="deploy-guide"><div class="inner"><div class="header">部署为预测服务</div><p>支持实验直接部署为预测服务，您选定“预测”节点后点击部署，系统根据您所选定的预测节点裁剪部署分支，确定无误后发布为线上服务。</p><footer><a href="https://lark.alipay.com/laixiang.bx/doc/yijianbushu-od" target="_blank">文档详情</a><button type="button" class="btn btn-sm btn-primary">知道了</button></footer></div></div></li><li class="btnUnDeploy deploy-item disabled hide" data-id="btnUnDeploy"><span class="icon icon-publish-stop-24"></span><span class="text">'+e(d("unDeploy"))+'</span></li><li class="btnDeploying deploy-item disabled hide" data-id="btnDeploying"><div class="icon-piler"><span class="icon icon-publish-l-24"></span><span class="icon icon-rotating icon-publish-run-24"></span></div><span class="text">'+e(d("deploying"))+'</span></li><li class="btnPushDeploy deploy-item disabled hide"><a href="" target="_blank"><span class="icon icon-upload-l-24"></span><span class="text">'+e(d("pushDeploy"))+"</span></a></li>"),m+="",f?m+='\x3c!-- 在线实验相关 --\x3e<li class="onlineCompileLoading disabled online-exp-item disabled hide" title="正在编译ing" data-id="btnExecute"><span class="icon icon-loading-spinner"></span><span class="text">编译中</span></li><li class="onlineBtnCompile online-exp-item disabled hide" title="编译GitRepo中的Class" data-id="btnExecute"><span class="icon icon-publish-l-24"></span><span class="text">编译</span></li><li class="onlineBtnSubmit online-exp-item disabled hide" title="提交OnlineLearning实验" data-id="btnExecute"><span class="icon icon-upload-l-24"></span><span class="text">提交运行</span></li><li class="onlineBtnKill online-exp-item disabled hide" title="停止OnlineLearning" data-id="btnExecute"><span class="icon icon-stop-o-24"></span><span class="text">'+e(d("stop"))+'</span></li><li class="onlineBtnLog online-exp-item disabled hide" title="查看日志" data-id="btnExecute"><span class="icon icon-analysis"></span><span class="text">'+e(d("viewLog"))+'</span></li><li class="onlineBtnMonitor online-exp-item disabled hide" title="跳转查看监控" data-id="btnExecute"><span class="icon icon-report-24"></span><span class="text link">查看监控</span></li>':(m+='\x3c!-- 执行相关 --\x3e<li class="btnExecute execute-item disabled hide" title="'+e(d("executeToolTips"))+'" data-id="btnExecute"><span class="icon icon-run-o-24"></span><span class="text">'+e(d("execute"))+'</span></li><li class="btnReExecute execute-item disabled hide" title="'+e(d("recoverExeToolTips"))+'" data-id="btnReExecute"><span class="icon icon-rerun-24"></span><span class="text">'+e(d("recoverExe"))+'</span></li><li class="btnStop execute-item disabled hide" data-id="btnStop"><span class="icon icon-stop-o-24"></span><span class="text">'+e(d("stop"))+"</span></li>",l||(m+='<li class="btnReport" data-id="btnReport" title="'+e(d("viewModuleReportTips"))+'"><span class="icon icon-report-24"></span><span class="text">'+e(d("viewModuleReport"))+"</span></li>"),m+="",k&&c&&(m+='<li class="modelDoc" data-id="modelDoc" title="'+e(d("modelDocTip"))+'"><span class="icon icon-analysis"></span><span class="text">'+e(d("modelDoc"))+"</span></li>"),m+=""),m+="</ul></div>"}(b.notInWhiteList,b.sanchoLink,b.isInternal,b.isOnlineExperiment,b.hideDeployGuide,b.isTmall,b.expId,b.userId,b.isAntUser,b.hideModuleReport)}}),define("workspace/panel",["zero","zero/zero","../i18n","../storage/persistence","../global/notice","../global/notify","../global/event","../global/environment","../storage/globalCache","./metadata","./toolbar","./statusBar","./statusTicker","./progressBarDag","./executor","./deployer","./deployTicker","./yunqiSharer","./yunqiCreator","./locker","./canvas","../ajax/experiment","../midway/workspace/main"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";function x(a){document.title=a}var y=a.Popup,z=c.translate,A=z("brand"),B=d.getBoolean(d.keys.hideDeployGuide,!1),C=d.getBoolean(d.keys.hideBenchmarkGuide,!1),D=0,E=0,F={workspace:"#j-workspace",container:"#j-bpmn",canvas:"#j-bpmn-dag",tab:"#j-bpmn-tab li",openedExp:"#j-opened-experiments",btnExecute:"#j-bpmn .pai-bpmn-bottom .btnExecute",experiment:".pai-bpmn-paper",toolbarCanvas:".pai-bnpm-actions",toolbarExperiment:".pai-toolbar-experiment"},G={isEmpty:"is-empty"},H=null,I=null,J={isEmpty:!0,open:function(a){var c=a.id;E!==c&&D!==c&&(D=c,J.isEmpty?J.init(a):(J.close(),J.reloadToolBar()),J.isEmpty=!1,n.start(),j.show(a),m.init(a),o.init(a),l.initializing(),r.init(a),s.init(a),h.isInternal&&(q.init(a),p.init(a)),H=new u($(F.canvas)[0]),H.load(a).then(function(a){D=0,E=c,k.enable(),n.end(),l.hide(),m.tick(),h.isInternal&&q.tick(),t.init(a)}),$(F.workspace).removeClass(G.isEmpty),x(b.unescape(a.name)+" - "+A))},close:function(){E=0,j.hide(),k.disable(),l.hide(),m.clean(),n.end(),o.clean(),r.clean(),h.isInternal&&p.clean(),t.clean(),H&&H.destroy(),H=null},reloadToolBar:function(a){a=a||{};var b=window.verCtrl(["internal"],"tmall",{cache:!0,sync:!0}),c=window.GLOBALS.isAntUser,d=c&&("true"===window.GLOBALS.isOnline||!0===window.GLOBALS.isOnline);d!==I&&(k.reloadBottomToolbar({hideDeployGuide:B,hideBenchmarkGuide:C,hideMPS:!0,isInternal:h.isInternal,hideModuleReport:h.isAliyun,isAntUser:c,isOnlineExperiment:d,monitorUrl:window.GLOBALS.monitorUrl,expId:a.id,userId:window.GLOBALS.userId,isTmall:b}),I=d)},init:function(a){if(a=a||{},J.isEmpty){var b=window.verCtrl(["internal"],"tmall",{cache:!0,sync:!0}),c=window.GLOBALS.isAntUser;I=c&&("true"===window.GLOBALS.isOnline||!0===window.GLOBALS.isOnline);var d=-1===[].concat(window.GLOBALS.whitelist_2||[]).indexOf(window.GLOBALS.userId||window.userNumber),e="/sancho/view?test=true&experimentId="+a.id,f=$(F.container).html(w({sanchoLink:e,hideDeployGuide:B,hideBenchmarkGuide:C,hideMPS:!0,notInWhiteList:d,isInternal:h.isInternal,hideModuleReport:h.isAliyun,isAntUser:c,isOnlineExperiment:I,monitorUrl:window.GLOBALS.monitorUrl,expId:a.id,userId:window.GLOBALS.userId,isTmall:b}));f.find(F.toolbarCanvas).find("li").each(function(){var a=$(this);a.attr("title")&&new y(a,{position:"middle right",align:"center"})}),f.find(F.toolbarExperiment).find("li").each(function(){var a=$(this);if(a.attr("title")){var b=new y(a,{position:"top left",align:"left",gap:-6,offset:11});a.on("mouseover",".pai-guide",function(){b.delayedHide()})}})}},empty:function(){J.close(),J.isEmpty=!0,$(F.container).html(""),$(F.workspace).addClass(G.isEmpty),n.destroy(),g.showTemplatePanel(),x(A)}};return J}),define("midway/workspace/experimentList",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){return null===a||void 0===a?"":a},d=a.escape||c;return function(b,c,e){var f='<ul class="pai-dropdown">';return a.each(b,function(a){f+="";var b=c===a.id;f+='<li data-id="'+d(a.id)+'" '+d(b?"class=selected":"")+">",b&&(f+='<span class="icon icon-ok-l i-checked"></span>'),f+='<span class="text-item">'+d(a.name)+'</span><span class="btn-close icon icon-close-l"></span></li>'}),f+="</ul>"}(b.list,b.activeId,b.isCurrent)}}),define("workspace/openedExperiments",["zero","zero/zero","zero/querystring","../i18n","../storage/persistence","../storage/globalCache","../storage/openedExperimentsCache","../global/notify","../global/config","../global/utils","../global/event","../global/newFeatureIntro","../ajax/experiment","../ajax/document","../ajax/git","../workspace/panel","../midway/workspace/experimentList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){if(g.clean(),!S.length)return V=0,D();if(window.location.href.indexOf("/admin")>-1){S.some(function(a){return a.id===V})||(S[0].name="admin查看实验",S[0].id=parseInt(L.experimentId,10))}g.add(S),V&&g.get(V)||(V=S[0].id),z(V,a)}function s(){$(P.container).find(P.dropdown).remove().end().removeClass(Q.hide).append(q({activeId:V,list:S}))}function t(a){if(!a){var b=g.get(V);a=b&&b.name}a&&$(P.container).find(P.text).html(a)}function u(a){a.stopPropagation(),$(P.container).removeClass(Q.isOpened);var b=parseInt($(this).attr("data-id"),10);if(b!==V){V=b;var c=g.get(b);c&&w(c)}}function v(a){a.stopPropagation();var b=parseInt($(this).parent().attr("data-id"),10);m.close([b]),C(b,!0)}function w(a){function b(){m.open(c).then(function(a){H(a),g.add(a),S.unshift(a),V=c,U=0,r()})}var c=a.id;if(U!==c){U=c,x(c);var d=S.length;if(d>=R){var e=S[d-1],f=e.id;m.close([f]).then(function(){k.closeExperiment(e),x(f),b()})}else b()}}function x(a){g.del(a);for(var b=S.length-1;b>=0;b--)S[b].id===a&&S.splice(b,1)}function y(a){$(P.container).find(P.item).filter("[data-id="+a+"]").remove()}function z(a,b){window.verCtrl(["internal"],"mydds",{cache:!0,async:!0,ajaxData:{projectName:window.currentProjectName||window.currentProject}}).then(function(c){window.verCtrl(["antUser"],"onlineLearning")?n.isOnlineExperiment(a).then(function(c){c?o.getGitBaseInfoByExperiment(a).then(function(){A(a,b,c)}):A(a,b,!1)}):A(a,b,!1)})}function A(a,b,c){var d=g.get(a),e=p.isEmpty;if(d){d.isOnline=c,p.open(d),e&&F();var h=j.changeURLArg(window.location.href,"experimentId",a);b||E(a,h),f.set(f.keys.hasOpenedExperiment,!0),k.unfreezeToolbox(!1),t(),s(),B(a)}}function B(a){if(window.Tracert)try{window._to&&(window._to.mdata=window._to.mdata||{},window._to.mdata.expId=a),window.Tracert.call("set",window._to)}catch(a){console.warn(a)}}function C(a,b){function c(){h.remove(),d&&(d.addClass(Q.selected),t())}var d,e,f=$(P.container).find(P.item),h=f.filter("[data-id="+a+"]"),i=h.index(),j=S.length,l=g.get(a);if(k.closeExperiment(l),a===V){if(V=0,1===j&&S[0].id===a)return S=[],g.clean(),void r();j>1&&(e=0===i?i+1:i-1,d=f.eq(e),V=parseInt(d.attr("data-id"),10),z(V))}x(a),b?h.onCSSTransitionEnd(c).addClass(Q.fade):c()}function D(){G(),p.empty(),E(0,j.deleteURLArg(window.location.href,"experimentId")),f.set(f.keys.hasOpenedExperiment,!1),k.allExperimentClosed(),k.freezeToolbox()}function E(a,b){if(history.pushState){var c=document.title,d=g.get(a)||{},e={url:b,id:a,name:d.name,title:c};window.history.pushState(e,c,b)}}function F(){$(P.container).on("mouseenter",P.text,function(){K||(K=l({storageKey:"selectExperiment",$parent:$(this)}))}).on("click"+O,function(){K&&K.remove(),$(P.container).toggleClass(Q.isOpened)}).on("click"+O,P.item,u).on("click"+O,P.itemClose,v),$(document).on("click"+O,function(a){var b=$(P.container);b.is(a.target)||$.contains(b[0],a.target)||b.removeClass(Q.isOpened)}),$(window).on("popstate"+O,function(){var a=history&&history.state;a&&a.id&&w({id:a.id,name:a.name})})}function G(){$(P.container).off(O),$(document).off(O),$(window).off(O),K&&(K.remove(),K=null)}function H(a){return N(a)||(a=[a]),M(a,function(a){a.description=a.description||"",a.createDate=a.gmtCreate}),a}function I(a,b){V===a&&t(b);var c=g.get(a);c&&(c.name=b,s())}function J(a){N(a)||(a=[a]);var b=!1;M(a,function(a){if(V===a)return void(b=!0);g.get(a)&&(x(a),y(a))}),b&&C(V)}var K,L,M=(a.Popup,b.each),N=b.isArray,O=(d.translate,".opened-experiments"),P={container:"#j-opened-experiments",dropdown:".pai-dropdown",itemClose:".btn-close",item:"li",text:".text"},Q={hide:"hide",fade:"fade",isOpened:"is-opened",selected:"selected"},R=i.maxExperimentsCount,S=[],T=!1,U=0,V=function(){var a,b=window.location.search;return b.length>0&&(b=b.substr(1),L=c.parse(b),a=L&&L.experimentId?parseInt(L.experimentId,10):0,T=a>0),a||0}();k.onTryOpenExperiment(w),k.onExperimentRenamed(I),k.onExperimentsDeleted(J),m.queryOpenedExperiment().then(H).then(function(a){S=a||[],r()}).then(function(){k.experimentsLoaded()}),p.closeExperiment=C}),define("ajax/report",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/report.json");return{createEvaluationReport:function(a,b){return c.post({method:"createEvaluationReport",experimentId:a,operations:JSON.stringify(b)}).then(function(a){return a})},updateEvaluationReport:function(a,b){return c.post({method:"updateEvaluationReport",reportId:a,operations:JSON.stringify(b)}).then(function(a){return a.operationsMap})}}}),define("workspace/report",["zero/zero","zero/querystring","../global/event","../ajax/report","../storage/persistence","../storage/globalCache"],function(a,b,c,d,e,f){"use strict";function g(a){var c=a.experimentId,d=i[a.reportType],f=window.location.search?window.location.search.slice(1):"",g=h(),j=void 0!==a.otherExperiment?a.otherExperiment:!!c;f=b.parse(f),j?f.experimentId=c:(f.experimentId=f.experimentId||e.get(e.keys.activeExperimentId),f.selectedNodes=JSON.stringify(g)),f.reportType=d,f.test=!0,window.open("/modelReport/evaluation?"+b.stringify(f),"_blank")}function h(){var a=f.get(f.keys.selectedNodes)||[];return a=a.map(function(a){return a.data&&a.data.id})}var i={performance:2,module:1};c.onGenerateReport(g)}),define("midway/workspace/onlineDeployMask",["zero/zero","zero/html/utils","zero/i18n"],function(a,b,c){c.translate;return function(b){b=b||{};var c=function(a){
return null===a||void 0===a?"":a},d=a.escape||c;return function(a,b){return'<div class="online-deploy-mask online-deploy-mask-bpmn"><div class="actions"><a class="btn btn-primary btn-ok" href="/onlineDeploy#/config/'+d(a)+"/"+d(b)+'" target="_blank">确认</a><button type="button" class="btn btn-close">取消</button></div></div>'}(b.experimentId,b.nodeInstanceId)}}),define("workspace/onlineDeployMask",["zero","zero/zero","../global/event","../ajax/onlineDeploy","../midway/workspace/onlineDeployMask"],function(a,b,c,d,e){var f={nav:"#j-nav",toolbox:"#j-toolbox",bpmn:"#j-bpmn",properties:"#j-properties",mask:".online-deploy-mask",bpmnActions:".pai-bnpm-actions",btnOk:".btn-ok",btnClose:".btn-close",btnConfig:".btn-config"},g={hide:"hide",disabled:"disabled",hideScroll:"hide-scroll"},h=!1;window.addEventListener("popstate",function(){h&&c.unHighlightDeployNode()}),c.onHighlightDeployNode(function(b){function d(){j&&(j.isHidden()?j.destroy():j.delayedHide(),j=null)}h=!0,$(f.nav).append('<div class="online-deploy-mask"></div>'),$(f.toolbox).append('<div class="online-deploy-mask"></div>').addClass(g.hideScroll),$(f.properties).append('<div class="online-deploy-mask"></div>').addClass(g.hideScroll);var i=$(f.bpmn).append(e(b)).addClass(g.hideScroll),j=null;if(i.find(f.mask).on("click",f.btnOk,function(){$(this).hasClass(g.disabled)||(d(),c.unHighlightDeployNode())}).on("click",f.btnClose,function(){d(),c.unHighlightDeployNode()}),b.cannotDeployNodes&&b.cannotDeployNodes.length){var k=i.find(f.mask).find(f.btnOk);k.addClass(g.disabled),j=new a.Popup(k[0],{position:"top left",align:"left",escape:!1,gap:10,offset:18,content:"<div><p>当前部分节点不支持预测服务，</p><p>如有需求请联系 @宗水，@来香</p></div>",onHidden:function(){setTimeout(this.destroy.bind(this),10)}})}i.find(f.bpmnActions).addClass(g.hide)}),c.onUnHighlightDeployNode(function(){h=!1,$(f.nav).find(f.mask).remove(),$(f.toolbox).removeClass(g.hideScroll).find(f.mask).remove(),$(f.properties).removeClass(g.hideScroll).find(f.mask).remove();var a=$(f.bpmn).removeClass(g.hideScroll);a.find(f.mask).off().remove(),a.find(f.bpmnActions).removeClass(g.hide)})}),define("workspace/main",["zero/zero","./openedExperiments","./report","./onlineDeployMask"],function(){}),define("global/consoleMessage",["zero/zero","./environment"],function(a,b){"use strict"}),define("ajax/userBehavior",["zero/zero","./base"],function(a,b){"use strict";var c=b.create("/logUserBehavior.json");return{doLog:function(a,b){return c.post({method:"doLog",target:a,action:b})}}}),define("global/logUserAction",["zero/zero","../ajax/userBehavior"],function(a,b){"use strict";var c=b.doLog;window.doLog=c}),define("toolbox/toggle",["zero/zero","../storage/persistence","../storage/globalCache","../global/config","../global/event","../layout/container"],function(a,b,c,d,e){"use strict";function f(a){var b=$(m.workspace),c=b.hasClass(n.isOpened);a!==c&&(b.toggleClass(n.isOpened),window.react_bridge&&window.react_bridge.actions.tabs.common.toggleToolbox({hideTool:c}),a?e.showToolbox():e.hideToolbox())}function g(){$(m.workspace).addClass("is-opened")}function h(a){a?($(m.tabWrap).on("mouseenter"+o,r),$(m.mickey).on("mouseenter"+o,r),$(m.toolbox).on("mouseenter"+o,r)):($(m.tabWrap).off(o),$(m.rTabWrap).off(o),$(m.toolbox).off(o)),p=a}function i(){return c.get(c.keys.hasOpenedExperiment,!1)}function j(a){q||(f(a),p&&h(!1))}function k(a){q||(p||!i()||h(!0),f(a))}function l(){$(document.body).outerWidth()>1281?(h(!1),e.offToolboxFreezed(j),e.offToolboxUnfreezed(k),e.offCanvasFocused(s),e.offNodeFocused(s),e.offLinkFocused(s)):(f(!i()),h(!0),e.onToolboxFreezed(j),e.onToolboxUnfreezed(k),e.onCanvasFocused(s),e.onNodeFocused(s),e.onLinkFocused(s))}var m={tabWrap:"#j-nav",rTabWrap:"#nav",mickey:"#mickey",toolbox:"#j-toolbox",stamp:"#j-toolbox-mask",workspace:"#j-workspace",paper:".pai-bpmn-paper",svg:"svg",nodeContent:".content",connection:".connection-wrap"},n={hide:"hide",isOpened:"is-opened"},o=".toolbox-toggle",p=!1,q=d.forceFreezeToolbox,r=a.bind(f,null,!0),s=a.bind(f,null,!1);e.onWindowResize(l),e.onTemplatePanelShowed(function(){j(!0),e.offWindowResize(l)}),e.onTemplatePanelHided(function(){k(!0),e.onWindowResize(l)}),e.onLocateModel(function(){}),e.onLocateExperiment(function(){q=!0,g()}),e.onLocateExperimentByModel(function(){f(!0)}),l()}),define("main",["../experiment/global/checkRefresh","../../lib/zero-components/dist/zero-components.js","zero/zero","zero/ui/onCSSAnimationEnd","./global/validation","./i18n","./layout/main","./toolbox/main","./properties/main","./workspace/main","./global/consoleMessage","./global/newFeatureIntro","./global/logUserAction","./toolbox/toggle"],function(){function a(a){var b=a.key,c=a.newValue||"{}";if("sancho_config"===b)try{const d=JSON.parse(c)||{};Object.keys(d).forEach(function(a){window.GLOBALS&&(window.GLOBALS[a]=d[a])})}catch(a){console.warn(a)}}window.addEventListener("storage",a);var b=JSON.parse(localStorage.getItem("sancho_config")||"{}");!0!==b.sync&&!1!==b.sync?(localStorage.setItem("sancho_config",'{"sync":false}'),window.GLOBALS.sync=!1):window.GLOBALS.sync=b.sync});
//# sourceMappingURL=src/source.map